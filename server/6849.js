var __defProp=Object.defineProperty,__name=(target,value)=>__defProp(target,"name",{value,configurable:!0});exports.id=6849,exports.ids=[6849],exports.modules={49829:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{zQ:()=>AngularFireAuth,ww:()=>AngularFireAuthModule,Qv:()=>USE_EMULATOR});var core=__webpack_require__(37716),Subject=__webpack_require__(79765),of=__webpack_require__(25917),Observable=__webpack_require__(18891),from=__webpack_require__(94402),merge=__webpack_require__(66682),switchMap=__webpack_require__(43190);function switchMapTo(innerObservable,resultSelector){return resultSelector?(0,switchMap.w)(()=>innerObservable,resultSelector):(0,switchMap.w)(()=>innerObservable)}__name(switchMapTo,"switchMapTo");var observeOn=__webpack_require__(59746),map=__webpack_require__(88002),shareReplay=__webpack_require__(47349),first=__webpack_require__(28049),subscribeOn=__webpack_require__(49673),filter=__webpack_require__(45435),angular_fire=__webpack_require__(50057),common=__webpack_require__(38583);const USE_EMULATOR=new core.OlP("angularfire2.auth.use-emulator"),SETTINGS=new core.OlP("angularfire2.auth.settings"),TENANT_ID=new core.OlP("angularfire2.auth.tenant-id"),LANGUAGE_CODE=new core.OlP("angularfire2.auth.langugage-code"),USE_DEVICE_LANGUAGE=new core.OlP("angularfire2.auth.use-device-language"),PERSISTENCE=new core.OlP("angularfire.auth.persistence");class AngularFireAuth{constructor(options,nameOrConfig,platformId,zone,_useEmulator,_settings,tenantId,languageCode,useDeviceLanguage,persistence){const schedulers=new angular_fire.HU(zone),keepUnstableUntilFirst=(0,angular_fire.ss)(schedulers),logins=new Subject.xQ,auth=(0,of.of)(void 0).pipe((0,observeOn.QV)(schedulers.outsideAngular),(0,switchMap.w)(()=>zone.runOutsideAngular(()=>Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,3977,23)))),(0,map.U)(()=>(0,angular_fire.on)(options,zone,nameOrConfig)),(0,map.U)(app=>zone.runOutsideAngular(()=>{const useEmulator=_useEmulator,settings=_settings;return(0,angular_fire.sI)(`${app.name}.auth`,"AngularFireAuth",app,()=>{const auth2=zone.runOutsideAngular(()=>app.auth());return useEmulator&&auth2.useEmulator(`http://${useEmulator.join(":")}`),tenantId&&(auth2.tenantId=tenantId),auth2.languageCode=languageCode,useDeviceLanguage&&auth2.useDeviceLanguage(),settings&&(auth2.settings=settings),persistence&&auth2.setPersistence(persistence),auth2},[useEmulator,tenantId,languageCode,useDeviceLanguage,settings,persistence])})),(0,shareReplay.d)({bufferSize:1,refCount:!1}));if((0,common.PM)(platformId))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,of.of)(null);else{auth.pipe((0,first.P)()).subscribe();const redirectResult=auth.pipe((0,switchMap.w)(auth2=>auth2.getRedirectResult().then(it=>it,()=>null)),keepUnstableUntilFirst,(0,shareReplay.d)({bufferSize:1,refCount:!1})),fromCallback=__name(cb=>new Observable.y(subscriber=>({unsubscribe:zone.runOutsideAngular(()=>cb(subscriber))})),"fromCallback"),authStateChanged=auth.pipe((0,switchMap.w)(auth2=>fromCallback(auth2.onAuthStateChanged.bind(auth2)))),idTokenChanged=auth.pipe((0,switchMap.w)(auth2=>fromCallback(auth2.onIdTokenChanged.bind(auth2))));this.authState=redirectResult.pipe(switchMapTo(authStateChanged),(0,subscribeOn.R)(schedulers.outsideAngular),(0,observeOn.QV)(schedulers.insideAngular)),this.user=redirectResult.pipe(switchMapTo(idTokenChanged),(0,subscribeOn.R)(schedulers.outsideAngular),(0,observeOn.QV)(schedulers.insideAngular)),this.idToken=this.user.pipe((0,switchMap.w)(user=>user?(0,from.D)(user.getIdToken()):(0,of.of)(null))),this.idTokenResult=this.user.pipe((0,switchMap.w)(user=>user?(0,from.D)(user.getIdTokenResult()):(0,of.of)(null))),this.credential=(0,merge.T)(redirectResult,logins,this.authState.pipe((0,filter.h)(it=>!it))).pipe((0,map.U)(credential=>(null==credential?void 0:credential.user)?credential:null),(0,subscribeOn.R)(schedulers.outsideAngular),(0,observeOn.QV)(schedulers.insideAngular))}return(0,angular_fire.pX)(this,auth,zone,{spy:{apply:(name,_,val)=>{(name.startsWith("signIn")||name.startsWith("createUser"))&&val.then(user=>logins.next(user))}}})}}__name(AngularFireAuth,"AngularFireAuth"),AngularFireAuth.\u0275fac=__name(function(t){return new(t||AngularFireAuth)(core.LFG(angular_fire.Dh),core.LFG(angular_fire.xv,8),core.LFG(core.Lbi),core.LFG(core.R0b),core.LFG(USE_EMULATOR,8),core.LFG(SETTINGS,8),core.LFG(TENANT_ID,8),core.LFG(LANGUAGE_CODE,8),core.LFG(USE_DEVICE_LANGUAGE,8),core.LFG(PERSISTENCE,8))},"AngularFireAuth_Factory"),AngularFireAuth.ctorParameters=()=>[{type:void 0,decorators:[{type:core.tBr,args:[angular_fire.Dh]}]},{type:void 0,decorators:[{type:core.FiY},{type:core.tBr,args:[angular_fire.xv]}]},{type:Object,decorators:[{type:core.tBr,args:[core.Lbi]}]},{type:core.R0b},{type:void 0,decorators:[{type:core.FiY},{type:core.tBr,args:[USE_EMULATOR]}]},{type:void 0,decorators:[{type:core.FiY},{type:core.tBr,args:[SETTINGS]}]},{type:void 0,decorators:[{type:core.FiY},{type:core.tBr,args:[TENANT_ID]}]},{type:void 0,decorators:[{type:core.FiY},{type:core.tBr,args:[LANGUAGE_CODE]}]},{type:void 0,decorators:[{type:core.FiY},{type:core.tBr,args:[USE_DEVICE_LANGUAGE]}]},{type:void 0,decorators:[{type:core.FiY},{type:core.tBr,args:[PERSISTENCE]}]}],AngularFireAuth.\u0275prov=(0,core.Yz7)({factory:__name(function(){return new AngularFireAuth((0,core.LFG)(angular_fire.Dh),(0,core.LFG)(angular_fire.xv,8),(0,core.LFG)(core.Lbi),(0,core.LFG)(core.R0b),(0,core.LFG)(USE_EMULATOR,8),(0,core.LFG)(SETTINGS,8),(0,core.LFG)(TENANT_ID,8),(0,core.LFG)(LANGUAGE_CODE,8),(0,core.LFG)(USE_DEVICE_LANGUAGE,8),(0,core.LFG)(PERSISTENCE,8))},"AngularFireAuth_Factory"),token:AngularFireAuth,providedIn:"any"}),(0,angular_fire.GT)(AngularFireAuth,[{app:null,applyActionCode:null,checkActionCode:null,confirmPasswordReset:null,createUserWithEmailAndPassword:null,currentUser:null,fetchSignInMethodsForEmail:null,isSignInWithEmailLink:null,getRedirectResult:null,languageCode:null,settings:null,onAuthStateChanged:null,onIdTokenChanged:null,sendSignInLinkToEmail:null,sendPasswordResetEmail:null,setPersistence:null,signInAndRetrieveDataWithCredential:null,signInAnonymously:null,signInWithCredential:null,signInWithCustomToken:null,signInWithEmailAndPassword:null,signInWithPhoneNumber:null,signInWithEmailLink:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,tenantId:null,updateCurrentUser:null,useDeviceLanguage:null,useEmulator:null,verifyPasswordResetCode:null}]);class AngularFireAuthModule{}__name(AngularFireAuthModule,"AngularFireAuthModule"),AngularFireAuthModule.\u0275fac=__name(function(t){return new(t||AngularFireAuthModule)},"AngularFireAuthModule_Factory"),AngularFireAuthModule.\u0275mod=core.oAB({type:AngularFireAuthModule}),AngularFireAuthModule.\u0275inj=core.cJS({providers:[AngularFireAuth]})},96849:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{KQ:()=>AngularFireDatabase,JS:()=>AngularFireDatabaseModule});var core=__webpack_require__(37716),scheduler_async=__webpack_require__(33637),Observable=__webpack_require__(18891),of=__webpack_require__(25917),merge=__webpack_require__(66682),Subscriber=__webpack_require__(77393);function skipWhile(predicate){return source=>source.lift(new SkipWhileOperator(predicate))}__name(skipWhile,"skipWhile");class SkipWhileOperator{constructor(predicate){this.predicate=predicate}call(subscriber,source){return source.subscribe(new SkipWhileSubscriber(subscriber,this.predicate))}}__name(SkipWhileOperator,"SkipWhileOperator");class SkipWhileSubscriber extends Subscriber.L{constructor(destination,predicate){super(destination),this.predicate=predicate,this.skipping=!0,this.index=0}_next(value){const destination=this.destination;this.skipping&&this.tryCallPredicate(value),this.skipping||destination.next(value)}tryCallPredicate(value){try{const result=this.predicate(value,this.index++);this.skipping=Boolean(result)}catch(err){this.destination.error(err)}}}__name(SkipWhileSubscriber,"SkipWhileSubscriber");var map=__webpack_require__(88002),share=__webpack_require__(78345),switchMap=__webpack_require__(43190),scan=__webpack_require__(42145),distinctUntilChanged=__webpack_require__(87519),withLatestFrom=__webpack_require__(57057),angular_fire=__webpack_require__(50057),angular_fire_auth=(__webpack_require__(96550),__webpack_require__(49829)),dist_index_cjs=__webpack_require__(24395),dist_index_cjs_default=__webpack_require__.n(dist_index_cjs);function isString(value){return"string"==typeof value}function isFirebaseDataSnapshot(value){return"function"==typeof value.exportVal}function isNil(obj){return null==obj}function isFirebaseRef(value){return"function"==typeof value.set}function getRef(database,pathRef){return isFirebaseRef(pathRef)?pathRef:database.ref(pathRef)}function checkOperationCases(item,cases){if(isString(item))return cases.stringCase();if(isFirebaseRef(item))return cases.firebaseCase();if(isFirebaseDataSnapshot(item))return cases.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof item)}function fromRef(ref,event,listenType="on",scheduler=scheduler_async.z){return new Observable.y(subscriber=>{let fn=null;return fn=ref[listenType](event,(snapshot,prevKey)=>{scheduler.schedule(()=>{subscriber.next({snapshot,prevKey})}),"once"===listenType&&scheduler.schedule(()=>subscriber.complete())},err=>{scheduler.schedule(()=>subscriber.error(err))}),"on"===listenType?{unsubscribe(){null!=fn&&ref.off(event,fn)}}:{unsubscribe(){}}}).pipe((0,map.U)(payload=>{const{snapshot,prevKey}=payload;let key=null;return snapshot.exists()&&(key=snapshot.key),{type:event,payload:snapshot,prevKey,key}}),(0,share.B)())}function listChanges(ref,events,scheduler){return fromRef(ref,"value","once",scheduler).pipe((0,switchMap.w)(snapshotAction=>{const childEvent$=[(0,of.of)(snapshotAction)];return events.forEach(event=>childEvent$.push(fromRef(ref,event,"on",scheduler))),(0,merge.T)(...childEvent$).pipe((0,scan.R)(buildView,[]))}),(0,distinctUntilChanged.x)())}function positionFor(changes,key){const len=changes.length;for(let i=0;i<len;i++)if(changes[i].payload.key===key)return i;return-1}function positionAfter(changes,prevKey){if(isNil(prevKey))return 0;{const i=positionFor(changes,prevKey);return-1===i?changes.length:i+1}}function buildView(current,action){const{payload,prevKey,key}=action,currentKeyPosition=positionFor(current,key),afterPreviousKeyPosition=positionAfter(current,prevKey);switch(action.type){case"value":if(action.payload&&action.payload.exists()){let prevKey2=null;action.payload.forEach(payload2=>{const action2={payload:payload2,type:"value",prevKey:prevKey2,key:payload2.key};return prevKey2=payload2.key,current=[...current,action2],!1})}return current;case"child_added":if(currentKeyPosition>-1){const previous=current[currentKeyPosition-1];(previous&&previous.key||null)!==prevKey&&(current=current.filter(x=>x.payload.key!==payload.key)).splice(afterPreviousKeyPosition,0,action)}else{if(null==prevKey)return[action,...current];(current=current.slice()).splice(afterPreviousKeyPosition,0,action)}return current;case"child_removed":return current.filter(x=>x.payload.key!==payload.key);case"child_changed":return current.map(x=>x.payload.key===key?action:x);case"child_moved":if(currentKeyPosition>-1){const data=current.splice(currentKeyPosition,1)[0];return(current=current.slice()).splice(afterPreviousKeyPosition,0,data),current}return current;default:return current}}function validateEventsArray(events){return(isNil(events)||0===events.length)&&(events=["child_added","child_removed","child_changed","child_moved"]),events}function snapshotChanges(query,events,scheduler){return listChanges(query,events=validateEventsArray(events),scheduler)}function stateChanges(query,events,scheduler){const childEvent$=(events=validateEventsArray(events)).map(event=>fromRef(query,event,"on",scheduler));return(0,merge.T)(...childEvent$)}function auditTrail(query,events,scheduler){return waitForLoaded(query,stateChanges(query,events).pipe((0,scan.R)((current,action)=>[...current,action],[])),scheduler)}function loadedData(query,scheduler){return fromRef(query,"value","on",scheduler).pipe((0,map.U)(data=>{let lastKeyToLoad;return data.payload.forEach(child=>(lastKeyToLoad=child.key,!1)),{data,lastKeyToLoad}}))}function waitForLoaded(query,action$,scheduler){return loadedData(query,scheduler).pipe((0,withLatestFrom.M)(action$),(0,map.U)(([loaded,actions])=>{const lastKeyToLoad=loaded.lastKeyToLoad,loadedKeys=actions.map(snap=>snap.key);return{actions,lastKeyToLoad,loadedKeys}}),skipWhile(meta=>-1===meta.loadedKeys.indexOf(meta.lastKeyToLoad)),(0,map.U)(meta=>meta.actions))}function createDataOperationMethod(ref,operation){return __name(function(item,value){return checkOperationCases(item,{stringCase:()=>ref.child(item)[operation](value),firebaseCase:()=>item[operation](value),snapshotCase:()=>item.ref[operation](value)})},"dataOperation")}function createRemoveMethod(ref){return __name(function(item){return item?checkOperationCases(item,{stringCase:()=>ref.child(item).remove(),firebaseCase:()=>item.remove(),snapshotCase:()=>item.ref.remove()}):ref.remove()},"remove")}function createListReference(query,afDatabase){const outsideAngularScheduler=afDatabase.schedulers.outsideAngular,refInZone=afDatabase.schedulers.ngZone.run(()=>query.ref);return{query,update:createDataOperationMethod(refInZone,"update"),set:createDataOperationMethod(refInZone,"set"),push:data=>refInZone.push(data),remove:createRemoveMethod(refInZone),snapshotChanges:events=>snapshotChanges(query,events,outsideAngularScheduler).pipe(afDatabase.keepUnstableUntilFirst),stateChanges:events=>stateChanges(query,events,outsideAngularScheduler).pipe(afDatabase.keepUnstableUntilFirst),auditTrail:events=>auditTrail(query,events,outsideAngularScheduler).pipe(afDatabase.keepUnstableUntilFirst),valueChanges:(events,options)=>snapshotChanges(query,events,outsideAngularScheduler).pipe((0,map.U)(actions=>actions.map(a=>options&&options.idField?Object.assign(Object.assign({},a.payload.val()),{[options.idField]:a.key}):a.payload.val())),afDatabase.keepUnstableUntilFirst)}}function createObjectSnapshotChanges(query,scheduler){return __name(function(){return fromRef(query,"value","on",scheduler)},"snapshotChanges")}function createObjectReference(query,afDatabase){return{query,snapshotChanges:()=>createObjectSnapshotChanges(query,afDatabase.schedulers.outsideAngular)().pipe(afDatabase.keepUnstableUntilFirst),update:data=>query.ref.update(data),set:data=>query.ref.set(data),remove:()=>query.ref.remove(),valueChanges:()=>createObjectSnapshotChanges(query,afDatabase.schedulers.outsideAngular)().pipe(afDatabase.keepUnstableUntilFirst,(0,map.U)(action=>action.payload.exists()?action.payload.val():null))}}__name(isString,"isString"),__name(isFirebaseDataSnapshot,"isFirebaseDataSnapshot"),__name(isNil,"isNil"),__name(isFirebaseRef,"isFirebaseRef"),__name(getRef,"getRef"),__name(checkOperationCases,"checkOperationCases"),__name(function(){},"SnapshotPrevKey"),__name(fromRef,"fromRef"),__name(listChanges,"listChanges"),__name(positionFor,"positionFor"),__name(positionAfter,"positionAfter"),__name(buildView,"buildView"),__name(validateEventsArray,"validateEventsArray"),__name(snapshotChanges,"snapshotChanges"),__name(stateChanges,"stateChanges"),__name(auditTrail,"auditTrail"),__name(function(){},"LoadedMetadata"),__name(loadedData,"loadedData"),__name(waitForLoaded,"waitForLoaded"),__name(createDataOperationMethod,"createDataOperationMethod"),__name(createRemoveMethod,"createRemoveMethod"),__name(createListReference,"createListReference"),__name(createObjectSnapshotChanges,"createObjectSnapshotChanges"),__name(createObjectReference,"createObjectReference");const URL=new core.OlP("angularfire2.realtimeDatabaseURL"),USE_EMULATOR=new core.OlP("angularfire2.database.use-emulator");class AngularFireDatabase{constructor(options,nameOrConfig,databaseURL,platformId,zone,_useEmulator,useAuthEmulator){this.schedulers=new angular_fire.HU(zone),this.keepUnstableUntilFirst=(0,angular_fire.ss)(this.schedulers);const useEmulator=_useEmulator,app=(0,angular_fire.on)(options,zone,nameOrConfig);!dist_index_cjs_default().auth&&useAuthEmulator&&(0,angular_fire.yq)(),this.database=(0,angular_fire.sI)(`${app.name}.database.${databaseURL}`,"AngularFireDatabase",app,()=>{const database=zone.runOutsideAngular(()=>app.database(databaseURL||void 0));return useEmulator&&database.useEmulator(...useEmulator),database},[useEmulator])}list(pathOrRef,queryFn){const ref=this.schedulers.ngZone.runOutsideAngular(()=>getRef(this.database,pathOrRef));let query=ref;return queryFn&&(query=queryFn(ref)),createListReference(query,this)}object(pathOrRef){return createObjectReference(this.schedulers.ngZone.runOutsideAngular(()=>getRef(this.database,pathOrRef)),this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}}__name(AngularFireDatabase,"AngularFireDatabase"),AngularFireDatabase.\u0275fac=__name(function(t){return new(t||AngularFireDatabase)(core.LFG(angular_fire.Dh),core.LFG(angular_fire.xv,8),core.LFG(URL,8),core.LFG(core.Lbi),core.LFG(core.R0b),core.LFG(USE_EMULATOR,8),core.LFG(angular_fire_auth.Qv,8))},"AngularFireDatabase_Factory"),AngularFireDatabase.ctorParameters=()=>[{type:void 0,decorators:[{type:core.tBr,args:[angular_fire.Dh]}]},{type:void 0,decorators:[{type:core.FiY},{type:core.tBr,args:[angular_fire.xv]}]},{type:void 0,decorators:[{type:core.FiY},{type:core.tBr,args:[URL]}]},{type:Object,decorators:[{type:core.tBr,args:[core.Lbi]}]},{type:core.R0b},{type:void 0,decorators:[{type:core.FiY},{type:core.tBr,args:[USE_EMULATOR]}]},{type:void 0,decorators:[{type:core.FiY},{type:core.tBr,args:[angular_fire_auth.Qv]}]}],AngularFireDatabase.\u0275prov=(0,core.Yz7)({factory:__name(function(){return new AngularFireDatabase((0,core.LFG)(angular_fire.Dh),(0,core.LFG)(angular_fire.xv,8),(0,core.LFG)(URL,8),(0,core.LFG)(core.Lbi),(0,core.LFG)(core.R0b),(0,core.LFG)(USE_EMULATOR,8),(0,core.LFG)(angular_fire_auth.Qv,8))},"AngularFireDatabase_Factory"),token:AngularFireDatabase,providedIn:"any"});class AngularFireDatabaseModule{}__name(AngularFireDatabaseModule,"AngularFireDatabaseModule"),AngularFireDatabaseModule.\u0275fac=__name(function(t){return new(t||AngularFireDatabaseModule)},"AngularFireDatabaseModule_Factory"),AngularFireDatabaseModule.\u0275mod=core.oAB({type:AngularFireDatabaseModule}),AngularFireDatabaseModule.\u0275inj=core.cJS({providers:[AngularFireDatabase]})},50057:(module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{hO:()=>AngularFireModule,xv:()=>FIREBASE_APP_NAME,Dh:()=>FIREBASE_OPTIONS,HU:()=>\u0275AngularFireSchedulers,GT:()=>\u0275applyMixins,sI:()=>\u0275fetchInstance,on:()=>\u0275firebaseAppFactory,ss:()=>\u0275keepUnstableUntilFirstFactory,pX:()=>\u0275lazySDKProxy,yq:()=>\u0275logAuthEmulatorError});var rxjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(57771),rxjs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(33637),rxjs_operators__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(93342),rxjs_operators__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(49673),rxjs_operators__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(59746),_angular_core__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(37716),firebase_app__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(24395),firebase_app__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(firebase_app__WEBPACK_IMPORTED_MODULE_0__);function noop(){}module=__webpack_require__.hmd(module),__name(noop,"noop");class \u0275ZoneScheduler{constructor(zone,delegate=rxjs__WEBPACK_IMPORTED_MODULE_1__.N){this.zone=zone,this.delegate=delegate}now(){return this.delegate.now()}schedule(work,delay,state){const targetZone=this.zone,workInZone=__name(function(state2){targetZone.runGuarded(()=>{work.apply(this,[state2])})},"workInZone");return this.delegate.schedule(workInZone,delay,state)}}__name(\u0275ZoneScheduler,"\u0275ZoneScheduler");class \u0275BlockUntilFirstOperator{constructor(zone){this.zone=zone,this.task=null}call(subscriber,source){const unscheduleTask=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",noop,{},noop,noop)),source.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_2__.b)({next:unscheduleTask,complete:unscheduleTask,error:unscheduleTask})).subscribe(subscriber).add(unscheduleTask)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}__name(\u0275BlockUntilFirstOperator,"\u0275BlockUntilFirstOperator");class \u0275AngularFireSchedulers{constructor(ngZone){this.ngZone=ngZone,this.outsideAngular=ngZone.runOutsideAngular(()=>new \u0275ZoneScheduler(Zone.current)),this.insideAngular=ngZone.run(()=>new \u0275ZoneScheduler(Zone.current,rxjs__WEBPACK_IMPORTED_MODULE_3__.z))}}function \u0275keepUnstableUntilFirstFactory(schedulers){return __name(function(obs$){return(obs$=obs$.lift(new \u0275BlockUntilFirstOperator(schedulers.ngZone))).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_4__.R)(schedulers.outsideAngular),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.QV)(schedulers.insideAngular))},"keepUnstableUntilFirst")}__name(\u0275AngularFireSchedulers,"\u0275AngularFireSchedulers"),__name(\u0275keepUnstableUntilFirstFactory,"\u0275keepUnstableUntilFirstFactory");const noopFunctions=["ngOnDestroy"],\u0275lazySDKProxy=__name((klass,observable,zone,options={})=>new Proxy(klass,{get:(_,name)=>zone.runOutsideAngular(()=>{var _a;if(klass[name])return(null===(_a=null==options?void 0:options.spy)||void 0===_a?void 0:_a.get)&&options.spy.get(name,klass[name]),klass[name];if(noopFunctions.indexOf(name)>-1)return()=>{};const promise=observable.toPromise().then(mod=>{const ret=mod&&mod[name];return"function"==typeof ret?ret.bind(mod):ret&&ret.then?ret.then(res=>zone.run(()=>res)):zone.run(()=>ret)});return new Proxy(()=>{},{get:(_2,name2)=>promise[name2],apply:(self2,_2,args)=>promise.then(it=>{var _a2;const res=it&&it(...args);return(null===(_a2=null==options?void 0:options.spy)||void 0===_a2?void 0:_a2.apply)&&options.spy.apply(name,args,res),res})})})}),"\u0275lazySDKProxy"),\u0275applyMixins=__name((derivedCtor,constructors)=>{constructors.forEach(baseCtor=>{Object.getOwnPropertyNames(baseCtor.prototype||baseCtor).forEach(name=>{Object.defineProperty(derivedCtor.prototype,name,Object.getOwnPropertyDescriptor(baseCtor.prototype||baseCtor,name))})})},"\u0275applyMixins");__name(function(){},"FirebaseOptions"),__name(function(){},"FirebaseAppConfig");const FIREBASE_OPTIONS=new _angular_core__WEBPACK_IMPORTED_MODULE_6__.OlP("angularfire2.app.options"),FIREBASE_APP_NAME=new _angular_core__WEBPACK_IMPORTED_MODULE_6__.OlP("angularfire2.app.nameOrConfig");class FirebaseApp{}__name(FirebaseApp,"FirebaseApp");const VERSION=new _angular_core__WEBPACK_IMPORTED_MODULE_6__.GfV("6.1.4");function \u0275firebaseAppFactory(options,zone,nameOrConfig){const name="string"==typeof nameOrConfig&&nameOrConfig||"[DEFAULT]",config="object"==typeof nameOrConfig&&nameOrConfig||{};config.name=config.name||name;const app=firebase_app__WEBPACK_IMPORTED_MODULE_0___default().apps.filter(app2=>app2&&app2.name===config.name)[0]||zone.runOutsideAngular(()=>firebase_app__WEBPACK_IMPORTED_MODULE_0___default().initializeApp(options,config));try{if(JSON.stringify(options)!==JSON.stringify(app.options)){const hmr=!!module.hot;log("error",`${app.name} Firebase App already initialized with different options${hmr?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch(e){}return app}__name(\u0275firebaseAppFactory,"\u0275firebaseAppFactory");const \u0275logAuthEmulatorError=__name(()=>{log("warn","You may need to import 'firebase/auth' manually in your component rather than rely on AngularFireAuth's dynamic import, when using the emulator suite https://github.com/angular/angularfire/issues/2656")},"\u0275logAuthEmulatorError"),log=__name((level,...args)=>{(0,_angular_core__WEBPACK_IMPORTED_MODULE_6__.X6Q)()&&"undefined"!=typeof console&&console[level](...args)},"log");function \u0275fetchInstance(cacheKey,moduleName,app,fn,args){const[instance,...cachedArgs]=globalThis.\u0275AngularfireInstanceCache.get(cacheKey)||[];if(instance){try{if(args.some((arg,i)=>{const cachedArg=cachedArgs[i];return arg&&"object"==typeof arg?JSON.stringify(arg)!==JSON.stringify(cachedArg):arg!==cachedArg})){const hmr=!!module.hot;log("error",`${moduleName} was already initialized on the ${app.name} Firebase App instance with different settings.${hmr?" You may need to reload as Firebase is not HMR aware.":""}`)}}catch(e){}return instance}{const newInstance=fn();return globalThis.\u0275AngularfireInstanceCache.set(cacheKey,[newInstance,...args]),newInstance}}globalThis.\u0275AngularfireInstanceCache||(globalThis.\u0275AngularfireInstanceCache=new Map),__name(\u0275fetchInstance,"\u0275fetchInstance");const FIREBASE_APP_PROVIDER={provide:FirebaseApp,useFactory:\u0275firebaseAppFactory,deps:[FIREBASE_OPTIONS,_angular_core__WEBPACK_IMPORTED_MODULE_6__.R0b,[new _angular_core__WEBPACK_IMPORTED_MODULE_6__.FiY,FIREBASE_APP_NAME]]};class AngularFireModule{constructor(platformId){firebase_app__WEBPACK_IMPORTED_MODULE_0___default().registerVersion("angularfire",VERSION.full,platformId.toString()),firebase_app__WEBPACK_IMPORTED_MODULE_0___default().registerVersion("angular",_angular_core__WEBPACK_IMPORTED_MODULE_6__.q4F.full)}static initializeApp(options,nameOrConfig){return{ngModule:AngularFireModule,providers:[{provide:FIREBASE_OPTIONS,useValue:options},{provide:FIREBASE_APP_NAME,useValue:nameOrConfig}]}}}__name(AngularFireModule,"AngularFireModule"),AngularFireModule.\u0275fac=__name(function(t){return new(t||AngularFireModule)(_angular_core__WEBPACK_IMPORTED_MODULE_6__.LFG(_angular_core__WEBPACK_IMPORTED_MODULE_6__.Lbi))},"AngularFireModule_Factory"),AngularFireModule.\u0275mod=_angular_core__WEBPACK_IMPORTED_MODULE_6__.oAB({type:AngularFireModule}),AngularFireModule.\u0275inj=_angular_core__WEBPACK_IMPORTED_MODULE_6__.cJS({providers:[FIREBASE_APP_PROVIDER]}),AngularFireModule.ctorParameters=()=>[{type:Object,decorators:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_6__.tBr,args:[_angular_core__WEBPACK_IMPORTED_MODULE_6__.Lbi]}]}]},42672:(__unused_webpack_module,exports2,__webpack_require__)=>{"use strict";Object.defineProperty(exports2,"__esModule",{value:!0});var tslib=__webpack_require__(64762),util=__webpack_require__(84268),component=__webpack_require__(71100),logger$1=__webpack_require__(16303),Storage=__webpack_require__(29311),xmlhttprequest=__webpack_require__(7924);function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}__name(_interopDefaultLegacy,"_interopDefaultLegacy");var _a$1,_a,Storage__default=_interopDefaultLegacy(Storage),ERRORS=((_a$1={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",_a$1["bad-app-name"]="Illegal App name: '{$appName}",_a$1["duplicate-app"]="Firebase App named '{$appName}' already exists",_a$1["app-deleted"]="Firebase App named '{$appName}' already deleted",_a$1["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",_a$1["invalid-log-argument"]="First argument to `onLog` must be null or a function.",_a$1),ERROR_FACTORY=new util.ErrorFactory("app","Firebase",ERRORS),PLATFORM_LOG_STRING=((_a={})["@firebase/app"]="fire-core",_a["@firebase/analytics"]="fire-analytics",_a["@firebase/app-check"]="fire-app-check",_a["@firebase/auth"]="fire-auth",_a["@firebase/database"]="fire-rtdb",_a["@firebase/functions"]="fire-fn",_a["@firebase/installations"]="fire-iid",_a["@firebase/messaging"]="fire-fcm",_a["@firebase/performance"]="fire-perf",_a["@firebase/remote-config"]="fire-rc",_a["@firebase/storage"]="fire-gcs",_a["@firebase/firestore"]="fire-fst",_a["fire-js"]="fire-js",_a["firebase-wrapper"]="fire-js-all",_a),logger=new logger$1.Logger("@firebase/app"),FirebaseAppImpl=function(){function FirebaseAppImpl2(options,config,firebase_){var _this=this;this.firebase_=firebase_,this.isDeleted_=!1,this.name_=config.name,this.automaticDataCollectionEnabled_=config.automaticDataCollectionEnabled||!1,this.options_=util.deepCopy(options),this.container=new component.ComponentContainer(config.name),this._addComponent(new component.Component("app",function(){return _this},"PUBLIC")),this.firebase_.INTERNAL.components.forEach(function(component2){return _this._addComponent(component2)})}return __name(FirebaseAppImpl2,"FirebaseAppImpl"),Object.defineProperty(FirebaseAppImpl2.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(val){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=val},enumerable:!1,configurable:!0}),Object.defineProperty(FirebaseAppImpl2.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(FirebaseAppImpl2.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),FirebaseAppImpl2.prototype.delete=function(){var _this=this;return new Promise(function(resolve){_this.checkDestroyed_(),resolve()}).then(function(){return _this.firebase_.INTERNAL.removeApp(_this.name_),Promise.all(_this.container.getProviders().map(function(provider){return provider.delete()}))}).then(function(){_this.isDeleted_=!0})},FirebaseAppImpl2.prototype._getService=function(name2,instanceIdentifier){var _a2;void 0===instanceIdentifier&&(instanceIdentifier="[DEFAULT]"),this.checkDestroyed_();var provider=this.container.getProvider(name2);return!provider.isInitialized()&&"EXPLICIT"===(null===(_a2=provider.getComponent())||void 0===_a2?void 0:_a2.instantiationMode)&&provider.initialize(),provider.getImmediate({identifier:instanceIdentifier})},FirebaseAppImpl2.prototype._removeServiceInstance=function(name2,instanceIdentifier){void 0===instanceIdentifier&&(instanceIdentifier="[DEFAULT]"),this.container.getProvider(name2).clearInstance(instanceIdentifier)},FirebaseAppImpl2.prototype._addComponent=function(component2){try{this.container.addComponent(component2)}catch(e){logger.debug("Component "+component2.name+" failed to register with FirebaseApp "+this.name,e)}},FirebaseAppImpl2.prototype._addOrOverwriteComponent=function(component2){this.container.addOrOverwriteComponent(component2)},FirebaseAppImpl2.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},FirebaseAppImpl2.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw ERROR_FACTORY.create("app-deleted",{appName:this.name_})},FirebaseAppImpl2}();FirebaseAppImpl.prototype.name&&FirebaseAppImpl.prototype.options||FirebaseAppImpl.prototype.delete||console.log("dc");function createFirebaseNamespaceCore(firebaseAppImpl){var apps={},components=new Map,namespace={__esModule:!0,initializeApp,app,registerVersion,setLogLevel:logger$1.setLogLevel,onLog,apps:null,SDK_VERSION:"8.10.0",INTERNAL:{registerComponent,removeApp,components,useAsService}};function removeApp(name2){delete apps[name2]}function app(name2){if(name2=name2||"[DEFAULT]",!util.contains(apps,name2))throw ERROR_FACTORY.create("no-app",{appName:name2});return apps[name2]}function initializeApp(options,rawConfig){(void 0===rawConfig&&(rawConfig={}),"object"!=typeof rawConfig||null===rawConfig)&&(rawConfig={name:rawConfig});var config=rawConfig;void 0===config.name&&(config.name="[DEFAULT]");var name2=config.name;if("string"!=typeof name2||!name2)throw ERROR_FACTORY.create("bad-app-name",{appName:String(name2)});if(util.contains(apps,name2))throw ERROR_FACTORY.create("duplicate-app",{appName:name2});var app2=new firebaseAppImpl(options,config,namespace);return apps[name2]=app2,app2}function getApps(){return Object.keys(apps).map(function(name2){return apps[name2]})}function registerComponent(component2){var componentName=component2.name;if(components.has(componentName))return logger.debug("There were multiple attempts to register component "+componentName+"."),"PUBLIC"===component2.type?namespace[componentName]:null;if(components.set(componentName,component2),"PUBLIC"===component2.type){var serviceNamespace=__name(function(appArg){if(void 0===appArg&&(appArg=app()),"function"!=typeof appArg[componentName])throw ERROR_FACTORY.create("invalid-app-argument",{appName:componentName});return appArg[componentName]()},"serviceNamespace");void 0!==component2.serviceProps&&util.deepExtend(serviceNamespace,component2.serviceProps),namespace[componentName]=serviceNamespace,firebaseAppImpl.prototype[componentName]=function(){for(var args=[],_i2=0;_i2<arguments.length;_i2++)args[_i2]=arguments[_i2];var serviceFxn=this._getService.bind(this,componentName);return serviceFxn.apply(this,component2.multipleInstances?args:[])}}for(var _i=0,_a2=Object.keys(apps);_i<_a2.length;_i++){var appName=_a2[_i];apps[appName]._addComponent(component2)}return"PUBLIC"===component2.type?namespace[componentName]:null}function registerVersion(libraryKeyOrName,version2,variant){var _a2,library=null!==(_a2=PLATFORM_LOG_STRING[libraryKeyOrName])&&void 0!==_a2?_a2:libraryKeyOrName;variant&&(library+="-"+variant);var libraryMismatch=library.match(/\s|\//),versionMismatch=version2.match(/\s|\//);if(libraryMismatch||versionMismatch){var warning=['Unable to register library "'+library+'" with version "'+version2+'":'];return libraryMismatch&&warning.push('library name "'+library+'" contains illegal characters (whitespace or "/")'),libraryMismatch&&versionMismatch&&warning.push("and"),versionMismatch&&warning.push('version name "'+version2+'" contains illegal characters (whitespace or "/")'),void logger.warn(warning.join(" "))}registerComponent(new component.Component(library+"-version",function(){return{library,version:version2}},"VERSION"))}function onLog(logCallback,options){if(null!==logCallback&&"function"!=typeof logCallback)throw ERROR_FACTORY.create("invalid-log-argument");logger$1.setUserLogHandler(logCallback,options)}function useAsService(app2,name2){return"serverAuth"===name2?null:name2}return namespace.default=namespace,Object.defineProperty(namespace,"apps",{get:getApps}),__name(removeApp,"removeApp"),__name(app,"app"),app.App=firebaseAppImpl,__name(initializeApp,"initializeApp"),__name(getApps,"getApps"),__name(registerComponent,"registerComponent"),__name(registerVersion,"registerVersion"),__name(onLog,"onLog"),__name(useAsService,"useAsService"),namespace}function createFirebaseNamespace(){var namespace=createFirebaseNamespaceCore(FirebaseAppImpl);function extendNamespace(props){util.deepExtend(namespace,props)}return namespace.INTERNAL=tslib.__assign(tslib.__assign({},namespace.INTERNAL),{createFirebaseNamespace,extendNamespace,createSubscribe:util.createSubscribe,ErrorFactory:util.ErrorFactory,deepExtend:util.deepExtend}),__name(extendNamespace,"extendNamespace"),namespace}__name(createFirebaseNamespaceCore,"createFirebaseNamespaceCore"),__name(createFirebaseNamespace,"createFirebaseNamespace");var firebase$1=createFirebaseNamespace(),PlatformLoggerService=function(){function PlatformLoggerService2(container){this.container=container}return __name(PlatformLoggerService2,"PlatformLoggerService"),PlatformLoggerService2.prototype.getPlatformInfoString=function(){return this.container.getProviders().map(function(provider){if(isVersionServiceProvider(provider)){var service=provider.getImmediate();return service.library+"/"+service.version}return null}).filter(function(logString){return logString}).join(" ")},PlatformLoggerService2}();function isVersionServiceProvider(provider){var component2=provider.getComponent();return"VERSION"===(null==component2?void 0:component2.type)}function registerCoreComponents(firebase2,variant){firebase2.INTERNAL.registerComponent(new component.Component("platform-logger",function(container){return new PlatformLoggerService(container)},"PRIVATE")),firebase2.registerVersion("@firebase/app","0.6.30",variant),firebase2.registerVersion("fire-js","")}__name(isVersionServiceProvider,"isVersionServiceProvider"),__name(registerCoreComponents,"registerCoreComponents"),firebase$1.INTERNAL.extendNamespace({INTERNAL:{node:{localStorage:new Storage__default.default(null,{strict:!0}),sessionStorage:new Storage__default.default(null,{strict:!0}),XMLHttpRequest:xmlhttprequest.XMLHttpRequest}}});var firebase=firebase$1;registerCoreComponents(firebase,"node"),exports2.default=firebase,exports2.firebase=firebase},6003:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{(function(){var k,firebase=__webpack_require__(42672).default,aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};function ba(a){a=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}return globalThis}__name(ba,"ba");var ca=ba(this);function da(a,b){if(b){var c=ca;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={}),c=c[e]}(b=b(d=c[a=a[a.length-1]]))!=d&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}function ea(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function fa(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:ea(a)}}__name(da,"da"),__name(ea,"ea"),__name(fa,"fa"),da("Promise",function(a){function b(g){this.b=0,this.c=void 0,this.a=[];var h=this.f();try{g(h.resolve,h.reject)}catch(m){h.reject(m)}}function c(){this.a=null}function d(g){return g instanceof b?g:new b(function(h){h(g)})}if(__name(b,"b"),__name(c,"c"),__name(d,"d"),a)return a;c.prototype.b=function(g){if(null==this.a){this.a=[];var h=this;this.c(function(){h.g()})}this.a.push(g)};var e=ca.setTimeout;c.prototype.c=function(g){e(g,0)},c.prototype.g=function(){for(;this.a&&this.a.length;){var g=this.a;this.a=[];for(var h=0;h<g.length;++h){var m=g[h];g[h]=null;try{m()}catch(p){this.f(p)}}}this.a=null},c.prototype.f=function(g){this.c(function(){throw g})},b.prototype.f=function(){function g(p){return function(v){m||(m=!0,p.call(h,v))}}__name(g,"g");var h=this,m=!1;return{resolve:g(this.m),reject:g(this.g)}},b.prototype.m=function(g){if(g===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof b)this.s(g);else{a:switch(typeof g){case"object":var h=null!=g;break a;case"function":h=!0;break a;default:h=!1}h?this.v(g):this.h(g)}},b.prototype.v=function(g){var h=void 0;try{h=g.then}catch(m){return void this.g(m)}"function"==typeof h?this.u(h,g):this.h(g)},b.prototype.g=function(g){this.i(2,g)},b.prototype.h=function(g){this.i(1,g)},b.prototype.i=function(g,h){if(0!=this.b)throw Error("Cannot settle("+g+", "+h+"): Promise already settled in state"+this.b);this.b=g,this.c=h,this.l()},b.prototype.l=function(){if(null!=this.a){for(var g=0;g<this.a.length;++g)f.b(this.a[g]);this.a=null}};var f=new c;return b.prototype.s=function(g){var h=this.f();g.Ra(h.resolve,h.reject)},b.prototype.u=function(g,h){var m=this.f();try{g.call(h,m.resolve,m.reject)}catch(p){m.reject(p)}},b.prototype.then=function(g,h){function m(A,Q){return"function"==typeof A?function(ya){try{p(A(ya))}catch(Ad){v(Ad)}}:Q}__name(m,"m");var p,v,B=new b(function(A,Q){p=A,v=Q});return this.Ra(m(g,p),m(h,v)),B},b.prototype.catch=function(g){return this.then(void 0,g)},b.prototype.Ra=function(g,h){function m(){switch(p.b){case 1:g(p.c);break;case 2:h(p.c);break;default:throw Error("Unexpected state: "+p.b)}}__name(m,"m");var p=this;null==this.a?f.b(m):this.a.push(m)},b.resolve=d,b.reject=function(g){return new b(function(h,m){m(g)})},b.race=function(g){return new b(function(h,m){for(var p=fa(g),v=p.next();!v.done;v=p.next())d(v.value).Ra(h,m)})},b.all=function(g){var h=fa(g),m=h.next();return m.done?d([]):new b(function(p,v){function B(ya){return function(Ad){A[ya]=Ad,0==--Q&&p(A)}}__name(B,"B");var A=[],Q=0;do{A.push(void 0),Q++,d(m.value).Ra(B(A.length-1),v),m=h.next()}while(!m.done)})},b});var ha=ha||{},l=this||self,ia=/^[\w+/_-]+[=]{0,2}$/,ja=null;function ka(a){return(a=a.querySelector&&a.querySelector("script[nonce]"))&&(a=a.nonce||a.getAttribute("nonce"))&&ia.test(a)?a:""}function la(){}function ma(a){var b=typeof a;return"object"!=b?b:a?Array.isArray(a)?"array":b:"null"}function na(a){var b=ma(a);return"array"==b||"object"==b&&"number"==typeof a.length}function oa(a){return"function"==ma(a)}function n(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}function pa(a){return Object.prototype.hasOwnProperty.call(a,qa)&&a[qa]||(a[qa]=++ra)}__name(ka,"ka"),__name(la,"la"),__name(ma,"ma"),__name(na,"na"),__name(oa,"oa"),__name(n,"n"),__name(pa,"pa");var qa="closure_uid_"+(1e9*Math.random()>>>0),ra=0;function sa(a,b,c){return a.call.apply(a.bind,arguments)}function ta(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,d),a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function q(a,b,c){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?sa:ta).apply(null,arguments)}function ua(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();return d.push.apply(d,arguments),a.apply(this,d)}}__name(sa,"sa"),__name(ta,"ta"),__name(q,"q"),__name(ua,"ua");var va=Date.now;function r(a,b){function c(){}__name(c,"c"),c.prototype=b.prototype,a.bb=b.prototype,a.prototype=new c,a.prototype.constructor=a}function wa(a){return a}function t(a,b,c){this.code=xa+a,this.message=b||za[a]||"",this.a=c||null}function Aa(a){var b=a&&a.code;return b?new t(b.substring(xa.length),a.message,a.serverResponse):null}__name(r,"r"),__name(wa,"wa"),__name(t,"t"),r(t,Error),t.prototype.w=function(){var a={code:this.code,message:this.message};return this.a&&(a.serverResponse=this.a),a},t.prototype.toJSON=function(){return this.w()},__name(Aa,"Aa");var Da,xa="auth/",za={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."},Ba={ld:{Ua:"https://staging-identitytoolkit.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",$a:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Xa:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"b"},sd:{Ua:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",$a:"https://securetoken.googleapis.com/v1/token",Xa:"https://identitytoolkit.googleapis.com/v2/",id:"p"},ud:{Ua:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",$a:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Xa:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"s"},vd:{Ua:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",$a:"https://test-securetoken.sandbox.googleapis.com/v1/token",Xa:"https://test-identitytoolkit.sandbox.googleapis.com/v2/",id:"t"}};function Ca(a){for(var b in Ba)if(Ba[b].id===a)return{firebaseEndpoint:(a=Ba[b]).Ua,secureTokenEndpoint:a.$a,identityPlatformEndpoint:a.Xa};return null}function Ea(a){if(!a)return!1;try{return!!a.$goog_Thenable}catch(b){return!1}}function u(a){if(Error.captureStackTrace)Error.captureStackTrace(this,u);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}function Fa(a,b){for(var c="",d=(a=a.split("%s")).length-1,e=0;e<d;e++)c+=a[e]+(e<b.length?b[e]:"%s");u.call(this,c+a[d])}function Ga(a,b){throw new Fa("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1))}function Ha(a,b){this.c=a,this.f=b,this.b=0,this.a=null}function Ia(a,b){a.f(b),100>a.b&&(a.b++,b.next=a.a,a.a=b)}function Ja(){this.b=this.a=null}__name(Ca,"Ca"),Da=Ca("__EID__")?"__EID__":void 0,__name(Ea,"Ea"),__name(u,"u"),r(u,Error),u.prototype.name="CustomError",__name(Fa,"Fa"),r(Fa,u),Fa.prototype.name="AssertionError",__name(Ga,"Ga"),__name(Ha,"Ha"),Ha.prototype.get=function(){if(0<this.b){this.b--;var a=this.a;this.a=a.next,a.next=null}else a=this.c();return a},__name(Ia,"Ia"),__name(Ja,"Ja");var La=new Ha(function(){return new Ka},function(a){a.reset()});function Ma(){var a=Na,b=null;return a.a&&(b=a.a,a.a=a.a.next,a.a||(a.b=null),b.next=null),b}function Ka(){this.next=this.b=this.a=null}Ja.prototype.add=function(a,b){var c=La.get();c.set(a,b),this.b?this.b.next=c:this.a=c,this.b=c},__name(Ma,"Ma"),__name(Ka,"Ka"),Ka.prototype.set=function(a,b){this.a=a,this.b=b,this.next=null},Ka.prototype.reset=function(){this.next=this.b=this.a=null};var Oa=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},w=Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e="string"==typeof a?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)};function Pa(a,b){for(var c="string"==typeof a?a.split(""):a,d=a.length-1;0<=d;--d)d in c&&b.call(void 0,c[d],d,a)}__name(Pa,"Pa");var Qa=Array.prototype.filter?function(a,b){return Array.prototype.filter.call(a,b,void 0)}:function(a,b){for(var c=a.length,d=[],e=0,f="string"==typeof a?a.split(""):a,g=0;g<c;g++)if(g in f){var h=f[g];b.call(void 0,h,g,a)&&(d[e++]=h)}return d},Ra=Array.prototype.map?function(a,b){return Array.prototype.map.call(a,b,void 0)}:function(a,b){for(var c=a.length,d=Array(c),e="string"==typeof a?a.split(""):a,f=0;f<c;f++)f in e&&(d[f]=b.call(void 0,e[f],f,a));return d},Sa=Array.prototype.some?function(a,b){return Array.prototype.some.call(a,b,void 0)}:function(a,b){for(var c=a.length,d="string"==typeof a?a.split(""):a,e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a))return!0;return!1};function Ta(a){a:{for(var b=Ua,c=a.length,d="string"==typeof a?a.split(""):a,e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a)){b=e;break a}b=-1}return 0>b?null:"string"==typeof a?a.charAt(b):a[b]}function Va(a,b){return 0<=Oa(a,b)}function Wa(a,b){var c;return(c=0<=(b=Oa(a,b)))&&Array.prototype.splice.call(a,b,1),c}function Xa(a,b){Pa(a,function(d,e){b.call(void 0,d,e,a)&&1==Array.prototype.splice.call(a,e,1).length&&0})}function Ya(a){return Array.prototype.concat.apply([],arguments)}function Za(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}__name(Ta,"Ta"),__name(Va,"Va"),__name(Wa,"Wa"),__name(Xa,"Xa"),__name(Ya,"Ya"),__name(Za,"Za");var ib,$a=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]},ab=/&/g,bb=/</g,cb=/>/g,db=/"/g,eb=/'/g,fb=/\x00/g,gb=/[\x00&<>"']/;function x(a,b){return-1!=a.indexOf(b)}function hb(a,b){return a<b?-1:a>b?1:0}__name(x,"x"),__name(hb,"hb");a:{var jb=l.navigator;if(jb){var kb=jb.userAgent;if(kb){ib=kb;break a}}ib=""}function y(a){return x(ib,a)}function lb(a,b){for(var c in a)b.call(void 0,a[c],c,a)}function mb(a){for(var b in a)return!1;return!0}function nb(a){var c,b={};for(c in a)b[c]=a[c];return b}__name(y,"y"),__name(lb,"lb"),__name(mb,"mb"),__name(nb,"nb");var ob="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(a,b){for(var c,d,e=1;e<arguments.length;e++){for(c in d=arguments[e])a[c]=d[c];for(var f=0;f<ob.length;f++)c=ob[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}function pb(a,b){a:{try{var c=a&&a.ownerDocument,d=c&&(c.defaultView||c.parentWindow);if((d=d||l).Element&&d.Location){var e=d;break a}}catch(g){}e=null}if(e&&void 0!==e[b]&&(!a||!(a instanceof e[b])&&(a instanceof e.Location||a instanceof e.Element))){if(n(a))try{var f=a.constructor.displayName||a.constructor.name||Object.prototype.toString.call(a)}catch(g){f="<object could not be stringified>"}else f=void 0===a?"undefined":null===a?"null":typeof a;Ga("Argument is not a %s (or a non-Element, non-Location mock); got: %s",b,f)}}function qb(a,b){this.a=a===rb&&b||"",this.b=sb}function tb(a){return a instanceof qb&&a.constructor===qb&&a.b===sb?a.a:(Ga("expected object of type Const, got '"+a+"'"),"type_error:Const")}__name(z,"z"),__name(pb,"pb"),__name(qb,"qb"),qb.prototype.ta=!0,qb.prototype.sa=function(){return this.a},qb.prototype.toString=function(){return"Const{"+this.a+"}"},__name(tb,"tb");var ub,sb={},rb={};function vb(){if(void 0===ub){var a=null,b=l.trustedTypes;if(b&&b.createPolicy){try{a=b.createPolicy("goog#html",{createHTML:wa,createScript:wa,createScriptURL:wa})}catch(c){l.console&&l.console.error(c.message)}ub=a}else ub=a}return ub}function wb(a,b){this.a=b===xb?a:""}function yb(a){return a instanceof wb&&a.constructor===wb?a.a:(Ga("expected object of type TrustedResourceUrl, got '"+a+"' of type "+ma(a)),"type_error:TrustedResourceUrl")}function zb(a,b){var c=tb(a);if(!Ab.test(c))throw Error("Invalid TrustedResourceUrl format: "+c);return Cb(a=c.replace(Bb,function(d,e){if(!Object.prototype.hasOwnProperty.call(b,e))throw Error('Found marker, "'+e+'", in format string, "'+c+'", but no valid label mapping found in args: '+JSON.stringify(b));return(d=b[e])instanceof qb?tb(d):encodeURIComponent(String(d))}))}__name(vb,"vb"),__name(wb,"wb"),wb.prototype.ta=!0,wb.prototype.sa=function(){return this.a.toString()},wb.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"},__name(yb,"yb"),__name(zb,"zb");var Bb=/%{(\w+)}/g,Ab=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,xb={};function Cb(a){var b=vb();return new wb(a=b?b.createScriptURL(a):a,xb)}function C(a,b){this.a=b===Db?a:""}function Eb(a){return a instanceof C&&a.constructor===C?a.a:(Ga("expected object of type SafeUrl, got '"+a+"' of type "+ma(a)),"type_error:SafeUrl")}__name(Cb,"Cb"),__name(C,"C"),C.prototype.ta=!0,C.prototype.sa=function(){return this.a.toString()},C.prototype.toString=function(){return"SafeUrl{"+this.a+"}"},__name(Eb,"Eb");var Fb=/^(?:audio\/(?:3gpp2|3gpp|aac|L16|midi|mp3|mp4|mpeg|oga|ogg|opus|x-m4a|x-matroska|x-wav|wav|webm)|font\/\w+|image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp|x-icon)|text\/csv|video\/(?:mpeg|mp4|ogg|webm|quicktime|x-matroska))(?:;\w+=(?:\w+|"[\w;,= ]+"))*$/i,Gb=/^data:(.*);base64,[a-z0-9+\/]+=*$/i,Hb=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function Ib(a){if(a instanceof C)return a;if(a="object"==typeof a&&a.ta?a.sa():String(a),Hb.test(a))a=new C(a,Db);else{var b=(a=(a=String(a)).replace(/(%0A|%0D)/g,"")).match(Gb);a=b&&Fb.test(b[1])?new C(a,Db):null}return a}function Jb(a){return a instanceof C?a:(a="object"==typeof a&&a.ta?a.sa():String(a),Hb.test(a)||(a="about:invalid#zClosurez"),new C(a,Db))}__name(Ib,"Ib"),__name(Jb,"Jb");var Db={},Kb=new C("about:invalid#zClosurez",Db);function Lb(a,b,c){this.a=c===Mb?a:""}function Nb(a){return a instanceof Lb&&a.constructor===Lb?a.a:(Ga("expected object of type SafeHtml, got '"+a+"' of type "+ma(a)),"type_error:SafeHtml")}__name(Lb,"Lb"),Lb.prototype.ta=!0,Lb.prototype.sa=function(){return this.a.toString()},Lb.prototype.toString=function(){return"SafeHtml{"+this.a+"}"},__name(Nb,"Nb");var Mb={};function Ob(a,b){pb(a,"HTMLScriptElement"),a.src=yb(b),(b=a.ownerDocument&&a.ownerDocument.defaultView)&&b!=l?b=ka(b.document):(null===ja&&(ja=ka(l.document)),b=ja),b&&a.setAttribute("nonce",b)}function Pb(a,b,c,d){return a=a instanceof C?a:Jb(a),b=b||l,c=c instanceof qb?tb(c):c||"",b.open(Eb(a),c,d,void 0)}function Qb(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")}function Rb(a){return gb.test(a)&&(-1!=a.indexOf("&")&&(a=a.replace(ab,"&amp;")),-1!=a.indexOf("<")&&(a=a.replace(bb,"&lt;")),-1!=a.indexOf(">")&&(a=a.replace(cb,"&gt;")),-1!=a.indexOf('"')&&(a=a.replace(db,"&quot;")),-1!=a.indexOf("'")&&(a=a.replace(eb,"&#39;")),-1!=a.indexOf("\0")&&(a=a.replace(fb,"&#0;"))),a}function Sb(a){return Sb[" "](a),a}function Tb(a,b){var c=Ub;return Object.prototype.hasOwnProperty.call(c,a)?c[a]:c[a]=b(a)}__name(Ob,"Ob"),__name(Pb,"Pb"),__name(Qb,"Qb"),__name(Rb,"Rb"),__name(Sb,"Sb"),Sb[" "]=la,__name(Tb,"Tb");var bc,a,Vb=y("Opera"),Wb=y("Trident")||y("MSIE"),Xb=y("Edge"),Yb=Xb||Wb,Zb=y("Gecko")&&!(x(ib.toLowerCase(),"webkit")&&!y("Edge"))&&!(y("Trident")||y("MSIE"))&&!y("Edge"),$b=x(ib.toLowerCase(),"webkit")&&!y("Edge");function ac(){var a=l.document;return a?a.documentMode:void 0}__name(ac,"ac");a:{var cc="",dc=(a=ib,Zb?/rv:([^\);]+)(\)|;)/.exec(a):Xb?/Edge\/([\d\.]+)/.exec(a):Wb?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):$b?/WebKit\/(\S+)/.exec(a):Vb?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(dc&&(cc=dc?dc[1]:""),Wb){var ec=ac();if(null!=ec&&ec>parseFloat(cc)){bc=String(ec);break a}}bc=cc}var gc,Ub={};function fc(a){return Tb(a,function(){for(var b=0,c=$a(String(bc)).split("."),d=$a(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"";do{if(g=/(\d*)(\D*)(.*)/.exec(g)||["","","",""],h=/(\d*)(\D*)(.*)/.exec(h)||["","","",""],0==g[0].length&&0==h[0].length)break;b=hb(0==g[1].length?0:parseInt(g[1],10),0==h[1].length?0:parseInt(h[1],10))||hb(0==g[2].length,0==h[2].length)||hb(g[2],h[2]),g=g[3],h=h[3]}while(0==b)}return 0<=b})}(__name(fc,"fc"),l.document&&Wb)?gc=ac()||parseInt(bc,10)||void 0:gc=void 0;var ic=gc;try{new self.OffscreenCanvas(0,0).getContext("2d")}catch(a){}var jc=!Wb||9<=Number(ic);function kc(a){var b=document;return"string"==typeof a?b.getElementById(a):a}function lc(a,b){lb(b,function(c,d){c&&"object"==typeof c&&c.ta&&(c=c.sa()),"style"==d?a.style.cssText=c:"class"==d?a.className=c:"for"==d?a.htmlFor=c:mc.hasOwnProperty(d)?a.setAttribute(mc[d],c):0==d.lastIndexOf("aria-",0)||0==d.lastIndexOf("data-",0)?a.setAttribute(d,c):a[d]=c})}__name(kc,"kc"),__name(lc,"lc");var rc,uc,mc={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function nc(a,b,c){var d=arguments,e=document,f=String(d[0]),g=d[1];if(!jc&&g&&(g.name||g.type)){if(f=["<",f],g.name&&f.push(' name="',Rb(g.name),'"'),g.type){f.push(' type="',Rb(g.type),'"');var h={};z(h,g),delete h.type,g=h}f.push(">"),f=f.join("")}return f=oc(e,f),g&&("string"==typeof g?f.className=g:Array.isArray(g)?f.className=g.join(" "):lc(f,g)),2<d.length&&pc(e,f,d),f}function pc(a,b,c){function d(h){h&&b.appendChild("string"==typeof h?a.createTextNode(h):h)}__name(d,"d");for(var e=2;e<c.length;e++){var f=c[e];if(!na(f)||n(f)&&0<f.nodeType)d(f);else{a:{if(f&&"number"==typeof f.length){if(n(f)){var g="function"==typeof f.item||"string"==typeof f.item;break a}if(oa(f)){g="function"==typeof f.item;break a}}g=!1}w(g?Za(f):f,d)}}}function oc(a,b){return b=String(b),"application/xhtml+xml"===a.contentType&&(b=b.toLowerCase()),a.createElement(b)}function qc(a){l.setTimeout(function(){throw a},0)}function sc(){var a=l.MessageChannel;if(void 0===a&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!y("Presto")&&(a=__name(function(){var e=oc(document,"IFRAME");e.style.display="none",document.documentElement.appendChild(e);var f=e.contentWindow;(e=f.document).open(),e.close();var g="callImmediate"+Math.random(),h="file:"==f.location.protocol?"*":f.location.protocol+"//"+f.location.host;e=q(function(m){("*"==h||m.origin==h)&&m.data==g&&this.port1.onmessage()},this),f.addEventListener("message",e,!1),this.port1={},this.port2={postMessage:function(){f.postMessage(g,h)}}},"a")),void 0!==a&&!y("Trident")&&!y("MSIE")){var b=new a,c={},d=c;return b.port1.onmessage=function(){if(void 0!==c.next){var e=(c=c.next).Hb;c.Hb=null,e()}},function(e){d.next={Hb:e},d=d.next,b.port2.postMessage(0)}}return function(e){l.setTimeout(e,0)}}function tc(a,b){uc||vc(),wc||(uc(),wc=!0),Na.add(a,b)}function vc(){if(l.Promise&&l.Promise.resolve){var a=l.Promise.resolve(void 0);uc=__name(function(){a.then(xc)},"uc")}else uc=__name(function(){var b=xc;!oa(l.setImmediate)||l.Window&&l.Window.prototype&&!y("Edge")&&l.Window.prototype.setImmediate==l.setImmediate?(rc||(rc=sc()),rc(b)):l.setImmediate(b)},"uc")}__name(nc,"nc"),__name(pc,"pc"),__name(oc,"oc"),__name(qc,"qc"),__name(sc,"sc"),__name(tc,"tc"),__name(vc,"vc");var wc=!1,Na=new Ja;function xc(){for(var a;a=Ma();){try{a.a.call(a.b)}catch(b){qc(b)}Ia(La,a)}wc=!1}function D(a,b){if(this.a=yc,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,a!=la)try{var c=this;a.call(b,function(d){zc(c,Ac,d)},function(d){if(!(d instanceof Bc))try{throw d instanceof Error?d:Error("Promise rejected.")}catch(e){}zc(c,Cc,d)})}catch(d){zc(this,Cc,d)}}__name(xc,"xc"),__name(D,"D");var yc=0,Ac=2,Cc=3;function Dc(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}__name(Dc,"Dc"),Dc.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Ec=new Ha(function(){return new Dc},function(a){a.reset()});function Fc(a,b,c){var d=Ec.get();return d.g=a,d.b=b,d.f=c,d}function E(a){if(a instanceof D)return a;var b=new D(la);return zc(b,Ac,a),b}function F(a){return new D(function(b,c){c(a)})}function Gc(a,b,c){Hc(a,b,c,null)||tc(ua(b,a))}function Ic(a){return new D(function(b,c){var d=a.length,e=[];if(d)for(var f=function(p,v){d--,e[p]=v,0==d&&b(e)},g=function(p){c(p)},h=0;h<a.length;h++)Gc(a[h],ua(f,h),g);else b(e)})}function Jc(a){return new D(function(b){var c=a.length,d=[];if(c)for(var e=function(h,m,p){c--,d[h]=m?{Qb:!0,value:p}:{Qb:!1,reason:p},0==c&&b(d)},f=0;f<a.length;f++)Gc(a[f],ua(e,f,!0),ua(e,f,!1));else b(d)})}function Mc(a,b){if(a.a==yc)if(a.c){var c=a.c;if(c.b){for(var d=0,e=null,f=null,g=c.b;g&&(g.c||(d++,g.a==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.a==yc&&1==d?Mc(c,b):(f?((d=f).next==c.f&&(c.f=d),d.next=d.next.next):Nc(c),Oc(c,e,Cc,b)))}a.c=null}else zc(a,Cc,b)}function Lc(a,b){a.b||a.a!=Ac&&a.a!=Cc||Pc(a),a.f?a.f.next=b:a.b=b,a.f=b}function Kc(a,b,c,d){var e=Fc(null,null,null);return e.a=new D(function(f,g){e.g=b?function(h){try{var m=b.call(d,h);f(m)}catch(p){g(p)}}:f,e.b=c?function(h){try{var m=c.call(d,h);void 0===m&&h instanceof Bc?g(h):f(m)}catch(p){g(p)}}:g}),e.a.c=a,Lc(a,e),e.a}function zc(a,b,c){a.a==yc&&(a===c&&(b=Cc,c=new TypeError("Promise cannot resolve to itself")),a.a=1,Hc(c,a.$c,a.ad,a)||(a.i=c,a.a=b,a.c=null,Pc(a),b!=Cc||c instanceof Bc||Qc(a,c)))}function Hc(a,b,c,d){if(a instanceof D)return Lc(a,Fc(b||la,c||null,d)),!0;if(Ea(a))return a.then(b,c,d),!0;if(n(a))try{var e=a.then;if(oa(e))return Rc(a,e,b,c,d),!0}catch(f){return c.call(d,f),!0}return!1}function Rc(a,b,c,d,e){function f(m){h||(h=!0,d.call(e,m))}function g(m){h||(h=!0,c.call(e,m))}__name(f,"f"),__name(g,"g");var h=!1;try{b.call(a,g,f)}catch(m){f(m)}}function Pc(a){a.h||(a.h=!0,tc(a.gc,a))}function Nc(a){var b=null;return a.b&&(b=a.b,a.b=b.next,b.next=null),a.b||(a.f=null),b}function Oc(a,b,c,d){if(c==Cc&&b.b&&!b.c)for(;a&&a.g;a=a.c)a.g=!1;if(b.a)b.a.c=null,Sc(b,c,d);else try{b.c?b.g.call(b.f):Sc(b,c,d)}catch(e){Tc.call(null,e)}Ia(Ec,b)}function Sc(a,b,c){b==Ac?a.g.call(a.f,c):a.b&&a.b.call(a.f,c)}function Qc(a,b){a.g=!0,tc(function(){a.g&&Tc.call(null,b)})}__name(Fc,"Fc"),__name(E,"E"),__name(F,"F"),__name(Gc,"Gc"),__name(Ic,"Ic"),__name(Jc,"Jc"),D.prototype.then=function(a,b,c){return Kc(this,oa(a)?a:null,oa(b)?b:null,c)},D.prototype.$goog_Thenable=!0,(k=D.prototype).oa=function(a,b){return(a=Fc(a,a,b)).c=!0,Lc(this,a),this},k.o=function(a,b){return Kc(this,null,a,b)},k.cancel=function(a){if(this.a==yc){var b=new Bc(a);tc(function(){Mc(this,b)},this)}},__name(Mc,"Mc"),__name(Lc,"Lc"),__name(Kc,"Kc"),k.$c=function(a){this.a=yc,zc(this,Ac,a)},k.ad=function(a){this.a=yc,zc(this,Cc,a)},__name(zc,"zc"),__name(Hc,"Hc"),__name(Rc,"Rc"),__name(Pc,"Pc"),__name(Nc,"Nc"),k.gc=function(){for(var a;a=Nc(this);)Oc(this,a,this.a,this.i);this.h=!1},__name(Oc,"Oc"),__name(Sc,"Sc"),__name(Qc,"Qc");var Tc=qc;function Bc(a){u.call(this,a)}function Uc(){0!=Vc&&(Wc[pa(this)]=this),this.ya=this.ya,this.pa=this.pa}__name(Bc,"Bc"),r(Bc,u),Bc.prototype.name="cancel",__name(Uc,"Uc");var Vc=0,Wc={};function Xc(a){if(!a.ya&&(a.ya=!0,a.Da(),0!=Vc)){var b=pa(a);if(0!=Vc&&a.pa&&0<a.pa.length)throw Error(a+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete Wc[b]}}Uc.prototype.ya=!1,__name(Xc,"Xc"),Uc.prototype.Da=function(){if(this.pa)for(;this.pa.length;)this.pa.shift()()};var Yc=Object.freeze||function(a){return a},Zc=!Wb||9<=Number(ic),$c=Wb&&!fc("9"),ad=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{l.addEventListener("test",la,b),l.removeEventListener("test",la,b)}catch(c){}return a}();function G(a,b){this.type=a,this.b=this.target=b,this.defaultPrevented=!1}function bd(a,b){if(G.call(this,a?a.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,a){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.b=b,b=a.relatedTarget){if(Zb){a:{try{Sb(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b,d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:cd[a.pointerType]||"",this.a=a,a.defaultPrevented&&this.preventDefault()}}__name(G,"G"),G.prototype.preventDefault=function(){this.defaultPrevented=!0},__name(bd,"bd"),r(bd,G);var cd=Yc({2:"touch",3:"pen",4:"mouse"});bd.prototype.preventDefault=function(){bd.bb.preventDefault.call(this);var a=this.a;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,$c)try{(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)&&(a.keyCode=-1)}catch(b){}},bd.prototype.g=function(){return this.a};var dd="closure_listenable_"+(1e6*Math.random()|0),ed=0;function fd(a,b,c,d,e){this.listener=a,this.proxy=null,this.src=b,this.type=c,this.capture=!!d,this.Wa=e,this.key=++ed,this.wa=this.Qa=!1}function gd(a){a.wa=!0,a.listener=null,a.proxy=null,a.src=null,a.Wa=null}function hd(a){this.src=a,this.a={},this.b=0}function jd(a,b){var c=b.type;c in a.a&&Wa(a.a[c],b)&&(gd(b),0==a.a[c].length&&(delete a.a[c],a.b--))}function id(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.wa&&f.listener==b&&f.capture==!!c&&f.Wa==d)return e}return-1}__name(fd,"fd"),__name(gd,"gd"),__name(hd,"hd"),hd.prototype.add=function(a,b,c,d,e){var f=a.toString();(a=this.a[f])||(a=this.a[f]=[],this.b++);var g=id(a,b,d,e);return-1<g?(b=a[g],c||(b.Qa=!1)):((b=new fd(b,this.src,f,!!d,e)).Qa=c,a.push(b)),b},__name(jd,"jd"),__name(id,"id");var kd="closure_lm_"+(1e6*Math.random()|0),ld={};function nd(a,b,c,d,e){if(d&&d.once)od(a,b,c,d,e);else if(Array.isArray(b))for(var f=0;f<b.length;f++)nd(a,b[f],c,d,e);else c=pd(c),a&&a[dd]?qd(a,b,c,n(d)?!!d.capture:!!d,e):rd(a,b,c,!1,d,e)}function rd(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=n(e)?!!e.capture:!!e,h=sd(a);if(h||(a[kd]=h=new hd(a)),!(c=h.add(b,c,d,g,f)).proxy){if(d=td(),c.proxy=d,d.src=a,d.listener=c,a.addEventListener)ad||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(ud(b.toString()),d);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(d)}0}}function td(){var a=vd,b=Zc?function(c){return a.call(b.src,b.listener,c)}:function(c){if(!(c=a.call(b.src,b.listener,c)))return c};return b}function od(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)od(a,b[f],c,d,e);else c=pd(c),a&&a[dd]?wd(a,b,c,n(d)?!!d.capture:!!d,e):rd(a,b,c,!0,d,e)}function xd(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)xd(a,b[f],c,d,e);else d=n(d)?!!d.capture:!!d,c=pd(c),a&&a[dd]?(a=a.v,(b=String(b).toString())in a.a&&(-1<(c=id(f=a.a[b],c,d,e))&&(gd(f[c]),Array.prototype.splice.call(f,c,1),0==f.length&&(delete a.a[b],a.b--)))):a&&(a=sd(a))&&(b=a.a[b.toString()],a=-1,b&&(a=id(b,c,d,e)),(c=-1<a?b[a]:null)&&yd(c))}function yd(a){if("number"!=typeof a&&a&&!a.wa){var b=a.src;if(b&&b[dd])jd(b.v,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(ud(c),d):b.addListener&&b.removeListener&&b.removeListener(d),(c=sd(b))?(jd(c,a),0==c.b&&(c.src=null,b[kd]=null)):gd(a)}}}function ud(a){return a in ld?ld[a]:ld[a]="on"+a}function zd(a,b,c,d){var e=!0;if((a=sd(a))&&(b=a.a[b.toString()]))for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.wa&&(f=Bd(f,d),e=e&&!1!==f)}return e}function Bd(a,b){var c=a.listener,d=a.Wa||a.src;return a.Qa&&yd(a),c.call(d,b)}function vd(a,b){if(a.wa)return!0;if(!Zc){if(!b)a:{b=["window","event"];for(var c=l,d=0;d<b.length;d++)if(null==(c=c[b[d]])){b=null;break a}b=c}if(b=new bd(d=b,this),c=!0,!(0>d.keyCode||null!=d.returnValue)){a:{var e=!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(g){e=!0}(e||null==d.returnValue)&&(d.returnValue=!0)}for(d=[],e=b.b;e;e=e.parentNode)d.push(e);for(a=a.type,e=d.length-1;0<=e;e--){b.b=d[e];var f=zd(d[e],a,!0,b);c=c&&f}for(e=0;e<d.length;e++)b.b=d[e],f=zd(d[e],a,!1,b),c=c&&f}return c}return Bd(a,new bd(b,this))}function sd(a){return(a=a[kd])instanceof hd?a:null}__name(nd,"nd"),__name(rd,"rd"),__name(td,"td"),__name(od,"od"),__name(xd,"xd"),__name(yd,"yd"),__name(ud,"ud"),__name(zd,"zd"),__name(Bd,"Bd"),__name(vd,"vd"),__name(sd,"sd");var Cd="__closure_events_fn_"+(1e9*Math.random()>>>0);function pd(a){return oa(a)?a:(a[Cd]||(a[Cd]=function(b){return a.handleEvent(b)}),a[Cd])}function H(){Uc.call(this),this.v=new hd(this),this.bc=this,this.hb=null}function qd(a,b,c,d,e){a.v.add(String(b),c,!1,d,e)}function wd(a,b,c,d,e){a.v.add(String(b),c,!0,d,e)}function Dd(a,b,c,d){if(!(b=a.v.a[String(b)]))return!0;b=b.concat();for(var e=!0,f=0;f<b.length;++f){var g=b[f];if(g&&!g.wa&&g.capture==c){var h=g.listener,m=g.Wa||g.src;g.Qa&&jd(a.v,g),e=!1!==h.call(m,d)&&e}}return e&&!d.defaultPrevented}function Ed(a,b,c){if(oa(a))c&&(a=q(a,c));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=q(a.handleEvent,a)}return 2147483647<Number(b)?-1:l.setTimeout(a,b||0)}function Fd(a){var b=null;return new D(function(c,d){-1==(b=Ed(function(){c(void 0)},a))&&d(Error("Failed to schedule timer."))}).o(function(c){throw l.clearTimeout(b),c})}function Gd(a){if(a.X&&"function"==typeof a.X)return a.X();if("string"==typeof a)return a.split("");if(na(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}for(d in b=[],c=0,a)b[c++]=a[d];return b}function Hd(a){if(a.Y&&"function"==typeof a.Y)return a.Y();if(!a.X||"function"!=typeof a.X){if(na(a)||"string"==typeof a){var b=[];a=a.length;for(var c=0;c<a;c++)b.push(c);return b}for(var d in b=[],c=0,a)b[c++]=d;return b}}function Id(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(na(a)||"string"==typeof a)w(a,b,void 0);else for(var c=Hd(a),d=Gd(a),e=d.length,f=0;f<e;f++)b.call(void 0,d[f],c&&c[f],a)}function Jd(a,b){this.b={},this.a=[],this.c=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a)if(a instanceof Jd)for(c=a.Y(),d=0;d<c.length;d++)this.set(c[d],a.get(c[d]));else for(d in a)this.set(d,a[d])}function Kd(a){if(a.c!=a.a.length){for(var b=0,c=0;b<a.a.length;){var d=a.a[b];Ld(a.b,d)&&(a.a[c++]=d),b++}a.a.length=c}if(a.c!=a.a.length){var e={};for(c=b=0;b<a.a.length;)Ld(e,d=a.a[b])||(a.a[c++]=d,e[d]=1),b++;a.a.length=c}}function Ld(a,b){return Object.prototype.hasOwnProperty.call(a,b)}__name(pd,"pd"),__name(H,"H"),r(H,Uc),H.prototype[dd]=!0,H.prototype.addEventListener=function(a,b,c,d){nd(this,a,b,c,d)},H.prototype.removeEventListener=function(a,b,c,d){xd(this,a,b,c,d)},H.prototype.dispatchEvent=function(a){var b,c=this.hb;if(c)for(b=[];c;c=c.hb)b.push(c);c=this.bc;var d=a.type||a;if("string"==typeof a)a=new G(a,c);else if(a instanceof G)a.target=a.target||c;else{var e=a;z(a=new G(d,c),e)}if(e=!0,b)for(var f=b.length-1;0<=f;f--){var g=a.b=b[f];e=Dd(g,d,!0,a)&&e}if(e=Dd(g=a.b=c,d,!0,a)&&e,e=Dd(g,d,!1,a)&&e,b)for(f=0;f<b.length;f++)e=Dd(g=a.b=b[f],d,!1,a)&&e;return e},H.prototype.Da=function(){if(H.bb.Da.call(this),this.v){var c,a=this.v;for(c in a.a){for(var d=a.a[c],e=0;e<d.length;e++)gd(d[e]);delete a.a[c],a.b--}}this.hb=null},__name(qd,"qd"),__name(wd,"wd"),__name(Dd,"Dd"),__name(Ed,"Ed"),__name(Fd,"Fd"),__name(Gd,"Gd"),__name(Hd,"Hd"),__name(Id,"Id"),__name(Jd,"Jd"),(k=Jd.prototype).X=function(){Kd(this);for(var a=[],b=0;b<this.a.length;b++)a.push(this.b[this.a[b]]);return a},k.Y=function(){return Kd(this),this.a.concat()},k.clear=function(){this.b={},this.c=this.a.length=0},__name(Kd,"Kd"),k.get=function(a,b){return Ld(this.b,a)?this.b[a]:b},k.set=function(a,b){Ld(this.b,a)||(this.c++,this.a.push(a)),this.b[a]=b},k.forEach=function(a,b){for(var c=this.Y(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}},__name(Ld,"Ld");var Md=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Nd(a,b){if(a){a=a.split("&");for(var c=0;c<a.length;c++){var d=a[c].indexOf("="),e=null;if(0<=d){var f=a[c].substring(0,d);e=a[c].substring(d+1)}else f=a[c];b(f,e?decodeURIComponent(e.replace(/\+/g," ")):"")}}}function Od(a,b){var c;this.a=this.l=this.c="",this.g=null,this.h=this.f="",this.i=!1,a instanceof Od?(this.i=void 0!==b?b:a.i,Pd(this,a.c),this.l=a.l,this.a=a.a,Qd(this,a.g),this.f=a.f,Rd(this,Sd(a.b)),this.h=a.h):a&&(c=String(a).match(Md))?(this.i=!!b,Pd(this,c[1]||"",!0),this.l=Td(c[2]||""),this.a=Td(c[3]||"",!0),Qd(this,c[4]),this.f=Td(c[5]||"",!0),Rd(this,c[6]||"",!0),this.h=Td(c[7]||"")):(this.i=!!b,this.b=new Ud(null,this.i))}function Pd(a,b,c){a.c=c?Td(b,!0):b,a.c&&(a.c=a.c.replace(/:$/,""))}function Qd(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.g=b}else a.g=null}function Rd(a,b,c){b instanceof Ud?(a.b=b,$d(a.b,a.i)):(c||(b=Vd(b,ae)),a.b=new Ud(b,a.i))}function I(a,b,c){a.b.set(b,c)}function be(a,b){return a.b.get(b)}function J(a){return a instanceof Od?new Od(a):new Od(a,void 0)}function ce(a,b,c,d){var e=new Od(null,void 0);return a&&Pd(e,a),b&&(e.a=b),c&&Qd(e,c),d&&(e.f=d),e}function Td(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Vd(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,de),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function de(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}__name(Nd,"Nd"),__name(Od,"Od"),Od.prototype.toString=function(){var a=[],b=this.c;b&&a.push(Vd(b,Wd,!0),":");var c=this.a;return(c||"file"==b)&&(a.push("//"),(b=this.l)&&a.push(Vd(b,Wd,!0),"@"),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(c=this.g)&&a.push(":",String(c))),(c=this.f)&&(this.a&&"/"!=c.charAt(0)&&a.push("/"),a.push(Vd(c,"/"==c.charAt(0)?Xd:Yd,!0))),(c=this.b.toString())&&a.push("?",c),(c=this.h)&&a.push("#",Vd(c,Zd)),a.join("")},Od.prototype.resolve=function(a){var b=new Od(this),c=!!a.c;c?Pd(b,a.c):c=!!a.l,c?b.l=a.l:c=!!a.a,c?b.a=a.a:c=null!=a.g;var d=a.f;if(c)Qd(b,a.g);else if(c=!!a.f){if("/"!=d.charAt(0))if(this.a&&!this.f)d="/"+d;else{var e=b.f.lastIndexOf("/");-1!=e&&(d=b.f.substr(0,e+1)+d)}if(".."==(e=d)||"."==e)d="";else if(x(e,"./")||x(e,"/.")){d=0==e.lastIndexOf("/",0),e=e.split("/");for(var f=[],g=0;g<e.length;){var h=e[g++];"."==h?d&&g==e.length&&f.push(""):".."==h?((1<f.length||1==f.length&&""!=f[0])&&f.pop(),d&&g==e.length&&f.push("")):(f.push(h),d=!0)}d=f.join("/")}else d=e}return c?b.f=d:c=""!==a.b.toString(),c?Rd(b,Sd(a.b)):c=!!a.h,c&&(b.h=a.h),b},__name(Pd,"Pd"),__name(Qd,"Qd"),__name(Rd,"Rd"),__name(I,"I"),__name(be,"be"),__name(J,"J"),__name(ce,"ce"),__name(Td,"Td"),__name(Vd,"Vd"),__name(de,"de");var Wd=/[#\/\?@]/g,Yd=/[#\?:]/g,Xd=/[#\?]/g,ae=/[#\?@]/g,Zd=/#/g;function Ud(a,b){this.b=this.a=null,this.c=a||null,this.f=!!b}function ee(a){a.a||(a.a=new Jd,a.b=0,a.c&&Nd(a.c,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)}))}function fe(a){var b=Hd(a);if(void 0===b)throw Error("Keys are undefined");var c=new Ud(null,void 0);a=Gd(a);for(var d=0;d<b.length;d++){var e=b[d],f=a[d];Array.isArray(f)?ge(c,e,f):c.add(e,f)}return c}function ie(a,b){ee(a),b=he(a,b),Ld(a.a.b,b)&&(a.c=null,a.b-=a.a.get(b).length,Ld((a=a.a).b,b)&&(delete a.b[b],a.c--,a.a.length>2*a.c&&Kd(a)))}function je(a,b){return ee(a),b=he(a,b),Ld(a.a.b,b)}function ge(a,b,c){ie(a,b),0<c.length&&(a.c=null,a.a.set(he(a,b),Za(c)),a.b+=c.length)}function Sd(a){var b=new Ud;return b.c=a.c,a.a&&(b.a=new Jd(a.a),b.b=a.b),b}function he(a,b){return b=String(b),a.f&&(b=b.toLowerCase()),b}function $d(a,b){b&&!a.f&&(ee(a),a.c=null,a.a.forEach(function(c,d){var e=d.toLowerCase();d!=e&&(ie(this,d),ge(this,e,c))},a)),a.f=b}function ke(a){var b=[];return le(new me,a,b),b.join("")}function me(){}function le(a,b,c){if(null==b)c.push("null");else{if("object"==typeof b){if(Array.isArray(b)){var d=b;b=d.length,c.push("[");for(var e="",f=0;f<b;f++)c.push(e),le(a,d[f],c),e=",";return void c.push("]")}if(!(b instanceof String||b instanceof Number||b instanceof Boolean)){for(d in c.push("{"),e="",b)Object.prototype.hasOwnProperty.call(b,d)&&("function"!=typeof(f=b[d])&&(c.push(e),ne(d,c),c.push(":"),le(a,f,c),e=","));return void c.push("}")}b=b.valueOf()}switch(typeof b){case"string":ne(b,c);break;case"number":c.push(isFinite(b)&&!isNaN(b)?String(b):"null");break;case"boolean":c.push(String(b));break;case"function":c.push("null");break;default:throw Error("Unknown type: "+typeof b)}}}__name(Ud,"Ud"),__name(ee,"ee"),__name(fe,"fe"),(k=Ud.prototype).add=function(a,b){ee(this),this.c=null,a=he(this,a);var c=this.a.get(a);return c||this.a.set(a,c=[]),c.push(b),this.b+=1,this},__name(ie,"ie"),k.clear=function(){this.a=this.c=null,this.b=0},__name(je,"je"),k.forEach=function(a,b){ee(this),this.a.forEach(function(c,d){w(c,function(e){a.call(b,e,d,this)},this)},this)},k.Y=function(){ee(this);for(var a=this.a.X(),b=this.a.Y(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c},k.X=function(a){ee(this);var b=[];if("string"==typeof a)je(this,a)&&(b=Ya(b,this.a.get(he(this,a))));else{a=this.a.X();for(var c=0;c<a.length;c++)b=Ya(b,a[c])}return b},k.set=function(a,b){return ee(this),this.c=null,je(this,a=he(this,a))&&(this.b-=this.a.get(a).length),this.a.set(a,[b]),this.b+=1,this},k.get=function(a,b){return a?0<(a=this.X(a)).length?String(a[0]):b:b},__name(ge,"ge"),k.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var a=[],b=this.a.Y(),c=0;c<b.length;c++){var d=b[c],e=encodeURIComponent(String(d));d=this.X(d);for(var f=0;f<d.length;f++){var g=e;""!==d[f]&&(g+="="+encodeURIComponent(String(d[f]))),a.push(g)}}return this.c=a.join("&")},__name(Sd,"Sd"),__name(he,"he"),__name($d,"$d"),__name(ke,"ke"),__name(me,"me"),__name(le,"le");var oe={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},pe=/\uffff/.test("\uffff")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function ne(a,b){b.push('"',a.replace(pe,function(c){var d=oe[c];return d||(d="\\u"+(65536|c.charCodeAt(0)).toString(16).substr(1),oe[c]=d),d}),'"')}function qe(){var a=K();return Wb&&!!ic&&11==ic||/Edge\/\d+/.test(a)}function re(){return l.window&&l.window.location.href||self&&self.location&&self.location.href||""}function se(a,b){b=b||l.window;var c="about:blank";a&&(c=Eb(Ib(a)||Kb)),b.location.href=c}function te(a,b){var d,c=[];for(d in a)d in b?typeof a[d]!=typeof b[d]?c.push(d):"object"==typeof a[d]&&null!=a[d]&&null!=b[d]?0<te(a[d],b[d]).length&&c.push(d):a[d]!==b[d]&&c.push(d):c.push(d);for(d in b)d in a||c.push(d);return c}function ue(){var a=K();return!((a=ve(a)!=we?null:(a=a.match(/\sChrome\/(\d+)/i))&&2==a.length?parseInt(a[1],10):null)&&30>a)&&(!Wb||!ic||9<ic)}function xe(a){return!!((a=(a||K()).toLowerCase()).match(/android/)||a.match(/webos/)||a.match(/iphone|ipad|ipod/)||a.match(/blackberry/)||a.match(/windows phone/)||a.match(/iemobile/))}function ye(a){a=a||l.window;try{a.close()}catch(b){}}function ze(a,b,c){var d=Math.floor(1e9*Math.random()).toString();b=b||500,c=c||600;var e=(window.screen.availHeight-c)/2,f=(window.screen.availWidth-b)/2;for(g in b={width:b,height:c,top:0<e?e:0,left:0<f?f:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},c=K().toLowerCase(),d&&(b.target=d,x(c,"crios/")&&(b.target="_blank")),ve(K())==Ae&&(a=a||"http://localhost",b.scrollbars=!0),c=a||"",(a=b)||(a={}),d=window,b=c instanceof C?c:Ib(void 0!==c.href?c.href:String(c))||Kb,c=a.target||c.target,e=[],a)switch(g){case"width":case"height":case"top":case"left":e.push(g+"="+a[g]);break;case"target":case"noopener":case"noreferrer":break;default:e.push(g+"="+(a[g]?1:0))}var g=e.join(",");if((y("iPhone")&&!y("iPod")&&!y("iPad")||y("iPad")||y("iPod"))&&d.navigator&&d.navigator.standalone&&c&&"_self"!=c?(pb(g=oc(document,"A"),"HTMLAnchorElement"),b=b instanceof C?b:Jb(b),g.href=Eb(b),g.setAttribute("target",c),a.noreferrer&&g.setAttribute("rel","noreferrer"),(a=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,d,1),g.dispatchEvent(a),g={}):a.noreferrer?(g=Pb("",d,c,g),a=Eb(b),g&&(Yb&&x(a,";")&&(a="'"+a.replace(/'/g,"%27")+"'"),g.opener=null,a='<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Rb(a)+'">',a=new Lb(a=(d=vb())?d.createHTML(a):a,null,Mb),d=g.document)&&(d.write(Nb(a)),d.close())):(g=Pb(b,d,c,g))&&a.noopener&&(g.opener=null),g)try{g.focus()}catch(h){}return g}function Be(a){return new D(function(b){function c(){Fd(2e3).then(function(){if(a&&!a.closed)return c();b()})}return __name(c,"c"),c()})}__name(ne,"ne"),__name(qe,"qe"),__name(re,"re"),__name(se,"se"),__name(te,"te"),__name(ue,"ue"),__name(xe,"xe"),__name(ye,"ye"),__name(ze,"ze"),__name(Be,"Be");var Ce=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,De=/^[^@]+@[^@]+$/;function Ee(){var a=null;return new D(function(b){"complete"==l.document.readyState?b():(a=__name(function(){b()},"a"),od(window,"load",a))}).o(function(b){throw xd(window,"load",a),b})}function Fe(){return Ge(void 0)?Ee().then(function(){return new D(function(a,b){var c=l.document,d=setTimeout(function(){b(Error("Cordova framework is not ready."))},1e3);c.addEventListener("deviceready",function(){clearTimeout(d),a()},!1)})}):F(Error("Cordova must run in an Android or iOS file scheme."))}function Ge(a){return a=a||K(),!("file:"!==He()&&"ionic:"!==He()||!a.toLowerCase().match(/iphone|ipad|ipod|android/))}function Ie(){var a=l.window;try{return!(!a||a==a.top)}catch(b){return!1}}function Je(){return void 0!==l.WorkerGlobalScope&&"function"==typeof l.importScripts}function Ke(){return firebase.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":firebase.INTERNAL.hasOwnProperty("node")?"Node":Je()?"Worker":"Browser"}function Le(){var a=Ke();return"ReactNative"===a||"Node"===a}function Me(){for(var a=50,b=[];0<a;)b.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),a--;return b.join("")}__name(Ee,"Ee"),__name(Fe,"Fe"),__name(Ge,"Ge"),__name(Ie,"Ie"),__name(Je,"Je"),__name(Ke,"Ke"),__name(Le,"Le"),__name(Me,"Me");var Ae="Firefox",we="Chrome";function ve(a){var b=a.toLowerCase();return x(b,"opera/")||x(b,"opr/")||x(b,"opios/")?"Opera":x(b,"iemobile")?"IEMobile":x(b,"msie")||x(b,"trident/")?"IE":x(b,"edge/")?"Edge":x(b,"firefox/")?Ae:x(b,"silk/")?"Silk":x(b,"blackberry")?"Blackberry":x(b,"webos")?"Webos":!x(b,"safari/")||x(b,"chrome/")||x(b,"crios/")||x(b,"android")?!x(b,"chrome/")&&!x(b,"crios/")||x(b,"edge/")?x(b,"android")?"Android":(a=a.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==a.length?a[1]:"Other":we:"Safari"}__name(ve,"ve");var Ne={md:"FirebaseCore-web",od:"FirebaseUI-web"};function Oe(a,b){b=b||[];var e,c=[],d={};for(e in Ne)d[Ne[e]]=!0;for(e=0;e<b.length;e++)void 0!==d[b[e]]&&(delete d[b[e]],c.push(b[e]));return c.sort(),(b=c).length||(b=["FirebaseCore-web"]),"Browser"===(c=Ke())?c=ve(d=K()):"Worker"===c&&(c=ve(d=K())+"-"+c),c+"/JsCore/"+a+"/"+b.join(",")}function K(){return l.navigator&&l.navigator.userAgent||""}function L(a,b){a=a.split("."),b=b||l;for(var c=0;c<a.length&&"object"==typeof b&&null!=b;c++)b=b[a[c]];return c!=a.length&&(b=void 0),b}function Pe(){try{var a=l.localStorage,b=Qe();if(a)return a.setItem(b,"1"),a.removeItem(b),!qe()||!!l.indexedDB}catch(c){return Je()&&!!l.indexedDB}return!1}function Re(){return(Se()||"chrome-extension:"===He()||Ge())&&!Le()&&Pe()&&!Je()}function Se(){return"http:"===He()||"https:"===He()}function He(){return l.location&&l.location.protocol||null}function Te(a){return!(xe(a=a||K())||ve(a)==Ae)}function Ue(a){return void 0===a?null:ke(a)}function Ve(a){var c,b={};for(c in a)a.hasOwnProperty(c)&&null!==a[c]&&void 0!==a[c]&&(b[c]=a[c]);return b}function We(a){if(null!==a)return JSON.parse(a)}function Qe(a){return a||Math.floor(1e9*Math.random()).toString()}function Xe(a){return!("Safari"==ve(a=a||K())||a.toLowerCase().match(/iphone|ipad|ipod/))}function Ye(){var a=l.___jsl;if(a&&a.H)for(var b in a.H)if(a.H[b].r=a.H[b].r||[],a.H[b].L=a.H[b].L||[],a.H[b].r=a.H[b].L.concat(),a.CP)for(var c=0;c<a.CP.length;c++)a.CP[c]=null}function Ze(a,b){if(a>b)throw Error("Short delay should be less than long delay!");this.a=a,this.c=b,a=K(),b=Ke(),this.b=xe(a)||"ReactNative"===b}function $e(){var a=l.document;return!a||void 0===a.visibilityState||"visible"==a.visibilityState}function af(){var a=l.document,b=null;return $e()||!a?E():new D(function(c){b=__name(function(){$e()&&(a.removeEventListener("visibilitychange",b,!1),c())},"b"),a.addEventListener("visibilitychange",b,!1)}).o(function(c){throw a.removeEventListener("visibilitychange",b,!1),c})}function bf(a){try{var b=new Date(parseInt(a,10));if(!isNaN(b.getTime())&&!/[^0-9]/.test(a))return b.toUTCString()}catch(c){}return null}function cf(){return!(!L("fireauth.oauthhelper",l)&&!L("fireauth.iframe",l))}function df(){var a=l.navigator;return a&&a.serviceWorker&&a.serviceWorker.controller||null}function ef(){var a=l.navigator;return a&&a.serviceWorker?E().then(function(){return a.serviceWorker.ready}).then(function(b){return b.active||null}).o(function(){return null}):E(null)}__name(Oe,"Oe"),__name(K,"K"),__name(L,"L"),__name(Pe,"Pe"),__name(Re,"Re"),__name(Se,"Se"),__name(He,"He"),__name(Te,"Te"),__name(Ue,"Ue"),__name(Ve,"Ve"),__name(We,"We"),__name(Qe,"Qe"),__name(Xe,"Xe"),__name(Ye,"Ye"),__name(Ze,"Ze"),Ze.prototype.get=function(){var a=l.navigator;return!a||"boolean"!=typeof a.onLine||!Se()&&"chrome-extension:"!==He()&&void 0===a.connection||a.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)},__name($e,"$e"),__name(af,"af"),__name(bf,"bf"),__name(cf,"cf"),__name(df,"df"),__name(ef,"ef");var hf,ff={};function gf(a){ff[a]||(ff[a]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(a))}__name(gf,"gf");try{var jf={};Object.defineProperty(jf,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(jf,"abcd",{configurable:!0,enumerable:!0,value:2}),hf=2==jf.abcd}catch(a){hf=!1}function M(a,b,c){hf?Object.defineProperty(a,b,{configurable:!0,enumerable:!0,value:c}):a[b]=c}function N(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&M(a,c,b[c])}function kf(a){var b={};return N(b,a),b}function lf(a){var c,b={};for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function mf(a,b){if(!b||!b.length)return!0;if(!a)return!1;for(var c=0;c<b.length;c++){var d=a[b[c]];if(null==d||""===d)return!1}return!0}function nf(a){var b=a;if("object"==typeof a&&null!=a)for(var c in b="length"in a?[]:{},a)M(b,c,nf(a[c]));return b}function of(a){var b=a&&(a[pf]?"phone":null);if(!(b&&a&&a[qf]))throw new t("internal-error","Internal assert: invalid MultiFactorInfo object");M(this,"uid",a[qf]),M(this,"displayName",a[rf]||null);var c=null;a[sf]&&(c=new Date(a[sf]).toUTCString()),M(this,"enrollmentTime",c),M(this,"factorId",b)}function tf(a){try{var b=new uf(a)}catch(c){b=null}return b}__name(M,"M"),__name(N,"N"),__name(kf,"kf"),__name(lf,"lf"),__name(mf,"mf"),__name(nf,"nf"),__name(of,"of"),of.prototype.w=function(){return{uid:this.uid,displayName:this.displayName,factorId:this.factorId,enrollmentTime:this.enrollmentTime}},__name(tf,"tf");var rf="displayName",sf="enrolledAt",qf="mfaEnrollmentId",pf="phoneInfo";function uf(a){of.call(this,a),M(this,"phoneNumber",a[pf])}function vf(a){var b={},c=a[wf],d=a[xf],e=a[yf];if(a=tf(a[zf]),!e||e!=Af&&e!=Bf&&!c||e==Bf&&!d||e==Cf&&!a)throw Error("Invalid checkActionCode response!");e==Bf?(b[Df]=c||null,b[Ef]=c||null,b[Ff]=d):(b[Df]=d||null,b[Ef]=d||null,b[Ff]=c||null),b[Gf]=a||null,M(this,Hf,e),M(this,If,nf(b))}__name(uf,"uf"),r(uf,of),uf.prototype.w=function(){var a=uf.bb.w.call(this);return a.phoneNumber=this.phoneNumber,a},__name(vf,"vf");var Cf="REVERT_SECOND_FACTOR_ADDITION",Af="EMAIL_SIGNIN",Bf="VERIFY_AND_CHANGE_EMAIL",wf="email",zf="mfaInfo",xf="newEmail",yf="requestType",Ff="email",Df="fromEmail",Gf="multiFactorInfo",Ef="previousEmail",If="data",Hf="operation";function Jf(a){var b=be(a=J(a),Kf)||null,c=be(a,Lf)||null,d=be(a,Mf)||null;if(d=d&&Nf[d]||null,!b||!c||!d)throw new t("argument-error",Kf+", "+Lf+"and "+Mf+" are required in a valid action code URL.");N(this,{apiKey:b,operation:d,code:c,continueUrl:be(a,Of)||null,languageCode:be(a,Pf)||null,tenantId:be(a,Qf)||null})}__name(Jf,"Jf");var Kf="apiKey",Lf="oobCode",Of="continueUrl",Pf="languageCode",Mf="mode",Qf="tenantId",Nf={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",revertSecondFactorAddition:Cf,signIn:Af,verifyAndChangeEmail:Bf,verifyEmail:"VERIFY_EMAIL"};function Rf(a){try{return new Jf(a)}catch(b){return null}}function Sf(a){var b=a[Tf];if(void 0===b)throw new t("missing-continue-uri");if("string"!=typeof b||"string"==typeof b&&!b.length)throw new t("invalid-continue-uri");this.h=b,this.b=this.a=null,this.g=!1;var c=a[Uf];if(c&&"object"==typeof c){b=c[Vf];var d=c[Wf];if(c=c[Xf],"string"==typeof b&&b.length){if(this.a=b,void 0!==d&&"boolean"!=typeof d)throw new t("argument-error",Wf+" property must be a boolean when specified.");if(this.g=!!d,void 0!==c&&("string"!=typeof c||"string"==typeof c&&!c.length))throw new t("argument-error",Xf+" property must be a non empty string when specified.");this.b=c||null}else{if(void 0!==b)throw new t("argument-error",Vf+" property must be a non empty string when specified.");if(void 0!==d||void 0!==c)throw new t("missing-android-pkg-name")}}else if(void 0!==c)throw new t("argument-error",Uf+" property must be a non null object when specified.");if(this.f=null,(b=a[Yf])&&"object"==typeof b){if("string"==typeof(b=b[Zf])&&b.length)this.f=b;else if(void 0!==b)throw new t("argument-error",Zf+" property must be a non empty string when specified.")}else if(void 0!==b)throw new t("argument-error",Yf+" property must be a non null object when specified.");if(void 0!==(b=a[$f])&&"boolean"!=typeof b)throw new t("argument-error",$f+" property must be a boolean when specified.");if(this.c=!!b,void 0!==(a=a[ag])&&("string"!=typeof a||"string"==typeof a&&!a.length))throw new t("argument-error",ag+" property must be a non empty string when specified.");this.i=a||null}__name(Rf,"Rf"),__name(Sf,"Sf");var Uf="android",ag="dynamicLinkDomain",$f="handleCodeInApp",Yf="iOS",Tf="url",Wf="installApp",Xf="minimumVersion",Vf="packageName",Zf="bundleId";function bg(a){var b={};for(var c in b.continueUrl=a.h,b.canHandleCodeInApp=a.c,(b.androidPackageName=a.a)&&(b.androidMinimumVersion=a.b,b.androidInstallApp=a.g),b.iOSBundleId=a.f,b.dynamicLinkDomain=a.i,b)null===b[c]&&delete b[c];return b}function cg(a){return Ra(a,function(b){return 1<(b=b.toString(16)).length?b:"0"+b}).join("")}__name(bg,"bg"),__name(cg,"cg");var dg=null;function eg(a){var b=[];return fg(a,function(c){b.push(c)}),b}function fg(a,b){function c(m){for(;d<a.length;){var p=a.charAt(d++),v=dg[p];if(null!=v)return v;if(!/^[\s\xa0]*$/.test(p))throw Error("Unknown base64 encoding at char: "+p)}return m}__name(c,"c"),gg();for(var d=0;;){var e=c(-1),f=c(0),g=c(64),h=c(64);if(64===h&&-1===e)break;b(e<<2|f>>4),64!=g&&(b(f<<4&240|g>>2),64!=h&&b(g<<6&192|h))}}function gg(){if(!dg){dg={};for(var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),b=["+/=","+/","-_=","-_.","-_"],c=0;5>c;c++)for(var d=a.concat(b[c].split("")),e=0;e<d.length;e++){var f=d[e];void 0===dg[f]&&(dg[f]=e)}}}function hg(a){var b=ig(a);if(!(b&&b.sub&&b.iss&&b.aud&&b.exp))throw Error("Invalid JWT");this.h=a,this.a=b.exp,this.i=b.sub,a=Date.now()/1e3,this.g=b.iat||(a>this.a?this.a:a),this.b=b.provider_id||b.firebase&&b.firebase.sign_in_provider||null,this.f=b.firebase&&b.firebase.tenant||null,this.c=!!b.is_anonymous||"anonymous"==this.b}function jg(a){try{return new hg(a)}catch(b){return null}}function ig(a){if(!a||3!=(a=a.split(".")).length)return null;for(var b=(4-(a=a[1]).length%4)%4,c=0;c<b;c++)a+=".";try{var d=eg(a);for(a=[],c=b=0;b<d.length;){var e=d[b++];if(128>e)a[c++]=String.fromCharCode(e);else if(191<e&&224>e){var f=d[b++];a[c++]=String.fromCharCode((31&e)<<6|63&f)}else if(239<e&&365>e){f=d[b++];var g=d[b++],m=((7&e)<<18|(63&f)<<12|(63&g)<<6|63&d[b++])-65536;a[c++]=String.fromCharCode(55296+(m>>10)),a[c++]=String.fromCharCode(56320+(1023&m))}else f=d[b++],g=d[b++],a[c++]=String.fromCharCode((15&e)<<12|(63&f)<<6|63&g)}return JSON.parse(a.join(""))}catch(p){}return null}__name(eg,"eg"),__name(fg,"fg"),__name(gg,"gg"),__name(hg,"hg"),hg.prototype.T=function(){return this.f},hg.prototype.l=function(){return this.c},hg.prototype.toString=function(){return this.h},__name(jg,"jg"),__name(ig,"ig");var kg="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),lg=["client_id","response_type","scope","redirect_uri","state"],mg={nd:{Ja:"locale",va:700,ua:600,fa:"facebook.com",Ya:lg},pd:{Ja:null,va:500,ua:750,fa:"github.com",Ya:lg},qd:{Ja:"hl",va:515,ua:680,fa:"google.com",Ya:lg},wd:{Ja:"lang",va:485,ua:705,fa:"twitter.com",Ya:kg},kd:{Ja:"locale",va:640,ua:600,fa:"apple.com",Ya:[]}};function ng(a){for(var b in mg)if(mg[b].fa==a)return mg[b];return null}function og(a){var b={};b["facebook.com"]=pg,b["google.com"]=qg,b["github.com"]=rg,b["twitter.com"]=sg;var c=a&&a[tg];try{if(c)return b[c]?new b[c](a):new ug(a);if(void 0!==a[vg])return new wg(a)}catch(d){}return null}__name(ng,"ng"),__name(og,"og");var vg="idToken",tg="providerId";function wg(a){var b=a[tg];if(!b&&a[vg]){var c=jg(a[vg]);c&&c.b&&(b=c.b)}if(!b)throw Error("Invalid additional user info!");("anonymous"==b||"custom"==b)&&(b=null),c=!1,void 0!==a.isNewUser?c=!!a.isNewUser:"identitytoolkit#SignupNewUserResponse"===a.kind&&(c=!0),M(this,"providerId",b),M(this,"isNewUser",c)}function ug(a){wg.call(this,a),M(this,"profile",nf((a=We(a.rawUserInfo||"{}"))||{}))}function pg(a){if(ug.call(this,a),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function rg(a){if(ug.call(this,a),"github.com"!=this.providerId)throw Error("Invalid provider ID!");M(this,"username",this.profile&&this.profile.login||null)}function qg(a){if(ug.call(this,a),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function sg(a){if(ug.call(this,a),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");M(this,"username",a.screenName||null)}function xg(a){var b=J(a),c=be(b,"link"),d=be(J(c),"link");return b=be(b,"deep_link_id"),be(J(b),"link")||b||d||c||a}function yg(a,b){if(!a&&!b)throw new t("internal-error","Internal assert: no raw session string available");if(a&&b)throw new t("internal-error","Internal assert: unable to determine the session type");this.a=a||null,this.b=b||null,this.type=this.a?zg:Ag}__name(wg,"wg"),__name(ug,"ug"),r(ug,wg),__name(pg,"pg"),r(pg,ug),__name(rg,"rg"),r(rg,ug),__name(qg,"qg"),r(qg,ug),__name(sg,"sg"),r(sg,ug),__name(xg,"xg"),__name(yg,"yg");var zg="enroll",Ag="signin";function Bg(){}function Cg(a,b){return a.then(function(c){if(c[Dg]){var d=jg(c[Dg]);if(!d||b!=d.i)throw new t("user-mismatch");return c}throw new t("user-mismatch")}).o(function(c){throw c&&c.code&&c.code==xa+"user-not-found"?new t("user-mismatch"):c})}function Eg(a,b){if(!b)throw new t("internal-error","failed to construct a credential");this.a=b,M(this,"providerId",a),M(this,"signInMethod",a)}function Gg(a){return{pendingToken:a.a,requestUri:"http://localhost"}}function Jg(a){if(a&&a.providerId&&a.signInMethod&&0==a.providerId.indexOf("saml.")&&a.pendingToken)try{return new Eg(a.providerId,a.pendingToken)}catch(b){}return null}function Kg(a,b,c){if(this.a=null,b.idToken||b.accessToken)b.idToken&&M(this,"idToken",b.idToken),b.accessToken&&M(this,"accessToken",b.accessToken),b.nonce&&!b.pendingToken&&M(this,"nonce",b.nonce),b.pendingToken&&(this.a=b.pendingToken);else{if(!b.oauthToken||!b.oauthTokenSecret)throw new t("internal-error","failed to construct a credential");M(this,"accessToken",b.oauthToken),M(this,"secret",b.oauthTokenSecret)}M(this,"providerId",a),M(this,"signInMethod",c)}function Lg(a){var b={};return a.idToken&&(b.id_token=a.idToken),a.accessToken&&(b.access_token=a.accessToken),a.secret&&(b.oauth_token_secret=a.secret),b.providerId=a.providerId,a.nonce&&!a.a&&(b.nonce=a.nonce),b={postBody:fe(b).toString(),requestUri:"http://localhost"},a.a&&(delete b.postBody,b.pendingToken=a.a),b}function Mg(a){if(a&&a.providerId&&a.signInMethod){var b={idToken:a.oauthIdToken,accessToken:a.oauthTokenSecret?null:a.oauthAccessToken,oauthTokenSecret:a.oauthTokenSecret,oauthToken:a.oauthTokenSecret&&a.oauthAccessToken,nonce:a.nonce,pendingToken:a.pendingToken};try{return new Kg(a.providerId,b,a.signInMethod)}catch(c){}}return null}function Ng(a,b){this.Qc=b||[],N(this,{providerId:a,isOAuthProvider:!0}),this.Jb={},this.qb=(ng(a)||{}).Ja||null,this.pb=null}function Og(a){if("string"!=typeof a||0!=a.indexOf("saml."))throw new t("argument-error",'SAML provider IDs must be prefixed with "saml."');Ng.call(this,a,[])}function Pg(a){Ng.call(this,a,lg),this.a=[]}function Qg(){Pg.call(this,"facebook.com")}function Rg(a){if(!a)throw new t("argument-error","credential failed: expected 1 argument (the OAuth access token).");var b=a;return n(a)&&(b=a.accessToken),(new Qg).credential({accessToken:b})}function Sg(){Pg.call(this,"github.com")}function Tg(a){if(!a)throw new t("argument-error","credential failed: expected 1 argument (the OAuth access token).");var b=a;return n(a)&&(b=a.accessToken),(new Sg).credential({accessToken:b})}function Ug(){Pg.call(this,"google.com"),this.Ca("profile")}function Vg(a,b){var c=a;return n(a)&&(c=a.idToken,b=a.accessToken),(new Ug).credential({idToken:c,accessToken:b})}function Wg(){Ng.call(this,"twitter.com",kg)}function Xg(a,b){var c=a;if(n(c)||(c={oauthToken:a,oauthTokenSecret:b}),!c.oauthToken||!c.oauthTokenSecret)throw new t("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Kg("twitter.com",c,"twitter.com")}function Yg(a,b,c){this.a=a,this.f=b,M(this,"providerId","password"),M(this,"signInMethod",c===Zg.EMAIL_LINK_SIGN_IN_METHOD?Zg.EMAIL_LINK_SIGN_IN_METHOD:Zg.EMAIL_PASSWORD_SIGN_IN_METHOD)}function dh(a){return a&&a.email&&a.password?new Yg(a.email,a.password,a.signInMethod):null}function Zg(){N(this,{providerId:"password",isOAuthProvider:!1})}function eh(a,b){if(!(b=fh(b)))throw new t("argument-error","Invalid email link!");return new Yg(a,b.code,Zg.EMAIL_LINK_SIGN_IN_METHOD)}function fh(a){return(a=Rf(a=xg(a)))&&a.operation===Af?a:null}function gh(a){if(!(a.fb&&a.eb||a.La&&a.ea))throw new t("internal-error");this.a=a,M(this,"providerId","phone"),this.fa="phone",M(this,"signInMethod","phone")}function kh(a){if(a&&"phone"===a.providerId&&(a.verificationId&&a.verificationCode||a.temporaryProof&&a.phoneNumber)){var b={};return w(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(c){a[c]&&(b[c]=a[c])}),new gh(b)}return null}function hh(a){return a.a.La&&a.a.ea?{temporaryProof:a.a.La,phoneNumber:a.a.ea}:{sessionInfo:a.a.fb,code:a.a.eb}}function lh(a){try{this.a=a||firebase.auth()}catch(b){throw new t("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}N(this,{providerId:"phone",isOAuthProvider:!1})}function ph(a,b){if(!a)throw new t("missing-verification-id");if(!b)throw new t("missing-verification-code");return new gh({fb:a,eb:b})}function qh(a){if(a.temporaryProof&&a.phoneNumber)return new gh({La:a.temporaryProof,ea:a.phoneNumber});var b=a&&a.providerId;if(!b||"password"===b)return null;var c=a&&a.oauthAccessToken,d=a&&a.oauthTokenSecret,e=a&&a.nonce,f=a&&a.oauthIdToken,g=a&&a.pendingToken;try{switch(b){case"google.com":return Vg(f,c);case"facebook.com":return Rg(c);case"github.com":return Tg(c);case"twitter.com":return Xg(c,d);default:return c||d||f||g?g?0==b.indexOf("saml.")?new Eg(b,g):new Kg(b,{pendingToken:g,idToken:a.oauthIdToken,accessToken:a.oauthAccessToken},b):new Pg(b).credential({idToken:f,accessToken:c,rawNonce:e}):null}}catch(h){return null}}function rh(a){if(!a.isOAuthProvider)throw new t("invalid-oauth-provider")}function sh(a,b,c,d,e,f,g){if(this.c=a,this.b=b||null,this.g=c||null,this.f=d||null,this.i=f||null,this.h=g||null,this.a=e||null,!this.g&&!this.a)throw new t("invalid-auth-event");if(this.g&&this.a)throw new t("invalid-auth-event");if(this.g&&!this.f)throw new t("invalid-auth-event")}function th(a){return(a=a||{}).type?new sh(a.type,a.eventId,a.urlResponse,a.sessionId,a.error&&Aa(a.error),a.postBody,a.tenantId):null}function uh(){this.b=null,this.a=[]}yg.prototype.Ha=function(){return this.a?E(this.a):E(this.b)},yg.prototype.w=function(){return this.type==zg?{multiFactorSession:{idToken:this.a}}:{multiFactorSession:{pendingCredential:this.b}}},__name(Bg,"Bg"),Bg.prototype.ka=function(){},Bg.prototype.b=function(){},Bg.prototype.c=function(){},Bg.prototype.w=function(){},__name(Cg,"Cg"),__name(Eg,"Eg"),Eg.prototype.ka=function(a){return Fg(a,Gg(this))},Eg.prototype.b=function(a,b){var c=Gg(this);return c.idToken=b,Hg(a,c)},Eg.prototype.c=function(a,b){return Cg(Ig(a,Gg(this)),b)},__name(Gg,"Gg"),Eg.prototype.w=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},__name(Jg,"Jg"),__name(Kg,"Kg"),Kg.prototype.ka=function(a){return Fg(a,Lg(this))},Kg.prototype.b=function(a,b){var c=Lg(this);return c.idToken=b,Hg(a,c)},Kg.prototype.c=function(a,b){return Cg(Ig(a,Lg(this)),b)},__name(Lg,"Lg"),Kg.prototype.w=function(){var a={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(a.oauthIdToken=this.idToken),this.accessToken&&(a.oauthAccessToken=this.accessToken),this.secret&&(a.oauthTokenSecret=this.secret),this.nonce&&(a.nonce=this.nonce),this.a&&(a.pendingToken=this.a),a},__name(Mg,"Mg"),__name(Ng,"Ng"),Ng.prototype.Ka=function(a){return this.Jb=nb(a),this},__name(Og,"Og"),r(Og,Ng),__name(Pg,"Pg"),r(Pg,Ng),Pg.prototype.Ca=function(a){return Va(this.a,a)||this.a.push(a),this},Pg.prototype.Rb=function(){return Za(this.a)},Pg.prototype.credential=function(a,b){var c;if(!(c=n(a)?{idToken:a.idToken||null,accessToken:a.accessToken||null,nonce:a.rawNonce||null}:{idToken:a||null,accessToken:b||null}).idToken&&!c.accessToken)throw new t("argument-error","credential failed: must provide the ID token and/or the access token.");return new Kg(this.providerId,c,this.providerId)},__name(Qg,"Qg"),r(Qg,Pg),M(Qg,"PROVIDER_ID","facebook.com"),M(Qg,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),__name(Rg,"Rg"),__name(Sg,"Sg"),r(Sg,Pg),M(Sg,"PROVIDER_ID","github.com"),M(Sg,"GITHUB_SIGN_IN_METHOD","github.com"),__name(Tg,"Tg"),__name(Ug,"Ug"),r(Ug,Pg),M(Ug,"PROVIDER_ID","google.com"),M(Ug,"GOOGLE_SIGN_IN_METHOD","google.com"),__name(Vg,"Vg"),__name(Wg,"Wg"),r(Wg,Ng),M(Wg,"PROVIDER_ID","twitter.com"),M(Wg,"TWITTER_SIGN_IN_METHOD","twitter.com"),__name(Xg,"Xg"),__name(Yg,"Yg"),Yg.prototype.ka=function(a){return this.signInMethod==Zg.EMAIL_LINK_SIGN_IN_METHOD?O(a,$g,{email:this.a,oobCode:this.f}):O(a,ah,{email:this.a,password:this.f})},Yg.prototype.b=function(a,b){return this.signInMethod==Zg.EMAIL_LINK_SIGN_IN_METHOD?O(a,bh,{idToken:b,email:this.a,oobCode:this.f}):O(a,ch,{idToken:b,email:this.a,password:this.f})},Yg.prototype.c=function(a,b){return Cg(this.ka(a),b)},Yg.prototype.w=function(){return{email:this.a,password:this.f,signInMethod:this.signInMethod}},__name(dh,"dh"),__name(Zg,"Zg"),__name(eh,"eh"),__name(fh,"fh"),N(Zg,{PROVIDER_ID:"password"}),N(Zg,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),N(Zg,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),__name(gh,"gh"),gh.prototype.ka=function(a){return a.gb(hh(this))},gh.prototype.b=function(a,b){var c=hh(this);return c.idToken=b,O(a,ih,c)},gh.prototype.c=function(a,b){var c=hh(this);return c.operation="REAUTH",Cg(a=O(a,jh,c),b)},gh.prototype.w=function(){var a={providerId:"phone"};return this.a.fb&&(a.verificationId=this.a.fb),this.a.eb&&(a.verificationCode=this.a.eb),this.a.La&&(a.temporaryProof=this.a.La),this.a.ea&&(a.phoneNumber=this.a.ea),a},__name(kh,"kh"),__name(hh,"hh"),__name(lh,"lh"),lh.prototype.gb=function(a,b){var c=this.a.a;return E(b.verify()).then(function(d){if("string"!=typeof d)throw new t("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(b.type){case"recaptcha":var e=n(a)?a.session:null,f=n(a)?a.phoneNumber:a;return(e&&e.type==zg?e.Ha().then(function(h){return mh(c,{idToken:h,phoneEnrollmentInfo:{phoneNumber:f,recaptchaToken:d}})}):e&&e.type==Ag?e.Ha().then(function(h){return nh(c,{mfaPendingCredential:h,mfaEnrollmentId:a.multiFactorHint&&a.multiFactorHint.uid||a.multiFactorUid,phoneSignInInfo:{recaptchaToken:d}})}):oh(c,{phoneNumber:f,recaptchaToken:d})).then(function(h){return"function"==typeof b.reset&&b.reset(),h},function(h){throw"function"==typeof b.reset&&b.reset(),h});default:throw new t("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},__name(ph,"ph"),N(lh,{PROVIDER_ID:"phone"}),N(lh,{PHONE_SIGN_IN_METHOD:"phone"}),__name(qh,"qh"),__name(rh,"rh"),__name(sh,"sh"),sh.prototype.getUid=function(){var a=[];return a.push(this.c),this.b&&a.push(this.b),this.f&&a.push(this.f),this.h&&a.push(this.h),a.join("-")},sh.prototype.T=function(){return this.h},sh.prototype.w=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.w()}},__name(th,"th"),__name(uh,"uh");var Ch,vh=null;function wh(a){var b=vh;b.a.push(a),b.b||(b.b=function(c){for(var d=0;d<b.a.length;d++)b.a[d](c)},"function"==typeof(a=L("universalLinks.subscribe",l))&&a(null,b.b))}function xh(a){var b="unauthorized-domain",c=void 0,d=J(a);a=d.a,"chrome-extension"==(d=d.c)?c=Qb("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",a):"http"==d||"https"==d?c=Qb("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",a):b="operation-not-supported-in-this-environment",t.call(this,b,c)}function yh(a,b,c){t.call(this,a,c),(a=b||{}).Kb&&M(this,"email",a.Kb),a.ea&&M(this,"phoneNumber",a.ea),a.credential&&M(this,"credential",a.credential),a.$b&&M(this,"tenantId",a.$b)}function zh(a){if(a.code){var b=a.code||"";0==b.indexOf(xa)&&(b=b.substring(xa.length));var c={credential:qh(a),$b:a.tenantId};if(a.email)c.Kb=a.email;else if(a.phoneNumber)c.ea=a.phoneNumber;else if(!c.credential)return new t(b,a.message||void 0);return new yh(b,c,a.message)}return null}function Ah(){}function Bh(a){return a.c||(a.c=a.b())}function Dh(){}function Eh(a){if(!a.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var b=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],c=0;c<b.length;c++){var d=b[c];try{return new ActiveXObject(d),a.f=d}catch(e){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return a.f}function Fh(){}function Gh(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=q(this.qc,this),this.a.onerror=q(this.Tb,this),this.a.onprogress=q(this.rc,this),this.a.ontimeout=q(this.vc,this)}function Hh(a,b){a.readyState=b,a.onreadystatechange&&a.onreadystatechange()}function Ih(a,b,c){this.reset(a,b,c,void 0,void 0)}__name(wh,"wh"),__name(xh,"xh"),r(xh,t),__name(yh,"yh"),r(yh,t),yh.prototype.w=function(){var a={code:this.code,message:this.message};this.email&&(a.email=this.email),this.phoneNumber&&(a.phoneNumber=this.phoneNumber),this.tenantId&&(a.tenantId=this.tenantId);var b=this.credential&&this.credential.w();return b&&z(a,b),a},yh.prototype.toJSON=function(){return this.w()},__name(zh,"zh"),__name(Ah,"Ah"),Ah.prototype.c=null,__name(Bh,"Bh"),__name(Dh,"Dh"),r(Dh,Ah),Dh.prototype.a=function(){var a=Eh(this);return a?new ActiveXObject(a):new XMLHttpRequest},Dh.prototype.b=function(){var a={};return Eh(this)&&(a[0]=!0,a[1]=!0),a},__name(Eh,"Eh"),Ch=new Dh,__name(Fh,"Fh"),r(Fh,Ah),Fh.prototype.a=function(){var a=new XMLHttpRequest;if("withCredentials"in a)return a;if("undefined"!=typeof XDomainRequest)return new Gh;throw Error("Unsupported browser")},Fh.prototype.b=function(){return{}},__name(Gh,"Gh"),(k=Gh.prototype).open=function(a,b,c){if(null!=c&&!c)throw Error("Only async requests are supported.");this.a.open(a,b)},k.send=function(a){if(a){if("string"!=typeof a)throw Error("Only string data is supported");this.a.send(a)}else this.a.send()},k.abort=function(){this.a.abort()},k.setRequestHeader=function(){},k.getResponseHeader=function(a){return"content-type"==a.toLowerCase()?this.a.contentType:""},k.qc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Hh(this,4)},k.Tb=function(){this.status=500,this.response=this.responseText="",Hh(this,4)},k.vc=function(){this.Tb()},k.rc=function(){this.status=200,Hh(this,1)},__name(Hh,"Hh"),k.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},__name(Ih,"Ih"),Ih.prototype.a=null;function Kh(a){this.f=a,this.b=this.c=this.a=null}function Lh(a,b){this.name=a,this.value=b}Ih.prototype.reset=function(a,b,c,d,e){"number"==typeof e||0,d||va(),delete this.a},__name(Kh,"Kh"),__name(Lh,"Lh"),Lh.prototype.toString=function(){return this.name};var Mh=new Lh("SEVERE",1e3),Nh=new Lh("WARNING",900),Oh=new Lh("CONFIG",700),Ph=new Lh("FINE",500);function Qh(a){return a.c?a.c:a.a?Qh(a.a):(Ga("Root logger has no level set."),null)}__name(Qh,"Qh"),Kh.prototype.log=function(a,b,c){if(a.value>=Qh(this).value)for(oa(b)&&(b=b()),a=new Ih(a,String(b),this.f),c&&(a.a=c),c=this;c;)c=c.a};var Rh={},Sh=null;function Th(a){var b;if(Sh||(Sh=new Kh(""),Rh[""]=Sh,Sh.c=Oh),!(b=Rh[a])){b=new Kh(a);var c=a.lastIndexOf("."),d=a.substr(c+1);(c=Th(a.substr(0,c))).b||(c.b={}),c.b[d]=b,b.a=c,Rh[a]=b}return b}function Uh(a,b){a&&a.log(Ph,b,void 0)}function Vh(a){this.f=a}function Wh(a){H.call(this),this.u=a,this.h=void 0,this.readyState=Xh,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.l=new Headers,this.b=null,this.s="GET",this.f="",this.a=!1,this.i=Th("goog.net.FetchXmlHttp"),this.m=this.c=this.g=null}__name(Th,"Th"),__name(Uh,"Uh"),__name(Vh,"Vh"),r(Vh,Ah),Vh.prototype.a=function(){return new Wh(this.f)},Vh.prototype.b=function(a){return function(){return a}}({}),__name(Wh,"Wh"),r(Wh,H);var Xh=0;function $h(a){a.c.read().then(a.pc.bind(a)).catch(a.Va.bind(a))}function Zh(a){a.readyState=4,a.g=null,a.c=null,a.m=null,Yh(a)}function Yh(a){a.onreadystatechange&&a.onreadystatechange.call(a)}function ai(a){H.call(this),this.headers=new Jd,this.D=a||null,this.c=!1,this.C=this.a=null,this.h=this.P=this.l="",this.f=this.N=this.i=this.J=!1,this.g=0,this.s=null,this.m=bi,this.u=this.S=!1}(k=Wh.prototype).open=function(a,b){if(this.readyState!=Xh)throw this.abort(),Error("Error reopening a connection");this.s=a,this.f=b,this.readyState=1,Yh(this)},k.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var b={headers:this.l,method:this.s,credentials:this.h,cache:void 0};a&&(b.body=a),this.u.fetch(new Request(this.f,b)).then(this.uc.bind(this),this.Va.bind(this))},k.abort=function(){this.response=this.responseText="",this.l=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Zh(this)),this.readyState=Xh},k.uc=function(a){this.a&&(this.g=a,this.b||(this.status=this.g.status,this.statusText=this.g.statusText,this.b=a.headers,this.readyState=2,Yh(this)),this.a&&(this.readyState=3,Yh(this),this.a&&("arraybuffer"===this.responseType?a.arrayBuffer().then(this.sc.bind(this),this.Va.bind(this)):void 0!==l.ReadableStream&&"body"in a?(this.response=this.responseText="",this.c=a.body.getReader(),this.m=new TextDecoder,$h(this)):a.text().then(this.tc.bind(this),this.Va.bind(this)))))},__name($h,"$h"),k.pc=function(a){if(this.a){var b=this.m.decode(a.value?a.value:new Uint8Array(0),{stream:!a.done});b&&(this.response=this.responseText+=b),a.done?Zh(this):Yh(this),3==this.readyState&&$h(this)}},k.tc=function(a){this.a&&(this.response=this.responseText=a,Zh(this))},k.sc=function(a){this.a&&(this.response=a,Zh(this))},k.Va=function(a){var b=this.i;b&&b.log(Nh,"Failed to fetch url "+this.f,a instanceof Error?a:Error(a)),this.a&&Zh(this)},__name(Zh,"Zh"),k.setRequestHeader=function(a,b){this.l.append(a,b)},k.getResponseHeader=function(a){return this.b?this.b.get(a.toLowerCase())||"":((a=this.i)&&a.log(Nh,"Attempting to get response header but no headers have been received for url: "+this.f,void 0),"")},k.getAllResponseHeaders=function(){if(!this.b){var a=this.i;return a&&a.log(Nh,"Attempting to get all response headers but no headers have been received for url: "+this.f,void 0),""}a=[];for(var b=this.b.entries(),c=b.next();!c.done;)c=c.value,a.push(c[0]+": "+c[1]),c=b.next();return a.join("\r\n")},__name(Yh,"Yh"),Object.defineProperty(Wh.prototype,"withCredentials",{get:function(){return"include"===this.h},set:function(a){this.h=a?"include":"same-origin"}}),__name(ai,"ai"),r(ai,H);var bi="";ai.prototype.b=Th("goog.net.XhrIo");var ci=/^https?$/i,di=["POST","PUT"];function ei(a,b,c,d,e){if(a.a)throw Error("[goog.net.XhrIo] Object is active with another request="+a.l+"; newUri="+b);c=c?c.toUpperCase():"GET",a.l=b,a.h="",a.P=c,a.J=!1,a.c=!0,a.a=a.D?a.D.a():Ch.a(),a.C=a.D?Bh(a.D):Bh(Ch),a.a.onreadystatechange=q(a.Wb,a);try{Uh(a.b,fi(a,"Opening Xhr")),a.N=!0,a.a.open(c,String(b),!0),a.N=!1}catch(g){return Uh(a.b,fi(a,"Error opening Xhr: "+g.message)),void gi(a,g)}b=d||"";var f=new Jd(a.headers);e&&Id(e,function(g,h){f.set(h,g)}),e=Ta(f.Y()),d=l.FormData&&b instanceof l.FormData,!Va(di,c)||e||d||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),f.forEach(function(g,h){this.a.setRequestHeader(h,g)},a),a.m&&(a.a.responseType=a.m),"withCredentials"in a.a&&a.a.withCredentials!==a.S&&(a.a.withCredentials=a.S);try{hi(a),0<a.g&&(a.u=ii(a.a),Uh(a.b,fi(a,"Will abort after "+a.g+"ms if incomplete, xhr2 "+a.u)),a.u?(a.a.timeout=a.g,a.a.ontimeout=q(a.Ma,a)):a.s=Ed(a.Ma,a.g,a)),Uh(a.b,fi(a,"Sending request")),a.i=!0,a.a.send(b),a.i=!1}catch(g){Uh(a.b,fi(a,"Send error: "+g.message)),gi(a,g)}}function ii(a){return Wb&&fc(9)&&"number"==typeof a.timeout&&void 0!==a.ontimeout}function Ua(a){return"content-type"==a.toLowerCase()}function gi(a,b){a.c=!1,a.a&&(a.f=!0,a.a.abort(),a.f=!1),a.h=b,ji(a),ki(a)}function ji(a){a.J||(a.J=!0,a.dispatchEvent("complete"),a.dispatchEvent("error"))}function li(a){if(a.c&&void 0!==ha)if(a.C[1]&&4==mi(a)&&2==ni(a))Uh(a.b,fi(a,"Local request error detected and ignored"));else if(a.i&&4==mi(a))Ed(a.Wb,0,a);else if(a.dispatchEvent("readystatechange"),4==mi(a)){Uh(a.b,fi(a,"Request complete")),a.c=!1;try{var d,b=ni(a);a:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break a;default:c=!1}if(!(d=c)){var e;if(e=0===b){var f=String(a.l).match(Md)[1]||null;if(!f&&l.self&&l.self.location){var g=l.self.location.protocol;f=g.substr(0,g.length-1)}e=!ci.test(f?f.toLowerCase():"")}d=e}if(d)a.dispatchEvent("complete"),a.dispatchEvent("success");else{try{var h=2<mi(a)?a.a.statusText:""}catch(m){Uh(a.b,"Can not get status: "+m.message),h=""}a.h=h+" ["+ni(a)+"]",ji(a)}}finally{ki(a)}}}function ki(a,b){if(a.a){hi(a);var c=a.a,d=a.C[0]?la:null;a.a=null,a.C=null,b||a.dispatchEvent("ready");try{c.onreadystatechange=d}catch(e){(a=a.b)&&a.log(Mh,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function hi(a){a.a&&a.u&&(a.a.ontimeout=null),a.s&&(l.clearTimeout(a.s),a.s=null)}function mi(a){return a.a?a.a.readyState:0}function ni(a){try{return 2<mi(a)?a.a.status:-1}catch(b){return-1}}function oi(a){try{return a.a?a.a.responseText:""}catch(b){return Uh(a.b,"Can not get responseText: "+b.message),""}}function fi(a,b){return b+" ["+a.P+" "+a.l+" "+ni(a)+"]"}function pi(a){var b=qi;this.g=[],this.u=b,this.s=a||null,this.f=this.a=!1,this.c=void 0,this.v=this.C=this.i=!1,this.h=0,this.b=null,this.l=0}function ti(a,b,c){a.a=!0,a.c=c,a.f=!b,ui(a)}function si(a){if(a.a){if(!a.v)throw new vi(a);a.v=!1}}function wi(a,b){xi(a,null,b,void 0)}function xi(a,b,c,d){a.g.push([b,c,d]),a.a&&ui(a)}function yi(a){return Sa(a.g,function(b){return oa(b[1])})}function ui(a){if(a.h&&a.a&&yi(a)){var b=a.h,c=zi[b];c&&(l.clearTimeout(c.a),delete zi[b]),a.h=0}a.b&&(a.b.l--,delete a.b),b=a.c;for(var d=c=!1;a.g.length&&!a.i;){var e=a.g.shift(),f=e[0],g=e[1];if(e=e[2],f=a.f?g:f)try{var h=f.call(e||a.s,b);void 0!==h&&(a.f=a.f&&(h==b||h instanceof Error),a.c=b=h),(Ea(b)||"function"==typeof l.Promise&&b instanceof l.Promise)&&(d=!0,a.i=!0)}catch(m){b=m,a.f=!0,yi(a)||(c=!0)}}a.c=b,d&&(h=q(a.m,a,!0),d=q(a.m,a,!1),b instanceof pi?(xi(b,h,d),b.C=!0):b.then(h,d)),c&&(b=new Ai(b),zi[b.a]=b,a.h=b.a)}function vi(){u.call(this)}function ri(){u.call(this)}function Ai(a){this.a=l.setTimeout(q(this.c,this),0),this.b=a}__name(ei,"ei"),__name(ii,"ii"),__name(Ua,"Ua"),(k=ai.prototype).Ma=function(){void 0!==ha&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Uh(this.b,fi(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},__name(gi,"gi"),__name(ji,"ji"),k.abort=function(){this.a&&this.c&&(Uh(this.b,fi(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),ki(this))},k.Da=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),ki(this,!0)),ai.bb.Da.call(this)},k.Wb=function(){this.ya||(this.N||this.i||this.f?li(this):this.Jc())},k.Jc=function(){li(this)},__name(li,"li"),__name(ki,"ki"),__name(hi,"hi"),__name(mi,"mi"),__name(ni,"ni"),__name(oi,"oi"),k.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case bi:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var a=this.b;return a&&a.log(Mh,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(b){return Uh(this.b,"Can not get response: "+b.message),null}},__name(fi,"fi"),__name(pi,"pi"),pi.prototype.cancel=function(a){if(this.a)this.c instanceof pi&&this.c.cancel();else{if(this.b){var b=this.b;delete this.b,a?b.cancel(a):(b.l--,0>=b.l&&b.cancel())}this.u?this.u.call(this.s,this):this.v=!0,this.a||(a=new ri(this),si(this),ti(this,!1,a))}},pi.prototype.m=function(a,b){this.i=!1,ti(this,a,b)},__name(ti,"ti"),__name(si,"si"),__name(wi,"wi"),__name(xi,"xi"),pi.prototype.then=function(a,b,c){var d,e,f=new D(function(g,h){d=g,e=h});return xi(this,d,function(g){g instanceof ri?f.cancel():e(g)}),f.then(a,b,c)},pi.prototype.$goog_Thenable=!0,__name(yi,"yi"),__name(ui,"ui"),__name(vi,"vi"),r(vi,u),vi.prototype.message="Deferred has already fired",vi.prototype.name="AlreadyCalledError",__name(ri,"ri"),r(ri,u),ri.prototype.message="Deferred was canceled",ri.prototype.name="CanceledError",__name(Ai,"Ai"),Ai.prototype.c=function(){throw delete zi[this.a],this.b};var zi={};function Bi(a){var b={},c=b.document||document,d=yb(a).toString(),e=oc(document,"SCRIPT"),f={Xb:e,Ma:void 0},g=new pi(f),h=null,m=null!=b.timeout?b.timeout:5e3;return 0<m&&(h=window.setTimeout(function(){Ci(e,!0);var p=new Di(Ei,"Timeout reached for loading script "+d);si(g),ti(g,!1,p)},m),f.Ma=h),e.onload=e.onreadystatechange=function(){e.readyState&&"loaded"!=e.readyState&&"complete"!=e.readyState||(Ci(e,b.xd||!1,h),si(g),ti(g,!0,null))},e.onerror=function(){Ci(e,!0,h);var p=new Di(Fi,"Error while loading script "+d);si(g),ti(g,!1,p)},z(f=b.attributes||{},{type:"text/javascript",charset:"UTF-8"}),lc(e,f),Ob(e,a),Gi(c).appendChild(e),g}function Gi(a){var b;return(b=(a||document).getElementsByTagName("HEAD"))&&0!=b.length?b[0]:a.documentElement}function qi(){if(this&&this.Xb){var a=this.Xb;a&&"SCRIPT"==a.tagName&&Ci(a,!0,this.Ma)}}function Ci(a,b,c){null!=c&&l.clearTimeout(c),a.onload=la,a.onerror=la,a.onreadystatechange=la,b&&window.setTimeout(function(){a&&a.parentNode&&a.parentNode.removeChild(a)},0)}__name(Bi,"Bi"),__name(Gi,"Gi"),__name(qi,"qi"),__name(Ci,"Ci");var Fi=0,Ei=1;function Di(a,b){var c="Jsloader error (code #"+a+")";b&&(c+=": "+b),u.call(this,c),this.code=a}function Hi(a){this.f=a}function Ii(a,b,c){if(this.c=a,a=b||{},this.l=a.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.m=a.secureTokenTimeout||Ji,this.g=nb(a.secureTokenHeaders||Ki),this.h=a.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=a.identityPlatformEndpoint||"https://identitytoolkit.googleapis.com/v2/",this.v=a.firebaseTimeout||Li,this.a=nb(a.firebaseHeaders||Mi),c&&(this.a["X-Client-Version"]=c,this.g["X-Client-Version"]=c),c="Node"==Ke(),!(c=l.XMLHttpRequest||c&&firebase.INTERNAL.node&&firebase.INTERNAL.node.XMLHttpRequest)&&!Je())throw new t("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,Je()?this.f=new Vh(self):Le()?this.f=new Hi(c):this.f=new Fh,this.b=null}__name(Di,"Di"),r(Di,u),__name(Hi,"Hi"),r(Hi,Ah),Hi.prototype.a=function(){return new this.f},Hi.prototype.b=function(){return{}},__name(Ii,"Ii");var Ni,Dg="idToken",Ji=new Ze(3e4,6e4),Ki={"Content-Type":"application/x-www-form-urlencoded"},Li=new Ze(3e4,6e4),Mi={"Content-Type":"application/json"};function Oi(a,b){b?a.a["X-Firebase-Locale"]=b:delete a.a["X-Firebase-Locale"]}function Pi(a,b){b&&(a.l=Qi("https://securetoken.googleapis.com/v1/token",b),a.h=Qi("https://www.googleapis.com/identitytoolkit/v3/relyingparty/",b),a.i=Qi("https://identitytoolkit.googleapis.com/v2/",b))}function Qi(a,b){return a=J(a),b=J(b.url),a.f=a.a+a.f,Pd(a,b.c),a.a=b.a,Qd(a,b.g),a.toString()}function Ri(a,b){b?(a.a["X-Client-Version"]=b,a.g["X-Client-Version"]=b):(delete a.a["X-Client-Version"],delete a.g["X-Client-Version"])}function Si(a,b,c,d,e,f,g){ue()||Je()?a=q(a.u,a):(Ni||(Ni=new D(function(h,m){Ti(h,m)})),a=q(a.s,a)),a(b,c,d,e,f,g)}__name(Oi,"Oi"),__name(Pi,"Pi"),__name(Qi,"Qi"),__name(Ri,"Ri"),Ii.prototype.T=function(){return this.b},__name(Si,"Si"),Ii.prototype.u=function(a,b,c,d,e,f){if(Je()&&(void 0===l.fetch||void 0===l.Headers||void 0===l.Request))throw new t("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var g=new ai(this.f);if(f){g.g=Math.max(0,f);var h=setTimeout(function(){g.dispatchEvent("timeout")},f)}qd(g,"complete",function(){h&&clearTimeout(h);var m=null;try{m=JSON.parse(oi(this))||null}catch(p){m=null}b&&b(m)}),wd(g,"ready",function(){h&&clearTimeout(h),Xc(this)}),wd(g,"timeout",function(){h&&clearTimeout(h),Xc(this),b&&b(null)}),ei(g,a,c,d,e)};var Ui=new qb(rb,"https://apis.google.com/js/client.js?onload=%{onload}"),Vi="__fcb"+Math.floor(1e6*Math.random()).toString();function Ti(a,b){((window.gapi||{}).client||{}).request?a():(l[Vi]=function(){((window.gapi||{}).client||{}).request?a():b(Error("CORS_UNSUPPORTED"))},wi(Bi(zb(Ui,{onload:Vi})),function(){b(Error("CORS_UNSUPPORTED"))}))}function Wi(a,b){return new D(function(c,d){"refresh_token"==b.grant_type&&b.refresh_token||"authorization_code"==b.grant_type&&b.code?Si(a,a.l+"?key="+encodeURIComponent(a.c),function(e){e?e.error?d(Xi(e)):e.access_token&&e.refresh_token?c(e):d(new t("internal-error")):d(new t("network-request-failed"))},"POST",fe(b).toString(),a.g,a.m.get()):d(new t("internal-error"))})}function Yi(a,b,c,d,e,f,g){var h=J(b+c);I(h,"key",a.c),g&&I(h,"cb",Date.now().toString());var m="GET"==d;if(m)for(var p in e)e.hasOwnProperty(p)&&I(h,p,e[p]);return new D(function(v,B){Si(a,h.toString(),function(A){A?A.error?B(Xi(A,f||{})):v(A):B(new t("network-request-failed"))},d,m?void 0:ke(Ve(e)),a.a,a.v.get())})}function Zi(a){if("string"!=typeof(a=a.email)||!De.test(a))throw new t("invalid-email")}function $i(a){"email"in a&&Zi(a)}function aj(a,b){return O(a,bj,{identifier:b,continueUri:Se()?re():"http://localhost"}).then(function(c){return c.signinMethods||[]})}function cj(a){return O(a,dj,{}).then(function(b){return b.authorizedDomains||[]})}function P(a){if(!a[Dg])throw a.mfaPendingCredential?new t("multi-factor-auth-required",null,nb(a)):new t("internal-error")}function ej(a){if(a.phoneNumber||a.temporaryProof){if(!a.phoneNumber||!a.temporaryProof)throw new t("internal-error")}else{if(!a.sessionInfo)throw new t("missing-verification-id");if(!a.code)throw new t("missing-verification-code")}}__name(Ti,"Ti"),Ii.prototype.s=function(a,b,c,d,e){var f=this;Ni.then(function(){window.gapi.client.setApiKey(f.c);var g=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:a,method:c,body:d,headers:e,authType:"none",callback:function(h){window.gapi.auth.setToken(g),b&&b(h)}})}).o(function(g){b&&b({error:{message:g&&g.message||"CORS_UNSUPPORTED"}})})},__name(Wi,"Wi"),__name(Yi,"Yi"),__name(Zi,"Zi"),__name($i,"$i"),__name(aj,"aj"),__name(cj,"cj"),__name(P,"P"),__name(ej,"ej"),Ii.prototype.Ab=function(){return O(this,fj,{})},Ii.prototype.Cb=function(a,b){return O(this,gj,{idToken:a,email:b})},Ii.prototype.Db=function(a,b){return O(this,ch,{idToken:a,password:b})};var hj={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function oh(a,b){return O(a,mj,b)}function mh(a,b){return O(a,oj,b).then(function(c){return c.phoneSessionInfo.sessionInfo})}function pj(a){if(!a.phoneVerificationInfo)throw new t("internal-error");if(!a.phoneVerificationInfo.sessionInfo)throw new t("missing-verification-id");if(!a.phoneVerificationInfo.code)throw new t("missing-verification-code")}function nh(a,b){return O(a,qj,b).then(function(c){return c.phoneResponseInfo.sessionInfo})}function rj(a,b,c){return O(a,sj,{idToken:b,deleteProvider:c})}function tj(a){if(!a.requestUri||!a.sessionId&&!a.postBody&&!a.pendingToken)throw new t("internal-error")}function uj(a,b){return b.oauthIdToken&&b.providerId&&0==b.providerId.indexOf("oidc.")&&!b.pendingToken&&(a.sessionId?b.nonce=a.sessionId:a.postBody&&(je(a=new Ud(a.postBody),"nonce")&&(b.nonce=a.get("nonce")))),b}function vj(a){var b=null;if(a.needConfirmation?(a.code="account-exists-with-different-credential",b=zh(a)):"FEDERATED_USER_ID_ALREADY_LINKED"==a.errorMessage?(a.code="credential-already-in-use",b=zh(a)):"EMAIL_EXISTS"==a.errorMessage?(a.code="email-already-in-use",b=zh(a)):a.errorMessage&&(b=wj(a.errorMessage)),b)throw b;P(a)}function Fg(a,b){return b.returnIdpCredential=!0,O(a,xj,b)}function Hg(a,b){return b.returnIdpCredential=!0,O(a,yj,b)}function Ig(a,b){return b.returnIdpCredential=!0,b.autoCreate=!1,O(a,zj,b)}function Aj(a){if(!a.oobCode)throw new t("invalid-action-code")}(k=Ii.prototype).Eb=function(a,b){var c={idToken:a},d=[];return lb(hj,function(e,f){var g=b[f];null===g?d.push(e):f in b&&(c[f]=g)}),d.length&&(c.deleteAttribute=d),O(this,gj,c)},k.wb=function(a,b){return z(a={requestType:"PASSWORD_RESET",email:a},b),O(this,ij,a)},k.xb=function(a,b){return z(a={requestType:"EMAIL_SIGNIN",email:a},b),O(this,jj,a)},k.vb=function(a,b){return z(a={requestType:"VERIFY_EMAIL",idToken:a},b),O(this,kj,a)},k.Fb=function(a,b,c){return z(a={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:a,newEmail:b},c),O(this,lj,a)},__name(oh,"oh"),k.gb=function(a){return O(this,nj,a)},__name(mh,"mh"),__name(pj,"pj"),__name(nh,"nh"),__name(rj,"rj"),__name(tj,"tj"),__name(uj,"uj"),__name(vj,"vj"),__name(Fg,"Fg"),__name(Hg,"Hg"),__name(Ig,"Ig"),__name(Aj,"Aj"),k.ob=function(a,b){return O(this,Bj,{oobCode:a,newPassword:b})},k.Sa=function(a){return O(this,Cj,{oobCode:a})},k.kb=function(a){return O(this,Dj,{oobCode:a})};var Dj={endpoint:"setAccountInfo",A:Aj,Z:"email",B:!0},Cj={endpoint:"resetPassword",A:Aj,G:function(a){var b=a.requestType;if(!b||!a.email&&"EMAIL_SIGNIN"!=b&&"VERIFY_AND_CHANGE_EMAIL"!=b)throw new t("internal-error")},B:!0},Ej={endpoint:"signupNewUser",A:function(a){if(Zi(a),!a.password)throw new t("weak-password")},G:P,V:!0,B:!0},bj={endpoint:"createAuthUri",B:!0},Fj={endpoint:"deleteAccount",O:["idToken"]},sj={endpoint:"setAccountInfo",O:["idToken","deleteProvider"],A:function(a){if(!Array.isArray(a.deleteProvider))throw new t("internal-error")}},$g={endpoint:"emailLinkSignin",O:["email","oobCode"],A:Zi,G:P,V:!0,B:!0},bh={endpoint:"emailLinkSignin",O:["idToken","email","oobCode"],A:Zi,G:P,V:!0},Gj={endpoint:"accounts/mfaEnrollment:finalize",O:["idToken","phoneVerificationInfo"],A:pj,G:P,B:!0,Na:!0},Hj={endpoint:"accounts/mfaSignIn:finalize",O:["mfaPendingCredential","phoneVerificationInfo"],A:pj,G:P,B:!0,Na:!0},Ij={endpoint:"getAccountInfo"},jj={endpoint:"getOobConfirmationCode",O:["requestType"],A:function(a){if("EMAIL_SIGNIN"!=a.requestType)throw new t("internal-error");Zi(a)},Z:"email",B:!0},kj={endpoint:"getOobConfirmationCode",O:["idToken","requestType"],A:function(a){if("VERIFY_EMAIL"!=a.requestType)throw new t("internal-error")},Z:"email",B:!0},lj={endpoint:"getOobConfirmationCode",O:["idToken","newEmail","requestType"],A:function(a){if("VERIFY_AND_CHANGE_EMAIL"!=a.requestType)throw new t("internal-error")},Z:"email",B:!0},ij={endpoint:"getOobConfirmationCode",O:["requestType"],A:function(a){if("PASSWORD_RESET"!=a.requestType)throw new t("internal-error");Zi(a)},Z:"email",B:!0},dj={mb:!0,endpoint:"getProjectConfig",Vb:"GET"},Jj={mb:!0,endpoint:"getRecaptchaParam",Vb:"GET",G:function(a){if(!a.recaptchaSiteKey)throw new t("internal-error")}},Bj={endpoint:"resetPassword",A:Aj,Z:"email",B:!0},mj={endpoint:"sendVerificationCode",O:["phoneNumber","recaptchaToken"],Z:"sessionInfo",B:!0},gj={endpoint:"setAccountInfo",O:["idToken"],A:$i,V:!0},ch={endpoint:"setAccountInfo",O:["idToken"],A:function(a){if($i(a),!a.password)throw new t("weak-password")},G:P,V:!0},fj={endpoint:"signupNewUser",G:P,V:!0,B:!0},oj={endpoint:"accounts/mfaEnrollment:start",O:["idToken","phoneEnrollmentInfo"],A:function(a){if(!a.phoneEnrollmentInfo)throw new t("internal-error");if(!a.phoneEnrollmentInfo.phoneNumber)throw new t("missing-phone-number");if(!a.phoneEnrollmentInfo.recaptchaToken)throw new t("missing-app-credential")},G:function(a){if(!a.phoneSessionInfo||!a.phoneSessionInfo.sessionInfo)throw new t("internal-error")},B:!0,Na:!0},qj={endpoint:"accounts/mfaSignIn:start",O:["mfaPendingCredential","mfaEnrollmentId","phoneSignInInfo"],A:function(a){if(!a.phoneSignInInfo||!a.phoneSignInInfo.recaptchaToken)throw new t("missing-app-credential")},G:function(a){if(!a.phoneResponseInfo||!a.phoneResponseInfo.sessionInfo)throw new t("internal-error")},B:!0,Na:!0},xj={endpoint:"verifyAssertion",A:tj,Za:uj,G:vj,V:!0,B:!0},zj={endpoint:"verifyAssertion",A:tj,Za:uj,G:function(a){if(a.errorMessage&&"USER_NOT_FOUND"==a.errorMessage)throw new t("user-not-found");if(a.errorMessage)throw wj(a.errorMessage);P(a)},V:!0,B:!0},yj={endpoint:"verifyAssertion",A:function(a){if(tj(a),!a.idToken)throw new t("internal-error")},Za:uj,G:vj,V:!0},Kj={endpoint:"verifyCustomToken",A:function(a){if(!a.token)throw new t("invalid-custom-token")},G:P,V:!0,B:!0},ah={endpoint:"verifyPassword",A:function(a){if(Zi(a),!a.password)throw new t("wrong-password")},G:P,V:!0,B:!0},nj={endpoint:"verifyPhoneNumber",A:ej,G:P,B:!0},ih={endpoint:"verifyPhoneNumber",A:function(a){if(!a.idToken)throw new t("internal-error");ej(a)},G:function(a){if(a.temporaryProof)throw a.code="credential-already-in-use",zh(a);P(a)}},jh={Ib:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",A:ej,G:P,B:!0},Lj={endpoint:"accounts/mfaEnrollment:withdraw",O:["idToken","mfaEnrollmentId"],G:function(a){if(!!a[Dg]^!!a.refreshToken)throw new t("internal-error")},B:!0,Na:!0};function O(a,b,c){if(!mf(c,b.O))return F(new t("internal-error"));var f,d=!!b.Na,e=b.Vb||"POST";return E(c).then(b.A).then(function(){return b.V&&(c.returnSecureToken=!0),b.B&&a.b&&void 0===c.tenantId&&(c.tenantId=a.b),Yi(a,d?a.i:a.h,b.endpoint,e,c,b.Ib,b.mb||!1)}).then(function(g){return f=g,b.Za?b.Za(c,f):f}).then(b.G).then(function(){if(!b.Z)return f;if(!(b.Z in f))throw new t("internal-error");return f[b.Z]})}function wj(a){return Xi({error:{errors:[{message:a}],code:400,message:a}})}function Xi(a,b){var c=(a.error&&a.error.errors&&a.error.errors[0]||{}).reason||"",d={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(c=d[c]?new t(d[c]):null)return c;for(var e in c=a.error&&a.error.message||"",z(d={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",TENANT_ID_MISMATCH:"tenant-id-mismatch",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",EMAIL_CHANGE_NEEDS_VERIFICATION:"email-change-needs-verification",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",UNSUPPORTED_FIRST_FACTOR:"unsupported-first-factor",UNVERIFIED_EMAIL:"unverified-email"},b||{}),b=(b=c.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<b.length?b[1]:void 0,d)if(0===c.indexOf(e))return new t(d[e],b);return!b&&a&&(b=Ue(a)),new t("internal-error",b)}function Mj(a){this.b=a,this.a=null,this.sb=Nj(this)}function Nj(a){return Oj().then(function(){return new D(function(b,c){L("gapi.iframes.getContext")().open({where:document.body,url:a.b,messageHandlersFilter:L("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(d){function e(){clearTimeout(f),b()}__name(e,"e"),a.a=d,a.a.restyle({setHideOnLeave:!1});var f=setTimeout(function(){c(Error("Network Error"))},Pj.get());d.ping(e).then(e,function(){c(Error("Network Error"))})})})})}function Qj(a,b){return a.sb.then(function(){return new D(function(c){a.a.send(b.type,b,c,L("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}function Rj(a,b){a.sb.then(function(){a.a.register("authEvent",b,L("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}__name(O,"O"),__name(wj,"wj"),__name(Xi,"Xi"),__name(Mj,"Mj"),__name(Nj,"Nj"),__name(Qj,"Qj"),__name(Rj,"Rj");var Sj=new qb(rb,"https://apis.google.com/js/api.js?onload=%{onload}"),Tj=new Ze(3e4,6e4),Pj=new Ze(5e3,15e3),Uj=null;function Oj(){return Uj||(Uj=new D(function(a,b){function c(){Ye(),L("gapi.load")("gapi.iframes",{callback:a,ontimeout:function(){Ye(),b(Error("Network Error"))},timeout:Tj.get()})}if(__name(c,"c"),L("gapi.iframes.Iframe"))a();else if(L("gapi.load"))c();else{var d="__iframefcb"+Math.floor(1e6*Math.random()).toString();l[d]=function(){L("gapi.load")?c():b(Error("Network Error"))},E(Bi(d=zb(Sj,{onload:d}))).o(function(){b(Error("Network Error"))})}}).o(function(a){throw Uj=null,a}))}function Vj(a,b,c,d){this.l=a,this.h=b,this.i=c,this.g=d,this.f=null,this.g?a=ce((a=J(this.g.url)).c,a.a,a.g,"/emulator/auth/iframe"):a=ce("https",this.l,null,"/__/auth/iframe"),this.a=a,I(this.a,"apiKey",this.h),I(this.a,"appName",this.i),this.b=null,this.c=[]}function Wj(a,b,c,d,e,f){this.u=a,this.s=b,this.c=c,this.m=d,this.v=f,this.i=this.g=this.l=null,this.a=e,this.h=this.f=null}function Xj(a){try{return firebase.app(a).auth().Ga()}catch(b){return[]}}function Yj(a,b,c,d,e,f){this.s=a,this.g=b,this.b=c,this.f=f,this.c=d||null,this.i=e||null,this.l=this.u=this.C=null,this.h=[],this.m=this.a=null}function Zj(a){var b=re();return cj(a).then(function(c){a:{var d=J(b),e=d.c;d=d.a;for(var f=0;f<c.length;f++){var g=c[f],h=d,m=e;if(0==g.indexOf("chrome-extension://")?h=J(g).a==h&&"chrome-extension"==m:"http"!=m&&"https"!=m?h=!1:Ce.test(g)?h=h==g:(g=g.split(".").join("\\."),h=new RegExp("^(.+\\."+g+"|"+g+")$","i").test(h)),h){c=!0;break a}}c=!1}if(!c)throw new xh(re())})}function ak(a){return a.m||(a.m=Ee().then(function(){if(!a.u){var b=a.c,c=a.i,d=Xj(a.b),e=new Vj(a.s,a.g,a.b,a.f);e.f=b,e.b=c,e.c=Za(d||[]),a.u=e.toString()}a.v=new Mj(a.u),bk(a)})),a.m}function dk(a){return a.l||(a.C=a.c?Oe(a.c,Xj(a.b)):null,a.l=new Ii(a.g,Ca(a.i),a.C),a.f&&Pi(a.l,a.f)),a.l}function ek(a,b,c,d,e,f,g,h,m,p,v,B){return(a=new Wj(a,b,c,d,e,B)).l=f,a.g=g,a.i=h,a.b=nb(m||null),a.f=p,a.zb(v).toString()}function bk(a){if(!a.v)throw Error("IfcHandler must be initialized!");Rj(a.v,function(b){var c={};if(b&&b.authEvent){var d=!1;for(b=th(b.authEvent),c=0;c<a.h.length;c++)d=a.h[c](b)||d;return(c={}).status=d?"ACK":"ERROR",E(c)}return c.status="ERROR",E(c)})}function ck(a){var b={type:"webStorageSupport"};return ak(a).then(function(){return Qj(a.v,b)}).then(function(c){if(c&&c.length&&void 0!==c[0].webStorageSupport)return c[0].webStorageSupport;throw Error()})}function fk(a){if(this.a=a||firebase.INTERNAL.reactNative&&firebase.INTERNAL.reactNative.AsyncStorage,!this.a)throw new t("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function gk(a){this.b=a,this.a={},this.f=q(this.c,this)}__name(Oj,"Oj"),__name(Vj,"Vj"),Vj.prototype.toString=function(){return this.f?I(this.a,"v",this.f):ie(this.a.b,"v"),this.b?I(this.a,"eid",this.b):ie(this.a.b,"eid"),this.c.length?I(this.a,"fw",this.c.join(",")):ie(this.a.b,"fw"),this.a.toString()},__name(Wj,"Wj"),Wj.prototype.zb=function(a){return this.h=a,this},Wj.prototype.toString=function(){if(this.v){var a=J(this.v.url);a=ce(a.c,a.a,a.g,"/emulator/auth/handler")}else a=ce("https",this.u,null,"/__/auth/handler");if(I(a,"apiKey",this.s),I(a,"appName",this.c),I(a,"authType",this.m),this.a.isOAuthProvider){var b=this.a;try{var c=firebase.app(this.c).auth().la()}catch(h){c=null}for(var d in b.pb=c,I(a,"providerId",this.a.providerId),b=Ve((c=this.a).Jb))b[d]=b[d].toString();d=c.Qc,b=nb(b);for(var e=0;e<d.length;e++){var f=d[e];f in b&&delete b[f]}c.qb&&c.pb&&!b[c.qb]&&(b[c.qb]=c.pb),mb(b)||I(a,"customParameters",Ue(b))}if("function"==typeof this.a.Rb&&((c=this.a.Rb()).length&&I(a,"scopes",c.join(","))),this.l?I(a,"redirectUrl",this.l):ie(a.b,"redirectUrl"),this.g?I(a,"eventId",this.g):ie(a.b,"eventId"),this.i?I(a,"v",this.i):ie(a.b,"v"),this.b)for(var g in this.b)this.b.hasOwnProperty(g)&&!be(a,g)&&I(a,g,this.b[g]);return this.h?I(a,"tid",this.h):ie(a.b,"tid"),this.f?I(a,"eid",this.f):ie(a.b,"eid"),(g=Xj(this.c)).length&&I(a,"fw",g.join(",")),a.toString()},__name(Xj,"Xj"),__name(Yj,"Yj"),__name(Zj,"Zj"),__name(ak,"ak"),(k=Yj.prototype).Pb=function(a,b,c){var d=new t("popup-closed-by-user"),e=new t("web-storage-unsupported"),f=this,g=!1;return this.ma().then(function(){ck(f).then(function(h){h||(a&&ye(a),b(e),g=!0)})}).o(function(){}).then(function(){if(!g)return Be(a)}).then(function(){if(!g)return Fd(c).then(function(){b(d)})})},k.Yb=function(){var a=K();return!Te(a)&&!Xe(a)},k.Ub=function(){return!1},k.Nb=function(a,b,c,d,e,f,g,h){if(!a)return F(new t("popup-blocked"));if(g&&!Te())return this.ma().o(function(p){ye(a),e(p)}),d(),E();this.a||(this.a=Zj(dk(this)));var m=this;return this.a.then(function(){var p=m.ma().o(function(v){throw ye(a),e(v),v});return d(),p}).then(function(){(rh(c),g)||se(ek(m.s,m.g,m.b,b,c,null,f,m.c,void 0,m.i,h,m.f),a)}).o(function(p){throw"auth/network-request-failed"==p.code&&(m.a=null),p})},__name(dk,"dk"),k.Ob=function(a,b,c,d){this.a||(this.a=Zj(dk(this)));var e=this;return this.a.then(function(){rh(b),se(ek(e.s,e.g,e.b,a,b,re(),c,e.c,void 0,e.i,d,e.f))}).o(function(f){throw"auth/network-request-failed"==f.code&&(e.a=null),f})},k.ma=function(){var a=this;return ak(this).then(function(){return a.v.sb}).o(function(){throw a.a=null,new t("network-request-failed")})},k.ac=function(){return!0},__name(ek,"ek"),__name(bk,"bk"),__name(ck,"ck"),k.Ea=function(a){this.h.push(a)},k.Ta=function(a){Xa(this.h,function(b){return b==a})},__name(fk,"fk"),(k=fk.prototype).get=function(a){return E(this.a.getItem(a)).then(function(b){return b&&We(b)})},k.set=function(a,b){return E(this.a.setItem(a,Ue(b)))},k.U=function(a){return E(this.a.removeItem(a))},k.ca=function(){},k.ia=function(){},__name(gk,"gk");var rk,hk=[];function ik(){var a=Je()?self:null;if(w(hk,function(c){c.b==a&&(b=c)}),!b){var b=new gk(a);hk.push(b)}return b}function jk(a,b,c){mb(a.a)&&a.b.addEventListener("message",a.f),void 0===a.a[b]&&(a.a[b]=[]),a.a[b].push(c)}function kk(a){this.a=a}function lk(a){this.c=a,this.b=!1,this.a=[]}function mk(a,b,c,d){var e,g,h,m,f=c||{},p=null;if(a.b)return F(Error("connection_unavailable"));var v=d?800:50,B="undefined"!=typeof MessageChannel?new MessageChannel:null;return new D(function(A,Q){B?(e=Math.floor(Math.random()*Math.pow(10,20)).toString(),B.port1.start(),h=setTimeout(function(){Q(Error("unsupported_event"))},v),p={messageChannel:B,onMessage:g=__name(function(ya){ya.data.eventId===e&&("ack"===ya.data.status?(clearTimeout(h),m=setTimeout(function(){Q(Error("timeout"))},3e3)):"done"===ya.data.status?(clearTimeout(m),void 0!==ya.data.response?A(ya.data.response):Q(Error("unknown_error"))):(clearTimeout(h),clearTimeout(m),Q(Error("invalid_response"))))},"g")},a.a.push(p),B.port1.addEventListener("message",g),a.c.postMessage({eventType:b,eventId:e,data:f},[B.port2])):Q(Error("connection_unavailable"))}).then(function(A){return nk(a,p),A}).o(function(A){throw nk(a,p),A})}function nk(a,b){if(b){var c=b.messageChannel,d=b.onMessage;c&&(c.port1.removeEventListener("message",d),c.port1.close()),Xa(a.a,function(e){return e==b})}}function ok(){if(!pk())throw new t("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.m=l.indexedDB,this.type="indexedDB",this.g=this.v=this.f=this.l=null,this.s=!1,this.h=null;var a=this;Je()&&self?(this.v=ik(),jk(this.v,"keyChanged",function(b,c){return qk(a).then(function(d){return 0<d.length&&w(a.a,function(e){e(d)}),{keyProcessed:Va(d,c.key)}})}),jk(this.v,"ping",function(){return E(["keyChanged"])})):ef().then(function(b){(a.h=b)&&(a.g=new lk(new kk(b)),mk(a.g,"ping",null,!0).then(function(c){c[0].fulfilled&&Va(c[0].value,"keyChanged")&&(a.s=!0)}).o(function(){}))})}function sk(a){return new D(function(b,c){var d=a.m.deleteDatabase("firebaseLocalStorageDb");d.onsuccess=function(){b()},d.onerror=function(e){c(Error(e.target.error))}})}function tk(a){return new D(function(b,c){var d=a.m.open("firebaseLocalStorageDb",1);d.onerror=function(e){try{e.preventDefault()}catch(f){}c(Error(e.target.error))},d.onupgradeneeded=function(e){e=e.target.result;try{e.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(f){c(f)}},d.onsuccess=function(e){(e=e.target.result).objectStoreNames.contains("firebaseLocalStorage")?b(e):sk(a).then(function(){return tk(a)}).then(function(f){b(f)}).o(function(f){c(f)})}})}function uk(a){return a.i||(a.i=tk(a)),a.i}function vk(a,b){function c(e,f){uk(a).then(b).then(e).o(function(g){if(!(3<++d))return uk(a).then(function(h){return h.close(),a.i=void 0,c(e,f)}).o(function(h){f(h)});f(g)})}__name(c,"c");var d=0;return new D(c)}function pk(){try{return!!l.indexedDB}catch(a){return!1}}function wk(a){return a.objectStore("firebaseLocalStorage")}function xk(a,b){return a.transaction(["firebaseLocalStorage"],b?"readwrite":"readonly")}function yk(a){return new D(function(b,c){a.onsuccess=function(d){d&&d.target?b(d.target.result):b()},a.onerror=function(d){c(d.target.error)}})}function zk(a,b){return a.g&&a.h&&df()===a.h?mk(a.g,"keyChanged",{key:b},a.s).then(function(){}).o(function(){}):E()}function qk(a){return uk(a).then(function(b){var c=wk(xk(b,!1));return c.getAll?yk(c.getAll()):new D(function(d,e){var f=[],g=c.openCursor();g.onsuccess=function(h){(h=h.target.result)?(f.push(h.value),h.continue()):d(f)},g.onerror=function(h){e(h.target.error)}})}).then(function(b){var c={},d=[];if(0==a.b){for(d=0;d<b.length;d++)c[b[d].fbase_key]=b[d].value;d=te(a.c,c),a.c=c}return d})}function Ak(a){function b(){a.f=setTimeout(function(){a.l=qk(a).then(function(c){0<c.length&&w(a.a,function(d){d(c)})}).then(function(){b()}).o(function(c){"STOP_EVENT"!=c.message&&b()})},800)}__name(b,"b"),Bk(a),b()}function Bk(a){a.l&&a.l.cancel("STOP_EVENT"),a.f&&(clearTimeout(a.f),a.f=null)}function Ck(a){var b=this,c=null;this.a=[],this.type="indexedDB",this.c=a,this.b=E().then(function(){if(pk()){var d=Qe(),e="__sak"+d;return rk||(rk=new ok),(c=rk).set(e,d).then(function(){return c.get(e)}).then(function(f){if(f!==d)throw Error("indexedDB not supported!");return c.U(e)}).then(function(){return c}).o(function(){return b.c})}return b.c}).then(function(d){return b.type=d.type,d.ca(function(e){w(b.a,function(f){f(e)})}),d})}function Dk(){this.a={},this.type="inMemory"}function Ek(){if(!Fk())throw"Node"==Ke()?new t("internal-error","The LocalStorage compatibility library was not found."):new t("web-storage-unsupported");this.a=Gk()||firebase.INTERNAL.node.localStorage,this.type="localStorage"}function Gk(){try{var a=l.localStorage,b=Qe();return a&&(a.setItem(b,"1"),a.removeItem(b)),a}catch(c){return null}}function Fk(){var a="Node"==Ke();if(!(a=Gk()||a&&firebase.INTERNAL.node&&firebase.INTERNAL.node.localStorage))return!1;try{return a.setItem("__sak","1"),a.removeItem("__sak"),!0}catch(b){return!1}}function Hk(){this.type="nullStorage"}function Ik(){if(!Jk())throw"Node"==Ke()?new t("internal-error","The SessionStorage compatibility library was not found."):new t("web-storage-unsupported");this.a=Kk()||firebase.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function Kk(){try{var a=l.sessionStorage,b=Qe();return a&&(a.setItem(b,"1"),a.removeItem(b)),a}catch(c){return null}}function Jk(){var a="Node"==Ke();if(!(a=Kk()||a&&firebase.INTERNAL.node&&firebase.INTERNAL.node.sessionStorage))return!1;try{return a.setItem("__sak","1"),a.removeItem("__sak"),!0}catch(b){return!1}}function Lk(){var a={};a.Browser=Mk,a.Node=Nk,a.ReactNative=Ok,a.Worker=Pk,this.a=a[Ke()]}__name(ik,"ik"),gk.prototype.c=function(a){var b=a.data.eventType,c=a.data.eventId,d=this.a[b];if(d&&0<d.length){a.ports[0].postMessage({status:"ack",eventId:c,eventType:b,response:null});var e=[];w(d,function(f){e.push(E().then(function(){return f(a.origin,a.data.data)}))}),Jc(e).then(function(f){var g=[];w(f,function(h){g.push({fulfilled:h.Qb,value:h.value,reason:h.reason?h.reason.message:void 0})}),w(g,function(h){for(var m in h)void 0===h[m]&&delete h[m]}),a.ports[0].postMessage({status:"done",eventId:c,eventType:b,response:g})})}},__name(jk,"jk"),__name(kk,"kk"),kk.prototype.postMessage=function(a,b){this.a.postMessage(a,b)},__name(lk,"lk"),__name(mk,"mk"),__name(nk,"nk"),lk.prototype.close=function(){for(;0<this.a.length;)nk(this,this.a[0]);this.b=!0},__name(ok,"ok"),__name(sk,"sk"),__name(tk,"tk"),__name(uk,"uk"),__name(vk,"vk"),__name(pk,"pk"),__name(wk,"wk"),__name(xk,"xk"),__name(yk,"yk"),(k=ok.prototype).set=function(a,b){var c=this,d=!1;return vk(this,function(e){return yk((e=wk(xk(e,!0))).get(a))}).then(function(e){return vk(c,function(f){if(f=wk(xk(f,!0)),e)return e.value=b,yk(f.put(e));c.b++,d=!0;var g={};return g.fbase_key=a,g.value=b,yk(f.add(g))})}).then(function(){return c.c[a]=b,zk(c,a)}).oa(function(){d&&c.b--})},__name(zk,"zk"),k.get=function(a){return vk(this,function(b){return yk(wk(xk(b,!1)).get(a))}).then(function(b){return b&&b.value})},k.U=function(a){var b=this,c=!1;return vk(this,function(d){return c=!0,b.b++,yk(wk(xk(d,!0)).delete(a))}).then(function(){return delete b.c[a],zk(b,a)}).oa(function(){c&&b.b--})},__name(qk,"qk"),k.ca=function(a){0==this.a.length&&Ak(this),this.a.push(a)},k.ia=function(a){Xa(this.a,function(b){return b==a}),0==this.a.length&&Bk(this)},__name(Ak,"Ak"),__name(Bk,"Bk"),__name(Ck,"Ck"),(k=Ck.prototype).get=function(a){return this.b.then(function(b){return b.get(a)})},k.set=function(a,b){return this.b.then(function(c){return c.set(a,b)})},k.U=function(a){return this.b.then(function(b){return b.U(a)})},k.ca=function(a){this.a.push(a)},k.ia=function(a){Xa(this.a,function(b){return b==a})},__name(Dk,"Dk"),(k=Dk.prototype).get=function(a){return E(this.a[a])},k.set=function(a,b){return this.a[a]=b,E()},k.U=function(a){return delete this.a[a],E()},k.ca=function(){},k.ia=function(){},__name(Ek,"Ek"),__name(Gk,"Gk"),__name(Fk,"Fk"),(k=Ek.prototype).get=function(a){var b=this;return E().then(function(){return We(b.a.getItem(a))})},k.set=function(a,b){var c=this;return E().then(function(){var d=Ue(b);null===d?c.U(a):c.a.setItem(a,d)})},k.U=function(a){var b=this;return E().then(function(){b.a.removeItem(a)})},k.ca=function(a){l.window&&nd(l.window,"storage",a)},k.ia=function(a){l.window&&xd(l.window,"storage",a)},__name(Hk,"Hk"),(k=Hk.prototype).get=function(){return E(null)},k.set=function(){return E()},k.U=function(){return E()},k.ca=function(){},k.ia=function(){},__name(Ik,"Ik"),__name(Kk,"Kk"),__name(Jk,"Jk"),(k=Ik.prototype).get=function(a){var b=this;return E().then(function(){return We(b.a.getItem(a))})},k.set=function(a,b){var c=this;return E().then(function(){var d=Ue(b);null===d?c.U(a):c.a.setItem(a,d)})},k.U=function(a){var b=this;return E().then(function(){b.a.removeItem(a)})},k.ca=function(){},k.ia=function(){},__name(Lk,"Lk");var Qk,Uk,Mk={F:Ek,cb:Ik},Nk={F:Ek,cb:Ik},Ok={F:fk,cb:Hk},Pk={F:Ek,cb:Hk},Rk={rd:"local",NONE:"none",td:"session"};function Sk(a){var b=new t("invalid-persistence-type"),c=new t("unsupported-persistence-type");a:{for(d in Rk)if(Rk[d]==a){var d=!0;break a}d=!1}if(!d||"string"!=typeof a)throw b;switch(Ke()){case"ReactNative":if("session"===a)throw c;break;case"Node":if("none"!==a)throw c;break;case"Worker":if("session"===a||!pk()&&"none"!==a)throw c;break;default:if(!Pe()&&"none"!==a)throw c}}function Tk(){var a=!(Xe(K())||!Ie()),b=Te(),c=Pe();this.m=a,this.h=b,this.l=c,this.a={},Qk||(Qk=new Lk),a=Qk;try{this.g=!qe()&&cf()||!l.indexedDB?new a.a.F:new Ck(Je()?new Dk:new a.a.F)}catch(d){this.g=new Dk,this.h=!0}try{this.i=new a.a.cb}catch(d){this.i=new Dk}this.v=new Dk,this.f=q(this.Zb,this),this.b={}}function Vk(){return Uk||(Uk=new Tk),Uk}function Wk(a,b){switch(b){case"session":return a.i;case"none":return a.v;default:return a.g}}function Xk(a,b){return"firebase:"+a.name+(b?":"+b:"")}function Yk(a,b,c){var d=Xk(b,c),e=Wk(a,b.F);return a.get(b,c).then(function(f){var g=null;try{g=We(l.localStorage.getItem(d))}catch(h){}if(g&&!f)return l.localStorage.removeItem(d),a.set(b,g,c);g&&f&&"localStorage"!=e.type&&l.localStorage.removeItem(d)})}function Zk(a,b,c){return c=Xk(b,c),"local"==b.F&&(a.b[c]=null),Wk(a,b.F).U(c)}function $k(a){al(a),a.c=setInterval(function(){for(var b in a.a){var c=l.localStorage.getItem(b),d=a.b[b];c!=d&&(a.b[b]=c,c=new bd({type:"storage",key:b,target:window,oldValue:d,newValue:c,a:!0}),a.Zb(c))}},1e3)}function al(a){a.c&&(clearInterval(a.c),a.c=null)}function bl(a){this.a=a,this.b=Vk()}__name(Sk,"Sk"),__name(Tk,"Tk"),__name(Vk,"Vk"),__name(Wk,"Wk"),__name(Xk,"Xk"),__name(Yk,"Yk"),(k=Tk.prototype).get=function(a,b){return Wk(this,a.F).get(Xk(a,b))},__name(Zk,"Zk"),k.set=function(a,b,c){var d=Xk(a,c),e=this,f=Wk(this,a.F);return f.set(d,b).then(function(){return f.get(d)}).then(function(g){"local"==a.F&&(e.b[d]=g)})},k.addListener=function(a,b,c){a=Xk(a,b),this.l&&(this.b[a]=l.localStorage.getItem(a)),mb(this.a)&&(Wk(this,"local").ca(this.f),this.h||(qe()||!cf())&&l.indexedDB||!this.l||$k(this)),this.a[a]||(this.a[a]=[]),this.a[a].push(c)},k.removeListener=function(a,b,c){a=Xk(a,b),this.a[a]&&(Xa(this.a[a],function(d){return d==c}),0==this.a[a].length&&delete this.a[a]),mb(this.a)&&(Wk(this,"local").ia(this.f),al(this))},__name($k,"$k"),__name(al,"al"),k.Zb=function(a){if(a&&a.g){var b=a.a.key;if(null==b)for(var c in this.a){var d=this.b[c];void 0===d&&(d=null);var e=l.localStorage.getItem(c);e!==d&&(this.b[c]=e,this.nb(c))}else if(0==b.indexOf("firebase:")&&this.a[b]){if(void 0!==a.a.a?Wk(this,"local").ia(this.f):al(this),this.m)if(c=l.localStorage.getItem(b),(d=a.a.newValue)!==c)null!==d?l.localStorage.setItem(b,d):l.localStorage.removeItem(b);else if(this.b[b]===d&&void 0===a.a.a)return;var f=this;c=__name(function(){(void 0!==a.a.a||f.b[b]!==l.localStorage.getItem(b))&&(f.b[b]=l.localStorage.getItem(b),f.nb(b))},"c"),Wb&&ic&&10==ic&&l.localStorage.getItem(b)!==a.a.newValue&&a.a.newValue!==a.a.oldValue?setTimeout(c,10):c()}}else w(a,q(this.nb,this))},k.nb=function(a){this.a[a]&&w(this.a[a],function(b){b()})},__name(bl,"bl");var il,cl={name:"authEvent",F:"local"};function dl(a){return a.b.get(cl,a.a).then(function(b){return th(b)})}function el(){this.a=Vk()}function fl(){this.b=-1}function gl(a,b){this.b=hl,this.f=l.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=a,this.h=b,this.l=l.Int32Array?new Int32Array(64):Array(64),void 0===il&&(il=l.Int32Array?new Int32Array(jl):jl),this.reset()}__name(dl,"dl"),__name(el,"el"),__name(fl,"fl"),__name(gl,"gl"),r(gl,fl);for(var hl=64,kl=hl-1,ll=[],ml=0;ml<kl;ml++)ll[ml]=0;var nl=Ya(128,ll);function ol(a){for(var b=a.f,c=a.l,d=0,e=0;e<b.length;)c[d++]=b[e]<<24|b[e+1]<<16|b[e+2]<<8|b[e+3],e=4*d;for(b=16;64>b;b++){e=0|c[b-15],d=0|c[b-2];var f=(0|c[b-16])+((e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3)|0,g=(0|c[b-7])+((d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10)|0;c[b]=f+g|0}d=0|a.a[0],e=0|a.a[1];var h=0|a.a[2],m=0|a.a[3],p=0|a.a[4],v=0|a.a[5],B=0|a.a[6];for(f=0|a.a[7],b=0;64>b;b++){var A=((d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10))+(d&e^d&h^e&h)|0;g=(f=f+((p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))|0)+((g=(g=p&v^~p&B)+(0|il[b])|0)+(0|c[b])|0)|0,f=B,B=v,v=p,p=m+g|0,m=h,h=e,e=d,d=g+A|0}a.a[0]=a.a[0]+d|0,a.a[1]=a.a[1]+e|0,a.a[2]=a.a[2]+h|0,a.a[3]=a.a[3]+m|0,a.a[4]=a.a[4]+p|0,a.a[5]=a.a[5]+v|0,a.a[6]=a.a[6]+B|0,a.a[7]=a.a[7]+f|0}function pl(a,b,c){void 0===c&&(c=b.length);var d=0,e=a.c;if("string"==typeof b)for(;d<c;)a.f[e++]=b.charCodeAt(d++),e==a.b&&(ol(a),e=0);else{if(!na(b))throw Error("message must be string or array");for(;d<c;){var f=b[d++];if(!("number"==typeof f&&0<=f&&255>=f&&f==(0|f)))throw Error("message must be a byte array");a.f[e++]=f,e==a.b&&(ol(a),e=0)}}a.c=e,a.g+=c}gl.prototype.reset=function(){this.g=this.c=0,this.a=l.Int32Array?new Int32Array(this.h):Za(this.h)},__name(ol,"ol"),__name(pl,"pl");var jl=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function ql(){gl.call(this,8,rl)}__name(ql,"ql"),r(ql,gl);var rl=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function sl(a,b,c,d,e,f){this.v=a,this.i=b,this.l=c,this.m=d||null,this.u=e||null,this.s=f,this.h=b+":"+c,this.C=new el,this.g=new bl(this.h),this.f=null,this.b=[],this.a=this.c=null}function tl(a){return new t("invalid-cordova-configuration",a)}function ul(){for(var a=20,b=[];0<a;)b.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),a--;return b.join("")}function vl(a){var b=new ql;pl(b,a),a=[];var c=8*b.g;56>b.c?pl(b,nl,56-b.c):pl(b,nl,b.b-(b.c-56));for(var d=63;56<=d;d--)b.f[d]=255&c,c/=256;for(ol(b),d=c=0;d<b.i;d++)for(var e=24;0<=e;e-=8)a[c++]=b.a[d]>>e&255;return cg(a)}function xl(a,b,c,d,e){var f=ul(),g=new sh(b,d,null,f,new t("no-auth-event"),null,e),h=L("BuildInfo.packageName",l);if("string"!=typeof h)throw new t("invalid-cordova-configuration");var m=L("BuildInfo.displayName",l),p={};if(K().toLowerCase().match(/iphone|ipad|ipod/))p.ibi=h;else{if(!K().toLowerCase().match(/android/))return F(new t("operation-not-supported-in-this-environment"));p.apn=h}m&&(p.appDisplayName=m),f=vl(f),p.sessionId=f;var v=ek(a.v,a.i,a.l,b,c,null,d,a.m,p,a.u,e,a.s);return a.ma().then(function(){var B=a.h;return a.C.a.set(cl,g.w(),B)}).then(function(){var B=L("cordova.plugins.browsertab.isAvailable",l);if("function"!=typeof B)throw new t("invalid-cordova-configuration");var A=null;B(function(Q){if(Q){if("function"!=typeof(A=L("cordova.plugins.browsertab.openUrl",l)))throw new t("invalid-cordova-configuration");A(v)}else{if("function"!=typeof(A=L("cordova.InAppBrowser.open",l)))throw new t("invalid-cordova-configuration");Q=K(),a.a=A(v,Q.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||Q.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}function zl(a,b){for(var c=0;c<a.b.length;c++)try{a.b[c](b)}catch(d){}}function wl(a){return a.f||(a.f=a.ma().then(function(){return new D(function(b){function c(d){return b(d),a.Ta(c),!1}__name(c,"c"),a.Ea(c),Al(a)})})),a.f}function yl(a){var b=null;return dl(a.g).then(function(c){return b=c,Zk((c=a.g).b,cl,c.a)}).then(function(){return b})}function Al(a){function b(g){d=!0,e&&e.cancel(),yl(a).then(function(h){var m=c;if(h&&g&&g.url){var p=null;-1!=(m=xg(g.url)).indexOf("/__/auth/callback")&&(p=(p="object"==typeof(p=We(be(p=J(m),"firebaseError")||null))?Aa(p):null)?new sh(h.c,h.b,null,null,p,null,h.T()):new sh(h.c,h.b,m,h.f,null,null,h.T())),m=p||c}zl(a,m)})}__name(b,"b");var c=new sh("unknown",null,null,null,new t("no-auth-event")),d=!1,e=Fd(500).then(function(){return yl(a).then(function(){d||zl(a,c)})}),f=l.handleOpenURL;l.handleOpenURL=function(g){if(0==g.toLowerCase().indexOf(L("BuildInfo.packageName",l).toLowerCase()+"://")&&b({url:g}),"function"==typeof f)try{f(g)}catch(h){console.error(h)}},vh||(vh=new uh),wh(b)}function Bl(a){this.a=a,this.b=Vk()}__name(sl,"sl"),__name(tl,"tl"),(k=sl.prototype).ma=function(){return this.Ia?this.Ia:this.Ia=Fe().then(function(){if("function"!=typeof L("universalLinks.subscribe",l))throw tl("cordova-universal-links-plugin-fix is not installed");if(void 0===L("BuildInfo.packageName",l))throw tl("cordova-plugin-buildinfo is not installed");if("function"!=typeof L("cordova.plugins.browsertab.openUrl",l))throw tl("cordova-plugin-browsertab is not installed");if("function"!=typeof L("cordova.InAppBrowser.open",l))throw tl("cordova-plugin-inappbrowser is not installed")},function(){throw new t("cordova-not-ready")})},__name(ul,"ul"),__name(vl,"vl"),k.Pb=function(a,b){return b(new t("operation-not-supported-in-this-environment")),E()},k.Nb=function(){return F(new t("operation-not-supported-in-this-environment"))},k.ac=function(){return!1},k.Yb=function(){return!0},k.Ub=function(){return!0},k.Ob=function(a,b,c,d){if(this.c)return F(new t("redirect-operation-pending"));var e=this,f=l.document,g=null,h=null,m=null,p=null;return this.c=E().then(function(){return rh(b),wl(e)}).then(function(){return xl(e,a,b,c,d)}).then(function(){return new D(function(v,B){h=__name(function(){var A=L("cordova.plugins.browsertab.close",l);return v(),"function"==typeof A&&A(),e.a&&"function"==typeof e.a.close&&(e.a.close(),e.a=null),!1},"h"),e.Ea(h),m=__name(function(){g||(g=Fd(2e3).then(function(){B(new t("redirect-cancelled-by-user"))}))},"m"),p=__name(function(){$e()&&m()},"p"),f.addEventListener("resume",m,!1),K().toLowerCase().match(/android/)||f.addEventListener("visibilitychange",p,!1)}).o(function(v){return yl(e).then(function(){throw v})})}).oa(function(){m&&f.removeEventListener("resume",m,!1),p&&f.removeEventListener("visibilitychange",p,!1),g&&g.cancel(),h&&e.Ta(h),e.c=null})},__name(xl,"xl"),__name(zl,"zl"),__name(wl,"wl"),__name(yl,"yl"),__name(Al,"Al"),k.Ea=function(a){this.b.push(a),wl(this).o(function(b){"auth/invalid-cordova-configuration"===b.code&&(b=new sh("unknown",null,null,null,new t("no-auth-event")),a(b))})},k.Ta=function(a){Xa(this.b,function(b){return b==a})},__name(Bl,"Bl");var Cl={name:"pendingRedirect",F:"session"};function Dl(a){return a.b.set(Cl,"pending",a.a)}function El(a){return Zk(a.b,Cl,a.a)}function Fl(a){return a.b.get(Cl,a.a).then(function(b){return"pending"==b})}function Gl(a,b,c,d){this.i={},this.u=0,this.D=a,this.v=b,this.m=c,this.J=d,this.h=[],this.f=!1,this.l=q(this.s,this),this.b=new Hl,this.C=new Il,this.g=new Bl(Jl(this.v,this.m)),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.C,this.c.linkViaPopup=this.C,this.c.reauthViaPopup=this.C,this.a=Kl(this.D,this.v,this.m,Da,this.J)}function Kl(a,b,c,d,e){var f=firebase.SDK_VERSION||null;return Ge()?new sl(a,b,c,f,d,e):new Yj(a,b,c,f,d,e)}function Ll(a){a.f||(a.f=!0,a.a.Ea(a.l));var b=a.a;return a.a.ma().o(function(c){throw a.a==b&&a.reset(),c})}function Ml(a){a.a.Yb()&&Ll(a).o(function(b){var c=new sh("unknown",null,null,null,new t("operation-not-supported-in-this-environment"));Nl(b)&&a.s(c)}),a.a.Ub()||Ol(a.b)}function Pl(a,b){Va(a.h,b)||a.h.push(b),a.f||Fl(a.g).then(function(c){c?El(a.g).then(function(){Ll(a).o(function(d){var e=new sh("unknown",null,null,null,new t("operation-not-supported-in-this-environment"));Nl(d)&&a.s(e)})}):Ml(a)}).o(function(){Ml(a)})}function Ql(a,b){Xa(a.h,function(c){return c==b})}__name(Dl,"Dl"),__name(El,"El"),__name(Fl,"Fl"),__name(Gl,"Gl"),__name(Kl,"Kl"),Gl.prototype.reset=function(){this.f=!1,this.a.Ta(this.l),this.a=Kl(this.D,this.v,this.m,null,this.J),this.i={}},__name(Ll,"Ll"),__name(Ml,"Ml"),__name(Pl,"Pl"),__name(Ql,"Ql"),Gl.prototype.s=function(a){if(!a)throw new t("invalid-auth-event");if(6e5<=Date.now()-this.u&&(this.i={},this.u=0),a&&a.getUid()&&this.i.hasOwnProperty(a.getUid()))return!1;for(var b=!1,c=0;c<this.h.length;c++){var d=this.h[c];if(d.Gb(a.c,a.b)){(b=this.c[a.c])&&(b.h(a,d),a&&(a.f||a.b)&&(this.i[a.getUid()]=!0,this.u=Date.now())),b=!0;break}}return Ol(this.b),b};var Rl=new Ze(2e3,1e4),Sl=new Ze(3e4,6e4);function Tl(a,b,c,d,e,f,g){return a.a.Nb(b,c,d,function(){a.f||(a.f=!0,a.a.Ea(a.l))},function(){a.reset()},e,f,g)}function Nl(a){return!(!a||"auth/cordova-not-ready"!=a.code)}function Ul(a,b,c,d,e){var f;return Dl(a.g).then(function(){return a.a.Ob(b,c,d,e).o(function(g){if(Nl(g))throw new t("operation-not-supported-in-this-environment");return f=g,El(a.g).then(function(){throw f})}).then(function(){return a.a.ac()?new D(function(){}):El(a.g).then(function(){return a.ra()}).then(function(){}).o(function(){})})})}function Vl(a,b,c,d,e){return a.a.Pb(d,function(f){b.na(c,null,f,e)},Rl.get())}Gl.prototype.ra=function(){return this.b.ra()},__name(Tl,"Tl"),__name(Nl,"Nl"),__name(Ul,"Ul"),__name(Vl,"Vl");var Wl={};function Jl(a,b,c){return a=a+":"+b,c&&(a=a+":"+c.url),a}function Xl(a,b,c,d){var e=Jl(b,c,d);return Wl[e]||(Wl[e]=new Gl(a,b,c,d)),Wl[e]}function Hl(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function Ol(a){a.g||(a.g=!0,Yl(a,!1,null,null))}function $l(a){a.g&&!a.i&&Yl(a,!1,null,null)}function Zl(a,b,c){c=c.Fa(b.c,b.b);var d=b.g,e=b.f,f=b.i,g=b.T(),h=!!b.c.match(/Redirect$/);c(d,e,g,f).then(function(m){Yl(a,h,m,null)}).o(function(m){Yl(a,h,null,m)})}function am(a,b){if(a.b=function(){return F(b)},a.c.length)for(var c=0;c<a.c.length;c++)a.c[c](b)}function bm(a,b){if(a.b=function(){return E(b)},a.f.length)for(var c=0;c<a.f.length;c++)a.f[c](b)}function Yl(a,b,c,d){b?d?am(a,d):bm(a,c):bm(a,{user:null}),a.f=[],a.c=[]}function cm(a){var b=new t("timeout");a.a&&a.a.cancel(),a.a=Fd(Sl.get()).then(function(){a.b||(a.g=!0,Yl(a,!0,null,b))})}function Il(){}function dm(a,b){var c=a.b,d=a.c;b.Fa(d,c)(a.g,a.f,a.T(),a.i).then(function(e){b.na(d,e,null,c)}).o(function(e){b.na(d,null,e,c)})}function em(){this.jb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.jb},set:function(a){this.jb=a},enumerable:!1})}function fm(a,b){this.a=b,M(this,"verificationId",a)}function gm(a,b,c,d){return new lh(a).gb(b,c).then(function(e){return new fm(e,d)})}function hm(a){var b=ig(a);if(!(b&&b.exp&&b.auth_time&&b.iat))throw new t("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");N(this,{token:a,expirationTime:bf(1e3*b.exp),authTime:bf(1e3*b.auth_time),issuedAtTime:bf(1e3*b.iat),signInProvider:b.firebase&&b.firebase.sign_in_provider?b.firebase.sign_in_provider:null,signInSecondFactor:b.firebase&&b.firebase.sign_in_second_factor?b.firebase.sign_in_second_factor:null,claims:b})}function im(a,b,c){var d=b&&b[jm];if(!d)throw new t("argument-error","Internal assert: Invalid MultiFactorResolver");this.a=a,this.f=nb(b),this.g=c,this.c=new yg(null,d),this.b=[];var e=this;w(b[km]||[],function(f){(f=tf(f))&&e.b.push(f)}),M(this,"auth",this.a),M(this,"session",this.c),M(this,"hints",this.b)}__name(Jl,"Jl"),__name(Xl,"Xl"),__name(Hl,"Hl"),Hl.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},Hl.prototype.h=function(a,b){if(a){this.reset(),this.g=!0;var c=a.c,d=a.b,e=a.a&&"auth/web-storage-unsupported"==a.a.code,f=a.a&&"auth/operation-not-supported-in-this-environment"==a.a.code;this.i=!(!e&&!f),"unknown"!=c||e||f?a.a?(Yl(this,!0,null,a.a),E()):b.Fa(c,d)?Zl(this,a,b):F(new t("invalid-auth-event")):(Yl(this,!1,null,null),E())}else F(new t("invalid-auth-event"))},__name(Ol,"Ol"),__name($l,"$l"),__name(Zl,"Zl"),__name(am,"am"),__name(bm,"bm"),__name(Yl,"Yl"),Hl.prototype.ra=function(){var a=this;return new D(function(b,c){a.b?a.b().then(b,c):(a.f.push(b),a.c.push(c),cm(a))})},__name(cm,"cm"),__name(Il,"Il"),Il.prototype.h=function(a,b){if(a){var c=a.c,d=a.b;a.a?(b.na(a.c,null,a.a,a.b),E()):b.Fa(c,d)?dm(a,b):F(new t("invalid-auth-event"))}else F(new t("invalid-auth-event"))},__name(dm,"dm"),__name(em,"em"),__name(fm,"fm"),fm.prototype.confirm=function(a){return a=ph(this.verificationId,a),this.a(a)},__name(gm,"gm"),__name(hm,"hm"),__name(im,"im");var km="mfaInfo",jm="mfaPendingCredential";function lm(a,b,c,d){t.call(this,"multi-factor-auth-required",d,b),this.b=new im(a,b,c),M(this,"resolver",this.b)}function mm(a,b,c){if(a&&n(a.serverResponse)&&"auth/multi-factor-auth-required"===a.code)try{return new lm(b,a.serverResponse,c,a.message)}catch(d){}return null}function nm(){}function om(a,b,c,d){return c.Ha().then(function(e){return e={idToken:e},void 0!==d&&(e.displayName=d),z(e,{phoneVerificationInfo:hh(a.a)}),O(b,Gj,e)})}function pm(a,b,c){return c.Ha().then(function(d){return z(d={mfaPendingCredential:d},{phoneVerificationInfo:hh(a.a)}),O(b,Hj,d)})}function qm(a){M(this,"factorId",a.fa),this.a=a}function rm(a){if(qm.call(this,a),this.a.fa!=lh.PROVIDER_ID)throw new t("argument-error","firebase.auth.PhoneMultiFactorAssertion requires a valid firebase.auth.PhoneAuthCredential")}function sm(a,b){for(var c in G.call(this,a),b)this[c]=b[c]}function tm(a,b){this.a=a,this.b=[],this.c=q(this.yc,this),nd(this.a,"userReloaded",this.c);var c=[];b&&b.multiFactor&&b.multiFactor.enrolledFactors&&w(b.multiFactor.enrolledFactors,function(d){var e=null,f={};if(d){d.uid&&(f[qf]=d.uid),d.displayName&&(f[rf]=d.displayName),d.enrollmentTime&&(f[sf]=new Date(d.enrollmentTime).toISOString()),d.phoneNumber&&(f[pf]=d.phoneNumber);try{e=new uf(f)}catch(g){}d=e}else d=null;d&&c.push(d)}),um(this,c)}function vm(a){var b=[];return w(a.mfaInfo||[],function(c){(c=tf(c))&&b.push(c)}),b}function um(a,b){a.b=b,M(a,"enrolledFactors",b)}function xm(a,b,c){if(this.h=a,this.i=b,this.g=c,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function zm(a,b){return b?(a.a=a.c,a.g()):(b=a.a,a.a*=2,a.a>a.f&&(a.a=a.f),b)}function ym(a,b){a.stop(),a.b=Fd(zm(a,b)).then(function(){return af()}).then(function(){return a.h()}).then(function(){ym(a,!0)}).o(function(c){a.i(c)&&ym(a,!1)})}function Am(a){this.f=a,this.b=this.a=null,this.c=Date.now()}function Bm(a,b){void 0===b&&(a.b?b=(b=a.b).a-b.g:b=0),a.c=Date.now()+1e3*b}function Cm(a,b){a.b=jg(b[Dg]||""),a.a=b.refreshToken,Bm(a,void 0!==(b=b.expiresIn)?Number(b):void 0)}function Dm(a,b){a.b=b.b,a.a=b.a,a.c=b.c}function Em(a,b){return Wi(a.f,b).then(function(c){return a.b=jg(c.access_token),a.a=c.refresh_token,Bm(a,c.expires_in),{accessToken:a.b.toString(),refreshToken:a.a}}).o(function(c){throw"auth/user-token-expired"==c.code&&(a.a=null),c})}function Fm(a,b){this.a=a||null,this.b=b||null,N(this,{lastSignInTime:bf(b||null),creationTime:bf(a||null)})}function Gm(a){return new Fm(a.a,a.b)}function Hm(a,b,c,d,e,f){N(this,{uid:a,displayName:d||null,photoURL:e||null,email:c||null,phoneNumber:f||null,providerId:b})}function Im(a,b,c){this.N=[],this.l=a.apiKey,this.m=a.appName,this.s=a.authDomain||null;var d=firebase.SDK_VERSION?Oe(firebase.SDK_VERSION):null;this.a=new Ii(this.l,Ca(Da),d),(this.u=a.emulatorConfig||null)&&Pi(this.a,this.u),this.h=new Am(this.a),Jm(this,b[Dg]),Cm(this.h,b),M(this,"refreshToken",this.h.a),Km(this,c||{}),H.call(this),this.P=!1,this.s&&Re()&&(this.b=Xl(this.s,this.l,this.m,this.u)),this.W=[],this.i=null,this.D=Lm(this),this.ba=q(this.ib,this);var e=this;this.za=null,this.Pa=function(f){e.xa(f.h)},this.qa=null,this.Ba=function(f){Mm(e,f.c)},this.$=null,this.aa=[],this.Oa=function(f){Nm(e,f.f)},this.ja=null,this.S=new tm(this,c),M(this,"multiFactor",this.S)}function Mm(a,b){a.u=b,Pi(a.a,b),a.b&&(b=a.b,a.b=Xl(a.s,a.l,a.m,a.u),a.P&&(Ql(b,a),Pl(a.b,a)))}function Om(a,b){a.qa&&xd(a.qa,"languageCodeChanged",a.Pa),(a.qa=b)&&nd(b,"languageCodeChanged",a.Pa)}function Pm(a,b){a.$&&xd(a.$,"emulatorConfigChanged",a.Ba),(a.$=b)&&nd(b,"emulatorConfigChanged",a.Ba)}function Nm(a,b){a.aa=b,Ri(a.a,firebase.SDK_VERSION?Oe(firebase.SDK_VERSION,a.aa):null)}function Qm(a,b){a.ja&&xd(a.ja,"frameworkChanged",a.Oa),(a.ja=b)&&nd(b,"frameworkChanged",a.Oa)}function Rm(a){try{return firebase.app(a.m).auth()}catch(b){throw new t("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+a.m+"'!")}}function Lm(a){return new xm(function(){return a.I(!0)},function(b){return!(!b||"auth/network-request-failed"!=b.code)},function(){var b=a.h.c-Date.now()-3e5;return 0<b?b:0})}function Sm(a){a.J||a.D.b||(a.D.start(),xd(a,"tokenChanged",a.ba),nd(a,"tokenChanged",a.ba))}function Tm(a){xd(a,"tokenChanged",a.ba),a.D.stop()}function Jm(a,b){a.Aa=b,M(a,"_lat",b)}function Um(a,b){Xa(a.W,function(c){return c==b})}function Vm(a){for(var b=[],c=0;c<a.W.length;c++)b.push(a.W[c](a));return Jc(b).then(function(){return a})}function Wm(a){a.b&&!a.P&&(a.P=!0,Pl(a.b,a))}function Km(a,b){N(a,{uid:b.uid,displayName:b.displayName||null,photoURL:b.photoURL||null,email:b.email||null,emailVerified:b.emailVerified||!1,phoneNumber:b.phoneNumber||null,isAnonymous:b.isAnonymous||!1,tenantId:b.tenantId||null,metadata:new Fm(b.createdAt,b.lastLoginAt),providerData:[]}),a.a.b=a.tenantId}function Xm(){}function Ym(a){return E().then(function(){if(a.J)throw new t("app-deleted")})}function Zm(a){return Ra(a.providerData,function(b){return b.providerId})}function $m(a,b){b&&(an(a,b.providerId),a.providerData.push(b))}function an(a,b){Xa(a.providerData,function(c){return c.providerId==b})}function bn(a,b,c){("uid"!=b||c)&&a.hasOwnProperty(b)&&M(a,b,c)}function cn(a,b){a!=b&&(N(a,{uid:b.uid,displayName:b.displayName,photoURL:b.photoURL,email:b.email,emailVerified:b.emailVerified,phoneNumber:b.phoneNumber,isAnonymous:b.isAnonymous,tenantId:b.tenantId,providerData:[]}),b.metadata?M(a,"metadata",Gm(b.metadata)):M(a,"metadata",new Fm),w(b.providerData,function(c){$m(a,c)}),Dm(a.h,b.h),M(a,"refreshToken",a.h.a),um(a.S,b.S.b))}function dn(a){return a.I().then(function(b){var c=a.isAnonymous;return en(a,b).then(function(){return c||bn(a,"isAnonymous",!1),b})})}function wm(a,b){b[Dg]&&a.Aa!=b[Dg]&&(Cm(a.h,b),a.dispatchEvent(new sm("tokenChanged")),Jm(a,b[Dg]),bn(a,"refreshToken",a.h.a))}function en(a,b){return O(a.a,Ij,{idToken:b}).then(q(a.Kc,a))}function fn(a){return(a=a.providerUserInfo)&&a.length?Ra(a,function(b){return new Hm(b.rawId,b.providerId,b.email,b.displayName,b.photoUrl,b.phoneNumber)}):[]}function hn(a,b){return dn(a).then(function(){if(Va(Zm(a),b))return Vm(a).then(function(){throw new t("provider-already-linked")})})}function gn(a,b,c){return kf({user:a,credential:qh(b),additionalUserInfo:b=og(b),operationType:c})}function jn(a,b){return wm(a,b),a.reload().then(function(){return a})}function kn(a,b,c,d,e){if(!Re())return F(new t("operation-not-supported-in-this-environment"));if(a.i&&!e)return F(a.i);var f=ng(c.providerId),g=Qe(a.uid+":::"),h=null;(!Te()||Ie())&&a.s&&c.isOAuthProvider&&(h=ek(a.s,a.l,a.m,b,c,null,g,firebase.SDK_VERSION||null,null,null,a.tenantId,a.u));var m=ze(h,f&&f.va,f&&f.ua);return d=d().then(function(){if(ln(a),!e)return a.I().then(function(){})}).then(function(){return Tl(a.b,m,b,c,g,!!h,a.tenantId)}).then(function(){return new D(function(p,v){a.na(b,null,new t("cancelled-popup-request"),a.g||null),a.f=p,a.C=v,a.g=g,a.c=Vl(a.b,a,b,m,g)})}).then(function(p){return m&&ye(m),p?kf(p):null}).o(function(p){throw m&&ye(m),p}),R(a,d,e)}function mn(a,b,c,d,e){if(!Re())return F(new t("operation-not-supported-in-this-environment"));if(a.i&&!e)return F(a.i);var f=null,g=Qe(a.uid+":::");return d=d().then(function(){if(ln(a),!e)return a.I().then(function(){})}).then(function(){return a.ga=g,Vm(a)}).then(function(h){return a.ha&&(h=(h=a.ha).b.set(nn,a.w(),h.a)),h}).then(function(){return Ul(a.b,b,c,g,a.tenantId)}).o(function(h){if(f=h,a.ha)return on(a.ha);throw f}).then(function(){if(f)throw f}),R(a,d,e)}function ln(a){if(!a.b||!a.P)throw a.b&&!a.P?new t("internal-error"):new t("auth-domain-config-required")}function R(a,b,c){var d=pn(a,b,c);return a.N.push(d),d.oa(function(){Wa(a.N,d)}),d.o(function(e){var f=null;throw e&&"auth/multi-factor-auth-required"===e.code&&(f=mm(e.w(),Rm(a),q(a.jc,a))),f||e})}function pn(a,b,c){return a.i&&!c?(b.cancel(),F(a.i)):b.o(function(d){throw!d||"auth/user-disabled"!=d.code&&"auth/user-token-expired"!=d.code||(a.i||a.dispatchEvent(new sm("userInvalidated")),a.i=d),d})}function qn(a){if(!a.apiKey)return null;var b={apiKey:a.apiKey,authDomain:a.authDomain,appName:a.appName,emulatorConfig:a.emulatorConfig},c={};if(!a.stsTokenManager||!a.stsTokenManager.accessToken)return null;c[Dg]=a.stsTokenManager.accessToken,c.refreshToken=a.stsTokenManager.refreshToken||null;var d=a.stsTokenManager.expirationTime;d&&(c.expiresIn=(d-Date.now())/1e3);var e=new Im(b,c,a);return a.providerData&&w(a.providerData,function(f){f&&$m(e,kf(f))}),a.redirectEventId&&(e.ga=a.redirectEventId),e}function rn(a,b,c,d){var e=new Im(a,b);return c&&(e.ha=c),d&&Nm(e,d),e.reload().then(function(){return e})}function sn(a,b,c,d){var e=a.h,f={};return f[Dg]=e.b&&e.b.toString(),f.refreshToken=e.a,b=new Im(b||{apiKey:a.l,authDomain:a.s,appName:a.m},f),c&&(b.ha=c),d&&Nm(b,d),cn(b,a),b}function tn(a){this.a=a,this.b=Vk()}im.prototype.Rc=function(a){var b=this;return a.tb(this.a.a,this.c).then(function(c){var d=nb(b.f);return delete d[km],delete d[jm],z(d,c),b.g(d)})},__name(lm,"lm"),r(lm,t),__name(mm,"mm"),__name(nm,"nm"),nm.prototype.tb=function(a,b,c){return b.type==zg?om(this,a,b,c):pm(this,a,b)},__name(om,"om"),__name(pm,"pm"),__name(qm,"qm"),r(qm,nm),__name(rm,"rm"),r(rm,qm),__name(sm,"sm"),r(sm,G),__name(tm,"tm"),__name(vm,"vm"),(k=tm.prototype).yc=function(a){um(this,vm(a.hd))},__name(um,"um"),k.Sb=function(){return this.a.I().then(function(a){return new yg(a,null)})},k.fc=function(a,b){var c=this,d=this.a.a;return this.Sb().then(function(e){return a.tb(d,e,b)}).then(function(e){return wm(c.a,e),c.a.reload()})},k.bd=function(a){var b=this,c="string"==typeof a?a:a.uid,d=this.a.a;return this.a.I().then(function(e){return O(d,Lj,{idToken:e,mfaEnrollmentId:c})}).then(function(e){var f=Qa(b.b,function(g){return g.uid!=c});return um(b,f),wm(b.a,e),b.a.reload().o(function(g){if("auth/user-token-expired"!=g.code)throw g})})},k.w=function(){return{multiFactor:{enrolledFactors:Ra(this.b,function(a){return a.w()})}}},__name(xm,"xm"),xm.prototype.start=function(){this.a=this.c,ym(this,!0)},__name(zm,"zm"),__name(ym,"ym"),xm.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},__name(Am,"Am"),Am.prototype.w=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b&&this.b.toString(),expirationTime:this.c}},__name(Bm,"Bm"),__name(Cm,"Cm"),__name(Dm,"Dm"),__name(Em,"Em"),Am.prototype.getToken=function(a){return a=!!a,this.b&&!this.a?F(new t("user-token-expired")):a||!this.b||Date.now()>this.c-3e4?this.a?Em(this,{grant_type:"refresh_token",refresh_token:this.a}):E(null):E({accessToken:this.b.toString(),refreshToken:this.a})},__name(Fm,"Fm"),__name(Gm,"Gm"),Fm.prototype.w=function(){return{lastLoginAt:this.b,createdAt:this.a}},__name(Hm,"Hm"),__name(Im,"Im"),r(Im,H),Im.prototype.xa=function(a){this.za=a,Oi(this.a,a)},__name(Mm,"Mm"),Im.prototype.la=function(){return this.za},__name(Om,"Om"),__name(Pm,"Pm"),__name(Nm,"Nm"),Im.prototype.Ga=function(){return Za(this.aa)},__name(Qm,"Qm"),Im.prototype.ib=function(){this.D.b&&(this.D.stop(),this.D.start())},__name(Rm,"Rm"),__name(Lm,"Lm"),__name(Sm,"Sm"),__name(Tm,"Tm"),__name(Jm,"Jm"),__name(Um,"Um"),__name(Vm,"Vm"),__name(Wm,"Wm"),__name(Km,"Km"),M(Im.prototype,"providerId","firebase"),__name(Xm,"Xm"),__name(Ym,"Ym"),__name(Zm,"Zm"),__name($m,"$m"),__name(an,"an"),__name(bn,"bn"),__name(cn,"cn"),(k=Im.prototype).reload=function(){var a=this;return R(this,Ym(this).then(function(){return dn(a).then(function(){return Vm(a)}).then(Xm)}))},__name(dn,"dn"),k.oc=function(a){return this.I(a).then(function(b){return new hm(b)})},k.I=function(a){var b=this;return R(this,Ym(this).then(function(){return b.h.getToken(a)}).then(function(c){if(!c)throw new t("internal-error");return c.accessToken!=b.Aa&&(Jm(b,c.accessToken),b.dispatchEvent(new sm("tokenChanged"))),bn(b,"refreshToken",c.refreshToken),c.accessToken}))},__name(wm,"wm"),__name(en,"en"),k.Kc=function(a){if(!(a=a.users)||!a.length)throw new t("internal-error");Km(this,{uid:(a=a[0]).localId,displayName:a.displayName,photoURL:a.photoUrl,email:a.email,emailVerified:!!a.emailVerified,phoneNumber:a.phoneNumber,lastLoginAt:a.lastLoginAt,createdAt:a.createdAt,tenantId:a.tenantId});for(var b=fn(a),c=0;c<b.length;c++)$m(this,b[c]);bn(this,"isAnonymous",!(this.email&&a.passwordHash||this.providerData&&this.providerData.length)),this.dispatchEvent(new sm("userReloaded",{hd:a}))},__name(fn,"fn"),k.Lc=function(a){return gf("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.ub(a)},k.ub=function(a){var b=this,c=null;return R(this,a.c(this.a,this.uid).then(function(d){return wm(b,d),c=gn(b,d,"reauthenticate"),b.i=null,b.reload()}).then(function(){return c}),!0)},__name(hn,"hn"),k.Cc=function(a){return gf("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.rb(a)},k.rb=function(a){var b=this,c=null;return R(this,hn(this,a.providerId).then(function(){return b.I()}).then(function(d){return a.b(b.a,d)}).then(function(d){return c=gn(b,d,"link"),jn(b,d)}).then(function(){return c}))},k.Dc=function(a,b){var c=this;return R(this,hn(this,"phone").then(function(){return gm(Rm(c),a,b,q(c.rb,c))}))},k.Mc=function(a,b){var c=this;return R(this,E().then(function(){return gm(Rm(c),a,b,q(c.ub,c))}),!0)},__name(gn,"gn"),__name(jn,"jn"),k.Cb=function(a){var b=this;return R(this,this.I().then(function(c){return b.a.Cb(c,a)}).then(function(c){return wm(b,c),b.reload()}))},k.ed=function(a){var b=this;return R(this,this.I().then(function(c){return a.b(b.a,c)}).then(function(c){return wm(b,c),b.reload()}))},k.Db=function(a){var b=this;return R(this,this.I().then(function(c){return b.a.Db(c,a)}).then(function(c){return wm(b,c),b.reload()}))},k.Eb=function(a){if(void 0===a.displayName&&void 0===a.photoURL)return Ym(this);var b=this;return R(this,this.I().then(function(c){return b.a.Eb(c,{displayName:a.displayName,photoUrl:a.photoURL})}).then(function(c){return wm(b,c),bn(b,"displayName",c.displayName||null),bn(b,"photoURL",c.photoUrl||null),w(b.providerData,function(d){"password"===d.providerId&&(M(d,"displayName",b.displayName),M(d,"photoURL",b.photoURL))}),Vm(b)}).then(Xm))},k.cd=function(a){var b=this;return R(this,dn(this).then(function(c){return Va(Zm(b),a)?rj(b.a,c,[a]).then(function(d){var e={};return w(d.providerUserInfo||[],function(f){e[f.providerId]=!0}),w(Zm(b),function(f){e[f]||an(b,f)}),e[lh.PROVIDER_ID]||M(b,"phoneNumber",null),Vm(b)}):Vm(b).then(function(){throw new t("no-such-provider")})}))},k.delete=function(){var a=this;return R(this,this.I().then(function(b){return O(a.a,Fj,{idToken:b})}).then(function(){a.dispatchEvent(new sm("userDeleted"))})).then(function(){for(var b=0;b<a.N.length;b++)a.N[b].cancel("app-deleted");Om(a,null),Pm(a,null),Qm(a,null),a.N=[],a.J=!0,Tm(a),M(a,"refreshToken",null),a.b&&Ql(a.b,a)})},k.Gb=function(a,b){return!!("linkViaPopup"==a&&(this.g||null)==b&&this.f||"reauthViaPopup"==a&&(this.g||null)==b&&this.f||"linkViaRedirect"==a&&(this.ga||null)==b||"reauthViaRedirect"==a&&(this.ga||null)==b)},k.na=function(a,b,c,d){"linkViaPopup"!=a&&"reauthViaPopup"!=a||d!=(this.g||null)||(c&&this.C?this.C(c):b&&!c&&this.f&&this.f(b),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.C)},k.Fa=function(a,b){return"linkViaPopup"==a&&b==(this.g||null)?q(this.Lb,this):"reauthViaPopup"==a&&b==(this.g||null)?q(this.Mb,this):"linkViaRedirect"==a&&(this.ga||null)==b?q(this.Lb,this):"reauthViaRedirect"==a&&(this.ga||null)==b?q(this.Mb,this):null},k.Ec=function(a){var b=this;return kn(this,"linkViaPopup",a,function(){return hn(b,a.providerId).then(function(){return Vm(b)})},!1)},k.Nc=function(a){return kn(this,"reauthViaPopup",a,function(){return E()},!0)},__name(kn,"kn"),k.Fc=function(a){var b=this;return mn(this,"linkViaRedirect",a,function(){return hn(b,a.providerId)},!1)},k.Oc=function(a){return mn(this,"reauthViaRedirect",a,function(){return E()},!0)},__name(mn,"mn"),__name(ln,"ln"),k.Lb=function(a,b,c,d){var e=this;this.c&&(this.c.cancel(),this.c=null);var f=null;return R(this,this.I().then(function(g){return Hg(e.a,{requestUri:a,postBody:d,sessionId:b,idToken:g})}).then(function(g){return f=gn(e,g,"link"),jn(e,g)}).then(function(){return f}))},k.Mb=function(a,b,c,d){var e=this;this.c&&(this.c.cancel(),this.c=null);var f=null;return R(this,E().then(function(){return Cg(Ig(e.a,{requestUri:a,sessionId:b,postBody:d,tenantId:c}),e.uid)}).then(function(h){return f=gn(e,h,"reauthenticate"),wm(e,h),e.i=null,e.reload()}).then(function(){return f}),!0)},k.vb=function(a){var b=this,c=null;return R(this,this.I().then(function(d){return c=d,void 0===a||mb(a)?{}:bg(new Sf(a))}).then(function(d){return b.a.vb(c,d)}).then(function(d){if(b.email!=d)return b.reload()}).then(function(){}))},k.Fb=function(a,b){var c=this,d=null;return R(this,this.I().then(function(e){return d=e,void 0===b||mb(b)?{}:bg(new Sf(b))}).then(function(e){return c.a.Fb(d,a,e)}).then(function(e){if(c.email!=e)return c.reload()}).then(function(){}))},__name(R,"R"),k.jc=function(a){var b=null,c=this;return R(this,a=Cg(E(a),c.uid).then(function(d){return b=gn(c,d,"reauthenticate"),wm(c,d),c.i=null,c.reload()}).then(function(){return b}),!0)},__name(pn,"pn"),k.toJSON=function(){return this.w()},k.w=function(){var a={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.s,stsTokenManager:this.h.w(),redirectEventId:this.ga||null};return this.metadata&&z(a,this.metadata.w()),w(this.providerData,function(b){a.providerData.push(lf(b))}),z(a,this.S.w()),a},__name(qn,"qn"),__name(rn,"rn"),__name(sn,"sn"),__name(tn,"tn");var nn={name:"redirectUser",F:"session"};function on(a){return Zk(a.b,nn,a.a)}function un(a,b){return a.b.get(nn,a.a).then(function(c){return c&&b&&(c.authDomain=b),qn(c||{})})}function vn(a){this.a=a,this.b=Vk(),this.c=null,this.f=wn(this),this.b.addListener(xn("local"),this.a,q(this.g,this))}function zn(a,b){var d,c=[];for(d in Rk)Rk[d]!==b&&c.push(Zk(a.b,xn(Rk[d]),a.a));return c.push(Zk(a.b,An,a.a)),Ic(c)}function wn(a){var b=xn("local"),c=xn("session"),d=xn("none");return Yk(a.b,b,a.a).then(function(){return a.b.get(c,a.a)}).then(function(e){return e?c:a.b.get(d,a.a).then(function(f){return f?d:a.b.get(b,a.a).then(function(g){return g?b:a.b.get(An,a.a).then(function(h){return h?xn(h):b})})})}).then(function(e){return a.c=e,zn(a,e.F)}).o(function(){a.c||(a.c=b)})}__name(on,"on"),__name(un,"un"),__name(vn,"vn"),vn.prototype.g=function(){var a=this,b=xn("local");yn(this,function(){return E().then(function(){return a.c&&"local"!=a.c.F?a.b.get(b,a.a):null}).then(function(c){if(c)return zn(a,"local").then(function(){a.c=b})})})},__name(zn,"zn"),__name(wn,"wn");var An={name:"persistence",F:"session"};function xn(a){return{name:"authUser",F:a}}function Bn(a){return yn(a,function(){return a.b.set(An,a.c.F,a.a)})}function Cn(a,b){return yn(a,function(){return a.b.set(a.c,b.w(),a.a)})}function Dn(a){return yn(a,function(){return Zk(a.b,a.c,a.a)})}function En(a,b,c){return yn(a,function(){return a.b.get(a.c,a.a).then(function(d){return d&&b&&(d.authDomain=b),d&&c&&(d.emulatorConfig=c),qn(d||{})})})}function yn(a,b){return a.f=a.f.then(b,b),a.f}function Fn(a){if(this.l=!1,M(this,"settings",new em),M(this,"app",a),!S(this).options||!S(this).options.apiKey)throw new t("invalid-api-key");a=firebase.SDK_VERSION?Oe(firebase.SDK_VERSION):null,this.a=new Ii(S(this).options&&S(this).options.apiKey,Ca(Da),a),this.P=[],this.s=[],this.N=[],this.Pa=firebase.INTERNAL.createSubscribe(q(this.zc,this)),this.W=void 0,this.ib=firebase.INTERNAL.createSubscribe(q(this.Ac,this)),Gn(this,null),this.i=new vn(S(this).options.apiKey+":"+S(this).name),this.D=new tn(S(this).options.apiKey+":"+S(this).name),this.$=T(this,Hn(this)),this.h=T(this,In(this)),this.ba=!1,this.ja=q(this.Zc,this),this.Ba=q(this.da,this),this.qa=q(this.mc,this),this.za=q(this.wc,this),this.Aa=q(this.xc,this),this.b=null,Jn(this),this.INTERNAL={},this.INTERNAL.delete=q(this.delete,this),this.INTERNAL.logFramework=q(this.Gc,this),this.u=0,H.call(this),Kn(this),this.J=[],this.R=null}function Ln(a){G.call(this,"languageCodeChanged"),this.h=a}function Mn(a){G.call(this,"emulatorConfigChanged"),this.c=a}function Nn(a){G.call(this,"frameworkChanged"),this.f=a}function On(a){"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),l.document&&!a&&Ee().then(function(){var b=l.document.createElement("div");b.innerText="Running in emulator mode. Do not use with production credentials.",b.style.position="fixed",b.style.width="100%",b.style.backgroundColor="#ffffff",b.style.border=".1em solid #000000",b.style.color="#b50000",b.style.bottom="0px",b.style.left="0px",b.style.margin="0px",b.style.zIndex=1e4,b.style.textAlign="center",b.classList.add("firebase-emulator-warning"),l.document.body.appendChild(b)})}function Kn(a){Object.defineProperty(a,"lc",{get:function(){return this.la()},set:function(b){this.xa(b)},enumerable:!1}),a.aa=null,Object.defineProperty(a,"ti",{get:function(){return this.T()},set:function(b){this.zb(b)},enumerable:!1}),a.S=null,Object.defineProperty(a,"emulatorConfig",{get:function(){if(this.R){var b=J(this.R.url);b=kf({protocol:b.c,host:b.a,port:b.g,options:kf({disableWarnings:this.R.ec})})}else b=null;return b},enumerable:!1})}function Pn(a){return a.Oa||F(new t("auth-domain-config-required"))}function Jn(a){var b=S(a).options.authDomain,c=S(a).options.apiKey;b&&Re()&&(a.Oa=a.$.then(function(){if(!a.l){if(a.b=Xl(b,c,S(a).name,a.R),Pl(a.b,a),U(a)&&Wm(U(a)),a.m){Wm(a.m);var d=a.m;d.xa(a.la()),Om(d,a),Nm(d=a.m,a.J),Qm(d,a),Mm(d=a.m,a.R),Pm(d,a),a.m=null}return a.b}}))}function Rn(a){if(!Re())return F(new t("operation-not-supported-in-this-environment"));var b=Pn(a).then(function(){return a.b.ra()}).then(function(c){return c?kf(c):null});return T(a,b)}function Tn(a,b){var c={};return c.apiKey=S(a).options.apiKey,c.authDomain=S(a).options.authDomain,c.appName=S(a).name,a.R&&(c.emulatorConfig=a.R),a.$.then(function(){return rn(c,b,a.D,a.Ga())}).then(function(d){return U(a)&&d.uid==U(a).uid?(cn(U(a),d),a.da(d)):(Gn(a,d),Wm(d),a.da(d))}).then(function(){Sn(a)})}function Gn(a,b){U(a)&&(Um(U(a),a.Ba),xd(U(a),"tokenChanged",a.qa),xd(U(a),"userDeleted",a.za),xd(U(a),"userInvalidated",a.Aa),Tm(U(a))),b&&(b.W.push(a.Ba),nd(b,"tokenChanged",a.qa),nd(b,"userDeleted",a.za),nd(b,"userInvalidated",a.Aa),0<a.u&&Sm(b)),M(a,"currentUser",b),b&&(b.xa(a.la()),Om(b,a),Nm(b,a.J),Qm(b,a),Mm(b,a.R),Pm(b,a))}function Un(a){var b=un(a.D,S(a).options.authDomain).then(function(c){return(a.m=c)&&(c.ha=a.D),on(a.D)});return T(a,b)}function Hn(a){var b=S(a).options.authDomain,c=Un(a).then(function(){return En(a.i,b,a.R)}).then(function(d){return d?(d.ha=a.D,a.m&&(a.m.ga||null)==(d.ga||null)?d:d.reload().then(function(){return Cn(a.i,d).then(function(){return d})}).o(function(e){return"auth/network-request-failed"==e.code?d:Dn(a.i)})):null}).then(function(d){Gn(a,d||null)});return T(a,c)}function In(a){return a.$.then(function(){return Rn(a)}).o(function(){}).then(function(){if(!a.l)return a.ja()}).o(function(){}).then(function(){if(!a.l){a.ba=!0;var b=a.i;b.b.addListener(xn("local"),b.a,a.ja)}})}function Qn(a,b){var c=null,d=null;return T(a,b.then(function(e){return c=qh(e),d=og(e),Tn(a,e)},function(e){var f=null;throw e&&"auth/multi-factor-auth-required"===e.code&&(f=mm(e.w(),a,q(a.kc,a))),f||e}).then(function(){return kf({user:U(a),credential:c,additionalUserInfo:d,operationType:"signIn"})}))}function S(a){return a.app}function U(a){return a.currentUser}function Wn(a){return U(a)&&U(a)._lat||null}function Sn(a){if(a.ba){for(var b=0;b<a.s.length;b++)a.s[b]&&a.s[b](Wn(a));if(a.W!==a.getUid()&&a.N.length)for(a.W=a.getUid(),b=0;b<a.N.length;b++)a.N[b]&&a.N[b](Wn(a))}}function Vn(a,b){a.N.push(b),T(a,a.h.then(function(){!a.l&&Va(a.N,b)&&a.W!==a.getUid()&&(a.W=a.getUid(),b(Wn(a)))}))}function T(a,b){return a.P.push(b),b.oa(function(){Wa(a.P,b)}),b}function Xn(){}function Yn(){this.a={},this.b=1e12}__name(xn,"xn"),vn.prototype.yb=function(a){var b=null,c=this;return Sk(a),yn(this,function(){return a!=c.c.F?c.b.get(c.c,c.a).then(function(d){return b=d,zn(c,a)}).then(function(){if(c.c=xn(a),b)return c.b.set(c.c,b,c.a)}):E()})},__name(Bn,"Bn"),__name(Cn,"Cn"),__name(Dn,"Dn"),__name(En,"En"),__name(yn,"yn"),__name(Fn,"Fn"),r(Fn,H),__name(Ln,"Ln"),r(Ln,G),__name(Mn,"Mn"),r(Mn,G),__name(Nn,"Nn"),r(Nn,G),(k=Fn.prototype).yb=function(a){return T(this,a=this.i.yb(a))},k.xa=function(a){this.aa===a||this.l||(this.aa=a,Oi(this.a,this.aa),this.dispatchEvent(new Ln(this.la())))},k.la=function(){return this.aa},k.fd=function(){var a=l.navigator;this.xa(a&&(a.languages&&a.languages[0]||a.language||a.userLanguage)||null)},k.gd=function(a,b){if(!this.R){if(!/^https?:\/\//.test(a))throw new t("argument-error","Emulator URL must start with a valid scheme (http:// or https://).");On(b=!!b&&!!b.disableWarnings),this.R={url:a,ec:b},this.settings.jb=!0,Pi(this.a,this.R),this.dispatchEvent(new Mn(this.R))}},__name(On,"On"),k.Gc=function(a){this.J.push(a),Ri(this.a,firebase.SDK_VERSION?Oe(firebase.SDK_VERSION,this.J):null),this.dispatchEvent(new Nn(this.J))},k.Ga=function(){return Za(this.J)},k.zb=function(a){this.S===a||this.l||(this.S=a,this.a.b=this.S)},k.T=function(){return this.S},__name(Kn,"Kn"),k.toJSON=function(){return{apiKey:S(this).options.apiKey,authDomain:S(this).options.authDomain,appName:S(this).name,currentUser:U(this)&&U(this).w()}},__name(Pn,"Pn"),__name(Jn,"Jn"),k.Gb=function(a,b){switch(a){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==b&&!!this.f;default:return!1}},k.na=function(a,b,c,d){"signInViaPopup"==a&&this.g==d&&(c&&this.C?this.C(c):b&&!c&&this.f&&this.f(b),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.C)},k.Fa=function(a,b){return"signInViaRedirect"==a||"signInViaPopup"==a&&this.g==b&&this.f?q(this.ic,this):null},k.ic=function(a,b,c,d){var e=this,f={requestUri:a,postBody:d,sessionId:b,tenantId:c};return this.c&&(this.c.cancel(),this.c=null),e.$.then(function(){return Qn(e,Fg(e.a,f))})},k.Xc=function(a){if(!Re())return F(new t("operation-not-supported-in-this-environment"));var b=this,c=ng(a.providerId),d=Qe(),e=null;(!Te()||Ie())&&S(this).options.authDomain&&a.isOAuthProvider&&(e=ek(S(this).options.authDomain,S(this).options.apiKey,S(this).name,"signInViaPopup",a,null,d,firebase.SDK_VERSION||null,null,null,this.T(),this.R));var f=ze(e,c&&c.va,c&&c.ua);return T(this,c=Pn(this).then(function(g){return Tl(g,f,"signInViaPopup",a,d,!!e,b.T())}).then(function(){return new D(function(g,h){b.na("signInViaPopup",null,new t("cancelled-popup-request"),b.g),b.f=g,b.C=h,b.g=d,b.c=Vl(b.b,b,"signInViaPopup",f,d)})}).then(function(g){return f&&ye(f),g?kf(g):null}).o(function(g){throw f&&ye(f),g}))},k.Yc=function(a){if(!Re())return F(new t("operation-not-supported-in-this-environment"));var b=this;return T(this,Pn(this).then(function(){return Bn(b.i)}).then(function(){return Ul(b.b,"signInViaRedirect",a,void 0,b.T())}))},__name(Rn,"Rn"),k.ra=function(){var a=this;return Rn(this).then(function(b){return a.b&&$l(a.b.b),b}).o(function(b){throw a.b&&$l(a.b.b),b})},k.dd=function(a){if(!a)return F(new t("null-user"));if(this.S!=a.tenantId)return F(new t("tenant-id-mismatch"));var b=this,c={};c.apiKey=S(this).options.apiKey,c.authDomain=S(this).options.authDomain,c.appName=S(this).name;var d=sn(a,c,b.D,b.Ga());return T(this,this.h.then(function(){if(S(b).options.apiKey!=a.l)return d.reload()}).then(function(){return U(b)&&a.uid==U(b).uid?(cn(U(b),a),b.da(a)):(Gn(b,d),Wm(d),b.da(d))}).then(function(){Sn(b)}))},__name(Tn,"Tn"),__name(Gn,"Gn"),k.Bb=function(){var a=this;return T(this,this.h.then(function(){return a.b&&$l(a.b.b),U(a)?(Gn(a,null),Dn(a.i).then(function(){Sn(a)})):E()}))},__name(Un,"Un"),__name(Hn,"Hn"),__name(In,"In"),k.Zc=function(){var a=this;return En(this.i,S(this).options.authDomain).then(function(b){if(!a.l){var c;if(c=U(a)&&b){c=U(a).uid;var d=b.uid;c=null!=c&&""!==c&&null!=d&&""!==d&&c==d}if(c)return cn(U(a),b),U(a).I();(U(a)||b)&&(Gn(a,b),b&&(Wm(b),b.ha=a.D),a.b&&Pl(a.b,a),Sn(a))}})},k.da=function(a){return Cn(this.i,a)},k.mc=function(){Sn(this),this.da(U(this))},k.wc=function(){this.Bb()},k.xc=function(){this.Bb()},__name(Qn,"Qn"),k.kc=function(a){var b=this;return this.h.then(function(){return Qn(b,E(a))})},k.zc=function(a){var b=this;this.addAuthTokenListener(function(){a.next(U(b))})},k.Ac=function(a){var b=this;Vn(this,function(){a.next(U(b))})},k.Ic=function(a,b,c){var d=this;return this.ba&&Promise.resolve().then(function(){"function"==typeof a?a(U(d)):"function"==typeof a.next&&a.next(U(d))}),this.Pa(a,b,c)},k.Hc=function(a,b,c){var d=this;return this.ba&&Promise.resolve().then(function(){d.W=d.getUid(),"function"==typeof a?a(U(d)):"function"==typeof a.next&&a.next(U(d))}),this.ib(a,b,c)},k.nc=function(a){var b=this;return T(this,this.h.then(function(){return U(b)?U(b).I(a).then(function(d){return{accessToken:d}}):null}))},k.Tc=function(a){var b=this;return this.h.then(function(){return Qn(b,O(b.a,Kj,{token:a}))}).then(function(c){var d=c.user;return bn(d,"isAnonymous",!1),b.da(d),c})},k.Uc=function(a,b){var c=this;return this.h.then(function(){return Qn(c,O(c.a,ah,{email:a,password:b}))})},k.dc=function(a,b){var c=this;return this.h.then(function(){return Qn(c,O(c.a,Ej,{email:a,password:b}))})},k.ab=function(a){var b=this;return this.h.then(function(){return Qn(b,a.ka(b.a))})},k.Sc=function(a){return gf("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.ab(a)},k.Ab=function(){var a=this;return this.h.then(function(){var b=U(a);if(b&&b.isAnonymous){var c=kf({providerId:null,isNewUser:!1});return kf({user:b,credential:null,additionalUserInfo:c,operationType:"signIn"})}return Qn(a,a.a.Ab()).then(function(d){var e=d.user;return bn(e,"isAnonymous",!0),a.da(e),d})})},__name(S,"S"),__name(U,"U"),k.getUid=function(){return U(this)&&U(this).uid||null},__name(Wn,"Wn"),__name(Sn,"Sn"),k.cc=function(a){this.addAuthTokenListener(a),this.u++,0<this.u&&U(this)&&Sm(U(this))},k.Pc=function(a){var b=this;w(this.s,function(c){c==a&&b.u--}),0>this.u&&(this.u=0),0==this.u&&U(this)&&Tm(U(this)),this.removeAuthTokenListener(a)},k.addAuthTokenListener=function(a){var b=this;this.s.push(a),T(this,this.h.then(function(){b.l||Va(b.s,a)&&a(Wn(b))}))},k.removeAuthTokenListener=function(a){Xa(this.s,function(b){return b==a})},__name(Vn,"Vn"),k.delete=function(){this.l=!0;for(var a=0;a<this.P.length;a++)this.P[a].cancel("app-deleted");return this.P=[],this.i&&(a=this.i).b.removeListener(xn("local"),a.a,this.ja),this.b&&(Ql(this.b,this),$l(this.b.b)),Promise.resolve()},__name(T,"T"),k.hc=function(a){return T(this,aj(this.a,a))},k.Bc=function(a){return!!fh(a)},k.xb=function(a,b){var c=this;return T(this,E().then(function(){var d=new Sf(b);if(!d.c)throw new t("argument-error",$f+" must be true when sending sign in link to email");return bg(d)}).then(function(d){return c.a.xb(a,d)}).then(function(){}))},k.jd=function(a){return this.Sa(a).then(function(b){return b.data.email})},k.ob=function(a,b){return T(this,this.a.ob(a,b).then(function(){}))},k.Sa=function(a){return T(this,this.a.Sa(a).then(function(b){return new vf(b)}))},k.kb=function(a){return T(this,this.a.kb(a).then(function(){}))},k.wb=function(a,b){var c=this;return T(this,E().then(function(){return void 0===b||mb(b)?{}:bg(new Sf(b))}).then(function(d){return c.a.wb(a,d)}).then(function(){}))},k.Wc=function(a,b){return T(this,gm(this,a,b,q(this.ab,this)))},k.Vc=function(a,b){var c=this;return T(this,E().then(function(){var d=b||re(),e=eh(a,d);if(!(d=fh(d)))throw new t("argument-error","Invalid email link!");if(d.tenantId!==c.T())throw new t("tenant-id-mismatch");return c.ab(e)}))},__name(Xn,"Xn"),Xn.prototype.render=function(){},Xn.prototype.reset=function(){},Xn.prototype.getResponse=function(){},Xn.prototype.execute=function(){},__name(Yn,"Yn");var Zn=null;function ao(a,b){return(b=bo(b))&&a.a[b]||null}function bo(a){return(a=void 0===a?1e12:a)?a.toString():null}function $n(a,b){this.g=!1,this.c=b,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=kc(a);var c=this;this.i=function(){c.execute()},this.h?this.execute():nd(this.f,"click",this.i)}function co(a){if(a.g)throw Error("reCAPTCHA mock was already deleted!")}function eo(){}function fo(){}Yn.prototype.render=function(a,b){return this.a[this.b.toString()]=new $n(a,b),this.b++},Yn.prototype.reset=function(a){var b=ao(this,a);a=bo(a),b&&a&&(b.delete(),delete this.a[a])},Yn.prototype.getResponse=function(a){return(a=ao(this,a))?a.getResponse():null},Yn.prototype.execute=function(a){(a=ao(this,a))&&a.execute()},__name(ao,"ao"),__name(bo,"bo"),__name($n,"$n"),$n.prototype.getResponse=function(){return co(this),this.b},$n.prototype.execute=function(){co(this);var a=this;this.a||(this.a=setTimeout(function(){a.b=Me();var b=a.c.callback,c=a.c["expired-callback"];if(b)try{b(a.b)}catch(d){}a.a=setTimeout(function(){if(a.a=null,a.b=null,c)try{c()}catch(d){}a.h&&a.execute()},6e4)},500))},$n.prototype.delete=function(){co(this),this.g=!0,clearTimeout(this.a),this.a=null,xd(this.f,"click",this.i)},__name(co,"co"),__name(eo,"eo"),M(eo,"FACTOR_ID","phone"),__name(fo,"fo"),fo.prototype.g=function(){return Zn||(Zn=new Yn),E(Zn)},fo.prototype.c=function(){};var go=null;function ho(){this.b=l.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}__name(ho,"ho");var io=new qb(rb,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),jo=new Ze(3e4,6e4);ho.prototype.g=function(a){var b=this;return new D(function(c,d){var e=setTimeout(function(){d(new t("network-request-failed"))},jo.get());!l.grecaptcha||a!==b.f&&!b.b?(l[b.a]=function(){if(l.grecaptcha){b.f=a;var g=l.grecaptcha.render;l.grecaptcha.render=function(h,m){return h=g(h,m),b.b++,h},clearTimeout(e),c(l.grecaptcha)}else clearTimeout(e),d(new t("internal-error"));delete l[b.a]},E(Bi(zb(io,{onload:b.a,hl:a||""}))).o(function(){clearTimeout(e),d(new t("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(e),c(l.grecaptcha))})},ho.prototype.c=function(){this.b--};var ko=null;function lo(a,b,c,d,e,f,g){if(M(this,"type","recaptcha"),this.c=this.f=null,this.J=!1,this.v=b,this.g=null,g?(go||(go=new fo),g=go):(ko||(ko=new ho),g=ko),this.m=g,this.a=c||{theme:"light",type:"image"},this.h=[],this.a[mo])throw new t("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[no],!l.document)throw new t("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!kc(b)||!this.i&&kc(b).hasChildNodes())throw new t("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.s=new Ii(a,f||null,e||null),this.u=d||function(){return null};var h=this;this.l=[];var m=this.a[oo];this.a[oo]=function(v){if(po(h,v),"function"==typeof m)m(v);else if("string"==typeof m){var B=L(m,l);"function"==typeof B&&B(v)}};var p=this.a[qo];this.a[qo]=function(){if(po(h,null),"function"==typeof p)p();else if("string"==typeof p){var v=L(p,l);"function"==typeof v&&v()}}}__name(lo,"lo");var oo="callback",qo="expired-callback",mo="sitekey",no="size";function po(a,b){for(var c=0;c<a.l.length;c++)try{a.l[c](b)}catch(d){}}function ro(a,b){Xa(a.l,function(c){return c==b})}function so(a,b){return a.h.push(b),b.oa(function(){Wa(a.h,b)}),b}function to(a){if(a.J)throw new t("internal-error","RecaptchaVerifier instance has been destroyed.")}function uo(a,b,c){var d=!1;try{this.b=c||firebase.app()}catch(g){throw new t("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new t("invalid-api-key");c=this.b.options.apiKey;var e=this,f=null;try{f=this.b.auth().Ga()}catch(g){}try{d=this.b.auth().settings.appVerificationDisabledForTesting}catch(g){}f=firebase.SDK_VERSION?Oe(firebase.SDK_VERSION,f):null,lo.call(this,c,a,b,function(){try{var g=e.b.auth().la()}catch(h){g=null}return g},f,Ca(Da),d)}function vo(a,b,c,d){a:{c=Array.prototype.slice.call(c);for(var e=0,f=!1,g=0;g<b.length;g++)if(b[g].optional)f=!0;else{if(f)throw new t("internal-error","Argument validator encountered a required argument after an optional argument.");e++}if(f=b.length,c.length<e||f<c.length)d="Expected "+(e==f?1==e?"1 argument":e+" arguments":e+"-"+f+" arguments")+" but got "+c.length+".";else{for(e=0;e<c.length;e++)if(f=b[e].optional&&void 0===c[e],!b[e].M(c[e])&&!f){if(b=b[e],0>e||e>=wo.length)throw new t("internal-error","Argument validator received an unsupported number of arguments.");c=wo[e],d=(d?"":c+" argument ")+(b.name?'"'+b.name+'" ':"")+"must be "+b.K+".";break a}d=null}}if(d)throw new t("argument-error",a+" failed: "+d)}__name(po,"po"),__name(ro,"ro"),__name(so,"so"),(k=lo.prototype).Ia=function(){var a=this;return this.f?this.f:this.f=so(this,E().then(function(){if(Se()&&!Je())return Ee();throw new t("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return a.m.g(a.u())}).then(function(b){return a.g=b,O(a.s,Jj,{})}).then(function(b){a.a[mo]=b.recaptchaSiteKey}).o(function(b){throw a.f=null,b}))},k.render=function(){to(this);var a=this;return so(this,this.Ia().then(function(){if(null===a.c){var b=a.v;if(!a.i){var c=kc(b);b=nc("DIV"),c.appendChild(b)}a.c=a.g.render(b,a.a)}return a.c}))},k.verify=function(){to(this);var a=this;return so(this,this.render().then(function(b){return new D(function(c){var d=a.g.getResponse(b);if(d)c(d);else{var e=__name(function(f){f&&(ro(a,e),c(f))},"e");a.l.push(e),a.i&&a.g.execute(a.c)}})}))},k.reset=function(){to(this),null!==this.c&&this.g.reset(this.c)},__name(to,"to"),k.clear=function(){to(this),this.J=!0,this.m.c();for(var a=0;a<this.h.length;a++)this.h[a].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){a=kc(this.v);for(var b;b=a.firstChild;)a.removeChild(b)}},__name(uo,"uo"),r(uo,lo),__name(vo,"vo");var wo="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function V(a,b){return{name:a||"",K:"a valid string",optional:!!b,M:function(c){return"string"==typeof c}}}function xo(a,b){return{name:a||"",K:"a boolean",optional:!!b,M:function(c){return"boolean"==typeof c}}}function W(a,b){return{name:a||"",K:"a valid object",optional:!!b,M:n}}function yo(a,b){return{name:a||"",K:"a function",optional:!!b,M:function(c){return"function"==typeof c}}}function zo(a,b){return{name:a||"",K:"null",optional:!!b,M:function(c){return null===c}}}function Ao(){return{name:"",K:"an HTML element",optional:!1,M:function(a){return!!(a&&a instanceof Element)}}}function Bo(){return{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(a){return!!(a&&a instanceof Fn)}}}function Co(){return{name:"app",K:"an instance of Firebase App",optional:!0,M:function(a){return!!(a&&a instanceof firebase.app.App)}}}function Do(a){return{name:a?a+"Credential":"credential",K:a?"a valid "+a+" credential":"a valid credential",optional:!1,M:function(b){if(!b)return!1;var c=!a||b.providerId===a;return!(!b.ka||!c)}}}function Eo(){return{name:"multiFactorAssertion",K:"a valid multiFactorAssertion",optional:!1,M:function(a){return!!a&&!!a.tb}}}function Fo(){return{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(a){return!!(a&&a.providerId&&a.hasOwnProperty&&a.hasOwnProperty("isOAuthProvider"))}}}function Go(a,b){return n(a)&&"string"==typeof a.type&&a.type===b&&"function"==typeof a.Ha}function Ho(a){return n(a)&&"string"==typeof a.uid}function Io(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(a){return!(!a||"string"!=typeof a.type||"function"!=typeof a.verify)}}}function X(a,b,c,d){return{name:c||"",K:a.K+" or "+b.K,optional:!!d,M:function(e){return a.M(e)||b.M(e)}}}function Y(a,b){for(var c in b){var d=b[c].name;a[d]=Jo(d,a[c],b[c].j)}}function Ko(a,b){for(var c in b){var d=b[c].name;d!==c&&Object.defineProperty(a,d,{get:ua(function(e){return this[e]},c),set:ua(function(e,f,g,h){vo(e,[g],[h],!0),this[f]=h},d,c,b[c].lb),enumerable:!0})}}function Z(a,b,c,d){a[b]=Jo(b,c,d)}function Jo(a,b,c){function d(){var g=Array.prototype.slice.call(arguments);return vo(e,c,g),b.apply(this,g)}if(__name(d,"d"),!c)return b;var f,e=Lo(a);for(f in b)d[f]=b[f];for(f in b.prototype)d.prototype[f]=b.prototype[f];return d}function Lo(a){return(a=a.split("."))[a.length-1]}__name(V,"V"),__name(xo,"xo"),__name(W,"W"),__name(yo,"yo"),__name(zo,"zo"),__name(Ao,"Ao"),__name(Bo,"Bo"),__name(Co,"Co"),__name(Do,"Do"),__name(Eo,"Eo"),__name(Fo,"Fo"),__name(Go,"Go"),__name(Ho,"Ho"),__name(Io,"Io"),__name(X,"X"),__name(Y,"Y"),__name(Ko,"Ko"),__name(Z,"Z"),__name(Jo,"Jo"),__name(Lo,"Lo"),Y(Fn.prototype,{kb:{name:"applyActionCode",j:[V("code")]},Sa:{name:"checkActionCode",j:[V("code")]},ob:{name:"confirmPasswordReset",j:[V("code"),V("newPassword")]},dc:{name:"createUserWithEmailAndPassword",j:[V("email"),V("password")]},hc:{name:"fetchSignInMethodsForEmail",j:[V("email")]},ra:{name:"getRedirectResult",j:[]},Bc:{name:"isSignInWithEmailLink",j:[V("emailLink")]},Hc:{name:"onAuthStateChanged",j:[X(W(),yo(),"nextOrObserver"),yo("opt_error",!0),yo("opt_completed",!0)]},Ic:{name:"onIdTokenChanged",j:[X(W(),yo(),"nextOrObserver"),yo("opt_error",!0),yo("opt_completed",!0)]},wb:{name:"sendPasswordResetEmail",j:[V("email"),X(W("opt_actionCodeSettings",!0),zo(null,!0),"opt_actionCodeSettings",!0)]},xb:{name:"sendSignInLinkToEmail",j:[V("email"),W("actionCodeSettings")]},yb:{name:"setPersistence",j:[V("persistence")]},Sc:{name:"signInAndRetrieveDataWithCredential",j:[Do()]},Ab:{name:"signInAnonymously",j:[]},ab:{name:"signInWithCredential",j:[Do()]},Tc:{name:"signInWithCustomToken",j:[V("token")]},Uc:{name:"signInWithEmailAndPassword",j:[V("email"),V("password")]},Vc:{name:"signInWithEmailLink",j:[V("email"),V("emailLink",!0)]},Wc:{name:"signInWithPhoneNumber",j:[V("phoneNumber"),{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(a){return!(!a||"string"!=typeof a.type||"function"!=typeof a.verify)}}]},Xc:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(a){return!!(a&&a.providerId&&a.hasOwnProperty&&a.hasOwnProperty("isOAuthProvider"))}}]},Yc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(a){return!!(a&&a.providerId&&a.hasOwnProperty&&a.hasOwnProperty("isOAuthProvider"))}}]},dd:{name:"updateCurrentUser",j:[X({name:"user",K:"an instance of Firebase User",optional:!1,M:function(b){return!!(b&&b instanceof Im)}},zo(),"user")]},Bb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[V(null,!0)]},fd:{name:"useDeviceLanguage",j:[]},gd:{name:"useEmulator",j:[V("url"),W("options",!0)]},jd:{name:"verifyPasswordResetCode",j:[V("code")]}}),Ko(Fn.prototype,{lc:{name:"languageCode",lb:X(V(),zo(),"languageCode")},ti:{name:"tenantId",lb:X(V(),zo(),"tenantId")}}),Fn.Persistence=Rk,Fn.Persistence.LOCAL="local",Fn.Persistence.SESSION="session",Fn.Persistence.NONE="none",Y(Im.prototype,{delete:{name:"delete",j:[]},oc:{name:"getIdTokenResult",j:[xo("opt_forceRefresh",!0)]},I:{name:"getIdToken",j:[xo("opt_forceRefresh",!0)]},Cc:{name:"linkAndRetrieveDataWithCredential",j:[Do()]},rb:{name:"linkWithCredential",j:[Do()]},Dc:{name:"linkWithPhoneNumber",j:[V("phoneNumber"),{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(a){return!(!a||"string"!=typeof a.type||"function"!=typeof a.verify)}}]},Ec:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(a){return!!(a&&a.providerId&&a.hasOwnProperty&&a.hasOwnProperty("isOAuthProvider"))}}]},Fc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(a){return!!(a&&a.providerId&&a.hasOwnProperty&&a.hasOwnProperty("isOAuthProvider"))}}]},Lc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Do()]},ub:{name:"reauthenticateWithCredential",j:[Do()]},Mc:{name:"reauthenticateWithPhoneNumber",j:[V("phoneNumber"),{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(a){return!(!a||"string"!=typeof a.type||"function"!=typeof a.verify)}}]},Nc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(a){return!!(a&&a.providerId&&a.hasOwnProperty&&a.hasOwnProperty("isOAuthProvider"))}}]},Oc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(a){return!!(a&&a.providerId&&a.hasOwnProperty&&a.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},vb:{name:"sendEmailVerification",j:[X(W("opt_actionCodeSettings",!0),zo(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[V(null,!0)]},cd:{name:"unlink",j:[V("provider")]},Cb:{name:"updateEmail",j:[V("email")]},Db:{name:"updatePassword",j:[V("password")]},ed:{name:"updatePhoneNumber",j:[Do("phone")]},Eb:{name:"updateProfile",j:[W("profile")]},Fb:{name:"verifyBeforeUpdateEmail",j:[V("email"),X(W("opt_actionCodeSettings",!0),zo(null,!0),"opt_actionCodeSettings",!0)]}}),Y(Yn.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),Y(Xn.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),Y(D.prototype,{oa:{name:"finally"},o:{name:"catch"},then:{name:"then"}}),Ko(em.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",lb:xo("appVerificationDisabledForTesting")}}),Y(fm.prototype,{confirm:{name:"confirm",j:[V("verificationCode")]}}),Z(Bg,"fromJSON",function(a){a="string"==typeof a?JSON.parse(a):a;for(var b,c=[Mg,dh,kh,Jg],d=0;d<c.length;d++)if(b=c[d](a))return b;return null},[X(V(),W(),"json")]),Z(Zg,"credential",function(a,b){return new Yg(a,b)},[V("email"),V("password")]),Y(Yg.prototype,{w:{name:"toJSON",j:[V(null,!0)]}}),Y(Qg.prototype,{Ca:{name:"addScope",j:[V("scope")]},Ka:{name:"setCustomParameters",j:[W("customOAuthParameters")]}}),Z(Qg,"credential",Rg,[X(V(),W(),"token")]),Z(Zg,"credentialWithLink",eh,[V("email"),V("emailLink")]),Y(Sg.prototype,{Ca:{name:"addScope",j:[V("scope")]},Ka:{name:"setCustomParameters",j:[W("customOAuthParameters")]}}),Z(Sg,"credential",Tg,[X(V(),W(),"token")]),Y(Ug.prototype,{Ca:{name:"addScope",j:[V("scope")]},Ka:{name:"setCustomParameters",j:[W("customOAuthParameters")]}}),Z(Ug,"credential",Vg,[X(V(),X(W(),zo()),"idToken"),X(V(),zo(),"accessToken",!0)]),Y(Wg.prototype,{Ka:{name:"setCustomParameters",j:[W("customOAuthParameters")]}}),Z(Wg,"credential",Xg,[X(V(),W(),"token"),V("secret",!0)]),Y(Pg.prototype,{Ca:{name:"addScope",j:[V("scope")]},credential:{name:"credential",j:[X(V(),X(W(),zo()),"optionsOrIdToken"),X(V(),zo(),"accessToken",!0)]},Ka:{name:"setCustomParameters",j:[W("customOAuthParameters")]}}),Y(Kg.prototype,{w:{name:"toJSON",j:[V(null,!0)]}}),Y(Eg.prototype,{w:{name:"toJSON",j:[V(null,!0)]}}),Z(lh,"credential",ph,[V("verificationId"),V("verificationCode")]),Y(lh.prototype,{gb:{name:"verifyPhoneNumber",j:[X(V(),{name:"phoneInfoOptions",K:"valid phone info options",optional:!1,M:function(c){return!!c&&(c.session&&c.phoneNumber?Go(c.session,zg)&&"string"==typeof c.phoneNumber:c.session&&c.multiFactorHint?Go(c.session,Ag)&&Ho(c.multiFactorHint):c.session&&c.multiFactorUid?Go(c.session,Ag)&&"string"==typeof c.multiFactorUid:!!c.phoneNumber&&"string"==typeof c.phoneNumber)}},"phoneInfoOptions"),{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(a){return!(!a||"string"!=typeof a.type||"function"!=typeof a.verify)}}]}}),Y(gh.prototype,{w:{name:"toJSON",j:[V(null,!0)]}}),Y(t.prototype,{toJSON:{name:"toJSON",j:[V(null,!0)]}}),Y(yh.prototype,{toJSON:{name:"toJSON",j:[V(null,!0)]}}),Y(xh.prototype,{toJSON:{name:"toJSON",j:[V(null,!0)]}}),Y(lm.prototype,{toJSON:{name:"toJSON",j:[V(null,!0)]}}),Y(im.prototype,{Rc:{name:"resolveSignIn",j:[{name:"multiFactorAssertion",K:"a valid multiFactorAssertion",optional:!1,M:function(a){return!!a&&!!a.tb}}]}}),Y(tm.prototype,{Sb:{name:"getSession",j:[]},fc:{name:"enroll",j:[{name:"multiFactorAssertion",K:"a valid multiFactorAssertion",optional:!1,M:function(a){return!!a&&!!a.tb}},V("displayName",!0)]},bd:{name:"unenroll",j:[X({name:"multiFactorInfo",K:"a valid multiFactorInfo",optional:!1,M:Ho},V(),"multiFactorInfoIdentifier")]}}),Y(uo.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),Z(Jf,"parseLink",Rf,[V("link")]),Z(eo,"assertion",function(a){return new rm(a)},[Do("phone")]),function(){if(void 0===firebase||!firebase.INTERNAL||!firebase.INTERNAL.registerComponent)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var a={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Af,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:Cf,VERIFY_AND_CHANGE_EMAIL:Bf,VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:Fn,AuthCredential:Bg,Error:t};Z(a,"EmailAuthProvider",Zg,[]),Z(a,"FacebookAuthProvider",Qg,[]),Z(a,"GithubAuthProvider",Sg,[]),Z(a,"GoogleAuthProvider",Ug,[]),Z(a,"TwitterAuthProvider",Wg,[]),Z(a,"OAuthProvider",Pg,[V("providerId")]),Z(a,"SAMLAuthProvider",Og,[V("providerId")]),Z(a,"PhoneAuthProvider",lh,[Bo()]),Z(a,"RecaptchaVerifier",uo,[X(V(),Ao(),"recaptchaContainer"),W("recaptchaParameters",!0),Co()]),Z(a,"ActionCodeURL",Jf,[]),Z(a,"PhoneMultiFactorGenerator",eo,[]),firebase.INTERNAL.registerComponent({name:"auth",instanceFactory:function(b){return new Fn(b=b.getProvider("app").getImmediate())},multipleInstances:!1,serviceProps:a,instantiationMode:"LAZY",type:"PUBLIC",onInstanceCreated:function(b){b.getProvider("auth-internal").initialize()}}),firebase.INTERNAL.registerComponent({name:"auth-internal",instanceFactory:function(b){return{getUid:q((b=b.getProvider("auth").getImmediate()).getUid,b),getToken:q(b.nc,b),addAuthTokenListener:q(b.cc,b),removeAuthTokenListener:q(b.Pc,b)}},multipleInstances:!1,instantiationMode:"LAZY",type:"PRIVATE"}),firebase.registerVersion("@firebase/auth","0.16.8"),firebase.INTERNAL.extendNamespace({User:Im})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},71100:(__unused_webpack_module,exports2,__webpack_require__)=>{"use strict";Object.defineProperty(exports2,"__esModule",{value:!0});var tslib=__webpack_require__(64762),util=__webpack_require__(84268),Component=function(){function Component2(name,instanceFactory,type){this.name=name,this.instanceFactory=instanceFactory,this.type=type,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return __name(Component2,"Component"),Component2.prototype.setInstantiationMode=function(mode){return this.instantiationMode=mode,this},Component2.prototype.setMultipleInstances=function(multipleInstances){return this.multipleInstances=multipleInstances,this},Component2.prototype.setServiceProps=function(props){return this.serviceProps=props,this},Component2.prototype.setInstanceCreatedCallback=function(callback){return this.onInstanceCreated=callback,this},Component2}(),Provider=function(){function Provider2(name,container){this.name=name,this.container=container,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return __name(Provider2,"Provider"),Provider2.prototype.get=function(identifier){var normalizedIdentifier=this.normalizeInstanceIdentifier(identifier);if(!this.instancesDeferred.has(normalizedIdentifier)){var deferred=new util.Deferred;if(this.instancesDeferred.set(normalizedIdentifier,deferred),this.isInitialized(normalizedIdentifier)||this.shouldAutoInitialize())try{var instance=this.getOrInitializeService({instanceIdentifier:normalizedIdentifier});instance&&deferred.resolve(instance)}catch(e){}}return this.instancesDeferred.get(normalizedIdentifier).promise},Provider2.prototype.getImmediate=function(options){var _a,normalizedIdentifier=this.normalizeInstanceIdentifier(null==options?void 0:options.identifier),optional=null!==(_a=null==options?void 0:options.optional)&&void 0!==_a&&_a;if(!this.isInitialized(normalizedIdentifier)&&!this.shouldAutoInitialize()){if(optional)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:normalizedIdentifier})}catch(e){if(optional)return null;throw e}},Provider2.prototype.getComponent=function(){return this.component},Provider2.prototype.setComponent=function(component){var e_1,_a;if(component.name!==this.name)throw Error("Mismatching Component "+component.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=component,this.shouldAutoInitialize()){if(isComponentEager(component))try{this.getOrInitializeService({instanceIdentifier:"[DEFAULT]"})}catch(e){}try{for(var _b=tslib.__values(this.instancesDeferred.entries()),_c=_b.next();!_c.done;_c=_b.next()){var _d=tslib.__read(_c.value,2),instanceIdentifier=_d[0],instanceDeferred=_d[1],normalizedIdentifier=this.normalizeInstanceIdentifier(instanceIdentifier);try{var instance=this.getOrInitializeService({instanceIdentifier:normalizedIdentifier});instanceDeferred.resolve(instance)}catch(e){}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}}},Provider2.prototype.clearInstance=function(identifier){void 0===identifier&&(identifier="[DEFAULT]"),this.instancesDeferred.delete(identifier),this.instancesOptions.delete(identifier),this.instances.delete(identifier)},Provider2.prototype.delete=function(){return tslib.__awaiter(this,void 0,void 0,function(){var services;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return services=Array.from(this.instances.values()),[4,Promise.all(tslib.__spreadArray(tslib.__spreadArray([],tslib.__read(services.filter(function(service){return"INTERNAL"in service}).map(function(service){return service.INTERNAL.delete()}))),tslib.__read(services.filter(function(service){return"_delete"in service}).map(function(service){return service._delete()}))))];case 1:return _a.sent(),[2]}})})},Provider2.prototype.isComponentSet=function(){return null!=this.component},Provider2.prototype.isInitialized=function(identifier){return void 0===identifier&&(identifier="[DEFAULT]"),this.instances.has(identifier)},Provider2.prototype.getOptions=function(identifier){return void 0===identifier&&(identifier="[DEFAULT]"),this.instancesOptions.get(identifier)||{}},Provider2.prototype.initialize=function(opts){var e_2,_a;void 0===opts&&(opts={});var _b=opts.options,options=void 0===_b?{}:_b,normalizedIdentifier=this.normalizeInstanceIdentifier(opts.instanceIdentifier);if(this.isInitialized(normalizedIdentifier))throw Error(this.name+"("+normalizedIdentifier+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var instance=this.getOrInitializeService({instanceIdentifier:normalizedIdentifier,options});try{for(var _c=tslib.__values(this.instancesDeferred.entries()),_d=_c.next();!_d.done;_d=_c.next()){var _e=tslib.__read(_d.value,2),instanceIdentifier=_e[0],instanceDeferred=_e[1];normalizedIdentifier===this.normalizeInstanceIdentifier(instanceIdentifier)&&instanceDeferred.resolve(instance)}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_d&&!_d.done&&(_a=_c.return)&&_a.call(_c)}finally{if(e_2)throw e_2.error}}return instance},Provider2.prototype.onInit=function(callback,identifier){var _a,normalizedIdentifier=this.normalizeInstanceIdentifier(identifier),existingCallbacks=null!==(_a=this.onInitCallbacks.get(normalizedIdentifier))&&void 0!==_a?_a:new Set;existingCallbacks.add(callback),this.onInitCallbacks.set(normalizedIdentifier,existingCallbacks);var existingInstance=this.instances.get(normalizedIdentifier);return existingInstance&&callback(existingInstance,normalizedIdentifier),function(){existingCallbacks.delete(callback)}},Provider2.prototype.invokeOnInitCallbacks=function(instance,identifier){var e_3,_a,callbacks=this.onInitCallbacks.get(identifier);if(callbacks)try{for(var callbacks_1=tslib.__values(callbacks),callbacks_1_1=callbacks_1.next();!callbacks_1_1.done;callbacks_1_1=callbacks_1.next()){var callback=callbacks_1_1.value;try{callback(instance,identifier)}catch(_b){}}}catch(e_3_1){e_3={error:e_3_1}}finally{try{callbacks_1_1&&!callbacks_1_1.done&&(_a=callbacks_1.return)&&_a.call(callbacks_1)}finally{if(e_3)throw e_3.error}}},Provider2.prototype.getOrInitializeService=function(_a){var instanceIdentifier=_a.instanceIdentifier,_b=_a.options,options=void 0===_b?{}:_b,instance=this.instances.get(instanceIdentifier);if(!instance&&this.component&&(instance=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(instanceIdentifier),options}),this.instances.set(instanceIdentifier,instance),this.instancesOptions.set(instanceIdentifier,options),this.invokeOnInitCallbacks(instance,instanceIdentifier),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,instanceIdentifier,instance)}catch(_c){}return instance||null},Provider2.prototype.normalizeInstanceIdentifier=function(identifier){return void 0===identifier&&(identifier="[DEFAULT]"),this.component?this.component.multipleInstances?identifier:"[DEFAULT]":identifier},Provider2.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},Provider2}();function normalizeIdentifierForFactory(identifier){return"[DEFAULT]"===identifier?void 0:identifier}function isComponentEager(component){return"EAGER"===component.instantiationMode}__name(normalizeIdentifierForFactory,"normalizeIdentifierForFactory"),__name(isComponentEager,"isComponentEager");var ComponentContainer=function(){function ComponentContainer2(name){this.name=name,this.providers=new Map}return __name(ComponentContainer2,"ComponentContainer"),ComponentContainer2.prototype.addComponent=function(component){var provider=this.getProvider(component.name);if(provider.isComponentSet())throw new Error("Component "+component.name+" has already been registered with "+this.name);provider.setComponent(component)},ComponentContainer2.prototype.addOrOverwriteComponent=function(component){this.getProvider(component.name).isComponentSet()&&this.providers.delete(component.name),this.addComponent(component)},ComponentContainer2.prototype.getProvider=function(name){if(this.providers.has(name))return this.providers.get(name);var provider=new Provider(name,this);return this.providers.set(name,provider),provider},ComponentContainer2.prototype.getProviders=function(){return Array.from(this.providers.values())},ComponentContainer2}();exports2.Component=Component,exports2.ComponentContainer=ComponentContainer,exports2.Provider=Provider},56099:(module,exports2,__webpack_require__)=>{"use strict";Object.defineProperty(exports2,"__esModule",{value:!0});var component=__webpack_require__(71100),util=__webpack_require__(84268),fayeWebsocket=__webpack_require__(79679),tslib=__webpack_require__(64762),logger$1=__webpack_require__(16303),SDK_VERSION="";function setSDKVersion(version2){SDK_VERSION=version2}__name(setSDKVersion,"setSDKVersion");var id,DOMStorageWrapper=function(){function DOMStorageWrapper2(domStorage_){this.domStorage_=domStorage_,this.prefix_="firebase:"}return __name(DOMStorageWrapper2,"DOMStorageWrapper"),DOMStorageWrapper2.prototype.set=function(key,value){null==value?this.domStorage_.removeItem(this.prefixedName_(key)):this.domStorage_.setItem(this.prefixedName_(key),util.stringify(value))},DOMStorageWrapper2.prototype.get=function(key){var storedVal=this.domStorage_.getItem(this.prefixedName_(key));return null==storedVal?null:util.jsonEval(storedVal)},DOMStorageWrapper2.prototype.remove=function(key){this.domStorage_.removeItem(this.prefixedName_(key))},DOMStorageWrapper2.prototype.prefixedName_=function(name2){return this.prefix_+name2},DOMStorageWrapper2.prototype.toString=function(){return this.domStorage_.toString()},DOMStorageWrapper2}(),MemoryStorage=function(){function MemoryStorage2(){this.cache_={},this.isInMemoryStorage=!0}return __name(MemoryStorage2,"MemoryStorage"),MemoryStorage2.prototype.set=function(key,value){null==value?delete this.cache_[key]:this.cache_[key]=value},MemoryStorage2.prototype.get=function(key){return util.contains(this.cache_,key)?this.cache_[key]:null},MemoryStorage2.prototype.remove=function(key){delete this.cache_[key]},MemoryStorage2}(),createStoragefor=__name(function(domStorageName){try{if("undefined"!=typeof window&&void 0!==window[domStorageName]){var domStorage=window[domStorageName];return domStorage.setItem("firebase:sentinel","cache"),domStorage.removeItem("firebase:sentinel"),new DOMStorageWrapper(domStorage)}}catch(e){}return new MemoryStorage},"createStoragefor"),PersistentStorage=createStoragefor("localStorage"),SessionStorage=createStoragefor("sessionStorage"),logClient=new logger$1.Logger("@firebase/database"),LUIDGenerator=(id=1,function(){return id++}),sha1=__name(function(str){var utf8Bytes=util.stringToByteArray(str),sha12=new util.Sha1;sha12.update(utf8Bytes);var sha1Bytes=sha12.digest();return util.base64.encodeByteArray(sha1Bytes)},"sha1"),buildLogMessage_=__name(function(){for(var varArgs=[],_i=0;_i<arguments.length;_i++)varArgs[_i]=arguments[_i];for(var message="",i=0;i<varArgs.length;i++){var arg=varArgs[i];Array.isArray(arg)||arg&&"object"==typeof arg&&"number"==typeof arg.length?message+=buildLogMessage_.apply(null,arg):message+="object"==typeof arg?util.stringify(arg):arg,message+=" "}return message},"buildLogMessage_"),logger=null,firstLog_=!0,enableLogging$1=__name(function(logger_,persistent){util.assert(!persistent||!0===logger_||!1===logger_,"Can't turn on custom loggers persistently."),!0===logger_?(logClient.logLevel=logger$1.LogLevel.VERBOSE,logger=logClient.log.bind(logClient),persistent&&SessionStorage.set("logging_enabled",!0)):"function"==typeof logger_?logger=logger_:(logger=null,SessionStorage.remove("logging_enabled"))},"enableLogging$1"),log=__name(function(){for(var varArgs=[],_i=0;_i<arguments.length;_i++)varArgs[_i]=arguments[_i];if(!0===firstLog_&&(firstLog_=!1,null===logger&&!0===SessionStorage.get("logging_enabled")&&enableLogging$1(!0)),logger){var message=buildLogMessage_.apply(null,varArgs);logger(message)}},"log"),logWrapper=__name(function(prefix){return function(){for(var varArgs=[],_i=0;_i<arguments.length;_i++)varArgs[_i]=arguments[_i];log.apply(void 0,tslib.__spreadArray([prefix],tslib.__read(varArgs)))}},"logWrapper"),error=__name(function(){for(var varArgs=[],_i=0;_i<arguments.length;_i++)varArgs[_i]=arguments[_i];var message="FIREBASE INTERNAL ERROR: "+buildLogMessage_.apply(void 0,tslib.__spreadArray([],tslib.__read(varArgs)));logClient.error(message)},"error"),fatal=__name(function(){for(var varArgs=[],_i=0;_i<arguments.length;_i++)varArgs[_i]=arguments[_i];var message="FIREBASE FATAL ERROR: "+buildLogMessage_.apply(void 0,tslib.__spreadArray([],tslib.__read(varArgs)));throw logClient.error(message),new Error(message)},"fatal"),warn=__name(function(){for(var varArgs=[],_i=0;_i<arguments.length;_i++)varArgs[_i]=arguments[_i];var message="FIREBASE WARNING: "+buildLogMessage_.apply(void 0,tslib.__spreadArray([],tslib.__read(varArgs)));logClient.warn(message)},"warn"),warnIfPageIsSecure=__name(function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&warn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},"warnIfPageIsSecure"),isInvalidJSONNumber=__name(function(data){return"number"==typeof data&&(data!=data||data===Number.POSITIVE_INFINITY||data===Number.NEGATIVE_INFINITY)},"isInvalidJSONNumber"),executeWhenDOMReady=__name(function(fn){if(util.isNodeSdk()||"complete"===document.readyState)fn();else{var called_1=!1,wrappedFn_1=__name(function(){document.body?called_1||(called_1=!0,fn()):setTimeout(wrappedFn_1,Math.floor(10))},"wrappedFn_1");document.addEventListener?(document.addEventListener("DOMContentLoaded",wrappedFn_1,!1),window.addEventListener("load",wrappedFn_1,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&wrappedFn_1()}),window.attachEvent("onload",wrappedFn_1))}},"executeWhenDOMReady"),MIN_NAME="[MIN_NAME]",MAX_NAME="[MAX_NAME]",nameCompare=__name(function(a,b){if(a===b)return 0;if(a===MIN_NAME||b===MAX_NAME)return-1;if(b===MIN_NAME||a===MAX_NAME)return 1;var aAsInt=tryParseInt(a),bAsInt=tryParseInt(b);return null!==aAsInt?null!==bAsInt?aAsInt-bAsInt==0?a.length-b.length:aAsInt-bAsInt:-1:null!==bAsInt?1:a<b?-1:1},"nameCompare"),stringCompare=__name(function(a,b){return a===b?0:a<b?-1:1},"stringCompare"),requireKey=__name(function(key,obj){if(obj&&key in obj)return obj[key];throw new Error("Missing required key ("+key+") in object: "+util.stringify(obj))},"requireKey"),ObjectToUniqueKey=__name(function(obj){if("object"!=typeof obj||null===obj)return util.stringify(obj);var keys=[];for(var k in obj)keys.push(k);keys.sort();for(var key="{",i=0;i<keys.length;i++)0!==i&&(key+=","),key+=util.stringify(keys[i]),key+=":",key+=ObjectToUniqueKey(obj[keys[i]]);return key+="}"},"ObjectToUniqueKey"),splitStringBySize=__name(function(str,segsize){var len=str.length;if(len<=segsize)return[str];for(var dataSegs=[],c=0;c<len;c+=segsize)c+segsize>len?dataSegs.push(str.substring(c,len)):dataSegs.push(str.substring(c,c+segsize));return dataSegs},"splitStringBySize");function each(obj,fn){for(var key in obj)obj.hasOwnProperty(key)&&fn(key,obj[key])}__name(each,"each");var doubleToIEEE754String=__name(function(v){util.assert(!isInvalidJSONNumber(v),"Invalid JSON number");var s,e,f,ln,i;0===v?(e=0,f=0,s=1/v==-1/0?1:0):(s=v<0,(v=Math.abs(v))>=Math.pow(2,-1022)?(e=(ln=Math.min(Math.floor(Math.log(v)/Math.LN2),1023))+1023,f=Math.round(v*Math.pow(2,52-ln)-Math.pow(2,52))):(e=0,f=Math.round(v/Math.pow(2,-1074))));var bits=[];for(i=52;i;i-=1)bits.push(f%2?1:0),f=Math.floor(f/2);for(i=11;i;i-=1)bits.push(e%2?1:0),e=Math.floor(e/2);bits.push(s?1:0),bits.reverse();var str=bits.join(""),hexByteString="";for(i=0;i<64;i+=8){var hexByte=parseInt(str.substr(i,8),2).toString(16);1===hexByte.length&&(hexByte="0"+hexByte),hexByteString+=hexByte}return hexByteString.toLowerCase()},"doubleToIEEE754String"),isChromeExtensionContentScript=__name(function(){return!("object"!=typeof window||!window.chrome||!window.chrome.extension||/^chrome/.test(window.location.href))},"isChromeExtensionContentScript"),isWindowsStoreApp=__name(function(){return"object"==typeof Windows&&"object"==typeof Windows.UI},"isWindowsStoreApp");function errorForServerCode(code,query2){var reason="Unknown Error";"too_big"===code?reason="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===code?reason="Client doesn't have permission to access the desired data.":"unavailable"===code&&(reason="The service is unavailable");var error2=new Error(code+" at "+query2._path.toString()+": "+reason);return error2.code=code.toUpperCase(),error2}__name(errorForServerCode,"errorForServerCode");var INTEGER_REGEXP_=new RegExp("^-?(0*)\\d{1,10}$"),tryParseInt=__name(function(str){if(INTEGER_REGEXP_.test(str)){var intVal=Number(str);if(intVal>=-2147483648&&intVal<=2147483647)return intVal}return null},"tryParseInt"),exceptionGuard=__name(function(fn){try{fn()}catch(e){setTimeout(function(){var stack=e.stack||"";throw warn("Exception was thrown by user callback.",stack),e},Math.floor(0))}},"exceptionGuard"),beingCrawled=__name(function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},"beingCrawled"),setTimeoutNonBlocking=__name(function(fn,time){var timeout=setTimeout(fn,time);return"object"==typeof timeout&&timeout.unref&&timeout.unref(),timeout},"setTimeoutNonBlocking"),AppCheckTokenProvider=function(){function AppCheckTokenProvider2(appName_,appCheckProvider){var _this=this;this.appName_=appName_,this.appCheckProvider=appCheckProvider,this.appCheck=null==appCheckProvider?void 0:appCheckProvider.getImmediate({optional:!0}),this.appCheck||null==appCheckProvider||appCheckProvider.get().then(function(appCheck){return _this.appCheck=appCheck})}return __name(AppCheckTokenProvider2,"AppCheckTokenProvider"),AppCheckTokenProvider2.prototype.getToken=function(forceRefresh){var _this=this;return this.appCheck?this.appCheck.getToken(forceRefresh):new Promise(function(resolve,reject){setTimeout(function(){_this.appCheck?_this.getToken(forceRefresh).then(resolve,reject):resolve(null)},0)})},AppCheckTokenProvider2.prototype.addTokenChangeListener=function(listener){var _a;null===(_a=this.appCheckProvider)||void 0===_a||_a.get().then(function(appCheck){return appCheck.addTokenListener(listener)})},AppCheckTokenProvider2.prototype.notifyForInvalidToken=function(){warn('Provided AppCheck credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly.')},AppCheckTokenProvider2}(),FirebaseAuthTokenProvider=function(){function FirebaseAuthTokenProvider2(appName_,firebaseOptions_,authProvider_){var _this=this;this.appName_=appName_,this.firebaseOptions_=firebaseOptions_,this.authProvider_=authProvider_,this.auth_=null,this.auth_=authProvider_.getImmediate({optional:!0}),this.auth_||authProvider_.onInit(function(auth){return _this.auth_=auth})}return __name(FirebaseAuthTokenProvider2,"FirebaseAuthTokenProvider"),FirebaseAuthTokenProvider2.prototype.getToken=function(forceRefresh){var _this=this;return this.auth_?this.auth_.getToken(forceRefresh).catch(function(error2){return error2&&"auth/token-not-initialized"===error2.code?(log("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(error2)}):new Promise(function(resolve,reject){setTimeout(function(){_this.auth_?_this.getToken(forceRefresh).then(resolve,reject):resolve(null)},0)})},FirebaseAuthTokenProvider2.prototype.addTokenChangeListener=function(listener){this.auth_?this.auth_.addAuthTokenListener(listener):this.authProvider_.get().then(function(auth){return auth.addAuthTokenListener(listener)})},FirebaseAuthTokenProvider2.prototype.removeTokenChangeListener=function(listener){this.authProvider_.get().then(function(auth){return auth.removeAuthTokenListener(listener)})},FirebaseAuthTokenProvider2.prototype.notifyForInvalidToken=function(){var errorMessage='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?errorMessage+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?errorMessage+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':errorMessage+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',warn(errorMessage)},FirebaseAuthTokenProvider2}(),EmulatorTokenProvider=function(){function EmulatorTokenProvider2(accessToken){this.accessToken=accessToken}return __name(EmulatorTokenProvider2,"EmulatorTokenProvider"),EmulatorTokenProvider2.prototype.getToken=function(forceRefresh){return Promise.resolve({accessToken:this.accessToken})},EmulatorTokenProvider2.prototype.addTokenChangeListener=function(listener){listener(this.accessToken)},EmulatorTokenProvider2.prototype.removeTokenChangeListener=function(listener){},EmulatorTokenProvider2.prototype.notifyForInvalidToken=function(){},EmulatorTokenProvider2.OWNER="owner",EmulatorTokenProvider2}(),FORGE_DOMAIN_RE=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,RepoInfo=function(){function RepoInfo2(host,secure,namespace,webSocketOnly,nodeAdmin,persistenceKey,includeNamespaceInQueryParams){void 0===nodeAdmin&&(nodeAdmin=!1),void 0===persistenceKey&&(persistenceKey=""),void 0===includeNamespaceInQueryParams&&(includeNamespaceInQueryParams=!1),this.secure=secure,this.namespace=namespace,this.webSocketOnly=webSocketOnly,this.nodeAdmin=nodeAdmin,this.persistenceKey=persistenceKey,this.includeNamespaceInQueryParams=includeNamespaceInQueryParams,this._host=host.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=PersistentStorage.get("host:"+host)||this._host}return __name(RepoInfo2,"RepoInfo"),RepoInfo2.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},RepoInfo2.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty(RepoInfo2.prototype,"host",{get:function(){return this._host},set:function(newHost){newHost!==this.internalHost&&(this.internalHost=newHost,this.isCacheableHost()&&PersistentStorage.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),RepoInfo2.prototype.toString=function(){var str=this.toURLString();return this.persistenceKey&&(str+="<"+this.persistenceKey+">"),str},RepoInfo2.prototype.toURLString=function(){var protocol=this.secure?"https://":"http://",query2=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return""+protocol+this.host+"/"+query2},RepoInfo2}();function repoInfoNeedsQueryParam(repoInfo){return repoInfo.host!==repoInfo.internalHost||repoInfo.isCustomHost()||repoInfo.includeNamespaceInQueryParams}function repoInfoConnectionURL(repoInfo,type,params){var connURL;if(util.assert("string"==typeof type,"typeof type must == string"),util.assert("object"==typeof params,"typeof params must == object"),"websocket"===type)connURL=(repoInfo.secure?"wss://":"ws://")+repoInfo.internalHost+"/.ws?";else{if("long_polling"!==type)throw new Error("Unknown connection type: "+type);connURL=(repoInfo.secure?"https://":"http://")+repoInfo.internalHost+"/.lp?"}repoInfoNeedsQueryParam(repoInfo)&&(params.ns=repoInfo.namespace);var pairs=[];return each(params,function(key,value){pairs.push(key+"="+value)}),connURL+pairs.join("&")}__name(repoInfoNeedsQueryParam,"repoInfoNeedsQueryParam"),__name(repoInfoConnectionURL,"repoInfoConnectionURL");var StatsCollection=function(){function StatsCollection2(){this.counters_={}}return __name(StatsCollection2,"StatsCollection"),StatsCollection2.prototype.incrementCounter=function(name2,amount){void 0===amount&&(amount=1),util.contains(this.counters_,name2)||(this.counters_[name2]=0),this.counters_[name2]+=amount},StatsCollection2.prototype.get=function(){return util.deepCopy(this.counters_)},StatsCollection2}(),collections={},reporters={};function statsManagerGetCollection(repoInfo){var hashString=repoInfo.toString();return collections[hashString]||(collections[hashString]=new StatsCollection),collections[hashString]}function statsManagerGetOrCreateReporter(repoInfo,creatorFunction){var hashString=repoInfo.toString();return reporters[hashString]||(reporters[hashString]=creatorFunction()),reporters[hashString]}__name(statsManagerGetCollection,"statsManagerGetCollection"),__name(statsManagerGetOrCreateReporter,"statsManagerGetOrCreateReporter");var PacketReceiver=function(){function PacketReceiver2(onMessage_){this.onMessage_=onMessage_,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return __name(PacketReceiver2,"PacketReceiver"),PacketReceiver2.prototype.closeAfter=function(responseNum,callback){this.closeAfterResponse=responseNum,this.onClose=callback,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},PacketReceiver2.prototype.handleResponse=function(requestNum,data){var _this=this;this.pendingResponses[requestNum]=data;for(var _loop_1=__name(function(){var toProcess=this_1.pendingResponses[this_1.currentResponseNum];delete this_1.pendingResponses[this_1.currentResponseNum];for(var _loop_2=__name(function(i2){toProcess[i2]&&exceptionGuard(function(){_this.onMessage_(toProcess[i2])})},"_loop_2"),i=0;i<toProcess.length;++i)_loop_2(i);if(this_1.currentResponseNum===this_1.closeAfterResponse)return this_1.onClose&&(this_1.onClose(),this_1.onClose=null),"break";this_1.currentResponseNum++},"_loop_1"),this_1=this;this.pendingResponses[this.currentResponseNum];){if("break"===_loop_1())break}},PacketReceiver2}(),BrowserPollConnection=function(){function BrowserPollConnection2(connId,repoInfo,applicationId,appCheckToken,authToken,transportSessionId,lastSessionId){var _this=this;this.connId=connId,this.repoInfo=repoInfo,this.applicationId=applicationId,this.appCheckToken=appCheckToken,this.authToken=authToken,this.transportSessionId=transportSessionId,this.lastSessionId=lastSessionId,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=logWrapper(connId),this.stats_=statsManagerGetCollection(repoInfo),this.urlFn=function(params){return _this.appCheckToken&&(params.ac=_this.appCheckToken),repoInfoConnectionURL(repoInfo,"long_polling",params)}}return __name(BrowserPollConnection2,"BrowserPollConnection"),BrowserPollConnection2.prototype.open=function(onMessage,onDisconnect){var _this=this;this.curSegmentNum=0,this.onDisconnect_=onDisconnect,this.myPacketOrderer=new PacketReceiver(onMessage),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){_this.log_("Timed out trying to connect."),_this.onClosed_(),_this.connectTimeoutTimer_=null},Math.floor(3e4)),executeWhenDOMReady(function(){if(!_this.isClosed_){_this.scriptTagHolder=new FirebaseIFrameScriptHolder(function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var _a=tslib.__read(args,5),command=_a[0],arg1=_a[1],arg2=_a[2];if(_a[3],_a[4],_this.incrementIncomingBytes_(args),_this.scriptTagHolder)if(_this.connectTimeoutTimer_&&(clearTimeout(_this.connectTimeoutTimer_),_this.connectTimeoutTimer_=null),_this.everConnected_=!0,"start"===command)_this.id=arg1,_this.password=arg2;else{if("close"!==command)throw new Error("Unrecognized command received: "+command);arg1?(_this.scriptTagHolder.sendNewPolls=!1,_this.myPacketOrderer.closeAfter(arg1,function(){_this.onClosed_()})):_this.onClosed_()}},function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var _a=tslib.__read(args,2),pN=_a[0],data=_a[1];_this.incrementIncomingBytes_(args),_this.myPacketOrderer.handleResponse(pN,data)},function(){_this.onClosed_()},_this.urlFn);var urlParams={start:"t"};urlParams.ser=Math.floor(1e8*Math.random()),_this.scriptTagHolder.uniqueCallbackIdentifier&&(urlParams.cb=_this.scriptTagHolder.uniqueCallbackIdentifier),urlParams.v="5",_this.transportSessionId&&(urlParams.s=_this.transportSessionId),_this.lastSessionId&&(urlParams.ls=_this.lastSessionId),_this.applicationId&&(urlParams.p=_this.applicationId),_this.appCheckToken&&(urlParams.ac=_this.appCheckToken),"undefined"!=typeof location&&location.hostname&&FORGE_DOMAIN_RE.test(location.hostname)&&(urlParams.r="f");var connectURL=_this.urlFn(urlParams);_this.log_("Connecting via long-poll to "+connectURL),_this.scriptTagHolder.addTag(connectURL,function(){})}})},BrowserPollConnection2.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},BrowserPollConnection2.forceAllow=function(){BrowserPollConnection2.forceAllow_=!0},BrowserPollConnection2.forceDisallow=function(){BrowserPollConnection2.forceDisallow_=!0},BrowserPollConnection2.isAvailable=function(){return!util.isNodeSdk()&&(!!BrowserPollConnection2.forceAllow_||!BrowserPollConnection2.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!isChromeExtensionContentScript()&&!isWindowsStoreApp())},BrowserPollConnection2.prototype.markConnectionHealthy=function(){},BrowserPollConnection2.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},BrowserPollConnection2.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},BrowserPollConnection2.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},BrowserPollConnection2.prototype.send=function(data){var dataStr=util.stringify(data);this.bytesSent+=dataStr.length,this.stats_.incrementCounter("bytes_sent",dataStr.length);for(var base64data=util.base64Encode(dataStr),dataSegs=splitStringBySize(base64data,1840),i=0;i<dataSegs.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,dataSegs.length,dataSegs[i]),this.curSegmentNum++},BrowserPollConnection2.prototype.addDisconnectPingFrame=function(id,pw){if(!util.isNodeSdk()){this.myDisconnFrame=document.createElement("iframe");var urlParams={dframe:"t"};urlParams.id=id,urlParams.pw=pw,this.myDisconnFrame.src=this.urlFn(urlParams),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},BrowserPollConnection2.prototype.incrementIncomingBytes_=function(args){var bytesReceived=util.stringify(args).length;this.bytesReceived+=bytesReceived,this.stats_.incrementCounter("bytes_received",bytesReceived)},BrowserPollConnection2}(),FirebaseIFrameScriptHolder=function(){function FirebaseIFrameScriptHolder2(commandCB,onMessageCB,onDisconnect,urlFn){if(this.onDisconnect=onDisconnect,this.urlFn=urlFn,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,util.isNodeSdk())this.commandCB=commandCB,this.onMessageCB=onMessageCB;else{this.uniqueCallbackIdentifier=LUIDGenerator(),window["pLPCommand"+this.uniqueCallbackIdentifier]=commandCB,window["pRTLPCB"+this.uniqueCallbackIdentifier]=onMessageCB,this.myIFrame=FirebaseIFrameScriptHolder2.createIFrame_();var script="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))script='<script>document.domain="'+document.domain+'";<\/script>';var iframeContents="<html><body>"+script+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(iframeContents),this.myIFrame.doc.close()}catch(e){log("frame writing exception"),e.stack&&log(e.stack),log(e)}}}return __name(FirebaseIFrameScriptHolder2,"FirebaseIFrameScriptHolder"),FirebaseIFrameScriptHolder2.createIFrame_=function(){var iframe=document.createElement("iframe");if(iframe.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(iframe);try{iframe.contentWindow.document||log("No IE domain setting required")}catch(e){var domain=document.domain;iframe.src="javascript:void((function(){document.open();document.domain='"+domain+"';document.close();})())"}return iframe.contentDocument?iframe.doc=iframe.contentDocument:iframe.contentWindow?iframe.doc=iframe.contentWindow.document:iframe.document&&(iframe.doc=iframe.document),iframe},FirebaseIFrameScriptHolder2.prototype.close=function(){var _this=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==_this.myIFrame&&(document.body.removeChild(_this.myIFrame),_this.myIFrame=null)},Math.floor(0)));var onDisconnect=this.onDisconnect;onDisconnect&&(this.onDisconnect=null,onDisconnect())},FirebaseIFrameScriptHolder2.prototype.startLongPoll=function(id,pw){for(this.myID=id,this.myPW=pw,this.alive=!0;this.newRequest_(););},FirebaseIFrameScriptHolder2.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var urlParams={};urlParams.id=this.myID,urlParams.pw=this.myPW,urlParams.ser=this.currentSerial;for(var theURL=this.urlFn(urlParams),curDataString="",i=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+curDataString.length<=1870))break;var theSeg=this.pendingSegs.shift();curDataString=curDataString+"&seg"+i+"="+theSeg.seg+"&ts"+i+"="+theSeg.ts+"&d"+i+"="+theSeg.d,i++}return theURL+=curDataString,this.addLongPollTag_(theURL,this.currentSerial),!0}return!1},FirebaseIFrameScriptHolder2.prototype.enqueueSegment=function(segnum,totalsegs,data){this.pendingSegs.push({seg:segnum,ts:totalsegs,d:data}),this.alive&&this.newRequest_()},FirebaseIFrameScriptHolder2.prototype.addLongPollTag_=function(url,serial){var _this=this;this.outstandingRequests.add(serial);var doNewRequest=__name(function(){_this.outstandingRequests.delete(serial),_this.newRequest_()},"doNewRequest"),keepaliveTimeout=setTimeout(doNewRequest,Math.floor(25e3)),readyStateCB=__name(function(){clearTimeout(keepaliveTimeout),doNewRequest()},"readyStateCB");this.addTag(url,readyStateCB)},FirebaseIFrameScriptHolder2.prototype.addTag=function(url,loadCB){var _this=this;util.isNodeSdk()?this.doNodeLongPoll(url,loadCB):setTimeout(function(){try{if(!_this.sendNewPolls)return;var newScript_1=_this.myIFrame.doc.createElement("script");newScript_1.type="text/javascript",newScript_1.async=!0,newScript_1.src=url,newScript_1.onload=newScript_1.onreadystatechange=function(){var rstate=newScript_1.readyState;(!rstate||"loaded"===rstate||"complete"===rstate)&&(newScript_1.onload=newScript_1.onreadystatechange=null,newScript_1.parentNode&&newScript_1.parentNode.removeChild(newScript_1),loadCB())},newScript_1.onerror=function(){log("Long-poll script failed to load: "+url),_this.sendNewPolls=!1,_this.close()},_this.myIFrame.doc.body.appendChild(newScript_1)}catch(e){}},Math.floor(1))},FirebaseIFrameScriptHolder2}(),WebSocketImpl=null;function setWebSocketImpl(impl){WebSocketImpl=impl}"undefined"!=typeof MozWebSocket?WebSocketImpl=MozWebSocket:"undefined"!=typeof WebSocket&&(WebSocketImpl=WebSocket),__name(setWebSocketImpl,"setWebSocketImpl");var WebSocketConnection=function(){function WebSocketConnection2(connId,repoInfo,applicationId,appCheckToken,authToken,transportSessionId,lastSessionId){this.connId=connId,this.applicationId=applicationId,this.appCheckToken=appCheckToken,this.authToken=authToken,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=logWrapper(this.connId),this.stats_=statsManagerGetCollection(repoInfo),this.connURL=WebSocketConnection2.connectionURL_(repoInfo,transportSessionId,lastSessionId,appCheckToken),this.nodeAdmin=repoInfo.nodeAdmin}return __name(WebSocketConnection2,"WebSocketConnection"),WebSocketConnection2.connectionURL_=function(repoInfo,transportSessionId,lastSessionId,appCheckToken){var urlParams={v:"5"};return!util.isNodeSdk()&&"undefined"!=typeof location&&location.hostname&&FORGE_DOMAIN_RE.test(location.hostname)&&(urlParams.r="f"),transportSessionId&&(urlParams.s=transportSessionId),lastSessionId&&(urlParams.ls=lastSessionId),appCheckToken&&(urlParams.ac=appCheckToken),repoInfoConnectionURL(repoInfo,"websocket",urlParams)},WebSocketConnection2.prototype.open=function(onMessage,onDisconnect){var _this=this;this.onDisconnect=onDisconnect,this.onMessage=onMessage,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,PersistentStorage.set("previous_websocket_failure",!0);try{if(util.isNodeSdk()){var device=this.nodeAdmin?"AdminNode":"Node",options={headers:{"User-Agent":"Firebase/5/"+SDK_VERSION+"/"+process.platform+"/"+device,"X-Firebase-GMPID":this.applicationId||""}};this.authToken&&(options.headers.Authorization="Bearer "+this.authToken),this.appCheckToken&&(options.headers["X-Firebase-AppCheck"]=this.appCheckToken);var env=process.env,proxy=0===this.connURL.indexOf("wss://")?env.HTTPS_PROXY||env.https_proxy:env.HTTP_PROXY||env.http_proxy;proxy&&(options.proxy={origin:proxy}),this.mySock=new WebSocketImpl(this.connURL,[],options)}else{options={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new WebSocketImpl(this.connURL,[],options)}}catch(e){this.log_("Error instantiating WebSocket.");var error2=e.message||e.data;return error2&&this.log_(error2),void this.onClosed_()}this.mySock.onopen=function(){_this.log_("Websocket connected."),_this.everConnected_=!0},this.mySock.onclose=function(){_this.log_("Websocket connection was disconnected."),_this.mySock=null,_this.onClosed_()},this.mySock.onmessage=function(m){_this.handleIncomingFrame(m)},this.mySock.onerror=function(e){_this.log_("WebSocket error.  Closing connection.");var error3=e.message||e.data;error3&&_this.log_(error3),_this.onClosed_()}},WebSocketConnection2.prototype.start=function(){},WebSocketConnection2.forceDisallow=function(){WebSocketConnection2.forceDisallow_=!0},WebSocketConnection2.isAvailable=function(){var isOldAndroid=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var oldAndroidMatch=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);oldAndroidMatch&&oldAndroidMatch.length>1&&parseFloat(oldAndroidMatch[1])<4.4&&(isOldAndroid=!0)}return!isOldAndroid&&null!==WebSocketImpl&&!WebSocketConnection2.forceDisallow_},WebSocketConnection2.previouslyFailed=function(){return PersistentStorage.isInMemoryStorage||!0===PersistentStorage.get("previous_websocket_failure")},WebSocketConnection2.prototype.markConnectionHealthy=function(){PersistentStorage.remove("previous_websocket_failure")},WebSocketConnection2.prototype.appendFrame_=function(data){if(this.frames.push(data),this.frames.length===this.totalFrames){var fullMess=this.frames.join("");this.frames=null;var jsonMess=util.jsonEval(fullMess);this.onMessage(jsonMess)}},WebSocketConnection2.prototype.handleNewFrameCount_=function(frameCount){this.totalFrames=frameCount,this.frames=[]},WebSocketConnection2.prototype.extractFrameCount_=function(data){if(util.assert(null===this.frames,"We already have a frame buffer"),data.length<=6){var frameCount=Number(data);if(!isNaN(frameCount))return this.handleNewFrameCount_(frameCount),null}return this.handleNewFrameCount_(1),data},WebSocketConnection2.prototype.handleIncomingFrame=function(mess){if(null!==this.mySock){var data=mess.data;if(this.bytesReceived+=data.length,this.stats_.incrementCounter("bytes_received",data.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(data);else{var remainingData=this.extractFrameCount_(data);null!==remainingData&&this.appendFrame_(remainingData)}}},WebSocketConnection2.prototype.send=function(data){this.resetKeepAlive();var dataStr=util.stringify(data);this.bytesSent+=dataStr.length,this.stats_.incrementCounter("bytes_sent",dataStr.length);var dataSegs=splitStringBySize(dataStr,16384);dataSegs.length>1&&this.sendString_(String(dataSegs.length));for(var i=0;i<dataSegs.length;i++)this.sendString_(dataSegs[i])},WebSocketConnection2.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},WebSocketConnection2.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},WebSocketConnection2.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},WebSocketConnection2.prototype.resetKeepAlive=function(){var _this=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){_this.mySock&&_this.sendString_("0"),_this.resetKeepAlive()},Math.floor(45e3))},WebSocketConnection2.prototype.sendString_=function(str){try{this.mySock.send(str)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},WebSocketConnection2.responsesRequiredToBeHealthy=2,WebSocketConnection2.healthyTimeout=3e4,WebSocketConnection2}(),TransportManager=function(){function TransportManager2(repoInfo){this.initTransports_(repoInfo)}return __name(TransportManager2,"TransportManager"),Object.defineProperty(TransportManager2,"ALL_TRANSPORTS",{get:function(){return[BrowserPollConnection,WebSocketConnection]},enumerable:!1,configurable:!0}),TransportManager2.prototype.initTransports_=function(repoInfo){var e_1,_a,isWebSocketsAvailable2=WebSocketConnection&&WebSocketConnection.isAvailable(),isSkipPollConnection=isWebSocketsAvailable2&&!WebSocketConnection.previouslyFailed();if(repoInfo.webSocketOnly&&(isWebSocketsAvailable2||warn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),isSkipPollConnection=!0),isSkipPollConnection)this.transports_=[WebSocketConnection];else{var transports=this.transports_=[];try{for(var _b=tslib.__values(TransportManager2.ALL_TRANSPORTS),_c=_b.next();!_c.done;_c=_b.next()){var transport=_c.value;transport&&transport.isAvailable()&&transports.push(transport)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}}},TransportManager2.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},TransportManager2.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},TransportManager2}(),Connection=function(){function Connection2(id,repoInfo_,applicationId_,appCheckToken_,authToken_,onMessage_,onReady_,onDisconnect_,onKill_,lastSessionId){this.id=id,this.repoInfo_=repoInfo_,this.applicationId_=applicationId_,this.appCheckToken_=appCheckToken_,this.authToken_=authToken_,this.onMessage_=onMessage_,this.onReady_=onReady_,this.onDisconnect_=onDisconnect_,this.onKill_=onKill_,this.lastSessionId=lastSessionId,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=logWrapper("c:"+this.id+":"),this.transportManager_=new TransportManager(repoInfo_),this.log_("Connection created"),this.start_()}return __name(Connection2,"Connection"),Connection2.prototype.start_=function(){var _this=this,conn=this.transportManager_.initialTransport();this.conn_=new conn(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=conn.responsesRequiredToBeHealthy||0;var onMessageReceived=this.connReceiver_(this.conn_),onConnectionLost=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){_this.conn_&&_this.conn_.open(onMessageReceived,onConnectionLost)},Math.floor(0));var healthyTimeoutMS=conn.healthyTimeout||0;healthyTimeoutMS>0&&(this.healthyTimeout_=setTimeoutNonBlocking(function(){_this.healthyTimeout_=null,_this.isHealthy_||(_this.conn_&&_this.conn_.bytesReceived>102400?(_this.log_("Connection exceeded healthy timeout but has received "+_this.conn_.bytesReceived+" bytes.  Marking connection healthy."),_this.isHealthy_=!0,_this.conn_.markConnectionHealthy()):_this.conn_&&_this.conn_.bytesSent>10240?_this.log_("Connection exceeded healthy timeout but has sent "+_this.conn_.bytesSent+" bytes.  Leaving connection alive."):(_this.log_("Closing unhealthy connection after timeout."),_this.close()))},Math.floor(healthyTimeoutMS)))},Connection2.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},Connection2.prototype.disconnReceiver_=function(conn){var _this=this;return function(everConnected){conn===_this.conn_?_this.onConnectionLost_(everConnected):conn===_this.secondaryConn_?(_this.log_("Secondary connection lost."),_this.onSecondaryConnectionLost_()):_this.log_("closing an old connection")}},Connection2.prototype.connReceiver_=function(conn){var _this=this;return function(message){2!==_this.state_&&(conn===_this.rx_?_this.onPrimaryMessageReceived_(message):conn===_this.secondaryConn_?_this.onSecondaryMessageReceived_(message):_this.log_("message on old connection"))}},Connection2.prototype.sendRequest=function(dataMsg){var msg={t:"d",d:dataMsg};this.sendData_(msg)},Connection2.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},Connection2.prototype.onSecondaryControl_=function(controlData){if("t"in controlData){var cmd=controlData.t;"a"===cmd?this.upgradeIfSecondaryHealthy_():"r"===cmd?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===cmd&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},Connection2.prototype.onSecondaryMessageReceived_=function(parsedData){var layer=requireKey("t",parsedData),data=requireKey("d",parsedData);if("c"===layer)this.onSecondaryControl_(data);else{if("d"!==layer)throw new Error("Unknown protocol layer: "+layer);this.pendingDataMessages.push(data)}},Connection2.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},Connection2.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},Connection2.prototype.onPrimaryMessageReceived_=function(parsedData){var layer=requireKey("t",parsedData),data=requireKey("d",parsedData);"c"===layer?this.onControl_(data):"d"===layer&&this.onDataMessage_(data)},Connection2.prototype.onDataMessage_=function(message){this.onPrimaryResponse_(),this.onMessage_(message)},Connection2.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},Connection2.prototype.onControl_=function(controlData){var cmd=requireKey("t",controlData);if("d"in controlData){var payload=controlData.d;if("h"===cmd)this.onHandshake_(payload);else if("n"===cmd){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===cmd?this.onConnectionShutdown_(payload):"r"===cmd?this.onReset_(payload):"e"===cmd?error("Server Error: "+payload):"o"===cmd?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):error("Unknown control packet command: "+cmd)}},Connection2.prototype.onHandshake_=function(handshake){var timestamp=handshake.ts,version2=handshake.v,host=handshake.h;this.sessionId=handshake.s,this.repoInfo_.host=host,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,timestamp),"5"!==version2&&warn("Protocol version mismatch detected"),this.tryStartUpgrade_())},Connection2.prototype.tryStartUpgrade_=function(){var conn=this.transportManager_.upgradeTransport();conn&&this.startUpgrade_(conn)},Connection2.prototype.startUpgrade_=function(conn){var _this=this;this.secondaryConn_=new conn(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=conn.responsesRequiredToBeHealthy||0;var onMessage=this.connReceiver_(this.secondaryConn_),onDisconnect=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(onMessage,onDisconnect),setTimeoutNonBlocking(function(){_this.secondaryConn_&&(_this.log_("Timed out trying to upgrade."),_this.secondaryConn_.close())},Math.floor(6e4))},Connection2.prototype.onReset_=function(host){this.log_("Reset packet received.  New host: "+host),this.repoInfo_.host=host,1===this.state_?this.close():(this.closeConnections_(),this.start_())},Connection2.prototype.onConnectionEstablished_=function(conn,timestamp){var _this=this;this.log_("Realtime connection established."),this.conn_=conn,this.state_=1,this.onReady_&&(this.onReady_(timestamp,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):setTimeoutNonBlocking(function(){_this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},Connection2.prototype.sendPingOnPrimaryIfNecessary_=function(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},Connection2.prototype.onSecondaryConnectionLost_=function(){var conn=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===conn||this.rx_===conn)&&this.close()},Connection2.prototype.onConnectionLost_=function(everConnected){this.conn_=null,everConnected||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(PersistentStorage.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},Connection2.prototype.onConnectionShutdown_=function(reason){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(reason),this.onKill_=null),this.onDisconnect_=null,this.close()},Connection2.prototype.sendData_=function(data){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(data)},Connection2.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},Connection2.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},Connection2}(),ServerActions=function(){function ServerActions2(){}return __name(ServerActions2,"ServerActions"),ServerActions2.prototype.put=function(pathString,data,onComplete,hash){},ServerActions2.prototype.merge=function(pathString,data,onComplete,hash){},ServerActions2.prototype.refreshAuthToken=function(token){},ServerActions2.prototype.refreshAppCheckToken=function(token){},ServerActions2.prototype.onDisconnectPut=function(pathString,data,onComplete){},ServerActions2.prototype.onDisconnectMerge=function(pathString,data,onComplete){},ServerActions2.prototype.onDisconnectCancel=function(pathString,onComplete){},ServerActions2.prototype.reportStats=function(stats2){},ServerActions2}(),EventEmitter=function(){function EventEmitter2(allowedEvents_){this.allowedEvents_=allowedEvents_,this.listeners_={},util.assert(Array.isArray(allowedEvents_)&&allowedEvents_.length>0,"Requires a non-empty array")}return __name(EventEmitter2,"EventEmitter"),EventEmitter2.prototype.trigger=function(eventType){for(var varArgs=[],_i=1;_i<arguments.length;_i++)varArgs[_i-1]=arguments[_i];if(Array.isArray(this.listeners_[eventType]))for(var listeners=tslib.__spreadArray([],tslib.__read(this.listeners_[eventType])),i=0;i<listeners.length;i++)listeners[i].callback.apply(listeners[i].context,varArgs)},EventEmitter2.prototype.on=function(eventType,callback,context){this.validateEventType_(eventType),this.listeners_[eventType]=this.listeners_[eventType]||[],this.listeners_[eventType].push({callback,context});var eventData=this.getInitialEvent(eventType);eventData&&callback.apply(context,eventData)},EventEmitter2.prototype.off=function(eventType,callback,context){this.validateEventType_(eventType);for(var listeners=this.listeners_[eventType]||[],i=0;i<listeners.length;i++)if(listeners[i].callback===callback&&(!context||context===listeners[i].context))return void listeners.splice(i,1)},EventEmitter2.prototype.validateEventType_=function(eventType){util.assert(this.allowedEvents_.find(function(et){return et===eventType}),"Unknown event: "+eventType)},EventEmitter2}(),OnlineMonitor=function(_super){function OnlineMonitor2(){var _this=_super.call(this,["online"])||this;return _this.online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&!util.isMobileCordova()&&(window.addEventListener("online",function(){_this.online_||(_this.online_=!0,_this.trigger("online",!0))},!1),window.addEventListener("offline",function(){_this.online_&&(_this.online_=!1,_this.trigger("online",!1))},!1)),_this}return tslib.__extends(OnlineMonitor2,_super),__name(OnlineMonitor2,"OnlineMonitor"),OnlineMonitor2.getInstance=function(){return new OnlineMonitor2},OnlineMonitor2.prototype.getInitialEvent=function(eventType){return util.assert("online"===eventType,"Unknown event type: "+eventType),[this.online_]},OnlineMonitor2.prototype.currentlyOnline=function(){return this.online_},OnlineMonitor2}(EventEmitter),Path=function(){function Path2(pathOrString,pieceNum){if(void 0===pieceNum){this.pieces_=pathOrString.split("/");for(var copyTo=0,i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[copyTo]=this.pieces_[i],copyTo++);this.pieces_.length=copyTo,this.pieceNum_=0}else this.pieces_=pathOrString,this.pieceNum_=pieceNum}return __name(Path2,"Path"),Path2.prototype.toString=function(){for(var pathString="",i=this.pieceNum_;i<this.pieces_.length;i++)""!==this.pieces_[i]&&(pathString+="/"+this.pieces_[i]);return pathString||"/"},Path2}();function newEmptyPath(){return new Path("")}function pathGetFront(path){return path.pieceNum_>=path.pieces_.length?null:path.pieces_[path.pieceNum_]}function pathGetLength(path){return path.pieces_.length-path.pieceNum_}function pathPopFront(path){var pieceNum=path.pieceNum_;return pieceNum<path.pieces_.length&&pieceNum++,new Path(path.pieces_,pieceNum)}function pathGetBack(path){return path.pieceNum_<path.pieces_.length?path.pieces_[path.pieces_.length-1]:null}function pathToUrlEncodedString(path){for(var pathString="",i=path.pieceNum_;i<path.pieces_.length;i++)""!==path.pieces_[i]&&(pathString+="/"+encodeURIComponent(String(path.pieces_[i])));return pathString||"/"}function pathSlice(path,begin){return void 0===begin&&(begin=0),path.pieces_.slice(path.pieceNum_+begin)}function pathParent(path){if(path.pieceNum_>=path.pieces_.length)return null;for(var pieces=[],i=path.pieceNum_;i<path.pieces_.length-1;i++)pieces.push(path.pieces_[i]);return new Path(pieces,0)}function pathChild(path,childPathObj){for(var pieces=[],i=path.pieceNum_;i<path.pieces_.length;i++)pieces.push(path.pieces_[i]);if(childPathObj instanceof Path)for(i=childPathObj.pieceNum_;i<childPathObj.pieces_.length;i++)pieces.push(childPathObj.pieces_[i]);else{var childPieces=childPathObj.split("/");for(i=0;i<childPieces.length;i++)childPieces[i].length>0&&pieces.push(childPieces[i])}return new Path(pieces,0)}function pathIsEmpty(path){return path.pieceNum_>=path.pieces_.length}function newRelativePath(outerPath,innerPath){var outer=pathGetFront(outerPath),inner=pathGetFront(innerPath);if(null===outer)return innerPath;if(outer===inner)return newRelativePath(pathPopFront(outerPath),pathPopFront(innerPath));throw new Error("INTERNAL ERROR: innerPath ("+innerPath+") is not within outerPath ("+outerPath+")")}function pathCompare(left,right){for(var leftKeys=pathSlice(left,0),rightKeys=pathSlice(right,0),i=0;i<leftKeys.length&&i<rightKeys.length;i++){var cmp=nameCompare(leftKeys[i],rightKeys[i]);if(0!==cmp)return cmp}return leftKeys.length===rightKeys.length?0:leftKeys.length<rightKeys.length?-1:1}function pathEquals(path,other){if(pathGetLength(path)!==pathGetLength(other))return!1;for(var i=path.pieceNum_,j=other.pieceNum_;i<=path.pieces_.length;i++,j++)if(path.pieces_[i]!==other.pieces_[j])return!1;return!0}function pathContains(path,other){var i=path.pieceNum_,j=other.pieceNum_;if(pathGetLength(path)>pathGetLength(other))return!1;for(;i<path.pieces_.length;){if(path.pieces_[i]!==other.pieces_[j])return!1;++i,++j}return!0}__name(newEmptyPath,"newEmptyPath"),__name(pathGetFront,"pathGetFront"),__name(pathGetLength,"pathGetLength"),__name(pathPopFront,"pathPopFront"),__name(pathGetBack,"pathGetBack"),__name(pathToUrlEncodedString,"pathToUrlEncodedString"),__name(pathSlice,"pathSlice"),__name(pathParent,"pathParent"),__name(pathChild,"pathChild"),__name(pathIsEmpty,"pathIsEmpty"),__name(newRelativePath,"newRelativePath"),__name(pathCompare,"pathCompare"),__name(pathEquals,"pathEquals"),__name(pathContains,"pathContains");var ValidationPath=function(){function ValidationPath2(path,errorPrefix_){this.errorPrefix_=errorPrefix_,this.parts_=pathSlice(path,0),this.byteLength_=Math.max(1,this.parts_.length);for(var i=0;i<this.parts_.length;i++)this.byteLength_+=util.stringLength(this.parts_[i]);validationPathCheckValid(this)}return __name(ValidationPath2,"ValidationPath"),ValidationPath2}();function validationPathPush(validationPath,child2){validationPath.parts_.length>0&&(validationPath.byteLength_+=1),validationPath.parts_.push(child2),validationPath.byteLength_+=util.stringLength(child2),validationPathCheckValid(validationPath)}function validationPathPop(validationPath){var last=validationPath.parts_.pop();validationPath.byteLength_-=util.stringLength(last),validationPath.parts_.length>0&&(validationPath.byteLength_-=1)}function validationPathCheckValid(validationPath){if(validationPath.byteLength_>768)throw new Error(validationPath.errorPrefix_+"has a key path longer than 768 bytes ("+validationPath.byteLength_+").");if(validationPath.parts_.length>32)throw new Error(validationPath.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+validationPathToErrorString(validationPath))}function validationPathToErrorString(validationPath){return 0===validationPath.parts_.length?"":"in property '"+validationPath.parts_.join(".")+"'"}__name(validationPathPush,"validationPathPush"),__name(validationPathPop,"validationPathPop"),__name(validationPathCheckValid,"validationPathCheckValid"),__name(validationPathToErrorString,"validationPathToErrorString");var __EMPTY_NODE,MAX_NODE$2,VisibilityMonitor=function(_super){function VisibilityMonitor2(){var hidden,visibilityChange,_this=_super.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(visibilityChange="visibilitychange",hidden="hidden"):void 0!==document.mozHidden?(visibilityChange="mozvisibilitychange",hidden="mozHidden"):void 0!==document.msHidden?(visibilityChange="msvisibilitychange",hidden="msHidden"):void 0!==document.webkitHidden&&(visibilityChange="webkitvisibilitychange",hidden="webkitHidden")),_this.visible_=!0,visibilityChange&&document.addEventListener(visibilityChange,function(){var visible=!document[hidden];visible!==_this.visible_&&(_this.visible_=visible,_this.trigger("visible",visible))},!1),_this}return tslib.__extends(VisibilityMonitor2,_super),__name(VisibilityMonitor2,"VisibilityMonitor"),VisibilityMonitor2.getInstance=function(){return new VisibilityMonitor2},VisibilityMonitor2.prototype.getInitialEvent=function(eventType){return util.assert("visible"===eventType,"Unknown event type: "+eventType),[this.visible_]},VisibilityMonitor2}(EventEmitter),PersistentConnection=function(_super){function PersistentConnection2(repoInfo_,applicationId_,onDataUpdate_,onConnectStatus_,onServerInfoUpdate_,authTokenProvider_,appCheckTokenProvider_,authOverride_){var _this=_super.call(this)||this;if(_this.repoInfo_=repoInfo_,_this.applicationId_=applicationId_,_this.onDataUpdate_=onDataUpdate_,_this.onConnectStatus_=onConnectStatus_,_this.onServerInfoUpdate_=onServerInfoUpdate_,_this.authTokenProvider_=authTokenProvider_,_this.appCheckTokenProvider_=appCheckTokenProvider_,_this.authOverride_=authOverride_,_this.id=PersistentConnection2.nextPersistentConnectionId_++,_this.log_=logWrapper("p:"+_this.id+":"),_this.interruptReasons_={},_this.listens=new Map,_this.outstandingPuts_=[],_this.outstandingGets_=[],_this.outstandingPutCount_=0,_this.outstandingGetCount_=0,_this.onDisconnectRequestQueue_=[],_this.connected_=!1,_this.reconnectDelay_=1e3,_this.maxReconnectDelay_=3e5,_this.securityDebugCallback_=null,_this.lastSessionId=null,_this.establishConnectionTimer_=null,_this.visible_=!1,_this.requestCBHash_={},_this.requestNumber_=0,_this.realtime_=null,_this.authToken_=null,_this.appCheckToken_=null,_this.forceTokenRefresh_=!1,_this.invalidAuthTokenCount_=0,_this.invalidAppCheckTokenCount_=0,_this.firstConnection_=!0,_this.lastConnectionAttemptTime_=null,_this.lastConnectionEstablishedTime_=null,authOverride_&&!util.isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return VisibilityMonitor.getInstance().on("visible",_this.onVisible_,_this),-1===repoInfo_.host.indexOf("fblocal")&&OnlineMonitor.getInstance().on("online",_this.onOnline_,_this),_this}return tslib.__extends(PersistentConnection2,_super),__name(PersistentConnection2,"PersistentConnection"),PersistentConnection2.prototype.sendRequest=function(action,body,onResponse){var curReqNum=++this.requestNumber_,msg={r:curReqNum,a:action,b:body};this.log_(util.stringify(msg)),util.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(msg),onResponse&&(this.requestCBHash_[curReqNum]=onResponse)},PersistentConnection2.prototype.get=function(query2){var _this=this;this.initConnection_();var deferred=new util.Deferred,request={p:query2._path.toString(),q:query2._queryObject},outstandingGet={action:"g",request,onComplete:function(message){var payload=message.d;"ok"===message.s?(_this.onDataUpdate_(request.p,payload,!1,null),deferred.resolve(payload)):deferred.reject(payload)}};this.outstandingGets_.push(outstandingGet),this.outstandingGetCount_++;var index=this.outstandingGets_.length-1;return this.connected_||setTimeout(function(){var get2=_this.outstandingGets_[index];void 0===get2||outstandingGet!==get2||(delete _this.outstandingGets_[index],_this.outstandingGetCount_--,0===_this.outstandingGetCount_&&(_this.outstandingGets_=[]),_this.log_("get "+index+" timed out on connection"),deferred.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(index),deferred.promise},PersistentConnection2.prototype.listen=function(query2,currentHashFn,tag,onComplete){this.initConnection_();var queryId=query2._queryIdentifier,pathString=query2._path.toString();this.log_("Listen called for "+pathString+" "+queryId),this.listens.has(pathString)||this.listens.set(pathString,new Map),util.assert(query2._queryParams.isDefault()||!query2._queryParams.loadsAllData(),"listen() called for non-default but complete query"),util.assert(!this.listens.get(pathString).has(queryId),"listen() called twice for same path/queryId.");var listenSpec={onComplete,hashFn:currentHashFn,query:query2,tag};this.listens.get(pathString).set(queryId,listenSpec),this.connected_&&this.sendListen_(listenSpec)},PersistentConnection2.prototype.sendGet_=function(index){var _this=this,get2=this.outstandingGets_[index];this.sendRequest("g",get2.request,function(message){delete _this.outstandingGets_[index],_this.outstandingGetCount_--,0===_this.outstandingGetCount_&&(_this.outstandingGets_=[]),get2.onComplete&&get2.onComplete(message)})},PersistentConnection2.prototype.sendListen_=function(listenSpec){var _this=this,query2=listenSpec.query,pathString=query2._path.toString(),queryId=query2._queryIdentifier;this.log_("Listen on "+pathString+" for "+queryId);var req={p:pathString};listenSpec.tag&&(req.q=query2._queryObject,req.t=listenSpec.tag),req.h=listenSpec.hashFn(),this.sendRequest("q",req,function(message){var payload=message.d,status=message.s;PersistentConnection2.warnOnListenWarnings_(payload,query2),(_this.listens.get(pathString)&&_this.listens.get(pathString).get(queryId))===listenSpec&&(_this.log_("listen response",message),"ok"!==status&&_this.removeListen_(pathString,queryId),listenSpec.onComplete&&listenSpec.onComplete(status,payload))})},PersistentConnection2.warnOnListenWarnings_=function(payload,query2){if(payload&&"object"==typeof payload&&util.contains(payload,"w")){var warnings=util.safeGet(payload,"w");if(Array.isArray(warnings)&&~warnings.indexOf("no_index")){var indexSpec='".indexOn": "'+query2._queryParams.getIndex().toString()+'"',indexPath=query2._path.toString();warn("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+indexSpec+" at "+indexPath+" to your security rules for better performance.")}}},PersistentConnection2.prototype.refreshAuthToken=function(token){this.authToken_=token,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(token)},PersistentConnection2.prototype.reduceReconnectDelayIfAdminCredential_=function(credential){(credential&&40===credential.length||util.isAdmin(credential))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},PersistentConnection2.prototype.refreshAppCheckToken=function(token){this.appCheckToken_=token,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},function(){})},PersistentConnection2.prototype.tryAuth=function(){var _this=this;if(this.connected_&&this.authToken_){var token_1=this.authToken_,authMethod=util.isValidFormat(token_1)?"auth":"gauth",requestData={cred:token_1};null===this.authOverride_?requestData.noauth=!0:"object"==typeof this.authOverride_&&(requestData.authvar=this.authOverride_),this.sendRequest(authMethod,requestData,function(res){var status=res.s,data=res.d||"error";_this.authToken_===token_1&&("ok"===status?_this.invalidAuthTokenCount_=0:_this.onAuthRevoked_(status,data))})}},PersistentConnection2.prototype.tryAppCheck=function(){var _this=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},function(res){var status=res.s,data=res.d||"error";"ok"===status?_this.invalidAppCheckTokenCount_=0:_this.onAppCheckRevoked_(status,data)})},PersistentConnection2.prototype.unlisten=function(query2,tag){var pathString=query2._path.toString(),queryId=query2._queryIdentifier;this.log_("Unlisten called for "+pathString+" "+queryId),util.assert(query2._queryParams.isDefault()||!query2._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(pathString,queryId)&&this.connected_&&this.sendUnlisten_(pathString,queryId,query2._queryObject,tag)},PersistentConnection2.prototype.sendUnlisten_=function(pathString,queryId,queryObj,tag){this.log_("Unlisten on "+pathString+" for "+queryId);var req={p:pathString};tag&&(req.q=queryObj,req.t=tag),this.sendRequest("n",req)},PersistentConnection2.prototype.onDisconnectPut=function(pathString,data,onComplete){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",pathString,data,onComplete):this.onDisconnectRequestQueue_.push({pathString,action:"o",data,onComplete})},PersistentConnection2.prototype.onDisconnectMerge=function(pathString,data,onComplete){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",pathString,data,onComplete):this.onDisconnectRequestQueue_.push({pathString,action:"om",data,onComplete})},PersistentConnection2.prototype.onDisconnectCancel=function(pathString,onComplete){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",pathString,null,onComplete):this.onDisconnectRequestQueue_.push({pathString,action:"oc",data:null,onComplete})},PersistentConnection2.prototype.sendOnDisconnect_=function(action,pathString,data,onComplete){var request={p:pathString,d:data};this.log_("onDisconnect "+action,request),this.sendRequest(action,request,function(response){onComplete&&setTimeout(function(){onComplete(response.s,response.d)},Math.floor(0))})},PersistentConnection2.prototype.put=function(pathString,data,onComplete,hash){this.putInternal("p",pathString,data,onComplete,hash)},PersistentConnection2.prototype.merge=function(pathString,data,onComplete,hash){this.putInternal("m",pathString,data,onComplete,hash)},PersistentConnection2.prototype.putInternal=function(action,pathString,data,onComplete,hash){this.initConnection_();var request={p:pathString,d:data};void 0!==hash&&(request.h=hash),this.outstandingPuts_.push({action,request,onComplete}),this.outstandingPutCount_++;var index=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(index):this.log_("Buffering put: "+pathString)},PersistentConnection2.prototype.sendPut_=function(index){var _this=this,action=this.outstandingPuts_[index].action,request=this.outstandingPuts_[index].request,onComplete=this.outstandingPuts_[index].onComplete;this.outstandingPuts_[index].queued=this.connected_,this.sendRequest(action,request,function(message){_this.log_(action+" response",message),delete _this.outstandingPuts_[index],_this.outstandingPutCount_--,0===_this.outstandingPutCount_&&(_this.outstandingPuts_=[]),onComplete&&onComplete(message.s,message.d)})},PersistentConnection2.prototype.reportStats=function(stats2){var _this=this;if(this.connected_){var request={c:stats2};this.log_("reportStats",request),this.sendRequest("s",request,function(result){if("ok"!==result.s){var errorReason=result.d;_this.log_("reportStats","Error sending stats: "+errorReason)}})}},PersistentConnection2.prototype.onDataMessage_=function(message){if("r"in message){this.log_("from server: "+util.stringify(message));var reqNum=message.r,onResponse=this.requestCBHash_[reqNum];onResponse&&(delete this.requestCBHash_[reqNum],onResponse(message.b))}else{if("error"in message)throw"A server-side error has occurred: "+message.error;"a"in message&&this.onDataPush_(message.a,message.b)}},PersistentConnection2.prototype.onDataPush_=function(action,body){this.log_("handleServerMessage",action,body),"d"===action?this.onDataUpdate_(body.p,body.d,!1,body.t):"m"===action?this.onDataUpdate_(body.p,body.d,!0,body.t):"c"===action?this.onListenRevoked_(body.p,body.q):"ac"===action?this.onAuthRevoked_(body.s,body.d):"apc"===action?this.onAppCheckRevoked_(body.s,body.d):"sd"===action?this.onSecurityDebugPacket_(body):error("Unrecognized action received from server: "+util.stringify(action)+"\nAre you using the latest client?")},PersistentConnection2.prototype.onReady_=function(timestamp,sessionId){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(timestamp),this.lastSessionId=sessionId,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},PersistentConnection2.prototype.scheduleConnect_=function(timeout){var _this=this;util.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){_this.establishConnectionTimer_=null,_this.establishConnection_()},Math.floor(timeout))},PersistentConnection2.prototype.initConnection_=function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)},PersistentConnection2.prototype.onVisible_=function(visible){visible&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=visible},PersistentConnection2.prototype.onOnline_=function(online){online?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},PersistentConnection2.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var timeSinceLastConnectAttempt=(new Date).getTime()-this.lastConnectionAttemptTime_,reconnectDelay=Math.max(0,this.reconnectDelay_-timeSinceLastConnectAttempt);reconnectDelay=Math.random()*reconnectDelay,this.log_("Trying to reconnect in "+reconnectDelay+"ms"),this.scheduleConnect_(reconnectDelay),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},PersistentConnection2.prototype.establishConnection_=function(){return tslib.__awaiter(this,void 0,void 0,function(){var onDataMessage,onReady,onDisconnect_1,connId,lastSessionId,canceled_1,connection_1,closeFn,sendRequestFn,forceRefresh,_a,authToken,appCheckToken,error_1,_this=this;return tslib.__generator(this,function(_b){switch(_b.label){case 0:if(!this.shouldReconnect_())return[3,4];this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,onDataMessage=this.onDataMessage_.bind(this),onReady=this.onReady_.bind(this),onDisconnect_1=this.onRealtimeDisconnect_.bind(this),connId=this.id+":"+PersistentConnection2.nextConnectionId_++,lastSessionId=this.lastSessionId,canceled_1=!1,connection_1=null,closeFn=__name(function(){connection_1?connection_1.close():(canceled_1=!0,onDisconnect_1())},"closeFn"),sendRequestFn=__name(function(msg){util.assert(connection_1,"sendRequest call when we're not connected not allowed."),connection_1.sendRequest(msg)},"sendRequestFn"),this.realtime_={close:closeFn,sendRequest:sendRequestFn},forceRefresh=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,_b.label=1;case 1:return _b.trys.push([1,3,,4]),[4,Promise.all([this.authTokenProvider_.getToken(forceRefresh),this.appCheckTokenProvider_.getToken(forceRefresh)])];case 2:return _a=tslib.__read.apply(void 0,[_b.sent(),2]),authToken=_a[0],appCheckToken=_a[1],canceled_1?log("getToken() completed but was canceled"):(log("getToken() completed. Creating connection."),this.authToken_=authToken&&authToken.accessToken,this.appCheckToken_=appCheckToken&&appCheckToken.token,connection_1=new Connection(connId,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,onDataMessage,onReady,onDisconnect_1,function(reason){warn(reason+" ("+_this.repoInfo_.toString()+")"),_this.interrupt("server_kill")},lastSessionId)),[3,4];case 3:return error_1=_b.sent(),this.log_("Failed to get token: "+error_1),canceled_1||(this.repoInfo_.nodeAdmin&&warn(error_1),closeFn()),[3,4];case 4:return[2]}})})},PersistentConnection2.prototype.interrupt=function(reason){log("Interrupting connection for reason: "+reason),this.interruptReasons_[reason]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},PersistentConnection2.prototype.resume=function(reason){log("Resuming connection for reason: "+reason),delete this.interruptReasons_[reason],util.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},PersistentConnection2.prototype.handleTimestamp_=function(timestamp){var delta=timestamp-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:delta})},PersistentConnection2.prototype.cancelSentTransactions_=function(){for(var i=0;i<this.outstandingPuts_.length;i++){var put=this.outstandingPuts_[i];put&&"h"in put.request&&put.queued&&(put.onComplete&&put.onComplete("disconnect"),delete this.outstandingPuts_[i],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},PersistentConnection2.prototype.onListenRevoked_=function(pathString,query2){var queryId;queryId=query2?query2.map(function(q){return ObjectToUniqueKey(q)}).join("$"):"default";var listen=this.removeListen_(pathString,queryId);listen&&listen.onComplete&&listen.onComplete("permission_denied")},PersistentConnection2.prototype.removeListen_=function(pathString,queryId){var listen,normalizedPathString=new Path(pathString).toString();if(this.listens.has(normalizedPathString)){var map=this.listens.get(normalizedPathString);listen=map.get(queryId),map.delete(queryId),0===map.size&&this.listens.delete(normalizedPathString)}else listen=void 0;return listen},PersistentConnection2.prototype.onAuthRevoked_=function(statusCode,explanation){log("Auth token revoked: "+statusCode+"/"+explanation),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===statusCode||"permission_denied"===statusCode)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},PersistentConnection2.prototype.onAppCheckRevoked_=function(statusCode,explanation){log("App check token revoked: "+statusCode+"/"+explanation),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===statusCode||"permission_denied"===statusCode)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())},PersistentConnection2.prototype.onSecurityDebugPacket_=function(body){this.securityDebugCallback_?this.securityDebugCallback_(body):"msg"in body&&console.log("FIREBASE: "+body.msg.replace("\n","\nFIREBASE: "))},PersistentConnection2.prototype.restoreState_=function(){var e_1,_a,e_2,_b;this.tryAuth(),this.tryAppCheck();try{for(var _c=tslib.__values(this.listens.values()),_d=_c.next();!_d.done;_d=_c.next()){var queries=_d.value;try{for(var _e=(e_2=void 0,tslib.__values(queries.values())),_f=_e.next();!_f.done;_f=_e.next()){var listenSpec=_f.value;this.sendListen_(listenSpec)}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_f&&!_f.done&&(_b=_e.return)&&_b.call(_e)}finally{if(e_2)throw e_2.error}}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_d&&!_d.done&&(_a=_c.return)&&_a.call(_c)}finally{if(e_1)throw e_1.error}}for(var i=0;i<this.outstandingPuts_.length;i++)this.outstandingPuts_[i]&&this.sendPut_(i);for(;this.onDisconnectRequestQueue_.length;){var request=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(request.action,request.pathString,request.data,request.onComplete)}for(i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)},PersistentConnection2.prototype.sendConnectStats_=function(){var stats2={},clientName="js";util.isNodeSdk()&&(clientName=this.repoInfo_.nodeAdmin?"admin_node":"node"),stats2["sdk."+clientName+"."+SDK_VERSION.replace(/\./g,"-")]=1,util.isMobileCordova()?stats2["framework.cordova"]=1:util.isReactNative()&&(stats2["framework.reactnative"]=1),this.reportStats(stats2)},PersistentConnection2.prototype.shouldReconnect_=function(){var online=OnlineMonitor.getInstance().currentlyOnline();return util.isEmpty(this.interruptReasons_)&&online},PersistentConnection2.nextPersistentConnectionId_=0,PersistentConnection2.nextConnectionId_=0,PersistentConnection2}(ServerActions),NamedNode=function(){function NamedNode2(name2,node){this.name=name2,this.node=node}return __name(NamedNode2,"NamedNode"),NamedNode2.Wrap=function(name2,node){return new NamedNode2(name2,node)},NamedNode2}(),Index=function(){function Index2(){}return __name(Index2,"Index"),Index2.prototype.getCompare=function(){return this.compare.bind(this)},Index2.prototype.indexedValueChanged=function(oldNode,newNode){var oldWrapped=new NamedNode(MIN_NAME,oldNode),newWrapped=new NamedNode(MIN_NAME,newNode);return 0!==this.compare(oldWrapped,newWrapped)},Index2.prototype.minPost=function(){return NamedNode.MIN},Index2}(),KeyIndex=function(_super){function KeyIndex2(){return null!==_super&&_super.apply(this,arguments)||this}return tslib.__extends(KeyIndex2,_super),__name(KeyIndex2,"KeyIndex"),Object.defineProperty(KeyIndex2,"__EMPTY_NODE",{get:function(){return __EMPTY_NODE},set:function(val){__EMPTY_NODE=val},enumerable:!1,configurable:!0}),KeyIndex2.prototype.compare=function(a,b){return nameCompare(a.name,b.name)},KeyIndex2.prototype.isDefinedOn=function(node){throw util.assertionError("KeyIndex.isDefinedOn not expected to be called.")},KeyIndex2.prototype.indexedValueChanged=function(oldNode,newNode){return!1},KeyIndex2.prototype.minPost=function(){return NamedNode.MIN},KeyIndex2.prototype.maxPost=function(){return new NamedNode(MAX_NAME,__EMPTY_NODE)},KeyIndex2.prototype.makePost=function(indexValue,name2){return util.assert("string"==typeof indexValue,"KeyIndex indexValue must always be a string."),new NamedNode(indexValue,__EMPTY_NODE)},KeyIndex2.prototype.toString=function(){return".key"},KeyIndex2}(Index),KEY_INDEX=new KeyIndex,SortedMapIterator=function(){function SortedMapIterator2(node,startKey,comparator,isReverse_,resultGenerator_){void 0===resultGenerator_&&(resultGenerator_=null),this.isReverse_=isReverse_,this.resultGenerator_=resultGenerator_,this.nodeStack_=[];for(var cmp=1;!node.isEmpty();)if(node=node,cmp=startKey?comparator(node.key,startKey):1,isReverse_&&(cmp*=-1),cmp<0)node=this.isReverse_?node.left:node.right;else{if(0===cmp){this.nodeStack_.push(node);break}this.nodeStack_.push(node),node=this.isReverse_?node.right:node.left}}return __name(SortedMapIterator2,"SortedMapIterator"),SortedMapIterator2.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var result,node=this.nodeStack_.pop();if(result=this.resultGenerator_?this.resultGenerator_(node.key,node.value):{key:node.key,value:node.value},this.isReverse_)for(node=node.left;!node.isEmpty();)this.nodeStack_.push(node),node=node.right;else for(node=node.right;!node.isEmpty();)this.nodeStack_.push(node),node=node.left;return result},SortedMapIterator2.prototype.hasNext=function(){return this.nodeStack_.length>0},SortedMapIterator2.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var node=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(node.key,node.value):{key:node.key,value:node.value}},SortedMapIterator2}(),LLRBNode=function(){function LLRBNode2(key,value,color,left,right){this.key=key,this.value=value,this.color=null!=color?color:LLRBNode2.RED,this.left=null!=left?left:SortedMap.EMPTY_NODE,this.right=null!=right?right:SortedMap.EMPTY_NODE}return __name(LLRBNode2,"LLRBNode"),LLRBNode2.prototype.copy=function(key,value,color,left,right){return new LLRBNode2(null!=key?key:this.key,null!=value?value:this.value,null!=color?color:this.color,null!=left?left:this.left,null!=right?right:this.right)},LLRBNode2.prototype.count=function(){return this.left.count()+1+this.right.count()},LLRBNode2.prototype.isEmpty=function(){return!1},LLRBNode2.prototype.inorderTraversal=function(action){return this.left.inorderTraversal(action)||!!action(this.key,this.value)||this.right.inorderTraversal(action)},LLRBNode2.prototype.reverseTraversal=function(action){return this.right.reverseTraversal(action)||action(this.key,this.value)||this.left.reverseTraversal(action)},LLRBNode2.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},LLRBNode2.prototype.minKey=function(){return this.min_().key},LLRBNode2.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},LLRBNode2.prototype.insert=function(key,value,comparator){var n=this,cmp=comparator(key,n.key);return(n=cmp<0?n.copy(null,null,null,n.left.insert(key,value,comparator),null):0===cmp?n.copy(null,value,null,null,null):n.copy(null,null,null,null,n.right.insert(key,value,comparator))).fixUp_()},LLRBNode2.prototype.removeMin_=function(){if(this.left.isEmpty())return SortedMap.EMPTY_NODE;var n=this;return!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),(n=n.copy(null,null,null,n.left.removeMin_(),null)).fixUp_()},LLRBNode2.prototype.remove=function(key,comparator){var n,smallest;if(comparator(key,(n=this).key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(key,comparator),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),0===comparator(key,n.key)){if(n.right.isEmpty())return SortedMap.EMPTY_NODE;smallest=n.right.min_(),n=n.copy(smallest.key,smallest.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(key,comparator))}return n.fixUp_()},LLRBNode2.prototype.isRed_=function(){return this.color},LLRBNode2.prototype.fixUp_=function(){var n=this;return n.right.isRed_()&&!n.left.isRed_()&&(n=n.rotateLeft_()),n.left.isRed_()&&n.left.left.isRed_()&&(n=n.rotateRight_()),n.left.isRed_()&&n.right.isRed_()&&(n=n.colorFlip_()),n},LLRBNode2.prototype.moveRedLeft_=function(){var n=this.colorFlip_();return n.right.left.isRed_()&&(n=(n=(n=n.copy(null,null,null,null,n.right.rotateRight_())).rotateLeft_()).colorFlip_()),n},LLRBNode2.prototype.moveRedRight_=function(){var n=this.colorFlip_();return n.left.left.isRed_()&&(n=(n=n.rotateRight_()).colorFlip_()),n},LLRBNode2.prototype.rotateLeft_=function(){var nl=this.copy(null,null,LLRBNode2.RED,null,this.right.left);return this.right.copy(null,null,this.color,nl,null)},LLRBNode2.prototype.rotateRight_=function(){var nr=this.copy(null,null,LLRBNode2.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,nr)},LLRBNode2.prototype.colorFlip_=function(){var left=this.left.copy(null,null,!this.left.color,null,null),right=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,left,right)},LLRBNode2.prototype.checkMaxDepth_=function(){var blackDepth=this.check_();return Math.pow(2,blackDepth)<=this.count()+1},LLRBNode2.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var blackDepth=this.left.check_();if(blackDepth!==this.right.check_())throw new Error("Black depths differ");return blackDepth+(this.isRed_()?0:1)},LLRBNode2.RED=!0,LLRBNode2.BLACK=!1,LLRBNode2}(),LLRBEmptyNode=function(){function LLRBEmptyNode2(){}return __name(LLRBEmptyNode2,"LLRBEmptyNode"),LLRBEmptyNode2.prototype.copy=function(key,value,color,left,right){return this},LLRBEmptyNode2.prototype.insert=function(key,value,comparator){return new LLRBNode(key,value,null)},LLRBEmptyNode2.prototype.remove=function(key,comparator){return this},LLRBEmptyNode2.prototype.count=function(){return 0},LLRBEmptyNode2.prototype.isEmpty=function(){return!0},LLRBEmptyNode2.prototype.inorderTraversal=function(action){return!1},LLRBEmptyNode2.prototype.reverseTraversal=function(action){return!1},LLRBEmptyNode2.prototype.minKey=function(){return null},LLRBEmptyNode2.prototype.maxKey=function(){return null},LLRBEmptyNode2.prototype.check_=function(){return 0},LLRBEmptyNode2.prototype.isRed_=function(){return!1},LLRBEmptyNode2}(),SortedMap=function(){function SortedMap2(comparator_,root_){void 0===root_&&(root_=SortedMap2.EMPTY_NODE),this.comparator_=comparator_,this.root_=root_}return __name(SortedMap2,"SortedMap"),SortedMap2.prototype.insert=function(key,value){return new SortedMap2(this.comparator_,this.root_.insert(key,value,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))},SortedMap2.prototype.remove=function(key){return new SortedMap2(this.comparator_,this.root_.remove(key,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))},SortedMap2.prototype.get=function(key){for(var cmp,node=this.root_;!node.isEmpty();){if(0===(cmp=this.comparator_(key,node.key)))return node.value;cmp<0?node=node.left:cmp>0&&(node=node.right)}return null},SortedMap2.prototype.getPredecessorKey=function(key){for(var cmp,node=this.root_,rightParent=null;!node.isEmpty();){if(0===(cmp=this.comparator_(key,node.key))){if(node.left.isEmpty())return rightParent?rightParent.key:null;for(node=node.left;!node.right.isEmpty();)node=node.right;return node.key}cmp<0?node=node.left:cmp>0&&(rightParent=node,node=node.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},SortedMap2.prototype.isEmpty=function(){return this.root_.isEmpty()},SortedMap2.prototype.count=function(){return this.root_.count()},SortedMap2.prototype.minKey=function(){return this.root_.minKey()},SortedMap2.prototype.maxKey=function(){return this.root_.maxKey()},SortedMap2.prototype.inorderTraversal=function(action){return this.root_.inorderTraversal(action)},SortedMap2.prototype.reverseTraversal=function(action){return this.root_.reverseTraversal(action)},SortedMap2.prototype.getIterator=function(resultGenerator){return new SortedMapIterator(this.root_,null,this.comparator_,!1,resultGenerator)},SortedMap2.prototype.getIteratorFrom=function(key,resultGenerator){return new SortedMapIterator(this.root_,key,this.comparator_,!1,resultGenerator)},SortedMap2.prototype.getReverseIteratorFrom=function(key,resultGenerator){return new SortedMapIterator(this.root_,key,this.comparator_,!0,resultGenerator)},SortedMap2.prototype.getReverseIterator=function(resultGenerator){return new SortedMapIterator(this.root_,null,this.comparator_,!0,resultGenerator)},SortedMap2.EMPTY_NODE=new LLRBEmptyNode,SortedMap2}();function NAME_ONLY_COMPARATOR(left,right){return nameCompare(left.name,right.name)}function NAME_COMPARATOR(left,right){return nameCompare(left,right)}function setMaxNode$1(val){MAX_NODE$2=val}__name(NAME_ONLY_COMPARATOR,"NAME_ONLY_COMPARATOR"),__name(NAME_COMPARATOR,"NAME_COMPARATOR"),__name(setMaxNode$1,"setMaxNode$1");var __childrenNodeConstructor,nodeFromJSON$1,MAX_NODE$1,priorityHashText=__name(function(priority){return"number"==typeof priority?"number:"+doubleToIEEE754String(priority):"string:"+priority},"priorityHashText"),validatePriorityNode=__name(function(priorityNode){if(priorityNode.isLeafNode()){var val=priorityNode.val();util.assert("string"==typeof val||"number"==typeof val||"object"==typeof val&&util.contains(val,".sv"),"Priority must be a string or number.")}else util.assert(priorityNode===MAX_NODE$2||priorityNode.isEmpty(),"priority of unexpected type.");util.assert(priorityNode===MAX_NODE$2||priorityNode.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},"validatePriorityNode"),LeafNode=function(){function LeafNode2(value_,priorityNode_){void 0===priorityNode_&&(priorityNode_=LeafNode2.__childrenNodeConstructor.EMPTY_NODE),this.value_=value_,this.priorityNode_=priorityNode_,this.lazyHash_=null,util.assert(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),validatePriorityNode(this.priorityNode_)}return __name(LeafNode2,"LeafNode"),Object.defineProperty(LeafNode2,"__childrenNodeConstructor",{get:function(){return __childrenNodeConstructor},set:function(val){__childrenNodeConstructor=val},enumerable:!1,configurable:!0}),LeafNode2.prototype.isLeafNode=function(){return!0},LeafNode2.prototype.getPriority=function(){return this.priorityNode_},LeafNode2.prototype.updatePriority=function(newPriorityNode){return new LeafNode2(this.value_,newPriorityNode)},LeafNode2.prototype.getImmediateChild=function(childName){return".priority"===childName?this.priorityNode_:LeafNode2.__childrenNodeConstructor.EMPTY_NODE},LeafNode2.prototype.getChild=function(path){return pathIsEmpty(path)?this:".priority"===pathGetFront(path)?this.priorityNode_:LeafNode2.__childrenNodeConstructor.EMPTY_NODE},LeafNode2.prototype.hasChild=function(){return!1},LeafNode2.prototype.getPredecessorChildName=function(childName,childNode){return null},LeafNode2.prototype.updateImmediateChild=function(childName,newChildNode){return".priority"===childName?this.updatePriority(newChildNode):newChildNode.isEmpty()&&".priority"!==childName?this:LeafNode2.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(childName,newChildNode).updatePriority(this.priorityNode_)},LeafNode2.prototype.updateChild=function(path,newChildNode){var front=pathGetFront(path);return null===front?newChildNode:newChildNode.isEmpty()&&".priority"!==front?this:(util.assert(".priority"!==front||1===pathGetLength(path),".priority must be the last token in a path"),this.updateImmediateChild(front,LeafNode2.__childrenNodeConstructor.EMPTY_NODE.updateChild(pathPopFront(path),newChildNode)))},LeafNode2.prototype.isEmpty=function(){return!1},LeafNode2.prototype.numChildren=function(){return 0},LeafNode2.prototype.forEachChild=function(index,action){return!1},LeafNode2.prototype.val=function(exportFormat){return exportFormat&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},LeafNode2.prototype.hash=function(){if(null===this.lazyHash_){var toHash="";this.priorityNode_.isEmpty()||(toHash+="priority:"+priorityHashText(this.priorityNode_.val())+":");var type=typeof this.value_;toHash+=type+":",toHash+="number"===type?doubleToIEEE754String(this.value_):this.value_,this.lazyHash_=sha1(toHash)}return this.lazyHash_},LeafNode2.prototype.getValue=function(){return this.value_},LeafNode2.prototype.compareTo=function(other){return other===LeafNode2.__childrenNodeConstructor.EMPTY_NODE?1:other instanceof LeafNode2.__childrenNodeConstructor?-1:(util.assert(other.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(other))},LeafNode2.prototype.compareToLeafNode_=function(otherLeaf){var otherLeafType=typeof otherLeaf.value_,thisLeafType=typeof this.value_,otherIndex=LeafNode2.VALUE_TYPE_ORDER.indexOf(otherLeafType),thisIndex=LeafNode2.VALUE_TYPE_ORDER.indexOf(thisLeafType);return util.assert(otherIndex>=0,"Unknown leaf type: "+otherLeafType),util.assert(thisIndex>=0,"Unknown leaf type: "+thisLeafType),otherIndex===thisIndex?"object"===thisLeafType?0:this.value_<otherLeaf.value_?-1:this.value_===otherLeaf.value_?0:1:thisIndex-otherIndex},LeafNode2.prototype.withIndex=function(){return this},LeafNode2.prototype.isIndexed=function(){return!0},LeafNode2.prototype.equals=function(other){if(other===this)return!0;if(other.isLeafNode()){var otherLeaf=other;return this.value_===otherLeaf.value_&&this.priorityNode_.equals(otherLeaf.priorityNode_)}return!1},LeafNode2.VALUE_TYPE_ORDER=["object","boolean","number","string"],LeafNode2}();function setNodeFromJSON(val){nodeFromJSON$1=val}function setMaxNode(val){MAX_NODE$1=val}__name(setNodeFromJSON,"setNodeFromJSON"),__name(setMaxNode,"setMaxNode");var _defaultIndexMap,EMPTY_NODE,PRIORITY_INDEX=new(function(_super){function PriorityIndex2(){return null!==_super&&_super.apply(this,arguments)||this}return tslib.__extends(PriorityIndex2,_super),__name(PriorityIndex2,"PriorityIndex"),PriorityIndex2.prototype.compare=function(a,b){var aPriority=a.node.getPriority(),bPriority=b.node.getPriority(),indexCmp=aPriority.compareTo(bPriority);return 0===indexCmp?nameCompare(a.name,b.name):indexCmp},PriorityIndex2.prototype.isDefinedOn=function(node){return!node.getPriority().isEmpty()},PriorityIndex2.prototype.indexedValueChanged=function(oldNode,newNode){return!oldNode.getPriority().equals(newNode.getPriority())},PriorityIndex2.prototype.minPost=function(){return NamedNode.MIN},PriorityIndex2.prototype.maxPost=function(){return new NamedNode(MAX_NAME,new LeafNode("[PRIORITY-POST]",MAX_NODE$1))},PriorityIndex2.prototype.makePost=function(indexValue,name2){var priorityNode=nodeFromJSON$1(indexValue);return new NamedNode(name2,new LeafNode("[PRIORITY-POST]",priorityNode))},PriorityIndex2.prototype.toString=function(){return".priority"},PriorityIndex2}(Index)),LOG_2=Math.log(2),Base12Num=function(){function Base12Num2(length){var logBase2=__name(function(num){return parseInt(Math.log(num)/LOG_2,10)},"logBase2"),bitMask=__name(function(bits){return parseInt(Array(bits+1).join("1"),2)},"bitMask");this.count=logBase2(length+1),this.current_=this.count-1;var mask=bitMask(this.count);this.bits_=length+1&mask}return __name(Base12Num2,"Base12Num"),Base12Num2.prototype.nextBitIsOne=function(){var result=!(this.bits_&1<<this.current_);return this.current_--,result},Base12Num2}(),buildChildSet=__name(function(childList,cmp,keyFn,mapSortFn){childList.sort(cmp);var buildBalancedTree=__name(function(low,high){var namedNode,key,length=high-low;if(0===length)return null;if(1===length)return namedNode=childList[low],key=keyFn?keyFn(namedNode):namedNode,new LLRBNode(key,namedNode.node,LLRBNode.BLACK,null,null);var middle=parseInt(length/2,10)+low,left=buildBalancedTree(low,middle),right=buildBalancedTree(middle+1,high);return namedNode=childList[middle],key=keyFn?keyFn(namedNode):namedNode,new LLRBNode(key,namedNode.node,LLRBNode.BLACK,left,right)},"buildBalancedTree"),root=__name(function(base122){for(var node=null,root2=null,index=childList.length,buildPennant=__name(function(chunkSize2,color){var low=index-chunkSize2,high=index;index-=chunkSize2;var childTree=buildBalancedTree(low+1,high),namedNode=childList[low],key=keyFn?keyFn(namedNode):namedNode;attachPennant(new LLRBNode(key,namedNode.node,color,null,childTree))},"buildPennant"),attachPennant=__name(function(pennant){node?(node.left=pennant,node=pennant):(root2=pennant,node=pennant)},"attachPennant"),i=0;i<base122.count;++i){var isOne=base122.nextBitIsOne(),chunkSize=Math.pow(2,base122.count-(i+1));isOne?buildPennant(chunkSize,LLRBNode.BLACK):(buildPennant(chunkSize,LLRBNode.BLACK),buildPennant(chunkSize,LLRBNode.RED))}return root2},"buildFrom12Array")(new Base12Num(childList.length));return new SortedMap(mapSortFn||cmp,root)},"buildChildSet"),fallbackObject={},IndexMap=function(){function IndexMap2(indexes_,indexSet_){this.indexes_=indexes_,this.indexSet_=indexSet_}return __name(IndexMap2,"IndexMap"),Object.defineProperty(IndexMap2,"Default",{get:function(){return util.assert(fallbackObject&&PRIORITY_INDEX,"ChildrenNode.ts has not been loaded"),_defaultIndexMap=_defaultIndexMap||new IndexMap2({".priority":fallbackObject},{".priority":PRIORITY_INDEX})},enumerable:!1,configurable:!0}),IndexMap2.prototype.get=function(indexKey){var sortedMap=util.safeGet(this.indexes_,indexKey);if(!sortedMap)throw new Error("No index defined for "+indexKey);return sortedMap instanceof SortedMap?sortedMap:null},IndexMap2.prototype.hasIndex=function(indexDefinition){return util.contains(this.indexSet_,indexDefinition.toString())},IndexMap2.prototype.addIndex=function(indexDefinition,existingChildren){util.assert(indexDefinition!==KEY_INDEX,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var childList=[],sawIndexedValue=!1,iter=existingChildren.getIterator(NamedNode.Wrap),next=iter.getNext();next;)sawIndexedValue=sawIndexedValue||indexDefinition.isDefinedOn(next.node),childList.push(next),next=iter.getNext();var newIndex;newIndex=sawIndexedValue?buildChildSet(childList,indexDefinition.getCompare()):fallbackObject;var indexName=indexDefinition.toString(),newIndexSet=tslib.__assign({},this.indexSet_);newIndexSet[indexName]=indexDefinition;var newIndexes=tslib.__assign({},this.indexes_);return newIndexes[indexName]=newIndex,new IndexMap2(newIndexes,newIndexSet)},IndexMap2.prototype.addToIndexes=function(namedNode,existingChildren){var _this=this;return new IndexMap2(util.map(this.indexes_,function(indexedChildren,indexName){var index=util.safeGet(_this.indexSet_,indexName);if(util.assert(index,"Missing index implementation for "+indexName),indexedChildren===fallbackObject){if(index.isDefinedOn(namedNode.node)){for(var childList=[],iter=existingChildren.getIterator(NamedNode.Wrap),next=iter.getNext();next;)next.name!==namedNode.name&&childList.push(next),next=iter.getNext();return childList.push(namedNode),buildChildSet(childList,index.getCompare())}return fallbackObject}var existingSnap=existingChildren.get(namedNode.name),newChildren=indexedChildren;return existingSnap&&(newChildren=newChildren.remove(new NamedNode(namedNode.name,existingSnap))),newChildren.insert(namedNode,namedNode.node)}),this.indexSet_)},IndexMap2.prototype.removeFromIndexes=function(namedNode,existingChildren){return new IndexMap2(util.map(this.indexes_,function(indexedChildren){if(indexedChildren===fallbackObject)return indexedChildren;var existingSnap=existingChildren.get(namedNode.name);return existingSnap?indexedChildren.remove(new NamedNode(namedNode.name,existingSnap)):indexedChildren}),this.indexSet_)},IndexMap2}(),ChildrenNode=function(){function ChildrenNode2(children_,priorityNode_,indexMap_){this.children_=children_,this.priorityNode_=priorityNode_,this.indexMap_=indexMap_,this.lazyHash_=null,this.priorityNode_&&validatePriorityNode(this.priorityNode_),this.children_.isEmpty()&&util.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return __name(ChildrenNode2,"ChildrenNode"),Object.defineProperty(ChildrenNode2,"EMPTY_NODE",{get:function(){return EMPTY_NODE||(EMPTY_NODE=new ChildrenNode2(new SortedMap(NAME_COMPARATOR),null,IndexMap.Default))},enumerable:!1,configurable:!0}),ChildrenNode2.prototype.isLeafNode=function(){return!1},ChildrenNode2.prototype.getPriority=function(){return this.priorityNode_||EMPTY_NODE},ChildrenNode2.prototype.updatePriority=function(newPriorityNode){return this.children_.isEmpty()?this:new ChildrenNode2(this.children_,newPriorityNode,this.indexMap_)},ChildrenNode2.prototype.getImmediateChild=function(childName){if(".priority"===childName)return this.getPriority();var child2=this.children_.get(childName);return null===child2?EMPTY_NODE:child2},ChildrenNode2.prototype.getChild=function(path){var front=pathGetFront(path);return null===front?this:this.getImmediateChild(front).getChild(pathPopFront(path))},ChildrenNode2.prototype.hasChild=function(childName){return null!==this.children_.get(childName)},ChildrenNode2.prototype.updateImmediateChild=function(childName,newChildNode){if(util.assert(newChildNode,"We should always be passing snapshot nodes"),".priority"===childName)return this.updatePriority(newChildNode);var namedNode=new NamedNode(childName,newChildNode),newChildren=void 0,newIndexMap=void 0;newChildNode.isEmpty()?(newChildren=this.children_.remove(childName),newIndexMap=this.indexMap_.removeFromIndexes(namedNode,this.children_)):(newChildren=this.children_.insert(childName,newChildNode),newIndexMap=this.indexMap_.addToIndexes(namedNode,this.children_));var newPriority=newChildren.isEmpty()?EMPTY_NODE:this.priorityNode_;return new ChildrenNode2(newChildren,newPriority,newIndexMap)},ChildrenNode2.prototype.updateChild=function(path,newChildNode){var front=pathGetFront(path);if(null===front)return newChildNode;util.assert(".priority"!==pathGetFront(path)||1===pathGetLength(path),".priority must be the last token in a path");var newImmediateChild=this.getImmediateChild(front).updateChild(pathPopFront(path),newChildNode);return this.updateImmediateChild(front,newImmediateChild)},ChildrenNode2.prototype.isEmpty=function(){return this.children_.isEmpty()},ChildrenNode2.prototype.numChildren=function(){return this.children_.count()},ChildrenNode2.prototype.val=function(exportFormat){if(this.isEmpty())return null;var obj={},numKeys=0,maxKey=0,allIntegerKeys=!0;if(this.forEachChild(PRIORITY_INDEX,function(key2,childNode){obj[key2]=childNode.val(exportFormat),numKeys++,allIntegerKeys&&ChildrenNode2.INTEGER_REGEXP_.test(key2)?maxKey=Math.max(maxKey,Number(key2)):allIntegerKeys=!1}),!exportFormat&&allIntegerKeys&&maxKey<2*numKeys){var array=[];for(var key in obj)array[key]=obj[key];return array}return exportFormat&&!this.getPriority().isEmpty()&&(obj[".priority"]=this.getPriority().val()),obj},ChildrenNode2.prototype.hash=function(){if(null===this.lazyHash_){var toHash_1="";this.getPriority().isEmpty()||(toHash_1+="priority:"+priorityHashText(this.getPriority().val())+":"),this.forEachChild(PRIORITY_INDEX,function(key,childNode){var childHash=childNode.hash();""!==childHash&&(toHash_1+=":"+key+":"+childHash)}),this.lazyHash_=""===toHash_1?"":sha1(toHash_1)}return this.lazyHash_},ChildrenNode2.prototype.getPredecessorChildName=function(childName,childNode,index){var idx=this.resolveIndex_(index);if(idx){var predecessor2=idx.getPredecessorKey(new NamedNode(childName,childNode));return predecessor2?predecessor2.name:null}return this.children_.getPredecessorKey(childName)},ChildrenNode2.prototype.getFirstChildName=function(indexDefinition){var idx=this.resolveIndex_(indexDefinition);if(idx){var minKey=idx.minKey();return minKey&&minKey.name}return this.children_.minKey()},ChildrenNode2.prototype.getFirstChild=function(indexDefinition){var minKey=this.getFirstChildName(indexDefinition);return minKey?new NamedNode(minKey,this.children_.get(minKey)):null},ChildrenNode2.prototype.getLastChildName=function(indexDefinition){var idx=this.resolveIndex_(indexDefinition);if(idx){var maxKey=idx.maxKey();return maxKey&&maxKey.name}return this.children_.maxKey()},ChildrenNode2.prototype.getLastChild=function(indexDefinition){var maxKey=this.getLastChildName(indexDefinition);return maxKey?new NamedNode(maxKey,this.children_.get(maxKey)):null},ChildrenNode2.prototype.forEachChild=function(index,action){var idx=this.resolveIndex_(index);return idx?idx.inorderTraversal(function(wrappedNode){return action(wrappedNode.name,wrappedNode.node)}):this.children_.inorderTraversal(action)},ChildrenNode2.prototype.getIterator=function(indexDefinition){return this.getIteratorFrom(indexDefinition.minPost(),indexDefinition)},ChildrenNode2.prototype.getIteratorFrom=function(startPost,indexDefinition){var idx=this.resolveIndex_(indexDefinition);if(idx)return idx.getIteratorFrom(startPost,function(key){return key});for(var iterator=this.children_.getIteratorFrom(startPost.name,NamedNode.Wrap),next=iterator.peek();null!=next&&indexDefinition.compare(next,startPost)<0;)iterator.getNext(),next=iterator.peek();return iterator},ChildrenNode2.prototype.getReverseIterator=function(indexDefinition){return this.getReverseIteratorFrom(indexDefinition.maxPost(),indexDefinition)},ChildrenNode2.prototype.getReverseIteratorFrom=function(endPost,indexDefinition){var idx=this.resolveIndex_(indexDefinition);if(idx)return idx.getReverseIteratorFrom(endPost,function(key){return key});for(var iterator=this.children_.getReverseIteratorFrom(endPost.name,NamedNode.Wrap),next=iterator.peek();null!=next&&indexDefinition.compare(next,endPost)>0;)iterator.getNext(),next=iterator.peek();return iterator},ChildrenNode2.prototype.compareTo=function(other){return this.isEmpty()?other.isEmpty()?0:-1:other.isLeafNode()||other.isEmpty()?1:other===MAX_NODE?-1:0},ChildrenNode2.prototype.withIndex=function(indexDefinition){if(indexDefinition===KEY_INDEX||this.indexMap_.hasIndex(indexDefinition))return this;var newIndexMap=this.indexMap_.addIndex(indexDefinition,this.children_);return new ChildrenNode2(this.children_,this.priorityNode_,newIndexMap)},ChildrenNode2.prototype.isIndexed=function(index){return index===KEY_INDEX||this.indexMap_.hasIndex(index)},ChildrenNode2.prototype.equals=function(other){if(other===this)return!0;if(other.isLeafNode())return!1;var otherChildrenNode=other;if(this.getPriority().equals(otherChildrenNode.getPriority())){if(this.children_.count()===otherChildrenNode.children_.count()){for(var thisIter=this.getIterator(PRIORITY_INDEX),otherIter=otherChildrenNode.getIterator(PRIORITY_INDEX),thisCurrent=thisIter.getNext(),otherCurrent=otherIter.getNext();thisCurrent&&otherCurrent;){if(thisCurrent.name!==otherCurrent.name||!thisCurrent.node.equals(otherCurrent.node))return!1;thisCurrent=thisIter.getNext(),otherCurrent=otherIter.getNext()}return null===thisCurrent&&null===otherCurrent}return!1}return!1},ChildrenNode2.prototype.resolveIndex_=function(indexDefinition){return indexDefinition===KEY_INDEX?null:this.indexMap_.get(indexDefinition.toString())},ChildrenNode2.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,ChildrenNode2}(),MAX_NODE=new(function(_super){function MaxNode2(){return _super.call(this,new SortedMap(NAME_COMPARATOR),ChildrenNode.EMPTY_NODE,IndexMap.Default)||this}return tslib.__extends(MaxNode2,_super),__name(MaxNode2,"MaxNode"),MaxNode2.prototype.compareTo=function(other){return other===this?0:1},MaxNode2.prototype.equals=function(other){return other===this},MaxNode2.prototype.getPriority=function(){return this},MaxNode2.prototype.getImmediateChild=function(childName){return ChildrenNode.EMPTY_NODE},MaxNode2.prototype.isEmpty=function(){return!1},MaxNode2}(ChildrenNode));Object.defineProperties(NamedNode,{MIN:{value:new NamedNode(MIN_NAME,ChildrenNode.EMPTY_NODE)},MAX:{value:new NamedNode(MAX_NAME,MAX_NODE)}}),KeyIndex.__EMPTY_NODE=ChildrenNode.EMPTY_NODE,LeafNode.__childrenNodeConstructor=ChildrenNode,setMaxNode$1(MAX_NODE),setMaxNode(MAX_NODE);function nodeFromJSON(json,priority){if(void 0===priority&&(priority=null),null===json)return ChildrenNode.EMPTY_NODE;if("object"==typeof json&&".priority"in json&&(priority=json[".priority"]),util.assert(null===priority||"string"==typeof priority||"number"==typeof priority||"object"==typeof priority&&".sv"in priority,"Invalid priority type found: "+typeof priority),"object"==typeof json&&".value"in json&&null!==json[".value"]&&(json=json[".value"]),"object"!=typeof json||".sv"in json)return new LeafNode(json,nodeFromJSON(priority));if(json instanceof Array){var node_1=ChildrenNode.EMPTY_NODE;return each(json,function(key,childData){if(util.contains(json,key)&&"."!==key.substring(0,1)){var childNode=nodeFromJSON(childData);(childNode.isLeafNode()||!childNode.isEmpty())&&(node_1=node_1.updateImmediateChild(key,childNode))}}),node_1.updatePriority(nodeFromJSON(priority))}var children_1=[],childrenHavePriority_1=!1;if(each(json,function(key,child2){if("."!==key.substring(0,1)){var childNode=nodeFromJSON(child2);childNode.isEmpty()||(childrenHavePriority_1=childrenHavePriority_1||!childNode.getPriority().isEmpty(),children_1.push(new NamedNode(key,childNode)))}}),0===children_1.length)return ChildrenNode.EMPTY_NODE;var childSet=buildChildSet(children_1,NAME_ONLY_COMPARATOR,function(namedNode){return namedNode.name},NAME_COMPARATOR);if(childrenHavePriority_1){var sortedChildSet=buildChildSet(children_1,PRIORITY_INDEX.getCompare());return new ChildrenNode(childSet,nodeFromJSON(priority),new IndexMap({".priority":sortedChildSet},{".priority":PRIORITY_INDEX}))}return new ChildrenNode(childSet,nodeFromJSON(priority),IndexMap.Default)}__name(nodeFromJSON,"nodeFromJSON"),setNodeFromJSON(nodeFromJSON);var lastPushTime,lastRandChars,PathIndex=function(_super){function PathIndex2(indexPath_){var _this=_super.call(this)||this;return _this.indexPath_=indexPath_,util.assert(!pathIsEmpty(indexPath_)&&".priority"!==pathGetFront(indexPath_),"Can't create PathIndex with empty path or .priority key"),_this}return tslib.__extends(PathIndex2,_super),__name(PathIndex2,"PathIndex"),PathIndex2.prototype.extractChild=function(snap){return snap.getChild(this.indexPath_)},PathIndex2.prototype.isDefinedOn=function(node){return!node.getChild(this.indexPath_).isEmpty()},PathIndex2.prototype.compare=function(a,b){var aChild=this.extractChild(a.node),bChild=this.extractChild(b.node),indexCmp=aChild.compareTo(bChild);return 0===indexCmp?nameCompare(a.name,b.name):indexCmp},PathIndex2.prototype.makePost=function(indexValue,name2){var valueNode=nodeFromJSON(indexValue),node=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,valueNode);return new NamedNode(name2,node)},PathIndex2.prototype.maxPost=function(){var node=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,MAX_NODE);return new NamedNode(MAX_NAME,node)},PathIndex2.prototype.toString=function(){return pathSlice(this.indexPath_,0).join("/")},PathIndex2}(Index),VALUE_INDEX=new(function(_super){function ValueIndex2(){return null!==_super&&_super.apply(this,arguments)||this}return tslib.__extends(ValueIndex2,_super),__name(ValueIndex2,"ValueIndex"),ValueIndex2.prototype.compare=function(a,b){var indexCmp=a.node.compareTo(b.node);return 0===indexCmp?nameCompare(a.name,b.name):indexCmp},ValueIndex2.prototype.isDefinedOn=function(node){return!0},ValueIndex2.prototype.indexedValueChanged=function(oldNode,newNode){return!oldNode.equals(newNode)},ValueIndex2.prototype.minPost=function(){return NamedNode.MIN},ValueIndex2.prototype.maxPost=function(){return NamedNode.MAX},ValueIndex2.prototype.makePost=function(indexValue,name2){var valueNode=nodeFromJSON(indexValue);return new NamedNode(name2,valueNode)},ValueIndex2.prototype.toString=function(){return".value"},ValueIndex2}(Index)),PUSH_CHARS="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",nextPushId=(lastPushTime=0,lastRandChars=[],function(now){var duplicateTime=now===lastPushTime;lastPushTime=now;var i,timeStampChars=new Array(8);for(i=7;i>=0;i--)timeStampChars[i]=PUSH_CHARS.charAt(now%64),now=Math.floor(now/64);util.assert(0===now,"Cannot push at time == 0");var id=timeStampChars.join("");if(duplicateTime){for(i=11;i>=0&&63===lastRandChars[i];i--)lastRandChars[i]=0;lastRandChars[i]++}else for(i=0;i<12;i++)lastRandChars[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)id+=PUSH_CHARS.charAt(lastRandChars[i]);return util.assert(20===id.length,"nextPushId: Length should be 20."),id}),successor=__name(function(key){if("2147483647"===key)return"-";var keyAsInt=tryParseInt(key);if(null!=keyAsInt)return""+(keyAsInt+1);for(var next=new Array(key.length),i_1=0;i_1<next.length;i_1++)next[i_1]=key.charAt(i_1);if(next.length<786)return next.push("-"),next.join("");for(var i=next.length-1;i>=0&&"z"===next[i];)i--;if(-1===i)return MAX_NAME;var source=next[i],sourcePlusOne=PUSH_CHARS.charAt(PUSH_CHARS.indexOf(source)+1);return next[i]=sourcePlusOne,next.slice(0,i+1).join("")},"successor"),predecessor=__name(function(key){if("-2147483648"===key)return MIN_NAME;var keyAsInt=tryParseInt(key);if(null!=keyAsInt)return""+(keyAsInt-1);for(var next=new Array(key.length),i=0;i<next.length;i++)next[i]=key.charAt(i);return"-"===next[next.length-1]?1===next.length?"2147483647":(delete next[next.length-1],next.join("")):(next[next.length-1]=PUSH_CHARS.charAt(PUSH_CHARS.indexOf(next[next.length-1])-1),next.join("")+"z".repeat(786-next.length))},"predecessor");function changeValue(snapshotNode){return{type:"value",snapshotNode}}function changeChildAdded(childName,snapshotNode){return{type:"child_added",snapshotNode,childName}}function changeChildRemoved(childName,snapshotNode){return{type:"child_removed",snapshotNode,childName}}function changeChildChanged(childName,snapshotNode,oldSnap){return{type:"child_changed",snapshotNode,childName,oldSnap}}function changeChildMoved(childName,snapshotNode){return{type:"child_moved",snapshotNode,childName}}__name(changeValue,"changeValue"),__name(changeChildAdded,"changeChildAdded"),__name(changeChildRemoved,"changeChildRemoved"),__name(changeChildChanged,"changeChildChanged"),__name(changeChildMoved,"changeChildMoved");var IndexedFilter=function(){function IndexedFilter2(index_){this.index_=index_}return __name(IndexedFilter2,"IndexedFilter"),IndexedFilter2.prototype.updateChild=function(snap,key,newChild,affectedPath,source,optChangeAccumulator){util.assert(snap.isIndexed(this.index_),"A node must be indexed if only a child is updated");var oldChild=snap.getImmediateChild(key);return oldChild.getChild(affectedPath).equals(newChild.getChild(affectedPath))&&oldChild.isEmpty()===newChild.isEmpty()||(null!=optChangeAccumulator&&(newChild.isEmpty()?snap.hasChild(key)?optChangeAccumulator.trackChildChange(changeChildRemoved(key,oldChild)):util.assert(snap.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):oldChild.isEmpty()?optChangeAccumulator.trackChildChange(changeChildAdded(key,newChild)):optChangeAccumulator.trackChildChange(changeChildChanged(key,newChild,oldChild))),snap.isLeafNode()&&newChild.isEmpty())?snap:snap.updateImmediateChild(key,newChild).withIndex(this.index_)},IndexedFilter2.prototype.updateFullNode=function(oldSnap,newSnap,optChangeAccumulator){return null!=optChangeAccumulator&&(oldSnap.isLeafNode()||oldSnap.forEachChild(PRIORITY_INDEX,function(key,childNode){newSnap.hasChild(key)||optChangeAccumulator.trackChildChange(changeChildRemoved(key,childNode))}),newSnap.isLeafNode()||newSnap.forEachChild(PRIORITY_INDEX,function(key,childNode){if(oldSnap.hasChild(key)){var oldChild=oldSnap.getImmediateChild(key);oldChild.equals(childNode)||optChangeAccumulator.trackChildChange(changeChildChanged(key,childNode,oldChild))}else optChangeAccumulator.trackChildChange(changeChildAdded(key,childNode))})),newSnap.withIndex(this.index_)},IndexedFilter2.prototype.updatePriority=function(oldSnap,newPriority){return oldSnap.isEmpty()?ChildrenNode.EMPTY_NODE:oldSnap.updatePriority(newPriority)},IndexedFilter2.prototype.filtersNodes=function(){return!1},IndexedFilter2.prototype.getIndexedFilter=function(){return this},IndexedFilter2.prototype.getIndex=function(){return this.index_},IndexedFilter2}(),RangedFilter=function(){function RangedFilter2(params){this.indexedFilter_=new IndexedFilter(params.getIndex()),this.index_=params.getIndex(),this.startPost_=RangedFilter2.getStartPost_(params),this.endPost_=RangedFilter2.getEndPost_(params)}return __name(RangedFilter2,"RangedFilter"),RangedFilter2.prototype.getStartPost=function(){return this.startPost_},RangedFilter2.prototype.getEndPost=function(){return this.endPost_},RangedFilter2.prototype.matches=function(node){return this.index_.compare(this.getStartPost(),node)<=0&&this.index_.compare(node,this.getEndPost())<=0},RangedFilter2.prototype.updateChild=function(snap,key,newChild,affectedPath,source,optChangeAccumulator){return this.matches(new NamedNode(key,newChild))||(newChild=ChildrenNode.EMPTY_NODE),this.indexedFilter_.updateChild(snap,key,newChild,affectedPath,source,optChangeAccumulator)},RangedFilter2.prototype.updateFullNode=function(oldSnap,newSnap,optChangeAccumulator){newSnap.isLeafNode()&&(newSnap=ChildrenNode.EMPTY_NODE);var filtered=newSnap.withIndex(this.index_);filtered=filtered.updatePriority(ChildrenNode.EMPTY_NODE);var self2=this;return newSnap.forEachChild(PRIORITY_INDEX,function(key,childNode){self2.matches(new NamedNode(key,childNode))||(filtered=filtered.updateImmediateChild(key,ChildrenNode.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(oldSnap,filtered,optChangeAccumulator)},RangedFilter2.prototype.updatePriority=function(oldSnap,newPriority){return oldSnap},RangedFilter2.prototype.filtersNodes=function(){return!0},RangedFilter2.prototype.getIndexedFilter=function(){return this.indexedFilter_},RangedFilter2.prototype.getIndex=function(){return this.index_},RangedFilter2.getStartPost_=function(params){if(params.hasStart()){var startName=params.getIndexStartName();return params.getIndex().makePost(params.getIndexStartValue(),startName)}return params.getIndex().minPost()},RangedFilter2.getEndPost_=function(params){if(params.hasEnd()){var endName=params.getIndexEndName();return params.getIndex().makePost(params.getIndexEndValue(),endName)}return params.getIndex().maxPost()},RangedFilter2}(),LimitedFilter=function(){function LimitedFilter2(params){this.rangedFilter_=new RangedFilter(params),this.index_=params.getIndex(),this.limit_=params.getLimit(),this.reverse_=!params.isViewFromLeft()}return __name(LimitedFilter2,"LimitedFilter"),LimitedFilter2.prototype.updateChild=function(snap,key,newChild,affectedPath,source,optChangeAccumulator){return this.rangedFilter_.matches(new NamedNode(key,newChild))||(newChild=ChildrenNode.EMPTY_NODE),snap.getImmediateChild(key).equals(newChild)?snap:snap.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(snap,key,newChild,affectedPath,source,optChangeAccumulator):this.fullLimitUpdateChild_(snap,key,newChild,source,optChangeAccumulator)},LimitedFilter2.prototype.updateFullNode=function(oldSnap,newSnap,optChangeAccumulator){var filtered;if(newSnap.isLeafNode()||newSnap.isEmpty())filtered=ChildrenNode.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<newSnap.numChildren()&&newSnap.isIndexed(this.index_)){filtered=ChildrenNode.EMPTY_NODE.withIndex(this.index_);var iterator=void 0;iterator=this.reverse_?newSnap.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):newSnap.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var count=0;iterator.hasNext()&&count<this.limit_;){var next=iterator.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),next)<=0:this.index_.compare(next,this.rangedFilter_.getEndPost())<=0))break;filtered=filtered.updateImmediateChild(next.name,next.node),count++}}else{filtered=(filtered=newSnap.withIndex(this.index_)).updatePriority(ChildrenNode.EMPTY_NODE);var startPost=void 0,endPost=void 0,cmp=void 0;iterator=void 0;if(this.reverse_){iterator=filtered.getReverseIterator(this.index_),startPost=this.rangedFilter_.getEndPost(),endPost=this.rangedFilter_.getStartPost();var indexCompare_1=this.index_.getCompare();cmp=__name(function(a,b){return indexCompare_1(b,a)},"cmp")}else iterator=filtered.getIterator(this.index_),startPost=this.rangedFilter_.getStartPost(),endPost=this.rangedFilter_.getEndPost(),cmp=this.index_.getCompare();count=0;for(var foundStartPost=!1;iterator.hasNext();){next=iterator.getNext();!foundStartPost&&cmp(startPost,next)<=0&&(foundStartPost=!0),foundStartPost&&count<this.limit_&&cmp(next,endPost)<=0?count++:filtered=filtered.updateImmediateChild(next.name,ChildrenNode.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(oldSnap,filtered,optChangeAccumulator)},LimitedFilter2.prototype.updatePriority=function(oldSnap,newPriority){return oldSnap},LimitedFilter2.prototype.filtersNodes=function(){return!0},LimitedFilter2.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},LimitedFilter2.prototype.getIndex=function(){return this.index_},LimitedFilter2.prototype.fullLimitUpdateChild_=function(snap,childKey,childSnap,source,changeAccumulator){var cmp;if(this.reverse_){var indexCmp_1=this.index_.getCompare();cmp=__name(function(a,b){return indexCmp_1(b,a)},"cmp")}else cmp=this.index_.getCompare();var oldEventCache=snap;util.assert(oldEventCache.numChildren()===this.limit_,"");var newChildNamedNode=new NamedNode(childKey,childSnap),windowBoundary=this.reverse_?oldEventCache.getFirstChild(this.index_):oldEventCache.getLastChild(this.index_),inRange=this.rangedFilter_.matches(newChildNamedNode);if(oldEventCache.hasChild(childKey)){for(var oldChildSnap=oldEventCache.getImmediateChild(childKey),nextChild=source.getChildAfterChild(this.index_,windowBoundary,this.reverse_);null!=nextChild&&(nextChild.name===childKey||oldEventCache.hasChild(nextChild.name));)nextChild=source.getChildAfterChild(this.index_,nextChild,this.reverse_);var compareNext=null==nextChild?1:cmp(nextChild,newChildNamedNode);if(inRange&&!childSnap.isEmpty()&&compareNext>=0)return null!=changeAccumulator&&changeAccumulator.trackChildChange(changeChildChanged(childKey,childSnap,oldChildSnap)),oldEventCache.updateImmediateChild(childKey,childSnap);null!=changeAccumulator&&changeAccumulator.trackChildChange(changeChildRemoved(childKey,oldChildSnap));var newEventCache=oldEventCache.updateImmediateChild(childKey,ChildrenNode.EMPTY_NODE);return null!=nextChild&&this.rangedFilter_.matches(nextChild)?(null!=changeAccumulator&&changeAccumulator.trackChildChange(changeChildAdded(nextChild.name,nextChild.node)),newEventCache.updateImmediateChild(nextChild.name,nextChild.node)):newEventCache}return childSnap.isEmpty()?snap:inRange&&cmp(windowBoundary,newChildNamedNode)>=0?(null!=changeAccumulator&&(changeAccumulator.trackChildChange(changeChildRemoved(windowBoundary.name,windowBoundary.node)),changeAccumulator.trackChildChange(changeChildAdded(childKey,childSnap))),oldEventCache.updateImmediateChild(childKey,childSnap).updateImmediateChild(windowBoundary.name,ChildrenNode.EMPTY_NODE)):snap},LimitedFilter2}(),QueryParams=function(){function QueryParams2(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=PRIORITY_INDEX}return __name(QueryParams2,"QueryParams"),QueryParams2.prototype.hasStart=function(){return this.startSet_},QueryParams2.prototype.hasStartAfter=function(){return this.startAfterSet_},QueryParams2.prototype.hasEndBefore=function(){return this.endBeforeSet_},QueryParams2.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},QueryParams2.prototype.getIndexStartValue=function(){return util.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},QueryParams2.prototype.getIndexStartName=function(){return util.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:MIN_NAME},QueryParams2.prototype.hasEnd=function(){return this.endSet_},QueryParams2.prototype.getIndexEndValue=function(){return util.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},QueryParams2.prototype.getIndexEndName=function(){return util.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:MAX_NAME},QueryParams2.prototype.hasLimit=function(){return this.limitSet_},QueryParams2.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},QueryParams2.prototype.getLimit=function(){return util.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},QueryParams2.prototype.getIndex=function(){return this.index_},QueryParams2.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},QueryParams2.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===PRIORITY_INDEX},QueryParams2.prototype.copy=function(){var copy=new QueryParams2;return copy.limitSet_=this.limitSet_,copy.limit_=this.limit_,copy.startSet_=this.startSet_,copy.indexStartValue_=this.indexStartValue_,copy.startNameSet_=this.startNameSet_,copy.indexStartName_=this.indexStartName_,copy.endSet_=this.endSet_,copy.indexEndValue_=this.indexEndValue_,copy.endNameSet_=this.endNameSet_,copy.indexEndName_=this.indexEndName_,copy.index_=this.index_,copy.viewFrom_=this.viewFrom_,copy},QueryParams2}();function queryParamsGetNodeFilter(queryParams){return queryParams.loadsAllData()?new IndexedFilter(queryParams.getIndex()):queryParams.hasLimit()?new LimitedFilter(queryParams):new RangedFilter(queryParams)}function queryParamsLimitToFirst(queryParams,newLimit){var newParams=queryParams.copy();return newParams.limitSet_=!0,newParams.limit_=newLimit,newParams.viewFrom_="l",newParams}function queryParamsLimitToLast(queryParams,newLimit){var newParams=queryParams.copy();return newParams.limitSet_=!0,newParams.limit_=newLimit,newParams.viewFrom_="r",newParams}function queryParamsStartAt(queryParams,indexValue,key){var newParams=queryParams.copy();return newParams.startSet_=!0,void 0===indexValue&&(indexValue=null),newParams.indexStartValue_=indexValue,null!=key?(newParams.startNameSet_=!0,newParams.indexStartName_=key):(newParams.startNameSet_=!1,newParams.indexStartName_=""),newParams}function queryParamsStartAfter(queryParams,indexValue,key){var params;if(queryParams.index_===KEY_INDEX)"string"==typeof indexValue&&(indexValue=successor(indexValue)),params=queryParamsStartAt(queryParams,indexValue,key);else{params=queryParamsStartAt(queryParams,indexValue,null==key?MAX_NAME:successor(key))}return params.startAfterSet_=!0,params}function queryParamsEndAt(queryParams,indexValue,key){var newParams=queryParams.copy();return newParams.endSet_=!0,void 0===indexValue&&(indexValue=null),newParams.indexEndValue_=indexValue,void 0!==key?(newParams.endNameSet_=!0,newParams.indexEndName_=key):(newParams.endNameSet_=!1,newParams.indexEndName_=""),newParams}function queryParamsEndBefore(queryParams,indexValue,key){var params;return queryParams.index_===KEY_INDEX?("string"==typeof indexValue&&(indexValue=predecessor(indexValue)),params=queryParamsEndAt(queryParams,indexValue,key)):params=queryParamsEndAt(queryParams,indexValue,null==key?MIN_NAME:predecessor(key)),params.endBeforeSet_=!0,params}function queryParamsOrderBy(queryParams,index){var newParams=queryParams.copy();return newParams.index_=index,newParams}function queryParamsToRestQueryStringParameters(queryParams){var orderBy,qs={};return queryParams.isDefault()||(queryParams.index_===PRIORITY_INDEX?orderBy="$priority":queryParams.index_===VALUE_INDEX?orderBy="$value":queryParams.index_===KEY_INDEX?orderBy="$key":(util.assert(queryParams.index_ instanceof PathIndex,"Unrecognized index type!"),orderBy=queryParams.index_.toString()),qs.orderBy=util.stringify(orderBy),queryParams.startSet_&&(qs.startAt=util.stringify(queryParams.indexStartValue_),queryParams.startNameSet_&&(qs.startAt+=","+util.stringify(queryParams.indexStartName_))),queryParams.endSet_&&(qs.endAt=util.stringify(queryParams.indexEndValue_),queryParams.endNameSet_&&(qs.endAt+=","+util.stringify(queryParams.indexEndName_))),queryParams.limitSet_&&(queryParams.isViewFromLeft()?qs.limitToFirst=queryParams.limit_:qs.limitToLast=queryParams.limit_)),qs}function queryParamsGetQueryObject(queryParams){var obj={};if(queryParams.startSet_&&(obj.sp=queryParams.indexStartValue_,queryParams.startNameSet_&&(obj.sn=queryParams.indexStartName_)),queryParams.endSet_&&(obj.ep=queryParams.indexEndValue_,queryParams.endNameSet_&&(obj.en=queryParams.indexEndName_)),queryParams.limitSet_){obj.l=queryParams.limit_;var viewFrom=queryParams.viewFrom_;""===viewFrom&&(viewFrom=queryParams.isViewFromLeft()?"l":"r"),obj.vf=viewFrom}return queryParams.index_!==PRIORITY_INDEX&&(obj.i=queryParams.index_.toString()),obj}__name(queryParamsGetNodeFilter,"queryParamsGetNodeFilter"),__name(queryParamsLimitToFirst,"queryParamsLimitToFirst"),__name(queryParamsLimitToLast,"queryParamsLimitToLast"),__name(queryParamsStartAt,"queryParamsStartAt"),__name(queryParamsStartAfter,"queryParamsStartAfter"),__name(queryParamsEndAt,"queryParamsEndAt"),__name(queryParamsEndBefore,"queryParamsEndBefore"),__name(queryParamsOrderBy,"queryParamsOrderBy"),__name(queryParamsToRestQueryStringParameters,"queryParamsToRestQueryStringParameters"),__name(queryParamsGetQueryObject,"queryParamsGetQueryObject");var ReadonlyRestClient=function(_super){function ReadonlyRestClient2(repoInfo_,onDataUpdate_,authTokenProvider_,appCheckTokenProvider_){var _this=_super.call(this)||this;return _this.repoInfo_=repoInfo_,_this.onDataUpdate_=onDataUpdate_,_this.authTokenProvider_=authTokenProvider_,_this.appCheckTokenProvider_=appCheckTokenProvider_,_this.log_=logWrapper("p:rest:"),_this.listens_={},_this}return tslib.__extends(ReadonlyRestClient2,_super),__name(ReadonlyRestClient2,"ReadonlyRestClient"),ReadonlyRestClient2.prototype.reportStats=function(stats2){throw new Error("Method not implemented.")},ReadonlyRestClient2.getListenId_=function(query2,tag){return void 0!==tag?"tag$"+tag:(util.assert(query2._queryParams.isDefault(),"should have a tag if it's not a default query."),query2._path.toString())},ReadonlyRestClient2.prototype.listen=function(query2,currentHashFn,tag,onComplete){var _this=this,pathString=query2._path.toString();this.log_("Listen called for "+pathString+" "+query2._queryIdentifier);var listenId=ReadonlyRestClient2.getListenId_(query2,tag),thisListen={};this.listens_[listenId]=thisListen;var queryStringParameters=queryParamsToRestQueryStringParameters(query2._queryParams);this.restRequest_(pathString+".json",queryStringParameters,function(error2,result){var data=result;(404===error2&&(data=null,error2=null),null===error2&&_this.onDataUpdate_(pathString,data,!1,tag),util.safeGet(_this.listens_,listenId)===thisListen)&&onComplete(error2?401===error2?"permission_denied":"rest_error:"+error2:"ok",null)})},ReadonlyRestClient2.prototype.unlisten=function(query2,tag){var listenId=ReadonlyRestClient2.getListenId_(query2,tag);delete this.listens_[listenId]},ReadonlyRestClient2.prototype.get=function(query2){var _this=this,queryStringParameters=queryParamsToRestQueryStringParameters(query2._queryParams),pathString=query2._path.toString(),deferred=new util.Deferred;return this.restRequest_(pathString+".json",queryStringParameters,function(error2,result){var data=result;404===error2&&(data=null,error2=null),null===error2?(_this.onDataUpdate_(pathString,data,!1,null),deferred.resolve(data)):deferred.reject(new Error(data))}),deferred.promise},ReadonlyRestClient2.prototype.refreshAuthToken=function(token){},ReadonlyRestClient2.prototype.restRequest_=function(pathString,queryStringParameters,callback){var _this=this;return void 0===queryStringParameters&&(queryStringParameters={}),queryStringParameters.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(function(_a){var _b=tslib.__read(_a,2),authToken=_b[0],appCheckToken=_b[1];authToken&&authToken.accessToken&&(queryStringParameters.auth=authToken.accessToken),appCheckToken&&appCheckToken.token&&(queryStringParameters.ac=appCheckToken.token);var url=(_this.repoInfo_.secure?"https://":"http://")+_this.repoInfo_.host+pathString+"?ns="+_this.repoInfo_.namespace+util.querystring(queryStringParameters);_this.log_("Sending REST request for "+url);var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(callback&&4===xhr.readyState){_this.log_("REST Response for "+url+" received. status:",xhr.status,"response:",xhr.responseText);var res=null;if(xhr.status>=200&&xhr.status<300){try{res=util.jsonEval(xhr.responseText)}catch(e){warn("Failed to parse JSON response for "+url+": "+xhr.responseText)}callback(null,res)}else 401!==xhr.status&&404!==xhr.status&&warn("Got unsuccessful REST response for "+url+" Status: "+xhr.status),callback(xhr.status);callback=null}},xhr.open("GET",url,!0),xhr.send()})},ReadonlyRestClient2}(ServerActions),SnapshotHolder=function(){function SnapshotHolder2(){this.rootNode_=ChildrenNode.EMPTY_NODE}return __name(SnapshotHolder2,"SnapshotHolder"),SnapshotHolder2.prototype.getNode=function(path){return this.rootNode_.getChild(path)},SnapshotHolder2.prototype.updateSnapshot=function(path,newSnapshotNode){this.rootNode_=this.rootNode_.updateChild(path,newSnapshotNode)},SnapshotHolder2}();function newSparseSnapshotTree(){return{value:null,children:new Map}}function sparseSnapshotTreeRemember(sparseSnapshotTree,path,data){if(pathIsEmpty(path))sparseSnapshotTree.value=data,sparseSnapshotTree.children.clear();else if(null!==sparseSnapshotTree.value)sparseSnapshotTree.value=sparseSnapshotTree.value.updateChild(path,data);else{var childKey=pathGetFront(path);sparseSnapshotTree.children.has(childKey)||sparseSnapshotTree.children.set(childKey,newSparseSnapshotTree()),sparseSnapshotTreeRemember(sparseSnapshotTree.children.get(childKey),path=pathPopFront(path),data)}}function sparseSnapshotTreeForget(sparseSnapshotTree,path){if(pathIsEmpty(path))return sparseSnapshotTree.value=null,sparseSnapshotTree.children.clear(),!0;if(null!==sparseSnapshotTree.value){if(sparseSnapshotTree.value.isLeafNode())return!1;var value=sparseSnapshotTree.value;return sparseSnapshotTree.value=null,value.forEachChild(PRIORITY_INDEX,function(key,tree){sparseSnapshotTreeRemember(sparseSnapshotTree,new Path(key),tree)}),sparseSnapshotTreeForget(sparseSnapshotTree,path)}if(sparseSnapshotTree.children.size>0){var childKey=pathGetFront(path);if(path=pathPopFront(path),sparseSnapshotTree.children.has(childKey))sparseSnapshotTreeForget(sparseSnapshotTree.children.get(childKey),path)&&sparseSnapshotTree.children.delete(childKey);return 0===sparseSnapshotTree.children.size}return!0}function sparseSnapshotTreeForEachTree(sparseSnapshotTree,prefixPath,func){null!==sparseSnapshotTree.value?func(prefixPath,sparseSnapshotTree.value):sparseSnapshotTreeForEachChild(sparseSnapshotTree,function(key,tree){sparseSnapshotTreeForEachTree(tree,new Path(prefixPath.toString()+"/"+key),func)})}function sparseSnapshotTreeForEachChild(sparseSnapshotTree,func){sparseSnapshotTree.children.forEach(function(tree,key){func(key,tree)})}__name(newSparseSnapshotTree,"newSparseSnapshotTree"),__name(sparseSnapshotTreeRemember,"sparseSnapshotTreeRemember"),__name(sparseSnapshotTreeForget,"sparseSnapshotTreeForget"),__name(sparseSnapshotTreeForEachTree,"sparseSnapshotTreeForEachTree"),__name(sparseSnapshotTreeForEachChild,"sparseSnapshotTreeForEachChild");var OperationType,OperationType2,StatsListener=function(){function StatsListener2(collection_){this.collection_=collection_,this.last_=null}return __name(StatsListener2,"StatsListener"),StatsListener2.prototype.get=function(){var newStats=this.collection_.get(),delta=tslib.__assign({},newStats);return this.last_&&each(this.last_,function(stat,value){delta[stat]=delta[stat]-value}),this.last_=newStats,delta},StatsListener2}(),StatsReporter=function(){function StatsReporter2(collection,server_){this.server_=server_,this.statsToReport_={},this.statsListener_=new StatsListener(collection);var timeout=1e4+2e4*Math.random();setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(timeout))}return __name(StatsReporter2,"StatsReporter"),StatsReporter2.prototype.reportStats_=function(){var _this=this,stats2=this.statsListener_.get(),reportedStats={},haveStatsToReport=!1;each(stats2,function(stat,value){value>0&&util.contains(_this.statsToReport_,stat)&&(reportedStats[stat]=value,haveStatsToReport=!0)}),haveStatsToReport&&this.server_.reportStats(reportedStats),setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},StatsReporter2}();function statsReporterIncludeStat(reporter,stat){reporter.statsToReport_[stat]=!0}function newOperationSourceUser(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function newOperationSourceServer(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function newOperationSourceServerTaggedQuery(queryId){return{fromUser:!1,fromServer:!0,queryId,tagged:!0}}__name(statsReporterIncludeStat,"statsReporterIncludeStat"),(OperationType2=OperationType||(OperationType={}))[OperationType2.OVERWRITE=0]="OVERWRITE",OperationType2[OperationType2.MERGE=1]="MERGE",OperationType2[OperationType2.ACK_USER_WRITE=2]="ACK_USER_WRITE",OperationType2[OperationType2.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",__name(newOperationSourceUser,"newOperationSourceUser"),__name(newOperationSourceServer,"newOperationSourceServer"),__name(newOperationSourceServerTaggedQuery,"newOperationSourceServerTaggedQuery");var AckUserWrite=function(){function AckUserWrite2(path,affectedTree,revert){this.path=path,this.affectedTree=affectedTree,this.revert=revert,this.type=OperationType.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}return __name(AckUserWrite2,"AckUserWrite"),AckUserWrite2.prototype.operationForChild=function(childName){if(pathIsEmpty(this.path)){if(null!=this.affectedTree.value)return util.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var childTree=this.affectedTree.subtree(new Path(childName));return new AckUserWrite2(newEmptyPath(),childTree,this.revert)}return util.assert(pathGetFront(this.path)===childName,"operationForChild called for unrelated child."),new AckUserWrite2(pathPopFront(this.path),this.affectedTree,this.revert)},AckUserWrite2}(),ListenComplete=function(){function ListenComplete2(source,path){this.source=source,this.path=path,this.type=OperationType.LISTEN_COMPLETE}return __name(ListenComplete2,"ListenComplete"),ListenComplete2.prototype.operationForChild=function(childName){return pathIsEmpty(this.path)?new ListenComplete2(this.source,newEmptyPath()):new ListenComplete2(this.source,pathPopFront(this.path))},ListenComplete2}(),Overwrite=function(){function Overwrite2(source,path,snap){this.source=source,this.path=path,this.snap=snap,this.type=OperationType.OVERWRITE}return __name(Overwrite2,"Overwrite"),Overwrite2.prototype.operationForChild=function(childName){return pathIsEmpty(this.path)?new Overwrite2(this.source,newEmptyPath(),this.snap.getImmediateChild(childName)):new Overwrite2(this.source,pathPopFront(this.path),this.snap)},Overwrite2}(),Merge=function(){function Merge2(source,path,children){this.source=source,this.path=path,this.children=children,this.type=OperationType.MERGE}return __name(Merge2,"Merge"),Merge2.prototype.operationForChild=function(childName){if(pathIsEmpty(this.path)){var childTree=this.children.subtree(new Path(childName));return childTree.isEmpty()?null:childTree.value?new Overwrite(this.source,newEmptyPath(),childTree.value):new Merge2(this.source,newEmptyPath(),childTree)}return util.assert(pathGetFront(this.path)===childName,"Can't get a merge for a child not on the path of the operation"),new Merge2(this.source,pathPopFront(this.path),this.children)},Merge2.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},Merge2}(),CacheNode=function(){function CacheNode2(node_,fullyInitialized_,filtered_){this.node_=node_,this.fullyInitialized_=fullyInitialized_,this.filtered_=filtered_}return __name(CacheNode2,"CacheNode"),CacheNode2.prototype.isFullyInitialized=function(){return this.fullyInitialized_},CacheNode2.prototype.isFiltered=function(){return this.filtered_},CacheNode2.prototype.isCompleteForPath=function(path){if(pathIsEmpty(path))return this.isFullyInitialized()&&!this.filtered_;var childKey=pathGetFront(path);return this.isCompleteForChild(childKey)},CacheNode2.prototype.isCompleteForChild=function(key){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(key)},CacheNode2.prototype.getNode=function(){return this.node_},CacheNode2}(),EventGenerator=function(){function EventGenerator2(query_){this.query_=query_,this.index_=this.query_._queryParams.getIndex()}return __name(EventGenerator2,"EventGenerator"),EventGenerator2}();function eventGeneratorGenerateEventsForChanges(eventGenerator,changes,eventCache,eventRegistrations){var events=[],moves=[];return changes.forEach(function(change){"child_changed"===change.type&&eventGenerator.index_.indexedValueChanged(change.oldSnap,change.snapshotNode)&&moves.push(changeChildMoved(change.childName,change.snapshotNode))}),eventGeneratorGenerateEventsForType(eventGenerator,events,"child_removed",changes,eventRegistrations,eventCache),eventGeneratorGenerateEventsForType(eventGenerator,events,"child_added",changes,eventRegistrations,eventCache),eventGeneratorGenerateEventsForType(eventGenerator,events,"child_moved",moves,eventRegistrations,eventCache),eventGeneratorGenerateEventsForType(eventGenerator,events,"child_changed",changes,eventRegistrations,eventCache),eventGeneratorGenerateEventsForType(eventGenerator,events,"value",changes,eventRegistrations,eventCache),events}function eventGeneratorGenerateEventsForType(eventGenerator,events,eventType,changes,registrations,eventCache){var filteredChanges=changes.filter(function(change){return change.type===eventType});filteredChanges.sort(function(a,b){return eventGeneratorCompareChanges(eventGenerator,a,b)}),filteredChanges.forEach(function(change){var materializedChange=eventGeneratorMaterializeSingleChange(eventGenerator,change,eventCache);registrations.forEach(function(registration){registration.respondsTo(change.type)&&events.push(registration.createEvent(materializedChange,eventGenerator.query_))})})}function eventGeneratorMaterializeSingleChange(eventGenerator,change,eventCache){return"value"===change.type||"child_removed"===change.type||(change.prevName=eventCache.getPredecessorChildName(change.childName,change.snapshotNode,eventGenerator.index_)),change}function eventGeneratorCompareChanges(eventGenerator,a,b){if(null==a.childName||null==b.childName)throw util.assertionError("Should only compare child_ events.");var aWrapped=new NamedNode(a.childName,a.snapshotNode),bWrapped=new NamedNode(b.childName,b.snapshotNode);return eventGenerator.index_.compare(aWrapped,bWrapped)}function newViewCache(eventCache,serverCache){return{eventCache,serverCache}}function viewCacheUpdateEventSnap(viewCache,eventSnap,complete,filtered){return newViewCache(new CacheNode(eventSnap,complete,filtered),viewCache.serverCache)}function viewCacheUpdateServerSnap(viewCache,serverSnap,complete,filtered){return newViewCache(viewCache.eventCache,new CacheNode(serverSnap,complete,filtered))}function viewCacheGetCompleteEventSnap(viewCache){return viewCache.eventCache.isFullyInitialized()?viewCache.eventCache.getNode():null}function viewCacheGetCompleteServerSnap(viewCache){return viewCache.serverCache.isFullyInitialized()?viewCache.serverCache.getNode():null}__name(eventGeneratorGenerateEventsForChanges,"eventGeneratorGenerateEventsForChanges"),__name(eventGeneratorGenerateEventsForType,"eventGeneratorGenerateEventsForType"),__name(eventGeneratorMaterializeSingleChange,"eventGeneratorMaterializeSingleChange"),__name(eventGeneratorCompareChanges,"eventGeneratorCompareChanges"),__name(newViewCache,"newViewCache"),__name(viewCacheUpdateEventSnap,"viewCacheUpdateEventSnap"),__name(viewCacheUpdateServerSnap,"viewCacheUpdateServerSnap"),__name(viewCacheGetCompleteEventSnap,"viewCacheGetCompleteEventSnap"),__name(viewCacheGetCompleteServerSnap,"viewCacheGetCompleteServerSnap");var emptyChildrenSingleton,EmptyChildren=__name(function(){return emptyChildrenSingleton||(emptyChildrenSingleton=new SortedMap(stringCompare)),emptyChildrenSingleton},"EmptyChildren"),ImmutableTree=function(){function ImmutableTree2(value,children){void 0===children&&(children=EmptyChildren()),this.value=value,this.children=children}return __name(ImmutableTree2,"ImmutableTree"),ImmutableTree2.fromObject=function(obj){var tree=new ImmutableTree2(null);return each(obj,function(childPath,childSnap){tree=tree.set(new Path(childPath),childSnap)}),tree},ImmutableTree2.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},ImmutableTree2.prototype.findRootMostMatchingPathAndValue=function(relativePath,predicate){if(null!=this.value&&predicate(this.value))return{path:newEmptyPath(),value:this.value};if(pathIsEmpty(relativePath))return null;var front=pathGetFront(relativePath),child2=this.children.get(front);if(null!==child2){var childExistingPathAndValue=child2.findRootMostMatchingPathAndValue(pathPopFront(relativePath),predicate);return null!=childExistingPathAndValue?{path:pathChild(new Path(front),childExistingPathAndValue.path),value:childExistingPathAndValue.value}:null}return null},ImmutableTree2.prototype.findRootMostValueAndPath=function(relativePath){return this.findRootMostMatchingPathAndValue(relativePath,function(){return!0})},ImmutableTree2.prototype.subtree=function(relativePath){if(pathIsEmpty(relativePath))return this;var front=pathGetFront(relativePath),childTree=this.children.get(front);return null!==childTree?childTree.subtree(pathPopFront(relativePath)):new ImmutableTree2(null)},ImmutableTree2.prototype.set=function(relativePath,toSet){if(pathIsEmpty(relativePath))return new ImmutableTree2(toSet,this.children);var front=pathGetFront(relativePath),newChild=(this.children.get(front)||new ImmutableTree2(null)).set(pathPopFront(relativePath),toSet),newChildren=this.children.insert(front,newChild);return new ImmutableTree2(this.value,newChildren)},ImmutableTree2.prototype.remove=function(relativePath){if(pathIsEmpty(relativePath))return this.children.isEmpty()?new ImmutableTree2(null):new ImmutableTree2(null,this.children);var front=pathGetFront(relativePath),child2=this.children.get(front);if(child2){var newChild=child2.remove(pathPopFront(relativePath)),newChildren=void 0;return newChildren=newChild.isEmpty()?this.children.remove(front):this.children.insert(front,newChild),null===this.value&&newChildren.isEmpty()?new ImmutableTree2(null):new ImmutableTree2(this.value,newChildren)}return this},ImmutableTree2.prototype.get=function(relativePath){if(pathIsEmpty(relativePath))return this.value;var front=pathGetFront(relativePath),child2=this.children.get(front);return child2?child2.get(pathPopFront(relativePath)):null},ImmutableTree2.prototype.setTree=function(relativePath,newTree){if(pathIsEmpty(relativePath))return newTree;var front=pathGetFront(relativePath),newChild=(this.children.get(front)||new ImmutableTree2(null)).setTree(pathPopFront(relativePath),newTree),newChildren=void 0;return newChildren=newChild.isEmpty()?this.children.remove(front):this.children.insert(front,newChild),new ImmutableTree2(this.value,newChildren)},ImmutableTree2.prototype.fold=function(fn){return this.fold_(newEmptyPath(),fn)},ImmutableTree2.prototype.fold_=function(pathSoFar,fn){var accum={};return this.children.inorderTraversal(function(childKey,childTree){accum[childKey]=childTree.fold_(pathChild(pathSoFar,childKey),fn)}),fn(pathSoFar,this.value,accum)},ImmutableTree2.prototype.findOnPath=function(path,f){return this.findOnPath_(path,newEmptyPath(),f)},ImmutableTree2.prototype.findOnPath_=function(pathToFollow,pathSoFar,f){var result=!!this.value&&f(pathSoFar,this.value);if(result)return result;if(pathIsEmpty(pathToFollow))return null;var front=pathGetFront(pathToFollow),nextChild=this.children.get(front);return nextChild?nextChild.findOnPath_(pathPopFront(pathToFollow),pathChild(pathSoFar,front),f):null},ImmutableTree2.prototype.foreachOnPath=function(path,f){return this.foreachOnPath_(path,newEmptyPath(),f)},ImmutableTree2.prototype.foreachOnPath_=function(pathToFollow,currentRelativePath,f){if(pathIsEmpty(pathToFollow))return this;this.value&&f(currentRelativePath,this.value);var front=pathGetFront(pathToFollow),nextChild=this.children.get(front);return nextChild?nextChild.foreachOnPath_(pathPopFront(pathToFollow),pathChild(currentRelativePath,front),f):new ImmutableTree2(null)},ImmutableTree2.prototype.foreach=function(f){this.foreach_(newEmptyPath(),f)},ImmutableTree2.prototype.foreach_=function(currentRelativePath,f){this.children.inorderTraversal(function(childName,childTree){childTree.foreach_(pathChild(currentRelativePath,childName),f)}),this.value&&f(currentRelativePath,this.value)},ImmutableTree2.prototype.foreachChild=function(f){this.children.inorderTraversal(function(childName,childTree){childTree.value&&f(childName,childTree.value)})},ImmutableTree2}(),CompoundWrite=function(){function CompoundWrite2(writeTree_){this.writeTree_=writeTree_}return __name(CompoundWrite2,"CompoundWrite"),CompoundWrite2.empty=function(){return new CompoundWrite2(new ImmutableTree(null))},CompoundWrite2}();function compoundWriteAddWrite(compoundWrite,path,node){if(pathIsEmpty(path))return new CompoundWrite(new ImmutableTree(node));var rootmost=compoundWrite.writeTree_.findRootMostValueAndPath(path);if(null!=rootmost){var rootMostPath=rootmost.path,value=rootmost.value,relativePath=newRelativePath(rootMostPath,path);return value=value.updateChild(relativePath,node),new CompoundWrite(compoundWrite.writeTree_.set(rootMostPath,value))}var subtree=new ImmutableTree(node),newWriteTree2=compoundWrite.writeTree_.setTree(path,subtree);return new CompoundWrite(newWriteTree2)}function compoundWriteAddWrites(compoundWrite,path,updates){var newWrite=compoundWrite;return each(updates,function(childKey,node){newWrite=compoundWriteAddWrite(newWrite,pathChild(path,childKey),node)}),newWrite}function compoundWriteRemoveWrite(compoundWrite,path){if(pathIsEmpty(path))return CompoundWrite.empty();var newWriteTree2=compoundWrite.writeTree_.setTree(path,new ImmutableTree(null));return new CompoundWrite(newWriteTree2)}function compoundWriteHasCompleteWrite(compoundWrite,path){return null!=compoundWriteGetCompleteNode(compoundWrite,path)}function compoundWriteGetCompleteNode(compoundWrite,path){var rootmost=compoundWrite.writeTree_.findRootMostValueAndPath(path);return null!=rootmost?compoundWrite.writeTree_.get(rootmost.path).getChild(newRelativePath(rootmost.path,path)):null}function compoundWriteGetCompleteChildren(compoundWrite){var children=[],node=compoundWrite.writeTree_.value;return null!=node?node.isLeafNode()||node.forEachChild(PRIORITY_INDEX,function(childName,childNode){children.push(new NamedNode(childName,childNode))}):compoundWrite.writeTree_.children.inorderTraversal(function(childName,childTree){null!=childTree.value&&children.push(new NamedNode(childName,childTree.value))}),children}function compoundWriteChildCompoundWrite(compoundWrite,path){if(pathIsEmpty(path))return compoundWrite;var shadowingNode=compoundWriteGetCompleteNode(compoundWrite,path);return new CompoundWrite(null!=shadowingNode?new ImmutableTree(shadowingNode):compoundWrite.writeTree_.subtree(path))}function compoundWriteIsEmpty(compoundWrite){return compoundWrite.writeTree_.isEmpty()}function compoundWriteApply(compoundWrite,node){return applySubtreeWrite(newEmptyPath(),compoundWrite.writeTree_,node)}function applySubtreeWrite(relativePath,writeTree,node){if(null!=writeTree.value)return node.updateChild(relativePath,writeTree.value);var priorityWrite_1=null;return writeTree.children.inorderTraversal(function(childKey,childTree){".priority"===childKey?(util.assert(null!==childTree.value,"Priority writes must always be leaf nodes"),priorityWrite_1=childTree.value):node=applySubtreeWrite(pathChild(relativePath,childKey),childTree,node)}),!node.getChild(relativePath).isEmpty()&&null!==priorityWrite_1&&(node=node.updateChild(pathChild(relativePath,".priority"),priorityWrite_1)),node}function writeTreeChildWrites(writeTree,path){return newWriteTreeRef(path,writeTree)}function writeTreeAddOverwrite(writeTree,path,snap,writeId,visible){util.assert(writeId>writeTree.lastWriteId,"Stacking an older write on top of newer ones"),void 0===visible&&(visible=!0),writeTree.allWrites.push({path,snap,writeId,visible}),visible&&(writeTree.visibleWrites=compoundWriteAddWrite(writeTree.visibleWrites,path,snap)),writeTree.lastWriteId=writeId}function writeTreeAddMerge(writeTree,path,changedChildren,writeId){util.assert(writeId>writeTree.lastWriteId,"Stacking an older merge on top of newer ones"),writeTree.allWrites.push({path,children:changedChildren,writeId,visible:!0}),writeTree.visibleWrites=compoundWriteAddWrites(writeTree.visibleWrites,path,changedChildren),writeTree.lastWriteId=writeId}function writeTreeGetWrite(writeTree,writeId){for(var i=0;i<writeTree.allWrites.length;i++){var record=writeTree.allWrites[i];if(record.writeId===writeId)return record}return null}function writeTreeRemoveWrite(writeTree,writeId){var idx=writeTree.allWrites.findIndex(function(s){return s.writeId===writeId});util.assert(idx>=0,"removeWrite called with nonexistent writeId.");var writeToRemove=writeTree.allWrites[idx];writeTree.allWrites.splice(idx,1);for(var removedWriteWasVisible=writeToRemove.visible,removedWriteOverlapsWithOtherWrites=!1,i=writeTree.allWrites.length-1;removedWriteWasVisible&&i>=0;){var currentWrite=writeTree.allWrites[i];currentWrite.visible&&(i>=idx&&writeTreeRecordContainsPath_(currentWrite,writeToRemove.path)?removedWriteWasVisible=!1:pathContains(writeToRemove.path,currentWrite.path)&&(removedWriteOverlapsWithOtherWrites=!0)),i--}if(removedWriteWasVisible){if(removedWriteOverlapsWithOtherWrites)return writeTreeResetTree_(writeTree),!0;if(writeToRemove.snap)writeTree.visibleWrites=compoundWriteRemoveWrite(writeTree.visibleWrites,writeToRemove.path);else each(writeToRemove.children,function(childName){writeTree.visibleWrites=compoundWriteRemoveWrite(writeTree.visibleWrites,pathChild(writeToRemove.path,childName))});return!0}return!1}function writeTreeRecordContainsPath_(writeRecord,path){if(writeRecord.snap)return pathContains(writeRecord.path,path);for(var childName in writeRecord.children)if(writeRecord.children.hasOwnProperty(childName)&&pathContains(pathChild(writeRecord.path,childName),path))return!0;return!1}function writeTreeResetTree_(writeTree){writeTree.visibleWrites=writeTreeLayerTree_(writeTree.allWrites,writeTreeDefaultFilter_,newEmptyPath()),writeTree.allWrites.length>0?writeTree.lastWriteId=writeTree.allWrites[writeTree.allWrites.length-1].writeId:writeTree.lastWriteId=-1}function writeTreeDefaultFilter_(write){return write.visible}function writeTreeLayerTree_(writes,filter,treeRoot){for(var compoundWrite=CompoundWrite.empty(),i=0;i<writes.length;++i){var write=writes[i];if(filter(write)){var writePath=write.path,relativePath=void 0;if(write.snap)pathContains(treeRoot,writePath)?compoundWrite=compoundWriteAddWrite(compoundWrite,relativePath=newRelativePath(treeRoot,writePath),write.snap):pathContains(writePath,treeRoot)&&(relativePath=newRelativePath(writePath,treeRoot),compoundWrite=compoundWriteAddWrite(compoundWrite,newEmptyPath(),write.snap.getChild(relativePath)));else{if(!write.children)throw util.assertionError("WriteRecord should have .snap or .children");if(pathContains(treeRoot,writePath))compoundWrite=compoundWriteAddWrites(compoundWrite,relativePath=newRelativePath(treeRoot,writePath),write.children);else if(pathContains(writePath,treeRoot))if(pathIsEmpty(relativePath=newRelativePath(writePath,treeRoot)))compoundWrite=compoundWriteAddWrites(compoundWrite,newEmptyPath(),write.children);else{var child2=util.safeGet(write.children,pathGetFront(relativePath));if(child2){var deepNode=child2.getChild(pathPopFront(relativePath));compoundWrite=compoundWriteAddWrite(compoundWrite,newEmptyPath(),deepNode)}}}}}return compoundWrite}function writeTreeCalcCompleteEventCache(writeTree,treePath,completeServerCache,writeIdsToExclude,includeHiddenWrites){if(writeIdsToExclude||includeHiddenWrites){var merge=compoundWriteChildCompoundWrite(writeTree.visibleWrites,treePath);if(!includeHiddenWrites&&compoundWriteIsEmpty(merge))return completeServerCache;if(!includeHiddenWrites&&null==completeServerCache&&!compoundWriteHasCompleteWrite(merge,newEmptyPath()))return null;var filter=__name(function(write){return(write.visible||includeHiddenWrites)&&(!writeIdsToExclude||!~writeIdsToExclude.indexOf(write.writeId))&&(pathContains(write.path,treePath)||pathContains(treePath,write.path))},"filter");return compoundWriteApply(writeTreeLayerTree_(writeTree.allWrites,filter,treePath),completeServerCache||ChildrenNode.EMPTY_NODE)}var shadowingNode=compoundWriteGetCompleteNode(writeTree.visibleWrites,treePath);if(null!=shadowingNode)return shadowingNode;var subMerge=compoundWriteChildCompoundWrite(writeTree.visibleWrites,treePath);return compoundWriteIsEmpty(subMerge)?completeServerCache:null!=completeServerCache||compoundWriteHasCompleteWrite(subMerge,newEmptyPath())?compoundWriteApply(subMerge,completeServerCache||ChildrenNode.EMPTY_NODE):null}function writeTreeCalcCompleteEventChildren(writeTree,treePath,completeServerChildren){var completeChildren=ChildrenNode.EMPTY_NODE,topLevelSet=compoundWriteGetCompleteNode(writeTree.visibleWrites,treePath);if(topLevelSet)return topLevelSet.isLeafNode()||topLevelSet.forEachChild(PRIORITY_INDEX,function(childName,childSnap){completeChildren=completeChildren.updateImmediateChild(childName,childSnap)}),completeChildren;if(completeServerChildren){var merge_1=compoundWriteChildCompoundWrite(writeTree.visibleWrites,treePath);return completeServerChildren.forEachChild(PRIORITY_INDEX,function(childName,childNode){var node=compoundWriteApply(compoundWriteChildCompoundWrite(merge_1,new Path(childName)),childNode);completeChildren=completeChildren.updateImmediateChild(childName,node)}),compoundWriteGetCompleteChildren(merge_1).forEach(function(namedNode){completeChildren=completeChildren.updateImmediateChild(namedNode.name,namedNode.node)}),completeChildren}return compoundWriteGetCompleteChildren(compoundWriteChildCompoundWrite(writeTree.visibleWrites,treePath)).forEach(function(namedNode){completeChildren=completeChildren.updateImmediateChild(namedNode.name,namedNode.node)}),completeChildren}function writeTreeCalcEventCacheAfterServerOverwrite(writeTree,treePath,childPath,existingEventSnap,existingServerSnap){util.assert(existingEventSnap||existingServerSnap,"Either existingEventSnap or existingServerSnap must exist");var path=pathChild(treePath,childPath);if(compoundWriteHasCompleteWrite(writeTree.visibleWrites,path))return null;var childMerge=compoundWriteChildCompoundWrite(writeTree.visibleWrites,path);return compoundWriteIsEmpty(childMerge)?existingServerSnap.getChild(childPath):compoundWriteApply(childMerge,existingServerSnap.getChild(childPath))}function writeTreeCalcCompleteChild(writeTree,treePath,childKey,existingServerSnap){var path=pathChild(treePath,childKey),shadowingNode=compoundWriteGetCompleteNode(writeTree.visibleWrites,path);return null!=shadowingNode?shadowingNode:existingServerSnap.isCompleteForChild(childKey)?compoundWriteApply(compoundWriteChildCompoundWrite(writeTree.visibleWrites,path),existingServerSnap.getNode().getImmediateChild(childKey)):null}function writeTreeShadowingWrite(writeTree,path){return compoundWriteGetCompleteNode(writeTree.visibleWrites,path)}function writeTreeCalcIndexedSlice(writeTree,treePath,completeServerData,startPost,count,reverse,index){var toIterate,merge=compoundWriteChildCompoundWrite(writeTree.visibleWrites,treePath),shadowingNode=compoundWriteGetCompleteNode(merge,newEmptyPath());if(null!=shadowingNode)toIterate=shadowingNode;else{if(null==completeServerData)return[];toIterate=compoundWriteApply(merge,completeServerData)}if((toIterate=toIterate.withIndex(index)).isEmpty()||toIterate.isLeafNode())return[];for(var nodes=[],cmp=index.getCompare(),iter=reverse?toIterate.getReverseIteratorFrom(startPost,index):toIterate.getIteratorFrom(startPost,index),next=iter.getNext();next&&nodes.length<count;)0!==cmp(next,startPost)&&nodes.push(next),next=iter.getNext();return nodes}function newWriteTree(){return{visibleWrites:CompoundWrite.empty(),allWrites:[],lastWriteId:-1}}function writeTreeRefCalcCompleteEventCache(writeTreeRef,completeServerCache,writeIdsToExclude,includeHiddenWrites){return writeTreeCalcCompleteEventCache(writeTreeRef.writeTree,writeTreeRef.treePath,completeServerCache,writeIdsToExclude,includeHiddenWrites)}function writeTreeRefCalcCompleteEventChildren(writeTreeRef,completeServerChildren){return writeTreeCalcCompleteEventChildren(writeTreeRef.writeTree,writeTreeRef.treePath,completeServerChildren)}function writeTreeRefCalcEventCacheAfterServerOverwrite(writeTreeRef,path,existingEventSnap,existingServerSnap){return writeTreeCalcEventCacheAfterServerOverwrite(writeTreeRef.writeTree,writeTreeRef.treePath,path,existingEventSnap,existingServerSnap)}function writeTreeRefShadowingWrite(writeTreeRef,path){return writeTreeShadowingWrite(writeTreeRef.writeTree,pathChild(writeTreeRef.treePath,path))}function writeTreeRefCalcIndexedSlice(writeTreeRef,completeServerData,startPost,count,reverse,index){return writeTreeCalcIndexedSlice(writeTreeRef.writeTree,writeTreeRef.treePath,completeServerData,startPost,count,reverse,index)}function writeTreeRefCalcCompleteChild(writeTreeRef,childKey,existingServerCache){return writeTreeCalcCompleteChild(writeTreeRef.writeTree,writeTreeRef.treePath,childKey,existingServerCache)}function writeTreeRefChild(writeTreeRef,childName){return newWriteTreeRef(pathChild(writeTreeRef.treePath,childName),writeTreeRef.writeTree)}function newWriteTreeRef(path,writeTree){return{treePath:path,writeTree}}__name(compoundWriteAddWrite,"compoundWriteAddWrite"),__name(compoundWriteAddWrites,"compoundWriteAddWrites"),__name(compoundWriteRemoveWrite,"compoundWriteRemoveWrite"),__name(compoundWriteHasCompleteWrite,"compoundWriteHasCompleteWrite"),__name(compoundWriteGetCompleteNode,"compoundWriteGetCompleteNode"),__name(compoundWriteGetCompleteChildren,"compoundWriteGetCompleteChildren"),__name(compoundWriteChildCompoundWrite,"compoundWriteChildCompoundWrite"),__name(compoundWriteIsEmpty,"compoundWriteIsEmpty"),__name(compoundWriteApply,"compoundWriteApply"),__name(applySubtreeWrite,"applySubtreeWrite"),__name(writeTreeChildWrites,"writeTreeChildWrites"),__name(writeTreeAddOverwrite,"writeTreeAddOverwrite"),__name(writeTreeAddMerge,"writeTreeAddMerge"),__name(writeTreeGetWrite,"writeTreeGetWrite"),__name(writeTreeRemoveWrite,"writeTreeRemoveWrite"),__name(writeTreeRecordContainsPath_,"writeTreeRecordContainsPath_"),__name(writeTreeResetTree_,"writeTreeResetTree_"),__name(writeTreeDefaultFilter_,"writeTreeDefaultFilter_"),__name(writeTreeLayerTree_,"writeTreeLayerTree_"),__name(writeTreeCalcCompleteEventCache,"writeTreeCalcCompleteEventCache"),__name(writeTreeCalcCompleteEventChildren,"writeTreeCalcCompleteEventChildren"),__name(writeTreeCalcEventCacheAfterServerOverwrite,"writeTreeCalcEventCacheAfterServerOverwrite"),__name(writeTreeCalcCompleteChild,"writeTreeCalcCompleteChild"),__name(writeTreeShadowingWrite,"writeTreeShadowingWrite"),__name(writeTreeCalcIndexedSlice,"writeTreeCalcIndexedSlice"),__name(newWriteTree,"newWriteTree"),__name(writeTreeRefCalcCompleteEventCache,"writeTreeRefCalcCompleteEventCache"),__name(writeTreeRefCalcCompleteEventChildren,"writeTreeRefCalcCompleteEventChildren"),__name(writeTreeRefCalcEventCacheAfterServerOverwrite,"writeTreeRefCalcEventCacheAfterServerOverwrite"),__name(writeTreeRefShadowingWrite,"writeTreeRefShadowingWrite"),__name(writeTreeRefCalcIndexedSlice,"writeTreeRefCalcIndexedSlice"),__name(writeTreeRefCalcCompleteChild,"writeTreeRefCalcCompleteChild"),__name(writeTreeRefChild,"writeTreeRefChild"),__name(newWriteTreeRef,"newWriteTreeRef");var ChildChangeAccumulator=function(){function ChildChangeAccumulator2(){this.changeMap=new Map}return __name(ChildChangeAccumulator2,"ChildChangeAccumulator"),ChildChangeAccumulator2.prototype.trackChildChange=function(change){var type=change.type,childKey=change.childName;util.assert("child_added"===type||"child_changed"===type||"child_removed"===type,"Only child changes supported for tracking"),util.assert(".priority"!==childKey,"Only non-priority child changes can be tracked.");var oldChange=this.changeMap.get(childKey);if(oldChange){var oldType=oldChange.type;if("child_added"===type&&"child_removed"===oldType)this.changeMap.set(childKey,changeChildChanged(childKey,change.snapshotNode,oldChange.snapshotNode));else if("child_removed"===type&&"child_added"===oldType)this.changeMap.delete(childKey);else if("child_removed"===type&&"child_changed"===oldType)this.changeMap.set(childKey,changeChildRemoved(childKey,oldChange.oldSnap));else if("child_changed"===type&&"child_added"===oldType)this.changeMap.set(childKey,changeChildAdded(childKey,change.snapshotNode));else{if("child_changed"!==type||"child_changed"!==oldType)throw util.assertionError("Illegal combination of changes: "+change+" occurred after "+oldChange);this.changeMap.set(childKey,changeChildChanged(childKey,change.snapshotNode,oldChange.oldSnap))}}else this.changeMap.set(childKey,change)},ChildChangeAccumulator2.prototype.getChanges=function(){return Array.from(this.changeMap.values())},ChildChangeAccumulator2}(),NO_COMPLETE_CHILD_SOURCE=new(function(){function NoCompleteChildSource_2(){}return __name(NoCompleteChildSource_2,"NoCompleteChildSource_"),NoCompleteChildSource_2.prototype.getCompleteChild=function(childKey){return null},NoCompleteChildSource_2.prototype.getChildAfterChild=function(index,child2,reverse){return null},NoCompleteChildSource_2}()),WriteTreeCompleteChildSource=function(){function WriteTreeCompleteChildSource2(writes_,viewCache_,optCompleteServerCache_){void 0===optCompleteServerCache_&&(optCompleteServerCache_=null),this.writes_=writes_,this.viewCache_=viewCache_,this.optCompleteServerCache_=optCompleteServerCache_}return __name(WriteTreeCompleteChildSource2,"WriteTreeCompleteChildSource"),WriteTreeCompleteChildSource2.prototype.getCompleteChild=function(childKey){var node=this.viewCache_.eventCache;if(node.isCompleteForChild(childKey))return node.getNode().getImmediateChild(childKey);var serverNode=null!=this.optCompleteServerCache_?new CacheNode(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return writeTreeRefCalcCompleteChild(this.writes_,childKey,serverNode)},WriteTreeCompleteChildSource2.prototype.getChildAfterChild=function(index,child2,reverse){var completeServerData=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:viewCacheGetCompleteServerSnap(this.viewCache_),nodes=writeTreeRefCalcIndexedSlice(this.writes_,completeServerData,child2,1,reverse,index);return 0===nodes.length?null:nodes[0]},WriteTreeCompleteChildSource2}();function newViewProcessor(filter){return{filter}}function viewProcessorAssertIndexed(viewProcessor,viewCache){util.assert(viewCache.eventCache.getNode().isIndexed(viewProcessor.filter.getIndex()),"Event snap not indexed"),util.assert(viewCache.serverCache.getNode().isIndexed(viewProcessor.filter.getIndex()),"Server snap not indexed")}function viewProcessorApplyOperation(viewProcessor,oldViewCache,operation,writesCache,completeCache){var newViewCache2,filterServerNode,accumulator=new ChildChangeAccumulator;if(operation.type===OperationType.OVERWRITE){var overwrite=operation;overwrite.source.fromUser?newViewCache2=viewProcessorApplyUserOverwrite(viewProcessor,oldViewCache,overwrite.path,overwrite.snap,writesCache,completeCache,accumulator):(util.assert(overwrite.source.fromServer,"Unknown source."),filterServerNode=overwrite.source.tagged||oldViewCache.serverCache.isFiltered()&&!pathIsEmpty(overwrite.path),newViewCache2=viewProcessorApplyServerOverwrite(viewProcessor,oldViewCache,overwrite.path,overwrite.snap,writesCache,completeCache,filterServerNode,accumulator))}else if(operation.type===OperationType.MERGE){var merge=operation;merge.source.fromUser?newViewCache2=viewProcessorApplyUserMerge(viewProcessor,oldViewCache,merge.path,merge.children,writesCache,completeCache,accumulator):(util.assert(merge.source.fromServer,"Unknown source."),filterServerNode=merge.source.tagged||oldViewCache.serverCache.isFiltered(),newViewCache2=viewProcessorApplyServerMerge(viewProcessor,oldViewCache,merge.path,merge.children,writesCache,completeCache,filterServerNode,accumulator))}else if(operation.type===OperationType.ACK_USER_WRITE){var ackUserWrite=operation;newViewCache2=ackUserWrite.revert?viewProcessorRevertUserWrite(viewProcessor,oldViewCache,ackUserWrite.path,writesCache,completeCache,accumulator):viewProcessorAckUserWrite(viewProcessor,oldViewCache,ackUserWrite.path,ackUserWrite.affectedTree,writesCache,completeCache,accumulator)}else{if(operation.type!==OperationType.LISTEN_COMPLETE)throw util.assertionError("Unknown operation type: "+operation.type);newViewCache2=viewProcessorListenComplete(viewProcessor,oldViewCache,operation.path,writesCache,accumulator)}var changes=accumulator.getChanges();return viewProcessorMaybeAddValueEvent(oldViewCache,newViewCache2,changes),{viewCache:newViewCache2,changes}}function viewProcessorMaybeAddValueEvent(oldViewCache,newViewCache2,accumulator){var eventSnap=newViewCache2.eventCache;if(eventSnap.isFullyInitialized()){var isLeafOrEmpty=eventSnap.getNode().isLeafNode()||eventSnap.getNode().isEmpty(),oldCompleteSnap=viewCacheGetCompleteEventSnap(oldViewCache);(accumulator.length>0||!oldViewCache.eventCache.isFullyInitialized()||isLeafOrEmpty&&!eventSnap.getNode().equals(oldCompleteSnap)||!eventSnap.getNode().getPriority().equals(oldCompleteSnap.getPriority()))&&accumulator.push(changeValue(viewCacheGetCompleteEventSnap(newViewCache2)))}}function viewProcessorGenerateEventCacheAfterServerEvent(viewProcessor,viewCache,changePath,writesCache,source,accumulator){var oldEventSnap=viewCache.eventCache;if(null!=writeTreeRefShadowingWrite(writesCache,changePath))return viewCache;var newEventCache=void 0,serverNode=void 0;if(pathIsEmpty(changePath))if(util.assert(viewCache.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),viewCache.serverCache.isFiltered()){var serverCache=viewCacheGetCompleteServerSnap(viewCache),completeEventChildren=writeTreeRefCalcCompleteEventChildren(writesCache,serverCache instanceof ChildrenNode?serverCache:ChildrenNode.EMPTY_NODE);newEventCache=viewProcessor.filter.updateFullNode(viewCache.eventCache.getNode(),completeEventChildren,accumulator)}else{var completeNode=writeTreeRefCalcCompleteEventCache(writesCache,viewCacheGetCompleteServerSnap(viewCache));newEventCache=viewProcessor.filter.updateFullNode(viewCache.eventCache.getNode(),completeNode,accumulator)}else{var childKey=pathGetFront(changePath);if(".priority"===childKey){util.assert(1===pathGetLength(changePath),"Can't have a priority with additional path components");var oldEventNode=oldEventSnap.getNode(),updatedPriority=writeTreeRefCalcEventCacheAfterServerOverwrite(writesCache,changePath,oldEventNode,serverNode=viewCache.serverCache.getNode());newEventCache=null!=updatedPriority?viewProcessor.filter.updatePriority(oldEventNode,updatedPriority):oldEventSnap.getNode()}else{var childChangePath=pathPopFront(changePath),newEventChild=void 0;if(oldEventSnap.isCompleteForChild(childKey)){serverNode=viewCache.serverCache.getNode();var eventChildUpdate=writeTreeRefCalcEventCacheAfterServerOverwrite(writesCache,changePath,oldEventSnap.getNode(),serverNode);newEventChild=null!=eventChildUpdate?oldEventSnap.getNode().getImmediateChild(childKey).updateChild(childChangePath,eventChildUpdate):oldEventSnap.getNode().getImmediateChild(childKey)}else newEventChild=writeTreeRefCalcCompleteChild(writesCache,childKey,viewCache.serverCache);newEventCache=null!=newEventChild?viewProcessor.filter.updateChild(oldEventSnap.getNode(),childKey,newEventChild,childChangePath,source,accumulator):oldEventSnap.getNode()}}return viewCacheUpdateEventSnap(viewCache,newEventCache,oldEventSnap.isFullyInitialized()||pathIsEmpty(changePath),viewProcessor.filter.filtersNodes())}function viewProcessorApplyServerOverwrite(viewProcessor,oldViewCache,changePath,changedSnap,writesCache,completeCache,filterServerNode,accumulator){var newServerCache,oldServerSnap=oldViewCache.serverCache,serverFilter=filterServerNode?viewProcessor.filter:viewProcessor.filter.getIndexedFilter();if(pathIsEmpty(changePath))newServerCache=serverFilter.updateFullNode(oldServerSnap.getNode(),changedSnap,null);else if(serverFilter.filtersNodes()&&!oldServerSnap.isFiltered()){var newServerNode=oldServerSnap.getNode().updateChild(changePath,changedSnap);newServerCache=serverFilter.updateFullNode(oldServerSnap.getNode(),newServerNode,null)}else{var childKey=pathGetFront(changePath);if(!oldServerSnap.isCompleteForPath(changePath)&&pathGetLength(changePath)>1)return oldViewCache;var childChangePath=pathPopFront(changePath),newChildNode=oldServerSnap.getNode().getImmediateChild(childKey).updateChild(childChangePath,changedSnap);newServerCache=".priority"===childKey?serverFilter.updatePriority(oldServerSnap.getNode(),newChildNode):serverFilter.updateChild(oldServerSnap.getNode(),childKey,newChildNode,childChangePath,NO_COMPLETE_CHILD_SOURCE,null)}var newViewCache2=viewCacheUpdateServerSnap(oldViewCache,newServerCache,oldServerSnap.isFullyInitialized()||pathIsEmpty(changePath),serverFilter.filtersNodes());return viewProcessorGenerateEventCacheAfterServerEvent(viewProcessor,newViewCache2,changePath,writesCache,new WriteTreeCompleteChildSource(writesCache,newViewCache2,completeCache),accumulator)}function viewProcessorApplyUserOverwrite(viewProcessor,oldViewCache,changePath,changedSnap,writesCache,completeCache,accumulator){var newViewCache2,newEventCache,oldEventSnap=oldViewCache.eventCache,source=new WriteTreeCompleteChildSource(writesCache,oldViewCache,completeCache);if(pathIsEmpty(changePath))newEventCache=viewProcessor.filter.updateFullNode(oldViewCache.eventCache.getNode(),changedSnap,accumulator),newViewCache2=viewCacheUpdateEventSnap(oldViewCache,newEventCache,!0,viewProcessor.filter.filtersNodes());else{var childKey=pathGetFront(changePath);if(".priority"===childKey)newEventCache=viewProcessor.filter.updatePriority(oldViewCache.eventCache.getNode(),changedSnap),newViewCache2=viewCacheUpdateEventSnap(oldViewCache,newEventCache,oldEventSnap.isFullyInitialized(),oldEventSnap.isFiltered());else{var childChangePath=pathPopFront(changePath),oldChild=oldEventSnap.getNode().getImmediateChild(childKey),newChild=void 0;if(pathIsEmpty(childChangePath))newChild=changedSnap;else{var childNode=source.getCompleteChild(childKey);newChild=null!=childNode?".priority"===pathGetBack(childChangePath)&&childNode.getChild(pathParent(childChangePath)).isEmpty()?childNode:childNode.updateChild(childChangePath,changedSnap):ChildrenNode.EMPTY_NODE}if(oldChild.equals(newChild))newViewCache2=oldViewCache;else newViewCache2=viewCacheUpdateEventSnap(oldViewCache,viewProcessor.filter.updateChild(oldEventSnap.getNode(),childKey,newChild,childChangePath,source,accumulator),oldEventSnap.isFullyInitialized(),viewProcessor.filter.filtersNodes())}}return newViewCache2}function viewProcessorCacheHasChild(viewCache,childKey){return viewCache.eventCache.isCompleteForChild(childKey)}function viewProcessorApplyUserMerge(viewProcessor,viewCache,path,changedChildren,writesCache,serverCache,accumulator){var curViewCache=viewCache;return changedChildren.foreach(function(relativePath,childNode){var writePath=pathChild(path,relativePath);viewProcessorCacheHasChild(viewCache,pathGetFront(writePath))&&(curViewCache=viewProcessorApplyUserOverwrite(viewProcessor,curViewCache,writePath,childNode,writesCache,serverCache,accumulator))}),changedChildren.foreach(function(relativePath,childNode){var writePath=pathChild(path,relativePath);viewProcessorCacheHasChild(viewCache,pathGetFront(writePath))||(curViewCache=viewProcessorApplyUserOverwrite(viewProcessor,curViewCache,writePath,childNode,writesCache,serverCache,accumulator))}),curViewCache}function viewProcessorApplyMerge(viewProcessor,node,merge){return merge.foreach(function(relativePath,childNode){node=node.updateChild(relativePath,childNode)}),node}function viewProcessorApplyServerMerge(viewProcessor,viewCache,path,changedChildren,writesCache,serverCache,filterServerNode,accumulator){if(viewCache.serverCache.getNode().isEmpty()&&!viewCache.serverCache.isFullyInitialized())return viewCache;var viewMergeTree,curViewCache=viewCache;viewMergeTree=pathIsEmpty(path)?changedChildren:new ImmutableTree(null).setTree(path,changedChildren);var serverNode=viewCache.serverCache.getNode();return viewMergeTree.children.inorderTraversal(function(childKey,childTree){if(serverNode.hasChild(childKey)){var newChild=viewProcessorApplyMerge(0,viewCache.serverCache.getNode().getImmediateChild(childKey),childTree);curViewCache=viewProcessorApplyServerOverwrite(viewProcessor,curViewCache,new Path(childKey),newChild,writesCache,serverCache,filterServerNode,accumulator)}}),viewMergeTree.children.inorderTraversal(function(childKey,childMergeTree){var isUnknownDeepMerge=!viewCache.serverCache.isCompleteForChild(childKey)&&void 0===childMergeTree.value;if(!serverNode.hasChild(childKey)&&!isUnknownDeepMerge){var newChild=viewProcessorApplyMerge(0,viewCache.serverCache.getNode().getImmediateChild(childKey),childMergeTree);curViewCache=viewProcessorApplyServerOverwrite(viewProcessor,curViewCache,new Path(childKey),newChild,writesCache,serverCache,filterServerNode,accumulator)}}),curViewCache}function viewProcessorAckUserWrite(viewProcessor,viewCache,ackPath,affectedTree,writesCache,completeCache,accumulator){if(null!=writeTreeRefShadowingWrite(writesCache,ackPath))return viewCache;var filterServerNode=viewCache.serverCache.isFiltered(),serverCache=viewCache.serverCache;if(null!=affectedTree.value){if(pathIsEmpty(ackPath)&&serverCache.isFullyInitialized()||serverCache.isCompleteForPath(ackPath))return viewProcessorApplyServerOverwrite(viewProcessor,viewCache,ackPath,serverCache.getNode().getChild(ackPath),writesCache,completeCache,filterServerNode,accumulator);if(pathIsEmpty(ackPath)){var changedChildren_1=new ImmutableTree(null);return serverCache.getNode().forEachChild(KEY_INDEX,function(name2,node){changedChildren_1=changedChildren_1.set(new Path(name2),node)}),viewProcessorApplyServerMerge(viewProcessor,viewCache,ackPath,changedChildren_1,writesCache,completeCache,filterServerNode,accumulator)}return viewCache}var changedChildren_2=new ImmutableTree(null);return affectedTree.foreach(function(mergePath,value){var serverCachePath=pathChild(ackPath,mergePath);serverCache.isCompleteForPath(serverCachePath)&&(changedChildren_2=changedChildren_2.set(mergePath,serverCache.getNode().getChild(serverCachePath)))}),viewProcessorApplyServerMerge(viewProcessor,viewCache,ackPath,changedChildren_2,writesCache,completeCache,filterServerNode,accumulator)}function viewProcessorListenComplete(viewProcessor,viewCache,path,writesCache,accumulator){var oldServerNode=viewCache.serverCache;return viewProcessorGenerateEventCacheAfterServerEvent(viewProcessor,viewCacheUpdateServerSnap(viewCache,oldServerNode.getNode(),oldServerNode.isFullyInitialized()||pathIsEmpty(path),oldServerNode.isFiltered()),path,writesCache,NO_COMPLETE_CHILD_SOURCE,accumulator)}function viewProcessorRevertUserWrite(viewProcessor,viewCache,path,writesCache,completeServerCache,accumulator){var complete;if(null!=writeTreeRefShadowingWrite(writesCache,path))return viewCache;var source=new WriteTreeCompleteChildSource(writesCache,viewCache,completeServerCache),oldEventCache=viewCache.eventCache.getNode(),newEventCache=void 0;if(pathIsEmpty(path)||".priority"===pathGetFront(path)){var newNode=void 0;if(viewCache.serverCache.isFullyInitialized())newNode=writeTreeRefCalcCompleteEventCache(writesCache,viewCacheGetCompleteServerSnap(viewCache));else{var serverChildren=viewCache.serverCache.getNode();util.assert(serverChildren instanceof ChildrenNode,"serverChildren would be complete if leaf node"),newNode=writeTreeRefCalcCompleteEventChildren(writesCache,serverChildren)}newNode=newNode,newEventCache=viewProcessor.filter.updateFullNode(oldEventCache,newNode,accumulator)}else{var childKey=pathGetFront(path),newChild=writeTreeRefCalcCompleteChild(writesCache,childKey,viewCache.serverCache);null==newChild&&viewCache.serverCache.isCompleteForChild(childKey)&&(newChild=oldEventCache.getImmediateChild(childKey)),(newEventCache=null!=newChild?viewProcessor.filter.updateChild(oldEventCache,childKey,newChild,pathPopFront(path),source,accumulator):viewCache.eventCache.getNode().hasChild(childKey)?viewProcessor.filter.updateChild(oldEventCache,childKey,ChildrenNode.EMPTY_NODE,pathPopFront(path),source,accumulator):oldEventCache).isEmpty()&&viewCache.serverCache.isFullyInitialized()&&((complete=writeTreeRefCalcCompleteEventCache(writesCache,viewCacheGetCompleteServerSnap(viewCache))).isLeafNode()&&(newEventCache=viewProcessor.filter.updateFullNode(newEventCache,complete,accumulator)))}return complete=viewCache.serverCache.isFullyInitialized()||null!=writeTreeRefShadowingWrite(writesCache,newEmptyPath()),viewCacheUpdateEventSnap(viewCache,newEventCache,complete,viewProcessor.filter.filtersNodes())}__name(newViewProcessor,"newViewProcessor"),__name(viewProcessorAssertIndexed,"viewProcessorAssertIndexed"),__name(viewProcessorApplyOperation,"viewProcessorApplyOperation"),__name(viewProcessorMaybeAddValueEvent,"viewProcessorMaybeAddValueEvent"),__name(viewProcessorGenerateEventCacheAfterServerEvent,"viewProcessorGenerateEventCacheAfterServerEvent"),__name(viewProcessorApplyServerOverwrite,"viewProcessorApplyServerOverwrite"),__name(viewProcessorApplyUserOverwrite,"viewProcessorApplyUserOverwrite"),__name(viewProcessorCacheHasChild,"viewProcessorCacheHasChild"),__name(viewProcessorApplyUserMerge,"viewProcessorApplyUserMerge"),__name(viewProcessorApplyMerge,"viewProcessorApplyMerge"),__name(viewProcessorApplyServerMerge,"viewProcessorApplyServerMerge"),__name(viewProcessorAckUserWrite,"viewProcessorAckUserWrite"),__name(viewProcessorListenComplete,"viewProcessorListenComplete"),__name(viewProcessorRevertUserWrite,"viewProcessorRevertUserWrite");var View=function(){function View2(query_,initialViewCache){this.query_=query_,this.eventRegistrations_=[];var params=this.query_._queryParams,indexFilter=new IndexedFilter(params.getIndex()),filter=queryParamsGetNodeFilter(params);this.processor_=newViewProcessor(filter);var initialServerCache=initialViewCache.serverCache,initialEventCache=initialViewCache.eventCache,serverSnap=indexFilter.updateFullNode(ChildrenNode.EMPTY_NODE,initialServerCache.getNode(),null),eventSnap=filter.updateFullNode(ChildrenNode.EMPTY_NODE,initialEventCache.getNode(),null),newServerCache=new CacheNode(serverSnap,initialServerCache.isFullyInitialized(),indexFilter.filtersNodes()),newEventCache=new CacheNode(eventSnap,initialEventCache.isFullyInitialized(),filter.filtersNodes());this.viewCache_=newViewCache(newEventCache,newServerCache),this.eventGenerator_=new EventGenerator(this.query_)}return __name(View2,"View"),Object.defineProperty(View2.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),View2}();function viewGetServerCache(view){return view.viewCache_.serverCache.getNode()}function viewGetCompleteNode(view){return viewCacheGetCompleteEventSnap(view.viewCache_)}function viewGetCompleteServerCache(view,path){var cache=viewCacheGetCompleteServerSnap(view.viewCache_);return cache&&(view.query._queryParams.loadsAllData()||!pathIsEmpty(path)&&!cache.getImmediateChild(pathGetFront(path)).isEmpty())?cache.getChild(path):null}function viewIsEmpty(view){return 0===view.eventRegistrations_.length}function viewAddEventRegistration(view,eventRegistration){view.eventRegistrations_.push(eventRegistration)}function viewRemoveEventRegistration(view,eventRegistration,cancelError){var cancelEvents=[];if(cancelError){util.assert(null==eventRegistration,"A cancel should cancel all event registrations.");var path_1=view.query._path;view.eventRegistrations_.forEach(function(registration){var maybeEvent=registration.createCancelEvent(cancelError,path_1);maybeEvent&&cancelEvents.push(maybeEvent)})}if(eventRegistration){for(var remaining=[],i=0;i<view.eventRegistrations_.length;++i){var existing=view.eventRegistrations_[i];if(existing.matches(eventRegistration)){if(eventRegistration.hasAnyCallback()){remaining=remaining.concat(view.eventRegistrations_.slice(i+1));break}}else remaining.push(existing)}view.eventRegistrations_=remaining}else view.eventRegistrations_=[];return cancelEvents}function viewApplyOperation(view,operation,writesCache,completeServerCache){operation.type===OperationType.MERGE&&null!==operation.source.queryId&&(util.assert(viewCacheGetCompleteServerSnap(view.viewCache_),"We should always have a full cache before handling merges"),util.assert(viewCacheGetCompleteEventSnap(view.viewCache_),"Missing event cache, even though we have a server cache"));var oldViewCache=view.viewCache_,result=viewProcessorApplyOperation(view.processor_,oldViewCache,operation,writesCache,completeServerCache);return viewProcessorAssertIndexed(view.processor_,result.viewCache),util.assert(result.viewCache.serverCache.isFullyInitialized()||!oldViewCache.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),view.viewCache_=result.viewCache,viewGenerateEventsForChanges_(view,result.changes,result.viewCache.eventCache.getNode(),null)}function viewGetInitialEvents(view,registration){var eventSnap=view.viewCache_.eventCache,initialChanges=[];eventSnap.getNode().isLeafNode()||eventSnap.getNode().forEachChild(PRIORITY_INDEX,function(key,childNode){initialChanges.push(changeChildAdded(key,childNode))});return eventSnap.isFullyInitialized()&&initialChanges.push(changeValue(eventSnap.getNode())),viewGenerateEventsForChanges_(view,initialChanges,eventSnap.getNode(),registration)}function viewGenerateEventsForChanges_(view,changes,eventCache,eventRegistration){var registrations=eventRegistration?[eventRegistration]:view.eventRegistrations_;return eventGeneratorGenerateEventsForChanges(view.eventGenerator_,changes,eventCache,registrations)}__name(viewGetServerCache,"viewGetServerCache"),__name(viewGetCompleteNode,"viewGetCompleteNode"),__name(viewGetCompleteServerCache,"viewGetCompleteServerCache"),__name(viewIsEmpty,"viewIsEmpty"),__name(viewAddEventRegistration,"viewAddEventRegistration"),__name(viewRemoveEventRegistration,"viewRemoveEventRegistration"),__name(viewApplyOperation,"viewApplyOperation"),__name(viewGetInitialEvents,"viewGetInitialEvents"),__name(viewGenerateEventsForChanges_,"viewGenerateEventsForChanges_");var referenceConstructor$1,referenceConstructor,SyncPoint=function(){function SyncPoint2(){this.views=new Map}return __name(SyncPoint2,"SyncPoint"),SyncPoint2}();function syncPointSetReferenceConstructor(val){util.assert(!referenceConstructor$1,"__referenceConstructor has already been defined"),referenceConstructor$1=val}function syncPointGetReferenceConstructor(){return util.assert(referenceConstructor$1,"Reference.ts has not been loaded"),referenceConstructor$1}function syncPointIsEmpty(syncPoint){return 0===syncPoint.views.size}function syncPointApplyOperation(syncPoint,operation,writesCache,optCompleteServerCache){var e_1,_a,queryId=operation.source.queryId;if(null!==queryId){var view=syncPoint.views.get(queryId);return util.assert(null!=view,"SyncTree gave us an op for an invalid query."),viewApplyOperation(view,operation,writesCache,optCompleteServerCache)}var events=[];try{for(var _b=tslib.__values(syncPoint.views.values()),_c=_b.next();!_c.done;_c=_b.next()){view=_c.value;events=events.concat(viewApplyOperation(view,operation,writesCache,optCompleteServerCache))}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}return events}function syncPointGetView(syncPoint,query2,writesCache,serverCache,serverCacheComplete){var queryId=query2._queryIdentifier,view=syncPoint.views.get(queryId);if(!view){var eventCache=writeTreeRefCalcCompleteEventCache(writesCache,serverCacheComplete?serverCache:null),eventCacheComplete=!1;eventCache?eventCacheComplete=!0:serverCache instanceof ChildrenNode?(eventCache=writeTreeRefCalcCompleteEventChildren(writesCache,serverCache),eventCacheComplete=!1):(eventCache=ChildrenNode.EMPTY_NODE,eventCacheComplete=!1);var viewCache=newViewCache(new CacheNode(eventCache,eventCacheComplete,!1),new CacheNode(serverCache,serverCacheComplete,!1));return new View(query2,viewCache)}return view}function syncPointAddEventRegistration(syncPoint,query2,eventRegistration,writesCache,serverCache,serverCacheComplete){var view=syncPointGetView(syncPoint,query2,writesCache,serverCache,serverCacheComplete);return syncPoint.views.has(query2._queryIdentifier)||syncPoint.views.set(query2._queryIdentifier,view),viewAddEventRegistration(view,eventRegistration),viewGetInitialEvents(view,eventRegistration)}function syncPointRemoveEventRegistration(syncPoint,query2,eventRegistration,cancelError){var e_2,_a,queryId=query2._queryIdentifier,removed=[],cancelEvents=[],hadCompleteView=syncPointHasCompleteView(syncPoint);if("default"===queryId)try{for(var _b=tslib.__values(syncPoint.views.entries()),_c=_b.next();!_c.done;_c=_b.next()){var _d=tslib.__read(_c.value,2),viewQueryId=_d[0],view=_d[1];cancelEvents=cancelEvents.concat(viewRemoveEventRegistration(view,eventRegistration,cancelError)),viewIsEmpty(view)&&(syncPoint.views.delete(viewQueryId),view.query._queryParams.loadsAllData()||removed.push(view.query))}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_2)throw e_2.error}}else(view=syncPoint.views.get(queryId))&&(cancelEvents=cancelEvents.concat(viewRemoveEventRegistration(view,eventRegistration,cancelError)),viewIsEmpty(view)&&(syncPoint.views.delete(queryId),view.query._queryParams.loadsAllData()||removed.push(view.query)));return hadCompleteView&&!syncPointHasCompleteView(syncPoint)&&removed.push(new(syncPointGetReferenceConstructor())(query2._repo,query2._path)),{removed,events:cancelEvents}}function syncPointGetQueryViews(syncPoint){var e_3,_a,result=[];try{for(var _b=tslib.__values(syncPoint.views.values()),_c=_b.next();!_c.done;_c=_b.next()){var view=_c.value;view.query._queryParams.loadsAllData()||result.push(view)}}catch(e_3_1){e_3={error:e_3_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_3)throw e_3.error}}return result}function syncPointGetCompleteServerCache(syncPoint,path){var e_4,_a,serverCache=null;try{for(var _b=tslib.__values(syncPoint.views.values()),_c=_b.next();!_c.done;_c=_b.next()){var view=_c.value;serverCache=serverCache||viewGetCompleteServerCache(view,path)}}catch(e_4_1){e_4={error:e_4_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_4)throw e_4.error}}return serverCache}function syncPointViewForQuery(syncPoint,query2){if(query2._queryParams.loadsAllData())return syncPointGetCompleteView(syncPoint);var queryId=query2._queryIdentifier;return syncPoint.views.get(queryId)}function syncPointViewExistsForQuery(syncPoint,query2){return null!=syncPointViewForQuery(syncPoint,query2)}function syncPointHasCompleteView(syncPoint){return null!=syncPointGetCompleteView(syncPoint)}function syncPointGetCompleteView(syncPoint){var e_5,_a;try{for(var _b=tslib.__values(syncPoint.views.values()),_c=_b.next();!_c.done;_c=_b.next()){var view=_c.value;if(view.query._queryParams.loadsAllData())return view}}catch(e_5_1){e_5={error:e_5_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_5)throw e_5.error}}return null}function syncTreeSetReferenceConstructor(val){util.assert(!referenceConstructor,"__referenceConstructor has already been defined"),referenceConstructor=val}function syncTreeGetReferenceConstructor(){return util.assert(referenceConstructor,"Reference.ts has not been loaded"),referenceConstructor}__name(syncPointSetReferenceConstructor,"syncPointSetReferenceConstructor"),__name(syncPointGetReferenceConstructor,"syncPointGetReferenceConstructor"),__name(syncPointIsEmpty,"syncPointIsEmpty"),__name(syncPointApplyOperation,"syncPointApplyOperation"),__name(syncPointGetView,"syncPointGetView"),__name(syncPointAddEventRegistration,"syncPointAddEventRegistration"),__name(syncPointRemoveEventRegistration,"syncPointRemoveEventRegistration"),__name(syncPointGetQueryViews,"syncPointGetQueryViews"),__name(syncPointGetCompleteServerCache,"syncPointGetCompleteServerCache"),__name(syncPointViewForQuery,"syncPointViewForQuery"),__name(syncPointViewExistsForQuery,"syncPointViewExistsForQuery"),__name(syncPointHasCompleteView,"syncPointHasCompleteView"),__name(syncPointGetCompleteView,"syncPointGetCompleteView"),__name(syncTreeSetReferenceConstructor,"syncTreeSetReferenceConstructor"),__name(syncTreeGetReferenceConstructor,"syncTreeGetReferenceConstructor");var syncTreeNextQueryTag_=1,SyncTree=function(){function SyncTree2(listenProvider_){this.listenProvider_=listenProvider_,this.syncPointTree_=new ImmutableTree(null),this.pendingWriteTree_=newWriteTree(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return __name(SyncTree2,"SyncTree"),SyncTree2}();function syncTreeApplyUserOverwrite(syncTree,path,newData,writeId,visible){return writeTreeAddOverwrite(syncTree.pendingWriteTree_,path,newData,writeId,visible),visible?syncTreeApplyOperationToSyncPoints_(syncTree,new Overwrite({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,newData)):[]}function syncTreeApplyUserMerge(syncTree,path,changedChildren,writeId){writeTreeAddMerge(syncTree.pendingWriteTree_,path,changedChildren,writeId);var changeTree=ImmutableTree.fromObject(changedChildren);return syncTreeApplyOperationToSyncPoints_(syncTree,new Merge({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,changeTree))}function syncTreeAckUserWrite(syncTree,writeId,revert){void 0===revert&&(revert=!1);var write=writeTreeGetWrite(syncTree.pendingWriteTree_,writeId);if(writeTreeRemoveWrite(syncTree.pendingWriteTree_,writeId)){var affectedTree_1=new ImmutableTree(null);return null!=write.snap?affectedTree_1=affectedTree_1.set(newEmptyPath(),!0):each(write.children,function(pathString){affectedTree_1=affectedTree_1.set(new Path(pathString),!0)}),syncTreeApplyOperationToSyncPoints_(syncTree,new AckUserWrite(write.path,affectedTree_1,revert))}return[]}function syncTreeApplyServerOverwrite(syncTree,path,newData){return syncTreeApplyOperationToSyncPoints_(syncTree,new Overwrite({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,newData))}function syncTreeApplyServerMerge(syncTree,path,changedChildren){var changeTree=ImmutableTree.fromObject(changedChildren);return syncTreeApplyOperationToSyncPoints_(syncTree,new Merge({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,changeTree))}function syncTreeApplyListenComplete(syncTree,path){return syncTreeApplyOperationToSyncPoints_(syncTree,new ListenComplete({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path))}function syncTreeApplyTaggedListenComplete(syncTree,path,tag){var queryKey=syncTreeQueryKeyForTag_(syncTree,tag);if(queryKey){var r=syncTreeParseQueryKey_(queryKey),queryPath=r.path,queryId=r.queryId,relativePath=newRelativePath(queryPath,path);return syncTreeApplyTaggedOperation_(syncTree,queryPath,new ListenComplete(newOperationSourceServerTaggedQuery(queryId),relativePath))}return[]}function syncTreeRemoveEventRegistration(syncTree,query2,eventRegistration,cancelError){var path=query2._path,maybeSyncPoint=syncTree.syncPointTree_.get(path),cancelEvents=[];if(maybeSyncPoint&&("default"===query2._queryIdentifier||syncPointViewExistsForQuery(maybeSyncPoint,query2))){var removedAndEvents=syncPointRemoveEventRegistration(maybeSyncPoint,query2,eventRegistration,cancelError);syncPointIsEmpty(maybeSyncPoint)&&(syncTree.syncPointTree_=syncTree.syncPointTree_.remove(path));var removed=removedAndEvents.removed;cancelEvents=removedAndEvents.events;var removingDefault=-1!==removed.findIndex(function(query3){return query3._queryParams.loadsAllData()}),covered=syncTree.syncPointTree_.findOnPath(path,function(relativePath,parentSyncPoint){return syncPointHasCompleteView(parentSyncPoint)});if(removingDefault&&!covered){var subtree=syncTree.syncPointTree_.subtree(path);if(!subtree.isEmpty())for(var newViews=syncTreeCollectDistinctViewsForSubTree_(subtree),i=0;i<newViews.length;++i){var view=newViews[i],newQuery=view.query,listener=syncTreeCreateListenerForView_(syncTree,view);syncTree.listenProvider_.startListening(syncTreeQueryForListening_(newQuery),syncTreeTagForQuery_(syncTree,newQuery),listener.hashFn,listener.onComplete)}}if(!covered&&removed.length>0&&!cancelError)if(removingDefault){syncTree.listenProvider_.stopListening(syncTreeQueryForListening_(query2),null)}else removed.forEach(function(queryToRemove){var tagToRemove=syncTree.queryToTagMap.get(syncTreeMakeQueryKey_(queryToRemove));syncTree.listenProvider_.stopListening(syncTreeQueryForListening_(queryToRemove),tagToRemove)});syncTreeRemoveTags_(syncTree,removed)}return cancelEvents}function syncTreeApplyTaggedQueryOverwrite(syncTree,path,snap,tag){var queryKey=syncTreeQueryKeyForTag_(syncTree,tag);if(null!=queryKey){var r=syncTreeParseQueryKey_(queryKey),queryPath=r.path,queryId=r.queryId,relativePath=newRelativePath(queryPath,path);return syncTreeApplyTaggedOperation_(syncTree,queryPath,new Overwrite(newOperationSourceServerTaggedQuery(queryId),relativePath,snap))}return[]}function syncTreeApplyTaggedQueryMerge(syncTree,path,changedChildren,tag){var queryKey=syncTreeQueryKeyForTag_(syncTree,tag);if(queryKey){var r=syncTreeParseQueryKey_(queryKey),queryPath=r.path,queryId=r.queryId,relativePath=newRelativePath(queryPath,path),changeTree=ImmutableTree.fromObject(changedChildren);return syncTreeApplyTaggedOperation_(syncTree,queryPath,new Merge(newOperationSourceServerTaggedQuery(queryId),relativePath,changeTree))}return[]}function syncTreeAddEventRegistration(syncTree,query2,eventRegistration){var path=query2._path,serverCache=null,foundAncestorDefaultView=!1;syncTree.syncPointTree_.foreachOnPath(path,function(pathToSyncPoint,sp){var relativePath=newRelativePath(pathToSyncPoint,path);serverCache=serverCache||syncPointGetCompleteServerCache(sp,relativePath),foundAncestorDefaultView=foundAncestorDefaultView||syncPointHasCompleteView(sp)});var serverCacheComplete,syncPoint=syncTree.syncPointTree_.get(path);(syncPoint?(foundAncestorDefaultView=foundAncestorDefaultView||syncPointHasCompleteView(syncPoint),serverCache=serverCache||syncPointGetCompleteServerCache(syncPoint,newEmptyPath())):(syncPoint=new SyncPoint,syncTree.syncPointTree_=syncTree.syncPointTree_.set(path,syncPoint)),null!=serverCache)?serverCacheComplete=!0:(serverCacheComplete=!1,serverCache=ChildrenNode.EMPTY_NODE,syncTree.syncPointTree_.subtree(path).foreachChild(function(childName,childSyncPoint){var completeCache=syncPointGetCompleteServerCache(childSyncPoint,newEmptyPath());completeCache&&(serverCache=serverCache.updateImmediateChild(childName,completeCache))}));var viewAlreadyExists=syncPointViewExistsForQuery(syncPoint,query2);if(!viewAlreadyExists&&!query2._queryParams.loadsAllData()){var queryKey=syncTreeMakeQueryKey_(query2);util.assert(!syncTree.queryToTagMap.has(queryKey),"View does not exist, but we have a tag");var tag=syncTreeGetNextQueryTag_();syncTree.queryToTagMap.set(queryKey,tag),syncTree.tagToQueryMap.set(tag,queryKey)}var events=syncPointAddEventRegistration(syncPoint,query2,eventRegistration,writeTreeChildWrites(syncTree.pendingWriteTree_,path),serverCache,serverCacheComplete);if(!viewAlreadyExists&&!foundAncestorDefaultView){var view=syncPointViewForQuery(syncPoint,query2);events=events.concat(syncTreeSetupListener_(syncTree,query2,view))}return events}function syncTreeCalcCompleteEventCache(syncTree,path,writeIdsToExclude){var writeTree=syncTree.pendingWriteTree_,serverCache=syncTree.syncPointTree_.findOnPath(path,function(pathSoFar,syncPoint){var serverCache2=syncPointGetCompleteServerCache(syncPoint,newRelativePath(pathSoFar,path));if(serverCache2)return serverCache2});return writeTreeCalcCompleteEventCache(writeTree,path,serverCache,writeIdsToExclude,!0)}function syncTreeGetServerValue(syncTree,query2){var path=query2._path,serverCache=null;syncTree.syncPointTree_.foreachOnPath(path,function(pathToSyncPoint,sp){var relativePath=newRelativePath(pathToSyncPoint,path);serverCache=serverCache||syncPointGetCompleteServerCache(sp,relativePath)});var syncPoint=syncTree.syncPointTree_.get(path);syncPoint?serverCache=serverCache||syncPointGetCompleteServerCache(syncPoint,newEmptyPath()):(syncPoint=new SyncPoint,syncTree.syncPointTree_=syncTree.syncPointTree_.set(path,syncPoint));var serverCacheComplete=null!=serverCache,serverCacheNode=serverCacheComplete?new CacheNode(serverCache,!0,!1):null;return viewGetCompleteNode(syncPointGetView(syncPoint,query2,writeTreeChildWrites(syncTree.pendingWriteTree_,query2._path),serverCacheComplete?serverCacheNode.getNode():ChildrenNode.EMPTY_NODE,serverCacheComplete))}function syncTreeApplyOperationToSyncPoints_(syncTree,operation){return syncTreeApplyOperationHelper_(operation,syncTree.syncPointTree_,null,writeTreeChildWrites(syncTree.pendingWriteTree_,newEmptyPath()))}function syncTreeApplyOperationHelper_(operation,syncPointTree,serverCache,writesCache){if(pathIsEmpty(operation.path))return syncTreeApplyOperationDescendantsHelper_(operation,syncPointTree,serverCache,writesCache);var syncPoint=syncPointTree.get(newEmptyPath());null==serverCache&&null!=syncPoint&&(serverCache=syncPointGetCompleteServerCache(syncPoint,newEmptyPath()));var events=[],childName=pathGetFront(operation.path),childOperation=operation.operationForChild(childName),childTree=syncPointTree.children.get(childName);if(childTree&&childOperation){var childServerCache=serverCache?serverCache.getImmediateChild(childName):null,childWritesCache=writeTreeRefChild(writesCache,childName);events=events.concat(syncTreeApplyOperationHelper_(childOperation,childTree,childServerCache,childWritesCache))}return syncPoint&&(events=events.concat(syncPointApplyOperation(syncPoint,operation,writesCache,serverCache))),events}function syncTreeApplyOperationDescendantsHelper_(operation,syncPointTree,serverCache,writesCache){var syncPoint=syncPointTree.get(newEmptyPath());null==serverCache&&null!=syncPoint&&(serverCache=syncPointGetCompleteServerCache(syncPoint,newEmptyPath()));var events=[];return syncPointTree.children.inorderTraversal(function(childName,childTree){var childServerCache=serverCache?serverCache.getImmediateChild(childName):null,childWritesCache=writeTreeRefChild(writesCache,childName),childOperation=operation.operationForChild(childName);childOperation&&(events=events.concat(syncTreeApplyOperationDescendantsHelper_(childOperation,childTree,childServerCache,childWritesCache)))}),syncPoint&&(events=events.concat(syncPointApplyOperation(syncPoint,operation,writesCache,serverCache))),events}function syncTreeCreateListenerForView_(syncTree,view){var query2=view.query,tag=syncTreeTagForQuery_(syncTree,query2);return{hashFn:function(){return(viewGetServerCache(view)||ChildrenNode.EMPTY_NODE).hash()},onComplete:function(status){if("ok"===status)return tag?syncTreeApplyTaggedListenComplete(syncTree,query2._path,tag):syncTreeApplyListenComplete(syncTree,query2._path);var error2=errorForServerCode(status,query2);return syncTreeRemoveEventRegistration(syncTree,query2,null,error2)}}}function syncTreeTagForQuery_(syncTree,query2){var queryKey=syncTreeMakeQueryKey_(query2);return syncTree.queryToTagMap.get(queryKey)}function syncTreeMakeQueryKey_(query2){return query2._path.toString()+"$"+query2._queryIdentifier}function syncTreeQueryKeyForTag_(syncTree,tag){return syncTree.tagToQueryMap.get(tag)}function syncTreeParseQueryKey_(queryKey){var splitIndex=queryKey.indexOf("$");return util.assert(-1!==splitIndex&&splitIndex<queryKey.length-1,"Bad queryKey."),{queryId:queryKey.substr(splitIndex+1),path:new Path(queryKey.substr(0,splitIndex))}}function syncTreeApplyTaggedOperation_(syncTree,queryPath,operation){var syncPoint=syncTree.syncPointTree_.get(queryPath);return util.assert(syncPoint,"Missing sync point for query tag that we're tracking"),syncPointApplyOperation(syncPoint,operation,writeTreeChildWrites(syncTree.pendingWriteTree_,queryPath),null)}function syncTreeCollectDistinctViewsForSubTree_(subtree){return subtree.fold(function(relativePath,maybeChildSyncPoint,childMap){if(maybeChildSyncPoint&&syncPointHasCompleteView(maybeChildSyncPoint))return[syncPointGetCompleteView(maybeChildSyncPoint)];var views_1=[];return maybeChildSyncPoint&&(views_1=syncPointGetQueryViews(maybeChildSyncPoint)),each(childMap,function(_key,childViews){views_1=views_1.concat(childViews)}),views_1})}function syncTreeQueryForListening_(query2){return query2._queryParams.loadsAllData()&&!query2._queryParams.isDefault()?new(syncTreeGetReferenceConstructor())(query2._repo,query2._path):query2}function syncTreeRemoveTags_(syncTree,queries){for(var j=0;j<queries.length;++j){var removedQuery=queries[j];if(!removedQuery._queryParams.loadsAllData()){var removedQueryKey=syncTreeMakeQueryKey_(removedQuery),removedQueryTag=syncTree.queryToTagMap.get(removedQueryKey);syncTree.queryToTagMap.delete(removedQueryKey),syncTree.tagToQueryMap.delete(removedQueryTag)}}}function syncTreeGetNextQueryTag_(){return syncTreeNextQueryTag_++}function syncTreeSetupListener_(syncTree,query2,view){var path=query2._path,tag=syncTreeTagForQuery_(syncTree,query2),listener=syncTreeCreateListenerForView_(syncTree,view),events=syncTree.listenProvider_.startListening(syncTreeQueryForListening_(query2),tag,listener.hashFn,listener.onComplete),subtree=syncTree.syncPointTree_.subtree(path);if(tag)util.assert(!syncPointHasCompleteView(subtree.value),"If we're adding a query, it shouldn't be shadowed");else for(var queriesToStop=subtree.fold(function(relativePath,maybeChildSyncPoint,childMap){if(!pathIsEmpty(relativePath)&&maybeChildSyncPoint&&syncPointHasCompleteView(maybeChildSyncPoint))return[syncPointGetCompleteView(maybeChildSyncPoint).query];var queries_1=[];return maybeChildSyncPoint&&(queries_1=queries_1.concat(syncPointGetQueryViews(maybeChildSyncPoint).map(function(view2){return view2.query}))),each(childMap,function(_key,childQueries){queries_1=queries_1.concat(childQueries)}),queries_1}),i=0;i<queriesToStop.length;++i){var queryToStop=queriesToStop[i];syncTree.listenProvider_.stopListening(syncTreeQueryForListening_(queryToStop),syncTreeTagForQuery_(syncTree,queryToStop))}return events}__name(syncTreeApplyUserOverwrite,"syncTreeApplyUserOverwrite"),__name(syncTreeApplyUserMerge,"syncTreeApplyUserMerge"),__name(syncTreeAckUserWrite,"syncTreeAckUserWrite"),__name(syncTreeApplyServerOverwrite,"syncTreeApplyServerOverwrite"),__name(syncTreeApplyServerMerge,"syncTreeApplyServerMerge"),__name(syncTreeApplyListenComplete,"syncTreeApplyListenComplete"),__name(syncTreeApplyTaggedListenComplete,"syncTreeApplyTaggedListenComplete"),__name(syncTreeRemoveEventRegistration,"syncTreeRemoveEventRegistration"),__name(syncTreeApplyTaggedQueryOverwrite,"syncTreeApplyTaggedQueryOverwrite"),__name(syncTreeApplyTaggedQueryMerge,"syncTreeApplyTaggedQueryMerge"),__name(syncTreeAddEventRegistration,"syncTreeAddEventRegistration"),__name(syncTreeCalcCompleteEventCache,"syncTreeCalcCompleteEventCache"),__name(syncTreeGetServerValue,"syncTreeGetServerValue"),__name(syncTreeApplyOperationToSyncPoints_,"syncTreeApplyOperationToSyncPoints_"),__name(syncTreeApplyOperationHelper_,"syncTreeApplyOperationHelper_"),__name(syncTreeApplyOperationDescendantsHelper_,"syncTreeApplyOperationDescendantsHelper_"),__name(syncTreeCreateListenerForView_,"syncTreeCreateListenerForView_"),__name(syncTreeTagForQuery_,"syncTreeTagForQuery_"),__name(syncTreeMakeQueryKey_,"syncTreeMakeQueryKey_"),__name(syncTreeQueryKeyForTag_,"syncTreeQueryKeyForTag_"),__name(syncTreeParseQueryKey_,"syncTreeParseQueryKey_"),__name(syncTreeApplyTaggedOperation_,"syncTreeApplyTaggedOperation_"),__name(syncTreeCollectDistinctViewsForSubTree_,"syncTreeCollectDistinctViewsForSubTree_"),__name(syncTreeQueryForListening_,"syncTreeQueryForListening_"),__name(syncTreeRemoveTags_,"syncTreeRemoveTags_"),__name(syncTreeGetNextQueryTag_,"syncTreeGetNextQueryTag_"),__name(syncTreeSetupListener_,"syncTreeSetupListener_");var ExistingValueProvider=function(){function ExistingValueProvider2(node_){this.node_=node_}return __name(ExistingValueProvider2,"ExistingValueProvider"),ExistingValueProvider2.prototype.getImmediateChild=function(childName){return new ExistingValueProvider2(this.node_.getImmediateChild(childName))},ExistingValueProvider2.prototype.node=function(){return this.node_},ExistingValueProvider2}(),DeferredValueProvider=function(){function DeferredValueProvider2(syncTree,path){this.syncTree_=syncTree,this.path_=path}return __name(DeferredValueProvider2,"DeferredValueProvider"),DeferredValueProvider2.prototype.getImmediateChild=function(childName){var childPath=pathChild(this.path_,childName);return new DeferredValueProvider2(this.syncTree_,childPath)},DeferredValueProvider2.prototype.node=function(){return syncTreeCalcCompleteEventCache(this.syncTree_,this.path_)},DeferredValueProvider2}(),generateWithValues=__name(function(values){return(values=values||{}).timestamp=values.timestamp||(new Date).getTime(),values},"generateWithValues"),resolveDeferredLeafValue=__name(function(value,existingVal,serverValues){return value&&"object"==typeof value?(util.assert(".sv"in value,"Unexpected leaf node or priority contents"),"string"==typeof value[".sv"]?resolveScalarDeferredValue(value[".sv"],existingVal,serverValues):"object"==typeof value[".sv"]?resolveComplexDeferredValue(value[".sv"],existingVal):void util.assert(!1,"Unexpected server value: "+JSON.stringify(value,null,2))):value},"resolveDeferredLeafValue"),resolveScalarDeferredValue=__name(function(op,existing,serverValues){switch(op){case"timestamp":return serverValues.timestamp;default:util.assert(!1,"Unexpected server value: "+op)}},"resolveScalarDeferredValue"),resolveComplexDeferredValue=__name(function(op,existing,unused){op.hasOwnProperty("increment")||util.assert(!1,"Unexpected server value: "+JSON.stringify(op,null,2));var delta=op.increment;"number"!=typeof delta&&util.assert(!1,"Unexpected increment value: "+delta);var existingNode=existing.node();if(util.assert(null!=existingNode,"Expected ChildrenNode.EMPTY_NODE for nulls"),!existingNode.isLeafNode())return delta;var existingVal=existingNode.getValue();return"number"!=typeof existingVal?delta:existingVal+delta},"resolveComplexDeferredValue"),resolveDeferredValueTree=__name(function(path,node,syncTree,serverValues){return resolveDeferredValue(node,new DeferredValueProvider(syncTree,path),serverValues)},"resolveDeferredValueTree"),resolveDeferredValueSnapshot=__name(function(node,existing,serverValues){return resolveDeferredValue(node,new ExistingValueProvider(existing),serverValues)},"resolveDeferredValueSnapshot");function resolveDeferredValue(node,existingVal,serverValues){var newNode,rawPri=node.getPriority().val(),priority=resolveDeferredLeafValue(rawPri,existingVal.getImmediateChild(".priority"),serverValues);if(node.isLeafNode()){var leafNode=node,value=resolveDeferredLeafValue(leafNode.getValue(),existingVal,serverValues);return value!==leafNode.getValue()||priority!==leafNode.getPriority().val()?new LeafNode(value,nodeFromJSON(priority)):node}var childrenNode=node;return newNode=childrenNode,priority!==childrenNode.getPriority().val()&&(newNode=newNode.updatePriority(new LeafNode(priority))),childrenNode.forEachChild(PRIORITY_INDEX,function(childName,childNode){var newChildNode=resolveDeferredValue(childNode,existingVal.getImmediateChild(childName),serverValues);newChildNode!==childNode&&(newNode=newNode.updateImmediateChild(childName,newChildNode))}),newNode}__name(resolveDeferredValue,"resolveDeferredValue");var Tree=function(){function Tree2(name2,parent,node){void 0===name2&&(name2=""),void 0===parent&&(parent=null),void 0===node&&(node={children:{},childCount:0}),this.name=name2,this.parent=parent,this.node=node}return __name(Tree2,"Tree"),Tree2}();function treeSubTree(tree,pathObj){for(var path=pathObj instanceof Path?pathObj:new Path(pathObj),child2=tree,next=pathGetFront(path);null!==next;){var childNode=util.safeGet(child2.node.children,next)||{children:{},childCount:0};child2=new Tree(next,child2,childNode),next=pathGetFront(path=pathPopFront(path))}return child2}function treeGetValue(tree){return tree.node.value}function treeSetValue(tree,value){tree.node.value=value,treeUpdateParents(tree)}function treeHasChildren(tree){return tree.node.childCount>0}function treeIsEmpty(tree){return void 0===treeGetValue(tree)&&!treeHasChildren(tree)}function treeForEachChild(tree,action){each(tree.node.children,function(child2,childTree){action(new Tree(child2,tree,childTree))})}function treeForEachDescendant(tree,action,includeSelf,childrenFirst){includeSelf&&!childrenFirst&&action(tree),treeForEachChild(tree,function(child2){treeForEachDescendant(child2,action,!0,childrenFirst)}),includeSelf&&childrenFirst&&action(tree)}function treeForEachAncestor(tree,action,includeSelf){for(var node=includeSelf?tree:tree.parent;null!==node;){if(action(node))return!0;node=node.parent}return!1}function treeGetPath(tree){return new Path(null===tree.parent?tree.name:treeGetPath(tree.parent)+"/"+tree.name)}function treeUpdateParents(tree){null!==tree.parent&&treeUpdateChild(tree.parent,tree.name,tree)}function treeUpdateChild(tree,childName,child2){var childEmpty=treeIsEmpty(child2),childExists=util.contains(tree.node.children,childName);childEmpty&&childExists?(delete tree.node.children[childName],tree.node.childCount--,treeUpdateParents(tree)):!childEmpty&&!childExists&&(tree.node.children[childName]=child2.node,tree.node.childCount++,treeUpdateParents(tree))}__name(treeSubTree,"treeSubTree"),__name(treeGetValue,"treeGetValue"),__name(treeSetValue,"treeSetValue"),__name(treeHasChildren,"treeHasChildren"),__name(treeIsEmpty,"treeIsEmpty"),__name(treeForEachChild,"treeForEachChild"),__name(treeForEachDescendant,"treeForEachDescendant"),__name(treeForEachAncestor,"treeForEachAncestor"),__name(treeGetPath,"treeGetPath"),__name(treeUpdateParents,"treeUpdateParents"),__name(treeUpdateChild,"treeUpdateChild");var INVALID_KEY_REGEX_=/[\[\].#$\/\u0000-\u001F\u007F]/,INVALID_PATH_REGEX_=/[\[\].#$\u0000-\u001F\u007F]/,isValidKey=__name(function(key){return"string"==typeof key&&0!==key.length&&!INVALID_KEY_REGEX_.test(key)},"isValidKey"),isValidPathString=__name(function(pathString){return"string"==typeof pathString&&0!==pathString.length&&!INVALID_PATH_REGEX_.test(pathString)},"isValidPathString"),isValidRootPathString=__name(function(pathString){return pathString&&(pathString=pathString.replace(/^\/*\.info(\/|$)/,"/")),isValidPathString(pathString)},"isValidRootPathString"),isValidPriority=__name(function(priority){return null===priority||"string"==typeof priority||"number"==typeof priority&&!isInvalidJSONNumber(priority)||priority&&"object"==typeof priority&&util.contains(priority,".sv")},"isValidPriority"),validateFirebaseDataArg=__name(function(fnName,value,path,optional){optional&&void 0===value||validateFirebaseData(util.errorPrefix(fnName,"value"),value,path)},"validateFirebaseDataArg"),validateFirebaseData=__name(function(errorPrefix,data,path_){var path=path_ instanceof Path?new ValidationPath(path_,errorPrefix):path_;if(void 0===data)throw new Error(errorPrefix+"contains undefined "+validationPathToErrorString(path));if("function"==typeof data)throw new Error(errorPrefix+"contains a function "+validationPathToErrorString(path)+" with contents = "+data.toString());if(isInvalidJSONNumber(data))throw new Error(errorPrefix+"contains "+data.toString()+" "+validationPathToErrorString(path));if("string"==typeof data&&data.length>10485760/3&&util.stringLength(data)>10485760)throw new Error(errorPrefix+"contains a string greater than 10485760 utf8 bytes "+validationPathToErrorString(path)+" ('"+data.substring(0,50)+"...')");if(data&&"object"==typeof data){var hasDotValue_1=!1,hasActualChild_1=!1;if(each(data,function(key,value){if(".value"===key)hasDotValue_1=!0;else if(".priority"!==key&&".sv"!==key&&(hasActualChild_1=!0,!isValidKey(key)))throw new Error(errorPrefix+" contains an invalid key ("+key+") "+validationPathToErrorString(path)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');validationPathPush(path,key),validateFirebaseData(errorPrefix,value,path),validationPathPop(path)}),hasDotValue_1&&hasActualChild_1)throw new Error(errorPrefix+' contains ".value" child '+validationPathToErrorString(path)+" in addition to actual children.")}},"validateFirebaseData"),validateFirebaseMergePaths=__name(function(errorPrefix,mergePaths){var i,curPath;for(i=0;i<mergePaths.length;i++)for(var keys=pathSlice(curPath=mergePaths[i]),j=0;j<keys.length;j++)if((".priority"!==keys[j]||j!==keys.length-1)&&!isValidKey(keys[j]))throw new Error(errorPrefix+"contains an invalid key ("+keys[j]+") in path "+curPath.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');mergePaths.sort(pathCompare);var prevPath=null;for(i=0;i<mergePaths.length;i++){if(curPath=mergePaths[i],null!==prevPath&&pathContains(prevPath,curPath))throw new Error(errorPrefix+"contains a path "+prevPath.toString()+" that is ancestor of another path "+curPath.toString());prevPath=curPath}},"validateFirebaseMergePaths"),validateFirebaseMergeDataArg=__name(function(fnName,data,path,optional){if(!optional||void 0!==data){var errorPrefix=util.errorPrefix(fnName,"values");if(!data||"object"!=typeof data||Array.isArray(data))throw new Error(errorPrefix+" must be an object containing the children to replace.");var mergePaths=[];each(data,function(key,value){var curPath=new Path(key);if(validateFirebaseData(errorPrefix,value,pathChild(path,curPath)),".priority"===pathGetBack(curPath)&&!isValidPriority(value))throw new Error(errorPrefix+"contains an invalid value for '"+curPath.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");mergePaths.push(curPath)}),validateFirebaseMergePaths(errorPrefix,mergePaths)}},"validateFirebaseMergeDataArg"),validatePriority=__name(function(fnName,priority,optional){if(!optional||void 0!==priority){if(isInvalidJSONNumber(priority))throw new Error(util.errorPrefix(fnName,"priority")+"is "+priority.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!isValidPriority(priority))throw new Error(util.errorPrefix(fnName,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},"validatePriority"),validateEventType=__name(function(fnName,eventType,optional){if(!optional||void 0!==eventType)switch(eventType){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(util.errorPrefix(fnName,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},"validateEventType"),validateKey=__name(function(fnName,argumentName,key,optional){if(!(optional&&void 0===key||isValidKey(key)))throw new Error(util.errorPrefix(fnName,argumentName)+'was an invalid key = "'+key+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},"validateKey"),validatePathString=__name(function(fnName,argumentName,pathString,optional){if(!(optional&&void 0===pathString||isValidPathString(pathString)))throw new Error(util.errorPrefix(fnName,argumentName)+'was an invalid path = "'+pathString+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},"validatePathString"),validateRootPathString=__name(function(fnName,argumentName,pathString,optional){pathString&&(pathString=pathString.replace(/^\/*\.info(\/|$)/,"/")),validatePathString(fnName,argumentName,pathString,optional)},"validateRootPathString"),validateWritablePath=__name(function(fnName,path){if(".info"===pathGetFront(path))throw new Error(fnName+" failed = Can't modify data under /.info/")},"validateWritablePath"),validateUrl=__name(function(fnName,parsedUrl){var pathString=parsedUrl.path.toString();if("string"!=typeof parsedUrl.repoInfo.host||0===parsedUrl.repoInfo.host.length||!isValidKey(parsedUrl.repoInfo.namespace)&&"localhost"!==parsedUrl.repoInfo.host.split(":")[0]||0!==pathString.length&&!isValidRootPathString(pathString))throw new Error(util.errorPrefix(fnName,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},"validateUrl"),validateBoolean=__name(function(fnName,argumentName,bool,optional){if((!optional||void 0!==bool)&&"boolean"!=typeof bool)throw new Error(util.errorPrefix(fnName,argumentName)+"must be a boolean.")},"validateBoolean"),EventQueue=function(){function EventQueue2(){this.eventLists_=[],this.recursionDepth_=0}return __name(EventQueue2,"EventQueue"),EventQueue2}();function eventQueueQueueEvents(eventQueue,eventDataList){for(var currList=null,i=0;i<eventDataList.length;i++){var data=eventDataList[i],path=data.getPath();null!==currList&&!pathEquals(path,currList.path)&&(eventQueue.eventLists_.push(currList),currList=null),null===currList&&(currList={events:[],path}),currList.events.push(data)}currList&&eventQueue.eventLists_.push(currList)}function eventQueueRaiseEventsAtPath(eventQueue,path,eventDataList){eventQueueQueueEvents(eventQueue,eventDataList),eventQueueRaiseQueuedEventsMatchingPredicate(eventQueue,function(eventPath){return pathEquals(eventPath,path)})}function eventQueueRaiseEventsForChangedPath(eventQueue,changedPath,eventDataList){eventQueueQueueEvents(eventQueue,eventDataList),eventQueueRaiseQueuedEventsMatchingPredicate(eventQueue,function(eventPath){return pathContains(eventPath,changedPath)||pathContains(changedPath,eventPath)})}function eventQueueRaiseQueuedEventsMatchingPredicate(eventQueue,predicate){eventQueue.recursionDepth_++;for(var sentAll=!0,i=0;i<eventQueue.eventLists_.length;i++){var eventList=eventQueue.eventLists_[i];if(eventList)predicate(eventList.path)?(eventListRaise(eventQueue.eventLists_[i]),eventQueue.eventLists_[i]=null):sentAll=!1}sentAll&&(eventQueue.eventLists_=[]),eventQueue.recursionDepth_--}function eventListRaise(eventList){for(var i=0;i<eventList.events.length;i++){var eventData=eventList.events[i];if(null!==eventData){eventList.events[i]=null;var eventFn=eventData.getEventRunner();logger&&log("event: "+eventData.toString()),exceptionGuard(eventFn)}}}__name(eventQueueQueueEvents,"eventQueueQueueEvents"),__name(eventQueueRaiseEventsAtPath,"eventQueueRaiseEventsAtPath"),__name(eventQueueRaiseEventsForChangedPath,"eventQueueRaiseEventsForChangedPath"),__name(eventQueueRaiseQueuedEventsMatchingPredicate,"eventQueueRaiseQueuedEventsMatchingPredicate"),__name(eventListRaise,"eventListRaise");var Repo=function(){function Repo2(repoInfo_,forceRestClient_,authTokenProvider_,appCheckProvider_){this.repoInfo_=repoInfo_,this.forceRestClient_=forceRestClient_,this.authTokenProvider_=authTokenProvider_,this.appCheckProvider_=appCheckProvider_,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new EventQueue,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=newSparseSnapshotTree(),this.transactionQueueTree_=new Tree,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return __name(Repo2,"Repo"),Repo2.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},Repo2}();function repoStart(repo,appId,authOverride){if(repo.stats_=statsManagerGetCollection(repo.repoInfo_),repo.forceRestClient_||beingCrawled())repo.server_=new ReadonlyRestClient(repo.repoInfo_,function(pathString,data,isMerge,tag){repoOnDataUpdate(repo,pathString,data,isMerge,tag)},repo.authTokenProvider_,repo.appCheckProvider_),setTimeout(function(){return repoOnConnectStatus(repo,!0)},0);else{if(null!=authOverride){if("object"!=typeof authOverride)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{util.stringify(authOverride)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}repo.persistentConnection_=new PersistentConnection(repo.repoInfo_,appId,function(pathString,data,isMerge,tag){repoOnDataUpdate(repo,pathString,data,isMerge,tag)},function(connectStatus){repoOnConnectStatus(repo,connectStatus)},function(updates){repoOnServerInfoUpdate(repo,updates)},repo.authTokenProvider_,repo.appCheckProvider_,authOverride),repo.server_=repo.persistentConnection_}repo.authTokenProvider_.addTokenChangeListener(function(token){repo.server_.refreshAuthToken(token)}),repo.appCheckProvider_.addTokenChangeListener(function(result){repo.server_.refreshAppCheckToken(result.token)}),repo.statsReporter_=statsManagerGetOrCreateReporter(repo.repoInfo_,function(){return new StatsReporter(repo.stats_,repo.server_)}),repo.infoData_=new SnapshotHolder,repo.infoSyncTree_=new SyncTree({startListening:function(query2,tag,currentHashFn,onComplete){var infoEvents=[],node=repo.infoData_.getNode(query2._path);return node.isEmpty()||(infoEvents=syncTreeApplyServerOverwrite(repo.infoSyncTree_,query2._path,node),setTimeout(function(){onComplete("ok")},0)),infoEvents},stopListening:function(){}}),repoUpdateInfo(repo,"connected",!1),repo.serverSyncTree_=new SyncTree({startListening:function(query2,tag,currentHashFn,onComplete){return repo.server_.listen(query2,currentHashFn,tag,function(status,data){var events=onComplete(status,data);eventQueueRaiseEventsForChangedPath(repo.eventQueue_,query2._path,events)}),[]},stopListening:function(query2,tag){repo.server_.unlisten(query2,tag)}})}function repoServerTime(repo){var offset=repo.infoData_.getNode(new Path(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+offset}function repoGenerateServerValues(repo){return generateWithValues({timestamp:repoServerTime(repo)})}function repoOnDataUpdate(repo,pathString,data,isMerge,tag){repo.dataUpdateCount++;var path=new Path(pathString);data=repo.interceptServerDataCallback_?repo.interceptServerDataCallback_(pathString,data):data;var events=[];if(tag)if(isMerge){var taggedChildren=util.map(data,function(raw){return nodeFromJSON(raw)});events=syncTreeApplyTaggedQueryMerge(repo.serverSyncTree_,path,taggedChildren,tag)}else{var taggedSnap=nodeFromJSON(data);events=syncTreeApplyTaggedQueryOverwrite(repo.serverSyncTree_,path,taggedSnap,tag)}else if(isMerge){var changedChildren=util.map(data,function(raw){return nodeFromJSON(raw)});events=syncTreeApplyServerMerge(repo.serverSyncTree_,path,changedChildren)}else{var snap=nodeFromJSON(data);events=syncTreeApplyServerOverwrite(repo.serverSyncTree_,path,snap)}var affectedPath=path;events.length>0&&(affectedPath=repoRerunTransactions(repo,path)),eventQueueRaiseEventsForChangedPath(repo.eventQueue_,affectedPath,events)}function repoInterceptServerData(repo,callback){repo.interceptServerDataCallback_=callback}function repoOnConnectStatus(repo,connectStatus){repoUpdateInfo(repo,"connected",connectStatus),!1===connectStatus&&repoRunOnDisconnectEvents(repo)}function repoOnServerInfoUpdate(repo,updates){each(updates,function(key,value){repoUpdateInfo(repo,key,value)})}function repoUpdateInfo(repo,pathString,value){var path=new Path("/.info/"+pathString),newNode=nodeFromJSON(value);repo.infoData_.updateSnapshot(path,newNode);var events=syncTreeApplyServerOverwrite(repo.infoSyncTree_,path,newNode);eventQueueRaiseEventsForChangedPath(repo.eventQueue_,path,events)}function repoGetNextWriteId(repo){return repo.nextWriteId_++}function repoGetValue(repo,query2){var cached=syncTreeGetServerValue(repo.serverSyncTree_,query2);return null!=cached?Promise.resolve(cached):repo.server_.get(query2).then(function(payload){var node=nodeFromJSON(payload).withIndex(query2._queryParams.getIndex()),events=syncTreeApplyServerOverwrite(repo.serverSyncTree_,query2._path,node);return eventQueueRaiseEventsAtPath(repo.eventQueue_,query2._path,events),Promise.resolve(node)},function(err){return repoLog(repo,"get for query "+util.stringify(query2)+" failed: "+err),Promise.reject(new Error(err))})}function repoSetWithPriority(repo,path,newVal,newPriority,onComplete){repoLog(repo,"set",{path:path.toString(),value:newVal,priority:newPriority});var serverValues=repoGenerateServerValues(repo),newNodeUnresolved=nodeFromJSON(newVal,newPriority),existing=syncTreeCalcCompleteEventCache(repo.serverSyncTree_,path),newNode=resolveDeferredValueSnapshot(newNodeUnresolved,existing,serverValues),writeId=repoGetNextWriteId(repo),events=syncTreeApplyUserOverwrite(repo.serverSyncTree_,path,newNode,writeId,!0);eventQueueQueueEvents(repo.eventQueue_,events),repo.server_.put(path.toString(),newNodeUnresolved.val(!0),function(status,errorReason){var success="ok"===status;success||warn("set at "+path+" failed: "+status);var clearEvents=syncTreeAckUserWrite(repo.serverSyncTree_,writeId,!success);eventQueueRaiseEventsForChangedPath(repo.eventQueue_,path,clearEvents),repoCallOnCompleteCallback(repo,onComplete,status,errorReason)});var affectedPath=repoAbortTransactions(repo,path);repoRerunTransactions(repo,affectedPath),eventQueueRaiseEventsForChangedPath(repo.eventQueue_,affectedPath,[])}function repoUpdate(repo,path,childrenToMerge,onComplete){repoLog(repo,"update",{path:path.toString(),value:childrenToMerge});var empty=!0,serverValues=repoGenerateServerValues(repo),changedChildren={};if(each(childrenToMerge,function(changedKey,changedValue){empty=!1,changedChildren[changedKey]=resolveDeferredValueTree(pathChild(path,changedKey),nodeFromJSON(changedValue),repo.serverSyncTree_,serverValues)}),empty)log("update() called with empty data.  Don't do anything."),repoCallOnCompleteCallback(repo,onComplete,"ok",void 0);else{var writeId_1=repoGetNextWriteId(repo),events=syncTreeApplyUserMerge(repo.serverSyncTree_,path,changedChildren,writeId_1);eventQueueQueueEvents(repo.eventQueue_,events),repo.server_.merge(path.toString(),childrenToMerge,function(status,errorReason){var success="ok"===status;success||warn("update at "+path+" failed: "+status);var clearEvents=syncTreeAckUserWrite(repo.serverSyncTree_,writeId_1,!success),affectedPath=clearEvents.length>0?repoRerunTransactions(repo,path):path;eventQueueRaiseEventsForChangedPath(repo.eventQueue_,affectedPath,clearEvents),repoCallOnCompleteCallback(repo,onComplete,status,errorReason)}),each(childrenToMerge,function(changedPath){var affectedPath=repoAbortTransactions(repo,pathChild(path,changedPath));repoRerunTransactions(repo,affectedPath)}),eventQueueRaiseEventsForChangedPath(repo.eventQueue_,path,[])}}function repoRunOnDisconnectEvents(repo){repoLog(repo,"onDisconnectEvents");var serverValues=repoGenerateServerValues(repo),resolvedOnDisconnectTree=newSparseSnapshotTree();sparseSnapshotTreeForEachTree(repo.onDisconnect_,newEmptyPath(),function(path,node){var resolved=resolveDeferredValueTree(path,node,repo.serverSyncTree_,serverValues);sparseSnapshotTreeRemember(resolvedOnDisconnectTree,path,resolved)});var events=[];sparseSnapshotTreeForEachTree(resolvedOnDisconnectTree,newEmptyPath(),function(path,snap){events=events.concat(syncTreeApplyServerOverwrite(repo.serverSyncTree_,path,snap));var affectedPath=repoAbortTransactions(repo,path);repoRerunTransactions(repo,affectedPath)}),repo.onDisconnect_=newSparseSnapshotTree(),eventQueueRaiseEventsForChangedPath(repo.eventQueue_,newEmptyPath(),events)}function repoOnDisconnectCancel(repo,path,onComplete){repo.server_.onDisconnectCancel(path.toString(),function(status,errorReason){"ok"===status&&sparseSnapshotTreeForget(repo.onDisconnect_,path),repoCallOnCompleteCallback(repo,onComplete,status,errorReason)})}function repoOnDisconnectSet(repo,path,value,onComplete){var newNode=nodeFromJSON(value);repo.server_.onDisconnectPut(path.toString(),newNode.val(!0),function(status,errorReason){"ok"===status&&sparseSnapshotTreeRemember(repo.onDisconnect_,path,newNode),repoCallOnCompleteCallback(repo,onComplete,status,errorReason)})}function repoOnDisconnectSetWithPriority(repo,path,value,priority,onComplete){var newNode=nodeFromJSON(value,priority);repo.server_.onDisconnectPut(path.toString(),newNode.val(!0),function(status,errorReason){"ok"===status&&sparseSnapshotTreeRemember(repo.onDisconnect_,path,newNode),repoCallOnCompleteCallback(repo,onComplete,status,errorReason)})}function repoOnDisconnectUpdate(repo,path,childrenToMerge,onComplete){if(util.isEmpty(childrenToMerge))return log("onDisconnect().update() called with empty data.  Don't do anything."),void repoCallOnCompleteCallback(repo,onComplete,"ok",void 0);repo.server_.onDisconnectMerge(path.toString(),childrenToMerge,function(status,errorReason){"ok"===status&&each(childrenToMerge,function(childName,childNode){var newChildNode=nodeFromJSON(childNode);sparseSnapshotTreeRemember(repo.onDisconnect_,pathChild(path,childName),newChildNode)}),repoCallOnCompleteCallback(repo,onComplete,status,errorReason)})}function repoAddEventCallbackForQuery(repo,query2,eventRegistration){var events;events=".info"===pathGetFront(query2._path)?syncTreeAddEventRegistration(repo.infoSyncTree_,query2,eventRegistration):syncTreeAddEventRegistration(repo.serverSyncTree_,query2,eventRegistration),eventQueueRaiseEventsAtPath(repo.eventQueue_,query2._path,events)}function repoRemoveEventCallbackForQuery(repo,query2,eventRegistration){var events;events=".info"===pathGetFront(query2._path)?syncTreeRemoveEventRegistration(repo.infoSyncTree_,query2,eventRegistration):syncTreeRemoveEventRegistration(repo.serverSyncTree_,query2,eventRegistration),eventQueueRaiseEventsAtPath(repo.eventQueue_,query2._path,events)}function repoInterrupt(repo){repo.persistentConnection_&&repo.persistentConnection_.interrupt("repo_interrupt")}function repoResume(repo){repo.persistentConnection_&&repo.persistentConnection_.resume("repo_interrupt")}function repoStats(repo,showDelta){if(void 0===showDelta&&(showDelta=!1),"undefined"!=typeof console){var stats2;showDelta?(repo.statsListener_||(repo.statsListener_=new StatsListener(repo.stats_)),stats2=repo.statsListener_.get()):stats2=repo.stats_.get();var longestName=Object.keys(stats2).reduce(function(previousValue,currentValue){return Math.max(currentValue.length,previousValue)},0);each(stats2,function(stat,value){for(var paddedStat=stat,i=stat.length;i<longestName+2;i++)paddedStat+=" ";console.log(paddedStat+value)})}}function repoStatsIncrementCounter(repo,metric){repo.stats_.incrementCounter(metric),statsReporterIncludeStat(repo.statsReporter_,metric)}function repoLog(repo){for(var varArgs=[],_i=1;_i<arguments.length;_i++)varArgs[_i-1]=arguments[_i];var prefix="";repo.persistentConnection_&&(prefix=repo.persistentConnection_.id+":"),log.apply(void 0,tslib.__spreadArray([prefix],tslib.__read(varArgs)))}function repoCallOnCompleteCallback(repo,callback,status,errorReason){callback&&exceptionGuard(function(){if("ok"===status)callback(null);else{var code=(status||"error").toUpperCase(),message=code;errorReason&&(message+=": "+errorReason);var error2=new Error(message);error2.code=code,callback(error2)}})}function repoStartTransaction(repo,path,transactionUpdate,onComplete,unwatcher,applyLocally){repoLog(repo,"transaction on "+path);var transaction={path,update:transactionUpdate,onComplete,status:null,order:LUIDGenerator(),applyLocally,retryCount:0,unwatcher,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},currentState=repoGetLatestState(repo,path,void 0);transaction.currentInputSnapshot=currentState;var newVal=transaction.update(currentState.val());if(void 0===newVal)transaction.unwatcher(),transaction.currentOutputSnapshotRaw=null,transaction.currentOutputSnapshotResolved=null,transaction.onComplete&&transaction.onComplete(null,!1,transaction.currentInputSnapshot);else{validateFirebaseData("transaction failed: Data returned ",newVal,transaction.path),transaction.status=0;var queueNode=treeSubTree(repo.transactionQueueTree_,path),nodeQueue=treeGetValue(queueNode)||[];nodeQueue.push(transaction),treeSetValue(queueNode,nodeQueue);var priorityForNode=void 0;if("object"==typeof newVal&&null!==newVal&&util.contains(newVal,".priority"))priorityForNode=util.safeGet(newVal,".priority"),util.assert(isValidPriority(priorityForNode),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else priorityForNode=(syncTreeCalcCompleteEventCache(repo.serverSyncTree_,path)||ChildrenNode.EMPTY_NODE).getPriority().val();var serverValues=repoGenerateServerValues(repo),newNodeUnresolved=nodeFromJSON(newVal,priorityForNode),newNode=resolveDeferredValueSnapshot(newNodeUnresolved,currentState,serverValues);transaction.currentOutputSnapshotRaw=newNodeUnresolved,transaction.currentOutputSnapshotResolved=newNode,transaction.currentWriteId=repoGetNextWriteId(repo);var events=syncTreeApplyUserOverwrite(repo.serverSyncTree_,path,newNode,transaction.currentWriteId,transaction.applyLocally);eventQueueRaiseEventsForChangedPath(repo.eventQueue_,path,events),repoSendReadyTransactions(repo,repo.transactionQueueTree_)}}function repoGetLatestState(repo,path,excludeSets){return syncTreeCalcCompleteEventCache(repo.serverSyncTree_,path,excludeSets)||ChildrenNode.EMPTY_NODE}function repoSendReadyTransactions(repo,node){if(void 0===node&&(node=repo.transactionQueueTree_),node||repoPruneCompletedTransactionsBelowNode(repo,node),treeGetValue(node)){var queue=repoBuildTransactionQueue(repo,node);util.assert(queue.length>0,"Sending zero length transaction queue"),queue.every(function(transaction){return 0===transaction.status})&&repoSendTransactionQueue(repo,treeGetPath(node),queue)}else treeHasChildren(node)&&treeForEachChild(node,function(childNode){repoSendReadyTransactions(repo,childNode)})}function repoSendTransactionQueue(repo,path,queue){for(var setsToIgnore=queue.map(function(txn2){return txn2.currentWriteId}),latestState=repoGetLatestState(repo,path,setsToIgnore),snapToSend=latestState,latestHash=latestState.hash(),i=0;i<queue.length;i++){var txn=queue[i];util.assert(0===txn.status,"tryToSendTransactionQueue_: items in queue should all be run."),txn.status=1,txn.retryCount++;var relativePath=newRelativePath(path,txn.path);snapToSend=snapToSend.updateChild(relativePath,txn.currentOutputSnapshotRaw)}var dataToSend=snapToSend.val(!0),pathToSend=path;repo.server_.put(pathToSend.toString(),dataToSend,function(status){repoLog(repo,"transaction put response",{path:pathToSend.toString(),status});var events=[];if("ok"===status){for(var callbacks=[],_loop_1=__name(function(i3){queue[i3].status=2,events=events.concat(syncTreeAckUserWrite(repo.serverSyncTree_,queue[i3].currentWriteId)),queue[i3].onComplete&&callbacks.push(function(){return queue[i3].onComplete(null,!0,queue[i3].currentOutputSnapshotResolved)}),queue[i3].unwatcher()},"_loop_1"),i2=0;i2<queue.length;i2++)_loop_1(i2);repoPruneCompletedTransactionsBelowNode(repo,treeSubTree(repo.transactionQueueTree_,path)),repoSendReadyTransactions(repo,repo.transactionQueueTree_),eventQueueRaiseEventsForChangedPath(repo.eventQueue_,path,events);for(i2=0;i2<callbacks.length;i2++)exceptionGuard(callbacks[i2])}else{if("datastale"===status)for(i2=0;i2<queue.length;i2++)3===queue[i2].status?queue[i2].status=4:queue[i2].status=0;else{warn("transaction at "+pathToSend.toString()+" failed: "+status);for(i2=0;i2<queue.length;i2++)queue[i2].status=4,queue[i2].abortReason=status}repoRerunTransactions(repo,path)}},latestHash)}function repoRerunTransactions(repo,changedPath){var rootMostTransactionNode=repoGetAncestorTransactionNode(repo,changedPath),path=treeGetPath(rootMostTransactionNode);return repoRerunTransactionQueue(repo,repoBuildTransactionQueue(repo,rootMostTransactionNode),path),path}function repoRerunTransactionQueue(repo,queue,path){if(0!==queue.length){for(var callbacks=[],events=[],setsToIgnore=queue.filter(function(q){return 0===q.status}).map(function(q){return q.currentWriteId}),_loop_2=__name(function(i2){var abortReason,unwatcher,transaction=queue[i2],relativePath=newRelativePath(path,transaction.path),abortTransaction=!1;if(util.assert(null!==relativePath,"rerunTransactionsUnderNode_: relativePath should not be null."),4===transaction.status)abortTransaction=!0,abortReason=transaction.abortReason,events=events.concat(syncTreeAckUserWrite(repo.serverSyncTree_,transaction.currentWriteId,!0));else if(0===transaction.status)if(transaction.retryCount>=25)abortTransaction=!0,abortReason="maxretry",events=events.concat(syncTreeAckUserWrite(repo.serverSyncTree_,transaction.currentWriteId,!0));else{var currentNode=repoGetLatestState(repo,transaction.path,setsToIgnore);transaction.currentInputSnapshot=currentNode;var newData=queue[i2].update(currentNode.val());if(void 0!==newData){validateFirebaseData("transaction failed: Data returned ",newData,transaction.path);var newDataNode=nodeFromJSON(newData);"object"==typeof newData&&null!=newData&&util.contains(newData,".priority")||(newDataNode=newDataNode.updatePriority(currentNode.getPriority()));var oldWriteId=transaction.currentWriteId,serverValues=repoGenerateServerValues(repo),newNodeResolved=resolveDeferredValueSnapshot(newDataNode,currentNode,serverValues);transaction.currentOutputSnapshotRaw=newDataNode,transaction.currentOutputSnapshotResolved=newNodeResolved,transaction.currentWriteId=repoGetNextWriteId(repo),setsToIgnore.splice(setsToIgnore.indexOf(oldWriteId),1),events=(events=events.concat(syncTreeApplyUserOverwrite(repo.serverSyncTree_,transaction.path,newNodeResolved,transaction.currentWriteId,transaction.applyLocally))).concat(syncTreeAckUserWrite(repo.serverSyncTree_,oldWriteId,!0))}else abortTransaction=!0,abortReason="nodata",events=events.concat(syncTreeAckUserWrite(repo.serverSyncTree_,transaction.currentWriteId,!0))}eventQueueRaiseEventsForChangedPath(repo.eventQueue_,path,events),events=[],abortTransaction&&(queue[i2].status=2,unwatcher=queue[i2].unwatcher,setTimeout(unwatcher,Math.floor(0)),queue[i2].onComplete&&("nodata"===abortReason?callbacks.push(function(){return queue[i2].onComplete(null,!1,queue[i2].currentInputSnapshot)}):callbacks.push(function(){return queue[i2].onComplete(new Error(abortReason),!1,null)})))},"_loop_2"),i=0;i<queue.length;i++)_loop_2(i);repoPruneCompletedTransactionsBelowNode(repo,repo.transactionQueueTree_);for(i=0;i<callbacks.length;i++)exceptionGuard(callbacks[i]);repoSendReadyTransactions(repo,repo.transactionQueueTree_)}}function repoGetAncestorTransactionNode(repo,path){var front,transactionNode=repo.transactionQueueTree_;for(front=pathGetFront(path);null!==front&&void 0===treeGetValue(transactionNode);)transactionNode=treeSubTree(transactionNode,front),front=pathGetFront(path=pathPopFront(path));return transactionNode}function repoBuildTransactionQueue(repo,transactionNode){var transactionQueue=[];return repoAggregateTransactionQueuesForNode(repo,transactionNode,transactionQueue),transactionQueue.sort(function(a,b){return a.order-b.order}),transactionQueue}function repoAggregateTransactionQueuesForNode(repo,node,queue){var nodeQueue=treeGetValue(node);if(nodeQueue)for(var i=0;i<nodeQueue.length;i++)queue.push(nodeQueue[i]);treeForEachChild(node,function(child2){repoAggregateTransactionQueuesForNode(repo,child2,queue)})}function repoPruneCompletedTransactionsBelowNode(repo,node){var queue=treeGetValue(node);if(queue){for(var to=0,from=0;from<queue.length;from++)2!==queue[from].status&&(queue[to]=queue[from],to++);queue.length=to,treeSetValue(node,queue.length>0?queue:void 0)}treeForEachChild(node,function(childNode){repoPruneCompletedTransactionsBelowNode(repo,childNode)})}function repoAbortTransactions(repo,path){var affectedPath=treeGetPath(repoGetAncestorTransactionNode(repo,path)),transactionNode=treeSubTree(repo.transactionQueueTree_,path);return treeForEachAncestor(transactionNode,function(node){repoAbortTransactionsOnNode(repo,node)}),repoAbortTransactionsOnNode(repo,transactionNode),treeForEachDescendant(transactionNode,function(node){repoAbortTransactionsOnNode(repo,node)}),affectedPath}function repoAbortTransactionsOnNode(repo,node){var queue=treeGetValue(node);if(queue){for(var callbacks=[],events=[],lastSent=-1,i=0;i<queue.length;i++)3===queue[i].status||(1===queue[i].status?(util.assert(lastSent===i-1,"All SENT items should be at beginning of queue."),lastSent=i,queue[i].status=3,queue[i].abortReason="set"):(util.assert(0===queue[i].status,"Unexpected transaction status in abort"),queue[i].unwatcher(),events=events.concat(syncTreeAckUserWrite(repo.serverSyncTree_,queue[i].currentWriteId,!0)),queue[i].onComplete&&callbacks.push(queue[i].onComplete.bind(null,new Error("set"),!1,null))));-1===lastSent?treeSetValue(node,void 0):queue.length=lastSent+1,eventQueueRaiseEventsForChangedPath(repo.eventQueue_,treeGetPath(node),events);for(i=0;i<callbacks.length;i++)exceptionGuard(callbacks[i])}}function decodePath(pathString){for(var pathStringDecoded="",pieces=pathString.split("/"),i=0;i<pieces.length;i++)if(pieces[i].length>0){var piece=pieces[i];try{piece=decodeURIComponent(piece.replace(/\+/g," "))}catch(e){}pathStringDecoded+="/"+piece}return pathStringDecoded}function decodeQuery(queryString){var e_1,_a,results={};"?"===queryString.charAt(0)&&(queryString=queryString.substring(1));try{for(var _b=tslib.__values(queryString.split("&")),_c=_b.next();!_c.done;_c=_b.next()){var segment=_c.value;if(0!==segment.length){var kv=segment.split("=");2===kv.length?results[decodeURIComponent(kv[0])]=decodeURIComponent(kv[1]):warn("Invalid query segment '"+segment+"' in query '"+queryString+"'")}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}return results}__name(repoStart,"repoStart"),__name(repoServerTime,"repoServerTime"),__name(repoGenerateServerValues,"repoGenerateServerValues"),__name(repoOnDataUpdate,"repoOnDataUpdate"),__name(repoInterceptServerData,"repoInterceptServerData"),__name(repoOnConnectStatus,"repoOnConnectStatus"),__name(repoOnServerInfoUpdate,"repoOnServerInfoUpdate"),__name(repoUpdateInfo,"repoUpdateInfo"),__name(repoGetNextWriteId,"repoGetNextWriteId"),__name(repoGetValue,"repoGetValue"),__name(repoSetWithPriority,"repoSetWithPriority"),__name(repoUpdate,"repoUpdate"),__name(repoRunOnDisconnectEvents,"repoRunOnDisconnectEvents"),__name(repoOnDisconnectCancel,"repoOnDisconnectCancel"),__name(repoOnDisconnectSet,"repoOnDisconnectSet"),__name(repoOnDisconnectSetWithPriority,"repoOnDisconnectSetWithPriority"),__name(repoOnDisconnectUpdate,"repoOnDisconnectUpdate"),__name(repoAddEventCallbackForQuery,"repoAddEventCallbackForQuery"),__name(repoRemoveEventCallbackForQuery,"repoRemoveEventCallbackForQuery"),__name(repoInterrupt,"repoInterrupt"),__name(repoResume,"repoResume"),__name(repoStats,"repoStats"),__name(repoStatsIncrementCounter,"repoStatsIncrementCounter"),__name(repoLog,"repoLog"),__name(repoCallOnCompleteCallback,"repoCallOnCompleteCallback"),__name(repoStartTransaction,"repoStartTransaction"),__name(repoGetLatestState,"repoGetLatestState"),__name(repoSendReadyTransactions,"repoSendReadyTransactions"),__name(repoSendTransactionQueue,"repoSendTransactionQueue"),__name(repoRerunTransactions,"repoRerunTransactions"),__name(repoRerunTransactionQueue,"repoRerunTransactionQueue"),__name(repoGetAncestorTransactionNode,"repoGetAncestorTransactionNode"),__name(repoBuildTransactionQueue,"repoBuildTransactionQueue"),__name(repoAggregateTransactionQueuesForNode,"repoAggregateTransactionQueuesForNode"),__name(repoPruneCompletedTransactionsBelowNode,"repoPruneCompletedTransactionsBelowNode"),__name(repoAbortTransactions,"repoAbortTransactions"),__name(repoAbortTransactionsOnNode,"repoAbortTransactionsOnNode"),__name(decodePath,"decodePath"),__name(decodeQuery,"decodeQuery");var parseRepoInfo=__name(function(dataURL,nodeAdmin){var parsedUrl=parseDatabaseURL(dataURL),namespace=parsedUrl.namespace;"firebase.com"===parsedUrl.domain&&fatal(parsedUrl.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!namespace||"undefined"===namespace)&&"localhost"!==parsedUrl.domain&&fatal("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),parsedUrl.secure||warnIfPageIsSecure();var webSocketOnly="ws"===parsedUrl.scheme||"wss"===parsedUrl.scheme;return{repoInfo:new RepoInfo(parsedUrl.host,parsedUrl.secure,namespace,nodeAdmin,webSocketOnly,"",namespace!==parsedUrl.subdomain),path:new Path(parsedUrl.pathString)}},"parseRepoInfo"),parseDatabaseURL=__name(function(dataURL){var host="",domain="",subdomain="",pathString="",namespace="",secure=!0,scheme="https",port=443;if("string"==typeof dataURL){var colonInd=dataURL.indexOf("//");colonInd>=0&&(scheme=dataURL.substring(0,colonInd-1),dataURL=dataURL.substring(colonInd+2));var slashInd=dataURL.indexOf("/");-1===slashInd&&(slashInd=dataURL.length);var questionMarkInd=dataURL.indexOf("?");-1===questionMarkInd&&(questionMarkInd=dataURL.length),host=dataURL.substring(0,Math.min(slashInd,questionMarkInd)),slashInd<questionMarkInd&&(pathString=decodePath(dataURL.substring(slashInd,questionMarkInd)));var queryParams=decodeQuery(dataURL.substring(Math.min(dataURL.length,questionMarkInd)));(colonInd=host.indexOf(":"))>=0?(secure="https"===scheme||"wss"===scheme,port=parseInt(host.substring(colonInd+1),10)):colonInd=host.length;var hostWithoutPort=host.slice(0,colonInd);if("localhost"===hostWithoutPort.toLowerCase())domain="localhost";else if(hostWithoutPort.split(".").length<=2)domain=hostWithoutPort;else{var dotInd=host.indexOf(".");subdomain=host.substring(0,dotInd).toLowerCase(),domain=host.substring(dotInd+1),namespace=subdomain}"ns"in queryParams&&(namespace=queryParams.ns)}return{host,port,domain,subdomain,secure,scheme,pathString,namespace}},"parseDatabaseURL"),DataEvent=function(){function DataEvent2(eventType,eventRegistration,snapshot,prevName){this.eventType=eventType,this.eventRegistration=eventRegistration,this.snapshot=snapshot,this.prevName=prevName}return __name(DataEvent2,"DataEvent"),DataEvent2.prototype.getPath=function(){var ref2=this.snapshot.ref;return"value"===this.eventType?ref2._path:ref2.parent._path},DataEvent2.prototype.getEventType=function(){return this.eventType},DataEvent2.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},DataEvent2.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+util.stringify(this.snapshot.exportVal())},DataEvent2}(),CancelEvent=function(){function CancelEvent2(eventRegistration,error2,path){this.eventRegistration=eventRegistration,this.error=error2,this.path=path}return __name(CancelEvent2,"CancelEvent"),CancelEvent2.prototype.getPath=function(){return this.path},CancelEvent2.prototype.getEventType=function(){return"cancel"},CancelEvent2.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},CancelEvent2.prototype.toString=function(){return this.path.toString()+":cancel"},CancelEvent2}(),CallbackContext=function(){function CallbackContext2(snapshotCallback,cancelCallback){this.snapshotCallback=snapshotCallback,this.cancelCallback=cancelCallback}return __name(CallbackContext2,"CallbackContext"),CallbackContext2.prototype.onValue=function(expDataSnapshot,previousChildName){this.snapshotCallback.call(null,expDataSnapshot,previousChildName)},CallbackContext2.prototype.onCancel=function(error2){return util.assert(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,error2)},Object.defineProperty(CallbackContext2.prototype,"hasCancelCallback",{get:function(){return!!this.cancelCallback},enumerable:!1,configurable:!0}),CallbackContext2.prototype.matches=function(other){return this.snapshotCallback===other.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===other.snapshotCallback.userCallback&&this.snapshotCallback.context===other.snapshotCallback.context},CallbackContext2}(),OnDisconnect$1=function(){function OnDisconnect2(_repo,_path){this._repo=_repo,this._path=_path}return __name(OnDisconnect2,"OnDisconnect"),OnDisconnect2.prototype.cancel=function(){var deferred=new util.Deferred;return repoOnDisconnectCancel(this._repo,this._path,deferred.wrapCallback(function(){})),deferred.promise},OnDisconnect2.prototype.remove=function(){validateWritablePath("OnDisconnect.remove",this._path);var deferred=new util.Deferred;return repoOnDisconnectSet(this._repo,this._path,null,deferred.wrapCallback(function(){})),deferred.promise},OnDisconnect2.prototype.set=function(value){validateWritablePath("OnDisconnect.set",this._path),validateFirebaseDataArg("OnDisconnect.set",value,this._path,!1);var deferred=new util.Deferred;return repoOnDisconnectSet(this._repo,this._path,value,deferred.wrapCallback(function(){})),deferred.promise},OnDisconnect2.prototype.setWithPriority=function(value,priority){validateWritablePath("OnDisconnect.setWithPriority",this._path),validateFirebaseDataArg("OnDisconnect.setWithPriority",value,this._path,!1),validatePriority("OnDisconnect.setWithPriority",priority,!1);var deferred=new util.Deferred;return repoOnDisconnectSetWithPriority(this._repo,this._path,value,priority,deferred.wrapCallback(function(){})),deferred.promise},OnDisconnect2.prototype.update=function(values){validateWritablePath("OnDisconnect.update",this._path),validateFirebaseMergeDataArg("OnDisconnect.update",values,this._path,!1);var deferred=new util.Deferred;return repoOnDisconnectUpdate(this._repo,this._path,values,deferred.wrapCallback(function(){})),deferred.promise},OnDisconnect2}(),QueryImpl=function(){function QueryImpl2(_repo,_path,_queryParams,_orderByCalled){this._repo=_repo,this._path=_path,this._queryParams=_queryParams,this._orderByCalled=_orderByCalled}return __name(QueryImpl2,"QueryImpl"),Object.defineProperty(QueryImpl2.prototype,"key",{get:function(){return pathIsEmpty(this._path)?null:pathGetBack(this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(QueryImpl2.prototype,"ref",{get:function(){return new ReferenceImpl(this._repo,this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(QueryImpl2.prototype,"_queryIdentifier",{get:function(){var obj=queryParamsGetQueryObject(this._queryParams),id=ObjectToUniqueKey(obj);return"{}"===id?"default":id},enumerable:!1,configurable:!0}),Object.defineProperty(QueryImpl2.prototype,"_queryObject",{get:function(){return queryParamsGetQueryObject(this._queryParams)},enumerable:!1,configurable:!0}),QueryImpl2.prototype.isEqual=function(other){if(!((other=util.getModularInstance(other))instanceof QueryImpl2))return!1;var sameRepo=this._repo===other._repo,samePath=pathEquals(this._path,other._path),sameQueryIdentifier=this._queryIdentifier===other._queryIdentifier;return sameRepo&&samePath&&sameQueryIdentifier},QueryImpl2.prototype.toJSON=function(){return this.toString()},QueryImpl2.prototype.toString=function(){return this._repo.toString()+pathToUrlEncodedString(this._path)},QueryImpl2}();function validateNoPreviousOrderByCall(query2,fnName){if(!0===query2._orderByCalled)throw new Error(fnName+": You can't combine multiple orderBy calls.")}function validateQueryEndpoints(params){var startNode=null,endNode=null;if(params.hasStart()&&(startNode=params.getIndexStartValue()),params.hasEnd()&&(endNode=params.getIndexEndValue()),params.getIndex()===KEY_INDEX){var tooManyArgsError="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",wrongArgTypeError="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(params.hasStart()){if(params.getIndexStartName()!==MIN_NAME)throw new Error(tooManyArgsError);if("string"!=typeof startNode)throw new Error(wrongArgTypeError)}if(params.hasEnd()){if(params.getIndexEndName()!==MAX_NAME)throw new Error(tooManyArgsError);if("string"!=typeof endNode)throw new Error(wrongArgTypeError)}}else if(params.getIndex()===PRIORITY_INDEX){if(null!=startNode&&!isValidPriority(startNode)||null!=endNode&&!isValidPriority(endNode))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(util.assert(params.getIndex()instanceof PathIndex||params.getIndex()===VALUE_INDEX,"unknown index type."),null!=startNode&&"object"==typeof startNode||null!=endNode&&"object"==typeof endNode)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function validateLimit(params){if(params.hasStart()&&params.hasEnd()&&params.hasLimit()&&!params.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}__name(validateNoPreviousOrderByCall,"validateNoPreviousOrderByCall"),__name(validateQueryEndpoints,"validateQueryEndpoints"),__name(validateLimit,"validateLimit");var ReferenceImpl=function(_super){function ReferenceImpl2(repo,path){return _super.call(this,repo,path,new QueryParams,!1)||this}return tslib.__extends(ReferenceImpl2,_super),__name(ReferenceImpl2,"ReferenceImpl"),Object.defineProperty(ReferenceImpl2.prototype,"parent",{get:function(){var parentPath=pathParent(this._path);return null===parentPath?null:new ReferenceImpl2(this._repo,parentPath)},enumerable:!1,configurable:!0}),Object.defineProperty(ReferenceImpl2.prototype,"root",{get:function(){for(var ref2=this;null!==ref2.parent;)ref2=ref2.parent;return ref2},enumerable:!1,configurable:!0}),ReferenceImpl2}(QueryImpl),DataSnapshot$1=function(){function DataSnapshot2(_node,ref2,_index){this._node=_node,this.ref=ref2,this._index=_index}return __name(DataSnapshot2,"DataSnapshot"),Object.defineProperty(DataSnapshot2.prototype,"priority",{get:function(){return this._node.getPriority().val()},enumerable:!1,configurable:!0}),Object.defineProperty(DataSnapshot2.prototype,"key",{get:function(){return this.ref.key},enumerable:!1,configurable:!0}),Object.defineProperty(DataSnapshot2.prototype,"size",{get:function(){return this._node.numChildren()},enumerable:!1,configurable:!0}),DataSnapshot2.prototype.child=function(path){var childPath=new Path(path),childRef=child(this.ref,path);return new DataSnapshot2(this._node.getChild(childPath),childRef,PRIORITY_INDEX)},DataSnapshot2.prototype.exists=function(){return!this._node.isEmpty()},DataSnapshot2.prototype.exportVal=function(){return this._node.val(!0)},DataSnapshot2.prototype.forEach=function(action){var _this=this;return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,function(key,node){return action(new DataSnapshot2(node,child(_this.ref,key),PRIORITY_INDEX))})},DataSnapshot2.prototype.hasChild=function(path){var childPath=new Path(path);return!this._node.getChild(childPath).isEmpty()},DataSnapshot2.prototype.hasChildren=function(){return!this._node.isLeafNode()&&!this._node.isEmpty()},DataSnapshot2.prototype.toJSON=function(){return this.exportVal()},DataSnapshot2.prototype.val=function(){return this._node.val()},DataSnapshot2}();function ref(db,path){return(db=util.getModularInstance(db))._checkNotDeleted("ref"),void 0!==path?child(db._root,path):db._root}function refFromURL(db,url){(db=util.getModularInstance(db))._checkNotDeleted("refFromURL");var parsedURL=parseRepoInfo(url,db._repo.repoInfo_.nodeAdmin);validateUrl("refFromURL",parsedURL);var repoInfo=parsedURL.repoInfo;return!db._repo.repoInfo_.isCustomHost()&&repoInfo.host!==db._repo.repoInfo_.host&&fatal("refFromURL: Host name does not match the current database: (found "+repoInfo.host+" but expected "+db._repo.repoInfo_.host+")"),ref(db,parsedURL.path.toString())}function child(parent,path){return null===pathGetFront((parent=util.getModularInstance(parent))._path)?validateRootPathString("child","path",path,!1):validatePathString("child","path",path,!1),new ReferenceImpl(parent._repo,pathChild(parent._path,path))}function push(parent,value){parent=util.getModularInstance(parent),validateWritablePath("push",parent._path),validateFirebaseDataArg("push",value,parent._path,!0);var promise,now=repoServerTime(parent._repo),name2=nextPushId(now),thennablePushRef=child(parent,name2),pushRef=child(parent,name2);return promise=null!=value?set(pushRef,value).then(function(){return pushRef}):Promise.resolve(pushRef),thennablePushRef.then=promise.then.bind(promise),thennablePushRef.catch=promise.then.bind(promise,void 0),thennablePushRef}function remove(ref2){return validateWritablePath("remove",ref2._path),set(ref2,null)}function set(ref2,value){ref2=util.getModularInstance(ref2),validateWritablePath("set",ref2._path),validateFirebaseDataArg("set",value,ref2._path,!1);var deferred=new util.Deferred;return repoSetWithPriority(ref2._repo,ref2._path,value,null,deferred.wrapCallback(function(){})),deferred.promise}function setPriority(ref2,priority){ref2=util.getModularInstance(ref2),validateWritablePath("setPriority",ref2._path),validatePriority("setPriority",priority,!1);var deferred=new util.Deferred;return repoSetWithPriority(ref2._repo,pathChild(ref2._path,".priority"),priority,null,deferred.wrapCallback(function(){})),deferred.promise}function setWithPriority(ref2,value,priority){if(validateWritablePath("setWithPriority",ref2._path),validateFirebaseDataArg("setWithPriority",value,ref2._path,!1),validatePriority("setWithPriority",priority,!1),".length"===ref2.key||".keys"===ref2.key)throw"setWithPriority failed: "+ref2.key+" is a read-only object.";var deferred=new util.Deferred;return repoSetWithPriority(ref2._repo,ref2._path,value,priority,deferred.wrapCallback(function(){})),deferred.promise}function update(ref2,values){validateFirebaseMergeDataArg("update",values,ref2._path,!1);var deferred=new util.Deferred;return repoUpdate(ref2._repo,ref2._path,values,deferred.wrapCallback(function(){})),deferred.promise}function get(query2){return repoGetValue((query2=util.getModularInstance(query2))._repo,query2).then(function(node){return new DataSnapshot$1(node,new ReferenceImpl(query2._repo,query2._path),query2._queryParams.getIndex())})}__name(ref,"ref"),__name(refFromURL,"refFromURL"),__name(child,"child"),__name(push,"push"),__name(remove,"remove"),__name(set,"set"),__name(setPriority,"setPriority"),__name(setWithPriority,"setWithPriority"),__name(update,"update"),__name(get,"get");var ValueEventRegistration=function(){function ValueEventRegistration2(callbackContext){this.callbackContext=callbackContext}return __name(ValueEventRegistration2,"ValueEventRegistration"),ValueEventRegistration2.prototype.respondsTo=function(eventType){return"value"===eventType},ValueEventRegistration2.prototype.createEvent=function(change,query2){var index=query2._queryParams.getIndex();return new DataEvent("value",this,new DataSnapshot$1(change.snapshotNode,new ReferenceImpl(query2._repo,query2._path),index))},ValueEventRegistration2.prototype.getEventRunner=function(eventData){var _this=this;return"cancel"===eventData.getEventType()?function(){return _this.callbackContext.onCancel(eventData.error)}:function(){return _this.callbackContext.onValue(eventData.snapshot,null)}},ValueEventRegistration2.prototype.createCancelEvent=function(error2,path){return this.callbackContext.hasCancelCallback?new CancelEvent(this,error2,path):null},ValueEventRegistration2.prototype.matches=function(other){return other instanceof ValueEventRegistration2&&(!other.callbackContext||!this.callbackContext||other.callbackContext.matches(this.callbackContext))},ValueEventRegistration2.prototype.hasAnyCallback=function(){return null!==this.callbackContext},ValueEventRegistration2}(),ChildEventRegistration=function(){function ChildEventRegistration2(eventType,callbackContext){this.eventType=eventType,this.callbackContext=callbackContext}return __name(ChildEventRegistration2,"ChildEventRegistration"),ChildEventRegistration2.prototype.respondsTo=function(eventType){var eventToCheck="children_added"===eventType?"child_added":eventType;return eventToCheck="children_removed"===eventToCheck?"child_removed":eventToCheck,this.eventType===eventToCheck},ChildEventRegistration2.prototype.createCancelEvent=function(error2,path){return this.callbackContext.hasCancelCallback?new CancelEvent(this,error2,path):null},ChildEventRegistration2.prototype.createEvent=function(change,query2){util.assert(null!=change.childName,"Child events should have a childName.");var childRef=child(new ReferenceImpl(query2._repo,query2._path),change.childName),index=query2._queryParams.getIndex();return new DataEvent(change.type,this,new DataSnapshot$1(change.snapshotNode,childRef,index),change.prevName)},ChildEventRegistration2.prototype.getEventRunner=function(eventData){var _this=this;return"cancel"===eventData.getEventType()?function(){return _this.callbackContext.onCancel(eventData.error)}:function(){return _this.callbackContext.onValue(eventData.snapshot,eventData.prevName)}},ChildEventRegistration2.prototype.matches=function(other){return other instanceof ChildEventRegistration2&&(this.eventType===other.eventType&&(!this.callbackContext||!other.callbackContext||this.callbackContext.matches(other.callbackContext)))},ChildEventRegistration2.prototype.hasAnyCallback=function(){return!!this.callbackContext},ChildEventRegistration2}();function addEventListener(query2,eventType,callback,cancelCallbackOrListenOptions,options){var cancelCallback;if("object"==typeof cancelCallbackOrListenOptions&&(cancelCallback=void 0,options=cancelCallbackOrListenOptions),"function"==typeof cancelCallbackOrListenOptions&&(cancelCallback=cancelCallbackOrListenOptions),options&&options.onlyOnce){var userCallback_1=callback,onceCallback=__name(function(dataSnapshot,previousChildName){repoRemoveEventCallbackForQuery(query2._repo,query2,container),userCallback_1(dataSnapshot,previousChildName)},"onceCallback");onceCallback.userCallback=callback.userCallback,onceCallback.context=callback.context,callback=onceCallback}var callbackContext=new CallbackContext(callback,cancelCallback||void 0),container="value"===eventType?new ValueEventRegistration(callbackContext):new ChildEventRegistration(eventType,callbackContext);return repoAddEventCallbackForQuery(query2._repo,query2,container),function(){return repoRemoveEventCallbackForQuery(query2._repo,query2,container)}}function onValue(query2,callback,cancelCallbackOrListenOptions,options){return addEventListener(query2,"value",callback,cancelCallbackOrListenOptions,options)}function onChildAdded(query2,callback,cancelCallbackOrListenOptions,options){return addEventListener(query2,"child_added",callback,cancelCallbackOrListenOptions,options)}function onChildChanged(query2,callback,cancelCallbackOrListenOptions,options){return addEventListener(query2,"child_changed",callback,cancelCallbackOrListenOptions,options)}function onChildMoved(query2,callback,cancelCallbackOrListenOptions,options){return addEventListener(query2,"child_moved",callback,cancelCallbackOrListenOptions,options)}function onChildRemoved(query2,callback,cancelCallbackOrListenOptions,options){return addEventListener(query2,"child_removed",callback,cancelCallbackOrListenOptions,options)}function off(query2,eventType,callback){var container=null,expCallback=callback?new CallbackContext(callback):null;"value"===eventType?container=new ValueEventRegistration(expCallback):eventType&&(container=new ChildEventRegistration(eventType,expCallback)),repoRemoveEventCallbackForQuery(query2._repo,query2,container)}__name(addEventListener,"addEventListener"),__name(onValue,"onValue"),__name(onChildAdded,"onChildAdded"),__name(onChildChanged,"onChildChanged"),__name(onChildMoved,"onChildMoved"),__name(onChildRemoved,"onChildRemoved"),__name(off,"off");var QueryConstraint=function(){function QueryConstraint2(){}return __name(QueryConstraint2,"QueryConstraint"),QueryConstraint2}(),QueryEndAtConstraint=function(_super){function QueryEndAtConstraint2(_value,_key){var _this=_super.call(this)||this;return _this._value=_value,_this._key=_key,_this}return tslib.__extends(QueryEndAtConstraint2,_super),__name(QueryEndAtConstraint2,"QueryEndAtConstraint"),QueryEndAtConstraint2.prototype._apply=function(query2){validateFirebaseDataArg("endAt",this._value,query2._path,!0);var newParams=queryParamsEndAt(query2._queryParams,this._value,this._key);if(validateLimit(newParams),validateQueryEndpoints(newParams),query2._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new QueryImpl(query2._repo,query2._path,newParams,query2._orderByCalled)},QueryEndAtConstraint2}(QueryConstraint);function endAt(value,key){return validateKey("endAt","key",key,!0),new QueryEndAtConstraint(value,key)}__name(endAt,"endAt");var QueryEndBeforeConstraint=function(_super){function QueryEndBeforeConstraint2(_value,_key){var _this=_super.call(this)||this;return _this._value=_value,_this._key=_key,_this}return tslib.__extends(QueryEndBeforeConstraint2,_super),__name(QueryEndBeforeConstraint2,"QueryEndBeforeConstraint"),QueryEndBeforeConstraint2.prototype._apply=function(query2){validateFirebaseDataArg("endBefore",this._value,query2._path,!1);var newParams=queryParamsEndBefore(query2._queryParams,this._value,this._key);if(validateLimit(newParams),validateQueryEndpoints(newParams),query2._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new QueryImpl(query2._repo,query2._path,newParams,query2._orderByCalled)},QueryEndBeforeConstraint2}(QueryConstraint);function endBefore(value,key){return validateKey("endBefore","key",key,!0),new QueryEndBeforeConstraint(value,key)}__name(endBefore,"endBefore");var QueryStartAtConstraint=function(_super){function QueryStartAtConstraint2(_value,_key){var _this=_super.call(this)||this;return _this._value=_value,_this._key=_key,_this}return tslib.__extends(QueryStartAtConstraint2,_super),__name(QueryStartAtConstraint2,"QueryStartAtConstraint"),QueryStartAtConstraint2.prototype._apply=function(query2){validateFirebaseDataArg("startAt",this._value,query2._path,!0);var newParams=queryParamsStartAt(query2._queryParams,this._value,this._key);if(validateLimit(newParams),validateQueryEndpoints(newParams),query2._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new QueryImpl(query2._repo,query2._path,newParams,query2._orderByCalled)},QueryStartAtConstraint2}(QueryConstraint);function startAt(value,key){return void 0===value&&(value=null),validateKey("startAt","key",key,!0),new QueryStartAtConstraint(value,key)}__name(startAt,"startAt");var QueryStartAfterConstraint=function(_super){function QueryStartAfterConstraint2(_value,_key){var _this=_super.call(this)||this;return _this._value=_value,_this._key=_key,_this}return tslib.__extends(QueryStartAfterConstraint2,_super),__name(QueryStartAfterConstraint2,"QueryStartAfterConstraint"),QueryStartAfterConstraint2.prototype._apply=function(query2){validateFirebaseDataArg("startAfter",this._value,query2._path,!1);var newParams=queryParamsStartAfter(query2._queryParams,this._value,this._key);if(validateLimit(newParams),validateQueryEndpoints(newParams),query2._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new QueryImpl(query2._repo,query2._path,newParams,query2._orderByCalled)},QueryStartAfterConstraint2}(QueryConstraint);function startAfter(value,key){return validateKey("startAfter","key",key,!0),new QueryStartAfterConstraint(value,key)}__name(startAfter,"startAfter");var QueryLimitToFirstConstraint=function(_super){function QueryLimitToFirstConstraint2(_limit){var _this=_super.call(this)||this;return _this._limit=_limit,_this}return tslib.__extends(QueryLimitToFirstConstraint2,_super),__name(QueryLimitToFirstConstraint2,"QueryLimitToFirstConstraint"),QueryLimitToFirstConstraint2.prototype._apply=function(query2){if(query2._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new QueryImpl(query2._repo,query2._path,queryParamsLimitToFirst(query2._queryParams,this._limit),query2._orderByCalled)},QueryLimitToFirstConstraint2}(QueryConstraint);function limitToFirst(limit){if("number"!=typeof limit||Math.floor(limit)!==limit||limit<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new QueryLimitToFirstConstraint(limit)}__name(limitToFirst,"limitToFirst");var QueryLimitToLastConstraint=function(_super){function QueryLimitToLastConstraint2(_limit){var _this=_super.call(this)||this;return _this._limit=_limit,_this}return tslib.__extends(QueryLimitToLastConstraint2,_super),__name(QueryLimitToLastConstraint2,"QueryLimitToLastConstraint"),QueryLimitToLastConstraint2.prototype._apply=function(query2){if(query2._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new QueryImpl(query2._repo,query2._path,queryParamsLimitToLast(query2._queryParams,this._limit),query2._orderByCalled)},QueryLimitToLastConstraint2}(QueryConstraint);function limitToLast(limit){if("number"!=typeof limit||Math.floor(limit)!==limit||limit<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new QueryLimitToLastConstraint(limit)}__name(limitToLast,"limitToLast");var QueryOrderByChildConstraint=function(_super){function QueryOrderByChildConstraint2(_path){var _this=_super.call(this)||this;return _this._path=_path,_this}return tslib.__extends(QueryOrderByChildConstraint2,_super),__name(QueryOrderByChildConstraint2,"QueryOrderByChildConstraint"),QueryOrderByChildConstraint2.prototype._apply=function(query2){validateNoPreviousOrderByCall(query2,"orderByChild");var parsedPath=new Path(this._path);if(pathIsEmpty(parsedPath))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");var index=new PathIndex(parsedPath),newParams=queryParamsOrderBy(query2._queryParams,index);return validateQueryEndpoints(newParams),new QueryImpl(query2._repo,query2._path,newParams,!0)},QueryOrderByChildConstraint2}(QueryConstraint);function orderByChild(path){if("$key"===path)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===path)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===path)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return validatePathString("orderByChild","path",path,!1),new QueryOrderByChildConstraint(path)}__name(orderByChild,"orderByChild");var QueryOrderByKeyConstraint=function(_super){function QueryOrderByKeyConstraint2(){return null!==_super&&_super.apply(this,arguments)||this}return tslib.__extends(QueryOrderByKeyConstraint2,_super),__name(QueryOrderByKeyConstraint2,"QueryOrderByKeyConstraint"),QueryOrderByKeyConstraint2.prototype._apply=function(query2){validateNoPreviousOrderByCall(query2,"orderByKey");var newParams=queryParamsOrderBy(query2._queryParams,KEY_INDEX);return validateQueryEndpoints(newParams),new QueryImpl(query2._repo,query2._path,newParams,!0)},QueryOrderByKeyConstraint2}(QueryConstraint);function orderByKey(){return new QueryOrderByKeyConstraint}__name(orderByKey,"orderByKey");var QueryOrderByPriorityConstraint=function(_super){function QueryOrderByPriorityConstraint2(){return null!==_super&&_super.apply(this,arguments)||this}return tslib.__extends(QueryOrderByPriorityConstraint2,_super),__name(QueryOrderByPriorityConstraint2,"QueryOrderByPriorityConstraint"),QueryOrderByPriorityConstraint2.prototype._apply=function(query2){validateNoPreviousOrderByCall(query2,"orderByPriority");var newParams=queryParamsOrderBy(query2._queryParams,PRIORITY_INDEX);return validateQueryEndpoints(newParams),new QueryImpl(query2._repo,query2._path,newParams,!0)},QueryOrderByPriorityConstraint2}(QueryConstraint);function orderByPriority(){return new QueryOrderByPriorityConstraint}__name(orderByPriority,"orderByPriority");var QueryOrderByValueConstraint=function(_super){function QueryOrderByValueConstraint2(){return null!==_super&&_super.apply(this,arguments)||this}return tslib.__extends(QueryOrderByValueConstraint2,_super),__name(QueryOrderByValueConstraint2,"QueryOrderByValueConstraint"),QueryOrderByValueConstraint2.prototype._apply=function(query2){validateNoPreviousOrderByCall(query2,"orderByValue");var newParams=queryParamsOrderBy(query2._queryParams,VALUE_INDEX);return validateQueryEndpoints(newParams),new QueryImpl(query2._repo,query2._path,newParams,!0)},QueryOrderByValueConstraint2}(QueryConstraint);function orderByValue(){return new QueryOrderByValueConstraint}__name(orderByValue,"orderByValue");var QueryEqualToValueConstraint=function(_super){function QueryEqualToValueConstraint2(_value,_key){var _this=_super.call(this)||this;return _this._value=_value,_this._key=_key,_this}return tslib.__extends(QueryEqualToValueConstraint2,_super),__name(QueryEqualToValueConstraint2,"QueryEqualToValueConstraint"),QueryEqualToValueConstraint2.prototype._apply=function(query2){if(validateFirebaseDataArg("equalTo",this._value,query2._path,!1),query2._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(query2._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new QueryEndAtConstraint(this._value,this._key)._apply(new QueryStartAtConstraint(this._value,this._key)._apply(query2))},QueryEqualToValueConstraint2}(QueryConstraint);function equalTo(value,key){return validateKey("equalTo","key",key,!0),new QueryEqualToValueConstraint(value,key)}function query(query2){for(var e_1,_a,queryConstraints=[],_i=1;_i<arguments.length;_i++)queryConstraints[_i-1]=arguments[_i];var queryImpl=util.getModularInstance(query2);try{for(var queryConstraints_1=tslib.__values(queryConstraints),queryConstraints_1_1=queryConstraints_1.next();!queryConstraints_1_1.done;queryConstraints_1_1=queryConstraints_1.next()){var constraint=queryConstraints_1_1.value;queryImpl=constraint._apply(queryImpl)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{queryConstraints_1_1&&!queryConstraints_1_1.done&&(_a=queryConstraints_1.return)&&_a.call(queryConstraints_1)}finally{if(e_1)throw e_1.error}}return queryImpl}__name(equalTo,"equalTo"),__name(query,"query"),syncPointSetReferenceConstructor(ReferenceImpl),syncTreeSetReferenceConstructor(ReferenceImpl);var repos={},useRestClient=!1;function repoManagerApplyEmulatorSettings(repo,host,port,tokenProvider){repo.repoInfo_=new RepoInfo(host+":"+port,!1,repo.repoInfo_.namespace,repo.repoInfo_.webSocketOnly,repo.repoInfo_.nodeAdmin,repo.repoInfo_.persistenceKey,repo.repoInfo_.includeNamespaceInQueryParams),tokenProvider&&(repo.authTokenProvider_=tokenProvider)}function repoManagerDatabaseFromApp(app,authProvider,appCheckProvider,url,nodeAdmin){var dbUrl=url||app.options.databaseURL;void 0===dbUrl&&(app.options.projectId||fatal("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),log("Using default host for project ",app.options.projectId),dbUrl=app.options.projectId+"-default-rtdb.firebaseio.com");var isEmulator,parsedUrl=parseRepoInfo(dbUrl,nodeAdmin),repoInfo=parsedUrl.repoInfo,dbEmulatorHost=void 0;"undefined"!=typeof process&&(dbEmulatorHost=process.env.FIREBASE_DATABASE_EMULATOR_HOST),dbEmulatorHost?(isEmulator=!0,dbUrl="http://"+dbEmulatorHost+"?ns="+repoInfo.namespace,repoInfo=(parsedUrl=parseRepoInfo(dbUrl,nodeAdmin)).repoInfo):isEmulator=!parsedUrl.repoInfo.secure;var authTokenProvider=nodeAdmin&&isEmulator?new EmulatorTokenProvider(EmulatorTokenProvider.OWNER):new FirebaseAuthTokenProvider(app.name,app.options,authProvider);validateUrl("Invalid Firebase Database URL",parsedUrl),pathIsEmpty(parsedUrl.path)||fatal("Database URL must point to the root of a Firebase Database (not including a child path).");var repo=repoManagerCreateRepo(repoInfo,app,authTokenProvider,new AppCheckTokenProvider(app.name,appCheckProvider));return new Database$1(repo,app)}function repoManagerDeleteRepo(repo,appName){var appRepos=repos[appName];(!appRepos||appRepos[repo.key]!==repo)&&fatal("Database "+appName+"("+repo.repoInfo_+") has already been deleted."),repoInterrupt(repo),delete appRepos[repo.key]}function repoManagerCreateRepo(repoInfo,app,authTokenProvider,appCheckProvider){var appRepos=repos[app.name];appRepos||(appRepos={},repos[app.name]=appRepos);var repo=appRepos[repoInfo.toURLString()];return repo&&fatal("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),repo=new Repo(repoInfo,useRestClient,authTokenProvider,appCheckProvider),appRepos[repoInfo.toURLString()]=repo,repo}function repoManagerForceRestClient(forceRestClient2){useRestClient=forceRestClient2}__name(repoManagerApplyEmulatorSettings,"repoManagerApplyEmulatorSettings"),__name(repoManagerDatabaseFromApp,"repoManagerDatabaseFromApp"),__name(repoManagerDeleteRepo,"repoManagerDeleteRepo"),__name(repoManagerCreateRepo,"repoManagerCreateRepo"),__name(repoManagerForceRestClient,"repoManagerForceRestClient");var Database$1=function(){function Database2(_repoInternal,app){this._repoInternal=_repoInternal,this.app=app,this.type="database",this._instanceStarted=!1}return __name(Database2,"Database"),Object.defineProperty(Database2.prototype,"_repo",{get:function(){return this._instanceStarted||(repoStart(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal},enumerable:!1,configurable:!0}),Object.defineProperty(Database2.prototype,"_root",{get:function(){return this._rootInternal||(this._rootInternal=new ReferenceImpl(this._repo,newEmptyPath())),this._rootInternal},enumerable:!1,configurable:!0}),Database2.prototype._delete=function(){return null!==this._rootInternal&&(repoManagerDeleteRepo(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()},Database2.prototype._checkNotDeleted=function(apiName){null===this._rootInternal&&fatal("Cannot call "+apiName+" on a deleted database.")},Database2}();function connectDatabaseEmulator(db,host,port,options){void 0===options&&(options={}),(db=util.getModularInstance(db))._checkNotDeleted("useEmulator"),db._instanceStarted&&fatal("Cannot call useEmulator() after instance has already been initialized.");var repo=db._repoInternal,tokenProvider=void 0;if(repo.repoInfo_.nodeAdmin)options.mockUserToken&&fatal('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),tokenProvider=new EmulatorTokenProvider(EmulatorTokenProvider.OWNER);else if(options.mockUserToken){var token="string"==typeof options.mockUserToken?options.mockUserToken:util.createMockUserToken(options.mockUserToken,db.app.options.projectId);tokenProvider=new EmulatorTokenProvider(token)}repoManagerApplyEmulatorSettings(repo,host,port,tokenProvider)}function goOffline(db){(db=util.getModularInstance(db))._checkNotDeleted("goOffline"),repoInterrupt(db._repo)}function goOnline(db){(db=util.getModularInstance(db))._checkNotDeleted("goOnline"),repoResume(db._repo)}function enableLogging(logger2,persistent){enableLogging$1(logger2,persistent)}__name(connectDatabaseEmulator,"connectDatabaseEmulator"),__name(goOffline,"goOffline"),__name(goOnline,"goOnline"),__name(enableLogging,"enableLogging");var SERVER_TIMESTAMP={".sv":"timestamp"};function serverTimestamp(){return SERVER_TIMESTAMP}function increment(delta){return{".sv":{increment:delta}}}__name(serverTimestamp,"serverTimestamp"),__name(increment,"increment");var TransactionResult$1=function(){function TransactionResult2(committed,snapshot){this.committed=committed,this.snapshot=snapshot}return __name(TransactionResult2,"TransactionResult"),TransactionResult2.prototype.toJSON=function(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}},TransactionResult2}();function runTransaction(ref2,transactionUpdate,options){var _a;if(ref2=util.getModularInstance(ref2),validateWritablePath("Reference.transaction",ref2._path),".length"===ref2.key||".keys"===ref2.key)throw"Reference.transaction failed: "+ref2.key+" is a read-only object.";var applyLocally=null===(_a=null==options?void 0:options.applyLocally)||void 0===_a||_a,deferred=new util.Deferred,promiseComplete=__name(function(error2,committed,node){var dataSnapshot=null;error2?deferred.reject(error2):(dataSnapshot=new DataSnapshot$1(node,new ReferenceImpl(ref2._repo,ref2._path),PRIORITY_INDEX),deferred.resolve(new TransactionResult$1(committed,dataSnapshot)))},"promiseComplete"),unwatcher=onValue(ref2,function(){});return repoStartTransaction(ref2._repo,ref2._path,transactionUpdate,promiseComplete,unwatcher,applyLocally),deferred.promise}__name(runTransaction,"runTransaction");var OnDisconnect=function(){function OnDisconnect2(_delegate){this._delegate=_delegate}return __name(OnDisconnect2,"OnDisconnect"),OnDisconnect2.prototype.cancel=function(onComplete){util.validateArgCount("OnDisconnect.cancel",0,1,arguments.length),util.validateCallback("OnDisconnect.cancel","onComplete",onComplete,!0);var result=this._delegate.cancel();return onComplete&&result.then(function(){return onComplete(null)},function(error2){return onComplete(error2)}),result},OnDisconnect2.prototype.remove=function(onComplete){util.validateArgCount("OnDisconnect.remove",0,1,arguments.length),util.validateCallback("OnDisconnect.remove","onComplete",onComplete,!0);var result=this._delegate.remove();return onComplete&&result.then(function(){return onComplete(null)},function(error2){return onComplete(error2)}),result},OnDisconnect2.prototype.set=function(value,onComplete){util.validateArgCount("OnDisconnect.set",1,2,arguments.length),util.validateCallback("OnDisconnect.set","onComplete",onComplete,!0);var result=this._delegate.set(value);return onComplete&&result.then(function(){return onComplete(null)},function(error2){return onComplete(error2)}),result},OnDisconnect2.prototype.setWithPriority=function(value,priority,onComplete){util.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length),util.validateCallback("OnDisconnect.setWithPriority","onComplete",onComplete,!0);var result=this._delegate.setWithPriority(value,priority);return onComplete&&result.then(function(){return onComplete(null)},function(error2){return onComplete(error2)}),result},OnDisconnect2.prototype.update=function(objectToMerge,onComplete){if(util.validateArgCount("OnDisconnect.update",1,2,arguments.length),Array.isArray(objectToMerge)){for(var newObjectToMerge={},i=0;i<objectToMerge.length;++i)newObjectToMerge[""+i]=objectToMerge[i];objectToMerge=newObjectToMerge,warn("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}util.validateCallback("OnDisconnect.update","onComplete",onComplete,!0);var result=this._delegate.update(objectToMerge);return onComplete&&result.then(function(){return onComplete(null)},function(error2){return onComplete(error2)}),result},OnDisconnect2}(),TransactionResult=function(){function TransactionResult2(committed,snapshot){this.committed=committed,this.snapshot=snapshot}return __name(TransactionResult2,"TransactionResult"),TransactionResult2.prototype.toJSON=function(){return util.validateArgCount("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},TransactionResult2}(),DataSnapshot=function(){function DataSnapshot2(_database,_delegate){this._database=_database,this._delegate=_delegate}return __name(DataSnapshot2,"DataSnapshot"),DataSnapshot2.prototype.val=function(){return util.validateArgCount("DataSnapshot.val",0,0,arguments.length),this._delegate.val()},DataSnapshot2.prototype.exportVal=function(){return util.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()},DataSnapshot2.prototype.toJSON=function(){return util.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()},DataSnapshot2.prototype.exists=function(){return util.validateArgCount("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()},DataSnapshot2.prototype.child=function(path){return util.validateArgCount("DataSnapshot.child",0,1,arguments.length),path=String(path),validatePathString("DataSnapshot.child","path",path,!1),new DataSnapshot2(this._database,this._delegate.child(path))},DataSnapshot2.prototype.hasChild=function(path){return util.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length),validatePathString("DataSnapshot.hasChild","path",path,!1),this._delegate.hasChild(path)},DataSnapshot2.prototype.getPriority=function(){return util.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority},DataSnapshot2.prototype.forEach=function(action){var _this=this;return util.validateArgCount("DataSnapshot.forEach",1,1,arguments.length),util.validateCallback("DataSnapshot.forEach","action",action,!1),this._delegate.forEach(function(expDataSnapshot){return action(new DataSnapshot2(_this._database,expDataSnapshot))})},DataSnapshot2.prototype.hasChildren=function(){return util.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()},Object.defineProperty(DataSnapshot2.prototype,"key",{get:function(){return this._delegate.key},enumerable:!1,configurable:!0}),DataSnapshot2.prototype.numChildren=function(){return util.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size},DataSnapshot2.prototype.getRef=function(){return util.validateArgCount("DataSnapshot.ref",0,0,arguments.length),new Reference(this._database,this._delegate.ref)},Object.defineProperty(DataSnapshot2.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),DataSnapshot2}(),Query=function(){function Query2(database,_delegate){this.database=database,this._delegate=_delegate}return __name(Query2,"Query"),Query2.prototype.on=function(eventType,callback,cancelCallbackOrContext,context){var _a,_this=this;util.validateArgCount("Query.on",2,4,arguments.length),util.validateCallback("Query.on","callback",callback,!1);var ret=Query2.getCancelAndContextArgs_("Query.on",cancelCallbackOrContext,context),valueCallback=__name(function(expSnapshot,previousChildName){callback.call(ret.context,new DataSnapshot(_this.database,expSnapshot),previousChildName)},"valueCallback");valueCallback.userCallback=callback,valueCallback.context=ret.context;var cancelCallback=null===(_a=ret.cancel)||void 0===_a?void 0:_a.bind(ret.context);switch(eventType){case"value":return onValue(this._delegate,valueCallback,cancelCallback),callback;case"child_added":return onChildAdded(this._delegate,valueCallback,cancelCallback),callback;case"child_removed":return onChildRemoved(this._delegate,valueCallback,cancelCallback),callback;case"child_changed":return onChildChanged(this._delegate,valueCallback,cancelCallback),callback;case"child_moved":return onChildMoved(this._delegate,valueCallback,cancelCallback),callback;default:throw new Error(util.errorPrefix("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},Query2.prototype.off=function(eventType,callback,context){if(util.validateArgCount("Query.off",0,3,arguments.length),validateEventType("Query.off",eventType,!0),util.validateCallback("Query.off","callback",callback,!0),util.validateContextObject("Query.off","context",context,!0),callback){var valueCallback=__name(function(){},"valueCallback");valueCallback.userCallback=callback,valueCallback.context=context,off(this._delegate,eventType,valueCallback)}else off(this._delegate,eventType)},Query2.prototype.get=function(){var _this=this;return get(this._delegate).then(function(expSnapshot){return new DataSnapshot(_this.database,expSnapshot)})},Query2.prototype.once=function(eventType,callback,failureCallbackOrContext,context){var _this=this;util.validateArgCount("Query.once",1,4,arguments.length),util.validateCallback("Query.once","callback",callback,!0);var ret=Query2.getCancelAndContextArgs_("Query.once",failureCallbackOrContext,context),deferred=new util.Deferred,valueCallback=__name(function(expSnapshot,previousChildName){var result=new DataSnapshot(_this.database,expSnapshot);callback&&callback.call(ret.context,result,previousChildName),deferred.resolve(result)},"valueCallback");valueCallback.userCallback=callback,valueCallback.context=ret.context;var cancelCallback=__name(function(error2){ret.cancel&&ret.cancel.call(ret.context,error2),deferred.reject(error2)},"cancelCallback");switch(eventType){case"value":onValue(this._delegate,valueCallback,cancelCallback,{onlyOnce:!0});break;case"child_added":onChildAdded(this._delegate,valueCallback,cancelCallback,{onlyOnce:!0});break;case"child_removed":onChildRemoved(this._delegate,valueCallback,cancelCallback,{onlyOnce:!0});break;case"child_changed":onChildChanged(this._delegate,valueCallback,cancelCallback,{onlyOnce:!0});break;case"child_moved":onChildMoved(this._delegate,valueCallback,cancelCallback,{onlyOnce:!0});break;default:throw new Error(util.errorPrefix("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return deferred.promise},Query2.prototype.limitToFirst=function(limit){return util.validateArgCount("Query.limitToFirst",1,1,arguments.length),new Query2(this.database,query(this._delegate,limitToFirst(limit)))},Query2.prototype.limitToLast=function(limit){return util.validateArgCount("Query.limitToLast",1,1,arguments.length),new Query2(this.database,query(this._delegate,limitToLast(limit)))},Query2.prototype.orderByChild=function(path){return util.validateArgCount("Query.orderByChild",1,1,arguments.length),new Query2(this.database,query(this._delegate,orderByChild(path)))},Query2.prototype.orderByKey=function(){return util.validateArgCount("Query.orderByKey",0,0,arguments.length),new Query2(this.database,query(this._delegate,orderByKey()))},Query2.prototype.orderByPriority=function(){return util.validateArgCount("Query.orderByPriority",0,0,arguments.length),new Query2(this.database,query(this._delegate,orderByPriority()))},Query2.prototype.orderByValue=function(){return util.validateArgCount("Query.orderByValue",0,0,arguments.length),new Query2(this.database,query(this._delegate,orderByValue()))},Query2.prototype.startAt=function(value,name2){return void 0===value&&(value=null),util.validateArgCount("Query.startAt",0,2,arguments.length),new Query2(this.database,query(this._delegate,startAt(value,name2)))},Query2.prototype.startAfter=function(value,name2){return void 0===value&&(value=null),util.validateArgCount("Query.startAfter",0,2,arguments.length),new Query2(this.database,query(this._delegate,startAfter(value,name2)))},Query2.prototype.endAt=function(value,name2){return void 0===value&&(value=null),util.validateArgCount("Query.endAt",0,2,arguments.length),new Query2(this.database,query(this._delegate,endAt(value,name2)))},Query2.prototype.endBefore=function(value,name2){return void 0===value&&(value=null),util.validateArgCount("Query.endBefore",0,2,arguments.length),new Query2(this.database,query(this._delegate,endBefore(value,name2)))},Query2.prototype.equalTo=function(value,name2){return util.validateArgCount("Query.equalTo",1,2,arguments.length),new Query2(this.database,query(this._delegate,equalTo(value,name2)))},Query2.prototype.toString=function(){return util.validateArgCount("Query.toString",0,0,arguments.length),this._delegate.toString()},Query2.prototype.toJSON=function(){return util.validateArgCount("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()},Query2.prototype.isEqual=function(other){if(util.validateArgCount("Query.isEqual",1,1,arguments.length),!(other instanceof Query2)){var error2="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(error2)}return this._delegate.isEqual(other._delegate)},Query2.getCancelAndContextArgs_=function(fnName,cancelOrContext,context){var ret={cancel:void 0,context:void 0};if(cancelOrContext&&context)ret.cancel=cancelOrContext,util.validateCallback(fnName,"cancel",ret.cancel,!0),ret.context=context,util.validateContextObject(fnName,"context",ret.context,!0);else if(cancelOrContext)if("object"==typeof cancelOrContext&&null!==cancelOrContext)ret.context=cancelOrContext;else{if("function"!=typeof cancelOrContext)throw new Error(util.errorPrefix(fnName,"cancelOrContext")+" must either be a cancel callback or a context object.");ret.cancel=cancelOrContext}return ret},Object.defineProperty(Query2.prototype,"ref",{get:function(){return new Reference(this.database,new ReferenceImpl(this._delegate._repo,this._delegate._path))},enumerable:!1,configurable:!0}),Query2}(),Reference=function(_super){function Reference2(database,_delegate){var _this=_super.call(this,database,new QueryImpl(_delegate._repo,_delegate._path,new QueryParams,!1))||this;return _this.database=database,_this._delegate=_delegate,_this}return tslib.__extends(Reference2,_super),__name(Reference2,"Reference"),Reference2.prototype.getKey=function(){return util.validateArgCount("Reference.key",0,0,arguments.length),this._delegate.key},Reference2.prototype.child=function(pathString){return util.validateArgCount("Reference.child",1,1,arguments.length),"number"==typeof pathString&&(pathString=String(pathString)),new Reference2(this.database,child(this._delegate,pathString))},Reference2.prototype.getParent=function(){util.validateArgCount("Reference.parent",0,0,arguments.length);var parent=this._delegate.parent;return parent?new Reference2(this.database,parent):null},Reference2.prototype.getRoot=function(){return util.validateArgCount("Reference.root",0,0,arguments.length),new Reference2(this.database,this._delegate.root)},Reference2.prototype.set=function(newVal,onComplete){util.validateArgCount("Reference.set",1,2,arguments.length),util.validateCallback("Reference.set","onComplete",onComplete,!0);var result=set(this._delegate,newVal);return onComplete&&result.then(function(){return onComplete(null)},function(error2){return onComplete(error2)}),result},Reference2.prototype.update=function(values,onComplete){if(util.validateArgCount("Reference.update",1,2,arguments.length),Array.isArray(values)){for(var newObjectToMerge={},i=0;i<values.length;++i)newObjectToMerge[""+i]=values[i];values=newObjectToMerge,warn("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}validateWritablePath("Reference.update",this._delegate._path),util.validateCallback("Reference.update","onComplete",onComplete,!0);var result=update(this._delegate,values);return onComplete&&result.then(function(){return onComplete(null)},function(error2){return onComplete(error2)}),result},Reference2.prototype.setWithPriority=function(newVal,newPriority,onComplete){util.validateArgCount("Reference.setWithPriority",2,3,arguments.length),util.validateCallback("Reference.setWithPriority","onComplete",onComplete,!0);var result=setWithPriority(this._delegate,newVal,newPriority);return onComplete&&result.then(function(){return onComplete(null)},function(error2){return onComplete(error2)}),result},Reference2.prototype.remove=function(onComplete){util.validateArgCount("Reference.remove",0,1,arguments.length),util.validateCallback("Reference.remove","onComplete",onComplete,!0);var result=remove(this._delegate);return onComplete&&result.then(function(){return onComplete(null)},function(error2){return onComplete(error2)}),result},Reference2.prototype.transaction=function(transactionUpdate,onComplete,applyLocally){var _this=this;util.validateArgCount("Reference.transaction",1,3,arguments.length),util.validateCallback("Reference.transaction","transactionUpdate",transactionUpdate,!1),util.validateCallback("Reference.transaction","onComplete",onComplete,!0),validateBoolean("Reference.transaction","applyLocally",applyLocally,!0);var result=runTransaction(this._delegate,transactionUpdate,{applyLocally}).then(function(transactionResult){return new TransactionResult(transactionResult.committed,new DataSnapshot(_this.database,transactionResult.snapshot))});return onComplete&&result.then(function(transactionResult){return onComplete(null,transactionResult.committed,transactionResult.snapshot)},function(error2){return onComplete(error2,!1,null)}),result},Reference2.prototype.setPriority=function(priority,onComplete){util.validateArgCount("Reference.setPriority",1,2,arguments.length),util.validateCallback("Reference.setPriority","onComplete",onComplete,!0);var result=setPriority(this._delegate,priority);return onComplete&&result.then(function(){return onComplete(null)},function(error2){return onComplete(error2)}),result},Reference2.prototype.push=function(value,onComplete){var _this=this;util.validateArgCount("Reference.push",0,2,arguments.length),util.validateCallback("Reference.push","onComplete",onComplete,!0);var expPromise=push(this._delegate,value),promise=expPromise.then(function(expRef){return new Reference2(_this.database,expRef)});onComplete&&promise.then(function(){return onComplete(null)},function(error2){return onComplete(error2)});var result=new Reference2(this.database,expPromise);return result.then=promise.then.bind(promise),result.catch=promise.catch.bind(promise,void 0),result},Reference2.prototype.onDisconnect=function(){return validateWritablePath("Reference.onDisconnect",this._delegate._path),new OnDisconnect(new OnDisconnect$1(this._delegate._repo,this._delegate._path))},Object.defineProperty(Reference2.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(Reference2.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(Reference2.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),Reference2}(Query),Database=function(){function Database2(_delegate,app){var _this=this;this._delegate=_delegate,this.app=app,this.INTERNAL={delete:function(){return _this._delegate._delete()}}}return __name(Database2,"Database"),Database2.prototype.useEmulator=function(host,port,options){void 0===options&&(options={}),connectDatabaseEmulator(this._delegate,host,port,options)},Database2.prototype.ref=function(path){if(util.validateArgCount("database.ref",0,1,arguments.length),path instanceof Reference){var childRef=refFromURL(this._delegate,path.toString());return new Reference(this,childRef)}childRef=ref(this._delegate,path);return new Reference(this,childRef)},Database2.prototype.refFromURL=function(url){var apiName="database.refFromURL";util.validateArgCount(apiName,1,1,arguments.length);var childRef=refFromURL(this._delegate,url);return new Reference(this,childRef)},Database2.prototype.goOffline=function(){return util.validateArgCount("database.goOffline",0,0,arguments.length),goOffline(this._delegate)},Database2.prototype.goOnline=function(){return util.validateArgCount("database.goOnline",0,0,arguments.length),goOnline(this._delegate)},Database2.ServerValue={TIMESTAMP:serverTimestamp(),increment:function(delta){return increment(delta)}},Database2}(),forceLongPolling=__name(function(){WebSocketConnection.forceDisallow(),BrowserPollConnection.forceAllow()},"forceLongPolling"),forceWebSockets=__name(function(){BrowserPollConnection.forceDisallow()},"forceWebSockets"),isWebSocketsAvailable=__name(function(){return WebSocketConnection.isAvailable()},"isWebSocketsAvailable"),setSecurityDebugCallback=__name(function(ref2,callback){ref2._delegate._repo.persistentConnection_.securityDebugCallback_=callback},"setSecurityDebugCallback"),stats=__name(function(ref2,showDelta){repoStats(ref2._delegate._repo,showDelta)},"stats"),statsIncrementCounter=__name(function(ref2,metric){repoStatsIncrementCounter(ref2._delegate._repo,metric)},"statsIncrementCounter"),dataUpdateCount=__name(function(ref2){return ref2._delegate._repo.dataUpdateCount},"dataUpdateCount"),interceptServerData=__name(function(ref2,callback){return repoInterceptServerData(ref2._delegate._repo,callback)},"interceptServerData");function initStandalone$1(_a){var app=_a.app,url=_a.url,version2=_a.version,customAuthImpl=_a.customAuthImpl,namespace=_a.namespace,_b=_a.nodeAdmin,nodeAdmin=void 0!==_b&&_b;setSDKVersion(version2);var authProvider=new component.Provider("auth-internal",new component.ComponentContainer("database-standalone"));return authProvider.setComponent(new component.Component("auth-internal",function(){return customAuthImpl},"PRIVATE")),{instance:new Database(repoManagerDatabaseFromApp(app,authProvider,void 0,url,nodeAdmin),app),namespace}}__name(initStandalone$1,"initStandalone$1");var INTERNAL=Object.freeze({__proto__:null,forceLongPolling,forceWebSockets,isWebSocketsAvailable,setSecurityDebugCallback,stats,statsIncrementCounter,dataUpdateCount,interceptServerData,initStandalone:initStandalone$1}),DataConnection=PersistentConnection;PersistentConnection.prototype.simpleListen=function(pathString,onComplete){this.sendRequest("q",{p:pathString},onComplete)},PersistentConnection.prototype.echo=function(data,onEcho){this.sendRequest("echo",{d:data},onEcho)};var RealTimeConnection=Connection,hijackHash=__name(function(newHash){var oldPut=PersistentConnection.prototype.put;return PersistentConnection.prototype.put=function(pathString,data,onComplete,hash){void 0!==hash&&(hash=newHash()),oldPut.call(this,pathString,data,onComplete,hash)},function(){PersistentConnection.prototype.put=oldPut}},"hijackHash"),ConnectionTarget=RepoInfo,queryIdentifier=__name(function(query2){return query2._delegate._queryIdentifier},"queryIdentifier"),forceRestClient=__name(function(forceRestClient2){repoManagerForceRestClient(forceRestClient2)},"forceRestClient"),TEST_ACCESS=Object.freeze({__proto__:null,DataConnection,RealTimeConnection,hijackHash,ConnectionTarget,queryIdentifier,forceRestClient});setWebSocketImpl(fayeWebsocket.Client);var ServerValue=Database.ServerValue;function initStandalone(app,url,version2,nodeAdmin){return void 0===nodeAdmin&&(nodeAdmin=!0),util.CONSTANTS.NODE_ADMIN=nodeAdmin,initStandalone$1({app,url,version:version2,customAuthImpl:app.INTERNAL,namespace:{Reference,Query,Database,DataSnapshot,enableLogging,INTERNAL,ServerValue,TEST_ACCESS},nodeAdmin})}function registerDatabase(instance){setSDKVersion(instance.SDK_VERSION);var namespace=instance.INTERNAL.registerComponent(new component.Component("database",function(container,_a){var url=_a.instanceIdentifier,app=container.getProvider("app").getImmediate(),authProvider=container.getProvider("auth-internal"),appCheckProvider=container.getProvider("app-check-internal");return new Database(repoManagerDatabaseFromApp(app,authProvider,appCheckProvider,url),app)},"PUBLIC").setServiceProps({Reference,Query,Database,DataSnapshot,enableLogging,INTERNAL,ServerValue,TEST_ACCESS}).setMultipleInstances(!0));instance.registerVersion("@firebase/database","0.11.0","node"),util.isNodeSdk()&&(module.exports=Object.assign({},namespace,{initStandalone}))}__name(initStandalone,"initStandalone"),__name(registerDatabase,"registerDatabase");try{var firebase=__webpack_require__(42672).default;firebase&&registerDatabase(firebase)}catch(err){if("MODULE_NOT_FOUND"!==err.code)throw err}exports2.DataSnapshot=DataSnapshot,exports2.Database=Database,exports2.OnDisconnect=OnDisconnect,exports2.Query=Query,exports2.Reference=Reference,exports2.ServerValue=ServerValue,exports2.enableLogging=enableLogging,exports2.initStandalone=initStandalone,exports2.registerDatabase=registerDatabase},83571:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Stream=__webpack_require__(92413).Stream,util=__webpack_require__(31669),driver=__webpack_require__(3081),Headers2=__webpack_require__(30419),API=__webpack_require__(42986),EventTarget=__webpack_require__(67407),Event=__webpack_require__(57651),EventSource=__name(function(request,response,options){this.writable=!0,options=options||{},this._stream=response.socket,this._ping=options.ping||this.DEFAULT_PING,this._retry=options.retry||this.DEFAULT_RETRY;var scheme=driver.isSecureRequest(request)?"https:":"http:";this.url=scheme+"//"+request.headers.host+request.url,this.lastEventId=request.headers["last-event-id"]||"",this.readyState=API.CONNECTING;var headers=new Headers2,self2=this;if(options.headers)for(var key2 in options.headers)headers.set(key2,options.headers[key2]);if(this._stream&&this._stream.writable){process.nextTick(function(){self2._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var handshake="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+headers.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(handshake),this._stream.on("drain",function(){self2.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){self2.ping()},1e3*this._ping)),["error","end"].forEach(function(event){self2._stream.on(event,function(){self2.close()})})}},"EventSource");util.inherits(EventSource,Stream),EventSource.isEventSource=function(request){return"GET"===request.method&&(request.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var instance={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(chunk){if(!this.writable)return!1;try{return this._stream.write(chunk,"utf8")}catch(e){return!1}},_open:function(){if(this.readyState===API.CONNECTING){this.readyState=API.OPEN;var event=new Event("open");event.initEvent("open",!1,!1),this.dispatchEvent(event)}},write:function(message){return this.send(message)},end:function(message){void 0!==message&&this.write(message),this.close()},send:function(message,options){if(this.readyState>API.OPEN)return!1;message=String(message).replace(/(\r\n|\r|\n)/g,"$1data: ");var frame="";return(options=options||{}).event&&(frame+="event: "+options.event+"\r\n"),options.id&&(frame+="id: "+options.id+"\r\n"),frame+="data: "+message+"\r\n\r\n",this._write(frame)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>API.OPEN)return!1;this.readyState=API.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var event=new Event("close");return event.initEvent("close",!1,!1),this.dispatchEvent(event),!0}};for(var method in instance)EventSource.prototype[method]=instance[method];for(var key in EventTarget)EventSource.prototype[key]=EventTarget[key];module.exports=EventSource},79679:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var util=__webpack_require__(31669),driver=__webpack_require__(3081),API=__webpack_require__(42986),WebSocket2=__name(function(request,socket,body,protocols,options){options=options||{},this._stream=socket,this._driver=driver.http(request,{maxLength:options.maxLength,protocols});var self2=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var catchup=__name(function(){self2._stream.removeListener("data",catchup)},"catchup");this._stream.on("data",catchup),API.call(this,options),process.nextTick(function(){self2._driver.start(),self2._driver.io.write(body)})}},"WebSocket");util.inherits(WebSocket2,API),WebSocket2.isWebSocket=function(request){return driver.isWebSocket(request)},WebSocket2.validateOptions=function(options,validKeys){driver.validateOptions(options,validKeys)},WebSocket2.WebSocket=WebSocket2,WebSocket2.Client=__webpack_require__(96390),WebSocket2.EventSource=__webpack_require__(83571),module.exports=WebSocket2},42986:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Stream=__webpack_require__(92413).Stream,util=__webpack_require__(31669),driver=__webpack_require__(3081),EventTarget=__webpack_require__(67407),Event=__webpack_require__(57651),API=__name(function(options){options=options||{},driver.validateOptions(options,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var headers=options.headers;if(headers)for(var name in headers)this._driver.setHeader(name,headers[name]);var extensions=options.extensions;extensions&&[].concat(extensions).forEach(this._driver.addExtension,this._driver),this._ping=options.ping,this._pingId=0,this.readyState=API.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var self2=this;this._driver.on("open",function(e){self2._open()}),this._driver.on("message",function(e){self2._receiveMessage(e.data)}),this._driver.on("close",function(e){self2._beginClose(e.reason,e.code)}),this._driver.on("error",function(error){self2._emitError(error.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){self2.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){self2._pingId+=1,self2.ping(self2._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))},"API");util.inherits(API,Stream),API.CONNECTING=0,API.OPEN=1,API.CLOSING=2,API.CLOSED=3,API.CLOSE_TIMEOUT=3e4;var instance={write:function(data){return this.send(data)},end:function(data){void 0!==data&&this.send(data),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(data){return!(this.readyState>API.OPEN)&&(data instanceof Buffer||(data=String(data)),this._driver.messages.write(data))},ping:function(message,callback){return!(this.readyState>API.OPEN)&&this._driver.ping(message,callback)},close:function(code,reason){if(void 0===code&&(code=1e3),void 0===reason&&(reason=""),1e3!==code&&(code<3e3||code>4999))throw new Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+code+" is neither.");this.readyState!==API.CLOSED&&(this.readyState=API.CLOSING);var self2=this;this._closeTimer=setTimeout(function(){self2._beginClose("",1006)},API.CLOSE_TIMEOUT),this._driver.close(reason,code)},_configureStream:function(){var self2=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(event){this._stream.on(event,function(){self2._finalizeClose()})},this),this._stream.on("error",function(error){self2._emitError("Network error: "+self2.url+": "+error.message),self2._finalizeClose()})},_open:function(){if(this.readyState===API.CONNECTING){this.readyState=API.OPEN,this.protocol=this._driver.protocol||"";var event=new Event("open");event.initEvent("open",!1,!1),this.dispatchEvent(event)}},_receiveMessage:function(data){if(this.readyState>API.OPEN)return!1;this.readable&&this.emit("data",data);var event=new Event("message",{data});event.initEvent("message",!1,!1),this.dispatchEvent(event)},_emitError:function(message){if(!(this.readyState>=API.CLOSING)){var event=new Event("error",{message});event.initEvent("error",!1,!1),this.dispatchEvent(event)}},_beginClose:function(reason,code){this.readyState!==API.CLOSED&&(this.readyState=API.CLOSING,this._closeParams=[reason,code],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==API.CLOSED){this.readyState=API.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var reason=this._closeParams?this._closeParams[0]:"",code=this._closeParams?this._closeParams[1]:1006,event=new Event("close",{code,reason});event.initEvent("close",!1,!1),this.dispatchEvent(event)}}};for(var method in instance)API.prototype[method]=instance[method];for(var key in EventTarget)API.prototype[key]=EventTarget[key];module.exports=API},57651:module=>{"use strict";var Event=__name(function(eventType,options){for(var key in this.type=eventType,options)this[key]=options[key]},"Event");Event.prototype.initEvent=function(eventType,canBubble,cancelable){this.type=eventType,this.bubbles=canBubble,this.cancelable=cancelable},Event.prototype.stopPropagation=function(){},Event.prototype.preventDefault=function(){},Event.CAPTURING_PHASE=1,Event.AT_TARGET=2,Event.BUBBLING_PHASE=3,module.exports=Event},67407:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Event=__webpack_require__(57651),EventTarget={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(eventType,listener,useCapture){this.on(eventType,listener)},removeEventListener:function(eventType,listener,useCapture){this.removeListener(eventType,listener)},dispatchEvent:function(event){event.target=event.currentTarget=this,event.eventPhase=Event.AT_TARGET,this["on"+event.type]&&this["on"+event.type](event),this.emit(event.type,event)}};module.exports=EventTarget},96390:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var util=__webpack_require__(31669),net=__webpack_require__(11631),tls=__webpack_require__(4016),url=__webpack_require__(78835),driver=__webpack_require__(3081),API=__webpack_require__(42986),DEFAULT_PORTS=(__webpack_require__(57651),{"http:":80,"https:":443,"ws:":80,"wss:":443}),SECURE_PROTOCOLS=["https:","wss:"],Client=__name(function(_url,protocols,options){options=options||{},this.url=_url,this._driver=driver.client(this.url,{maxLength:options.maxLength,protocols}),["open","error"].forEach(function(event){this._driver.on(event,function(){self2.headers=self2._driver.headers,self2.statusCode=self2._driver.statusCode})},this);var proxy=options.proxy||{},endpoint=url.parse(proxy.origin||this.url),port=endpoint.port||DEFAULT_PORTS[endpoint.protocol],secure=SECURE_PROTOCOLS.indexOf(endpoint.protocol)>=0,onConnect=__name(function(){self2._onConnect()},"onConnect"),netOptions=options.net||{},originTLS=options.tls||{},socketTLS=proxy.origin?proxy.tls||{}:originTLS,self2=this;netOptions.host=socketTLS.host=endpoint.hostname,netOptions.port=socketTLS.port=port,originTLS.ca=originTLS.ca||options.ca,socketTLS.servername=socketTLS.servername||endpoint.hostname,this._stream=secure?tls.connect(socketTLS,onConnect):net.connect(netOptions,onConnect),proxy.origin&&this._configureProxy(proxy,originTLS),API.call(this,options)},"Client");util.inherits(Client,API),Client.prototype._onConnect=function(){(this._proxy||this._driver).start()},Client.prototype._configureProxy=function(proxy,originTLS){var name,uri=url.parse(this.url),secure=SECURE_PROTOCOLS.indexOf(uri.protocol)>=0,self2=this;if(this._proxy=this._driver.proxy(proxy.origin),proxy.headers)for(name in proxy.headers)this._proxy.setHeader(name,proxy.headers[name]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(secure){var options={socket:self2._stream,servername:uri.hostname};for(name in originTLS)options[name]=originTLS[name];self2._stream=tls.connect(options),self2._configureStream()}self2._driver.io.pipe(self2._stream),self2._stream.pipe(self2._driver.io),self2._driver.start()}),this._proxy.on("error",function(error){self2._driver.emit("error",error)})},module.exports=Client},16303:(__unused_webpack_module,exports2)=>{"use strict";function __spreadArrays(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;var r=Array(s),k=0;for(i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r}Object.defineProperty(exports2,"__esModule",{value:!0}),__name(__spreadArrays,"__spreadArrays");var _a,LogLevel,instances=[];(LogLevel=exports2.LogLevel||(exports2.LogLevel={}))[LogLevel.DEBUG=0]="DEBUG",LogLevel[LogLevel.VERBOSE=1]="VERBOSE",LogLevel[LogLevel.INFO=2]="INFO",LogLevel[LogLevel.WARN=3]="WARN",LogLevel[LogLevel.ERROR=4]="ERROR",LogLevel[LogLevel.SILENT=5]="SILENT";var levelStringToEnum={debug:exports2.LogLevel.DEBUG,verbose:exports2.LogLevel.VERBOSE,info:exports2.LogLevel.INFO,warn:exports2.LogLevel.WARN,error:exports2.LogLevel.ERROR,silent:exports2.LogLevel.SILENT},defaultLogLevel=exports2.LogLevel.INFO,ConsoleMethod=((_a={})[exports2.LogLevel.DEBUG]="log",_a[exports2.LogLevel.VERBOSE]="log",_a[exports2.LogLevel.INFO]="info",_a[exports2.LogLevel.WARN]="warn",_a[exports2.LogLevel.ERROR]="error",_a),defaultLogHandler=__name(function(instance,logType){for(var args=[],_i=2;_i<arguments.length;_i++)args[_i-2]=arguments[_i];if(!(logType<instance.logLevel)){var now=(new Date).toISOString(),method=ConsoleMethod[logType];if(!method)throw new Error("Attempted to log a message with an invalid logType (value: "+logType+")");console[method].apply(console,__spreadArrays(["["+now+"]  "+instance.name+":"],args))}},"defaultLogHandler"),Logger=function(){function Logger2(name){this.name=name,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null,instances.push(this)}return __name(Logger2,"Logger"),Object.defineProperty(Logger2.prototype,"logLevel",{get:function(){return this._logLevel},set:function(val){if(!(val in exports2.LogLevel))throw new TypeError('Invalid value "'+val+'" assigned to `logLevel`');this._logLevel=val},enumerable:!1,configurable:!0}),Logger2.prototype.setLogLevel=function(val){this._logLevel="string"==typeof val?levelStringToEnum[val]:val},Object.defineProperty(Logger2.prototype,"logHandler",{get:function(){return this._logHandler},set:function(val){if("function"!=typeof val)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=val},enumerable:!1,configurable:!0}),Object.defineProperty(Logger2.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(val){this._userLogHandler=val},enumerable:!1,configurable:!0}),Logger2.prototype.debug=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this._userLogHandler&&this._userLogHandler.apply(this,__spreadArrays([this,exports2.LogLevel.DEBUG],args)),this._logHandler.apply(this,__spreadArrays([this,exports2.LogLevel.DEBUG],args))},Logger2.prototype.log=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this._userLogHandler&&this._userLogHandler.apply(this,__spreadArrays([this,exports2.LogLevel.VERBOSE],args)),this._logHandler.apply(this,__spreadArrays([this,exports2.LogLevel.VERBOSE],args))},Logger2.prototype.info=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this._userLogHandler&&this._userLogHandler.apply(this,__spreadArrays([this,exports2.LogLevel.INFO],args)),this._logHandler.apply(this,__spreadArrays([this,exports2.LogLevel.INFO],args))},Logger2.prototype.warn=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this._userLogHandler&&this._userLogHandler.apply(this,__spreadArrays([this,exports2.LogLevel.WARN],args)),this._logHandler.apply(this,__spreadArrays([this,exports2.LogLevel.WARN],args))},Logger2.prototype.error=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this._userLogHandler&&this._userLogHandler.apply(this,__spreadArrays([this,exports2.LogLevel.ERROR],args)),this._logHandler.apply(this,__spreadArrays([this,exports2.LogLevel.ERROR],args))},Logger2}();function setLogLevel(level){instances.forEach(function(inst){inst.setLogLevel(level)})}function setUserLogHandler(logCallback,options){for(var _loop_1=__name(function(instance2){var customLogLevel=null;options&&options.level&&(customLogLevel=levelStringToEnum[options.level]),instance2.userLogHandler=null===logCallback?null:function(instance3,level){for(var args=[],_i2=2;_i2<arguments.length;_i2++)args[_i2-2]=arguments[_i2];var message=args.map(function(arg){if(null==arg)return null;if("string"==typeof arg)return arg;if("number"==typeof arg||"boolean"==typeof arg)return arg.toString();if(arg instanceof Error)return arg.message;try{return JSON.stringify(arg)}catch(ignored){return null}}).filter(function(arg){return arg}).join(" ");level>=(null!=customLogLevel?customLogLevel:instance3.logLevel)&&logCallback({level:exports2.LogLevel[level].toLowerCase(),message,args,type:instance3.name})}},"_loop_1"),_i=0,instances_1=instances;_i<instances_1.length;_i++){_loop_1(instances_1[_i])}}__name(setLogLevel,"setLogLevel"),__name(setUserLogHandler,"setUserLogHandler"),exports2.Logger=Logger,exports2.setLogLevel=setLogLevel,exports2.setUserLogHandler=setUserLogHandler},84268:(__unused_webpack_module,exports2,__webpack_require__)=>{"use strict";Object.defineProperty(exports2,"__esModule",{value:!0});var tslib=__webpack_require__(64762),CONSTANTS={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},assert=__name(function(assertion,message){if(!assertion)throw assertionError(message)},"assert"),assertionError=__name(function(message){return new Error("Firebase Database ("+CONSTANTS.SDK_VERSION+") INTERNAL ASSERT FAILED: "+message)},"assertionError"),stringToByteArray$1=__name(function(str){for(var out=[],p=0,i=0;i<str.length;i++){var c=str.charCodeAt(i);c<128?out[p++]=c:c<2048?(out[p++]=c>>6|192,out[p++]=63&c|128):55296==(64512&c)&&i+1<str.length&&56320==(64512&str.charCodeAt(i+1))?(c=65536+((1023&c)<<10)+(1023&str.charCodeAt(++i)),out[p++]=c>>18|240,out[p++]=c>>12&63|128,out[p++]=c>>6&63|128,out[p++]=63&c|128):(out[p++]=c>>12|224,out[p++]=c>>6&63|128,out[p++]=63&c|128)}return out},"stringToByteArray$1"),byteArrayToString=__name(function(bytes){for(var out=[],pos=0,c=0;pos<bytes.length;){var c1=bytes[pos++];if(c1<128)out[c++]=String.fromCharCode(c1);else if(c1>191&&c1<224){var c2=bytes[pos++];out[c++]=String.fromCharCode((31&c1)<<6|63&c2)}else if(c1>239&&c1<365){var u=((7&c1)<<18|(63&(c2=bytes[pos++]))<<12|(63&(c3=bytes[pos++]))<<6|63&bytes[pos++])-65536;out[c++]=String.fromCharCode(55296+(u>>10)),out[c++]=String.fromCharCode(56320+(1023&u))}else{c2=bytes[pos++];var c3=bytes[pos++];out[c++]=String.fromCharCode((15&c1)<<12|(63&c2)<<6|63&c3)}}return out.join("")},"byteArrayToString"),base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(input,webSafe){if(!Array.isArray(input))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var byteToCharMap=webSafe?this.byteToCharMapWebSafe_:this.byteToCharMap_,output=[],i=0;i<input.length;i+=3){var byte1=input[i],haveByte2=i+1<input.length,byte2=haveByte2?input[i+1]:0,haveByte3=i+2<input.length,byte3=haveByte3?input[i+2]:0,outByte1=byte1>>2,outByte2=(3&byte1)<<4|byte2>>4,outByte3=(15&byte2)<<2|byte3>>6,outByte4=63&byte3;haveByte3||(outByte4=64,haveByte2||(outByte3=64)),output.push(byteToCharMap[outByte1],byteToCharMap[outByte2],byteToCharMap[outByte3],byteToCharMap[outByte4])}return output.join("")},encodeString:function(input,webSafe){return this.HAS_NATIVE_SUPPORT&&!webSafe?btoa(input):this.encodeByteArray(stringToByteArray$1(input),webSafe)},decodeString:function(input,webSafe){return this.HAS_NATIVE_SUPPORT&&!webSafe?atob(input):byteArrayToString(this.decodeStringToByteArray(input,webSafe))},decodeStringToByteArray:function(input,webSafe){this.init_();for(var charToByteMap=webSafe?this.charToByteMapWebSafe_:this.charToByteMap_,output=[],i=0;i<input.length;){var byte1=charToByteMap[input.charAt(i++)],byte2=i<input.length?charToByteMap[input.charAt(i)]:0,byte3=++i<input.length?charToByteMap[input.charAt(i)]:64,byte4=++i<input.length?charToByteMap[input.charAt(i)]:64;if(++i,null==byte1||null==byte2||null==byte3||null==byte4)throw Error();var outByte1=byte1<<2|byte2>>4;if(output.push(outByte1),64!==byte3){var outByte2=byte2<<4&240|byte3>>2;if(output.push(outByte2),64!==byte4){var outByte3=byte3<<6&192|byte4;output.push(outByte3)}}}return output},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}},base64Encode=__name(function(str){var utf8Bytes=stringToByteArray$1(str);return base64.encodeByteArray(utf8Bytes,!0)},"base64Encode"),base64urlEncodeWithoutPadding=__name(function(str){return base64Encode(str).replace(/\./g,"")},"base64urlEncodeWithoutPadding"),base64Decode=__name(function(str){try{return base64.decodeString(str,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},"base64Decode");function deepCopy(value){return deepExtend(void 0,value)}function deepExtend(target,source){if(!(source instanceof Object))return source;switch(source.constructor){case Date:return new Date(source.getTime());case Object:void 0===target&&(target={});break;case Array:target=[];break;default:return source}for(var prop in source)!source.hasOwnProperty(prop)||!isValidKey(prop)||(target[prop]=deepExtend(target[prop],source[prop]));return target}function isValidKey(key){return"__proto__"!==key}__name(deepCopy,"deepCopy"),__name(deepExtend,"deepExtend"),__name(isValidKey,"isValidKey");var Deferred=function(){function Deferred2(){var _this=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(resolve,reject){_this.resolve=resolve,_this.reject=reject})}return __name(Deferred2,"Deferred"),Deferred2.prototype.wrapCallback=function(callback){var _this=this;return function(error,value){error?_this.reject(error):_this.resolve(value),"function"==typeof callback&&(_this.promise.catch(function(){}),1===callback.length?callback(error):callback(error,value))}},Deferred2}();function createMockUserToken(token,projectId){if(token.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var project=projectId||"demo-project",iat=token.iat||0,sub=token.sub||token.user_id;if(!sub)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var payload=tslib.__assign({iss:"https://securetoken.google.com/"+project,aud:project,iat,exp:iat+3600,auth_time:iat,sub,user_id:sub,firebase:{sign_in_provider:"custom",identities:{}}},token);return[base64urlEncodeWithoutPadding(JSON.stringify({alg:"none",type:"JWT"})),base64urlEncodeWithoutPadding(JSON.stringify(payload)),""].join(".")}function getUA(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function isMobileCordova(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA())}function isNode(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function isBrowser(){return"object"==typeof self&&self.self===self}function isBrowserExtension(){var runtime="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof runtime&&void 0!==runtime.id}function isReactNative(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function isElectron(){return getUA().indexOf("Electron/")>=0}function isIE(){var ua=getUA();return ua.indexOf("MSIE ")>=0||ua.indexOf("Trident/")>=0}function isUWP(){return getUA().indexOf("MSAppHost/")>=0}function isNodeSdk(){return!0===CONSTANTS.NODE_CLIENT||!0===CONSTANTS.NODE_ADMIN}function isSafari(){return!isNode()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function isIndexedDBAvailable(){return"indexedDB"in self&&null!=indexedDB}function validateIndexedDBOpenable(){return new Promise(function(resolve,reject){try{var preExist_1=!0,DB_CHECK_NAME_1="validate-browser-context-for-indexeddb-analytics-module",request_1=self.indexedDB.open(DB_CHECK_NAME_1);request_1.onsuccess=function(){request_1.result.close(),preExist_1||self.indexedDB.deleteDatabase(DB_CHECK_NAME_1),resolve(!0)},request_1.onupgradeneeded=function(){preExist_1=!1},request_1.onerror=function(){var _a;reject((null===(_a=request_1.error)||void 0===_a?void 0:_a.message)||"")}}catch(error){reject(error)}})}function areCookiesEnabled(){return!(!navigator||!navigator.cookieEnabled)}function getGlobal(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}__name(createMockUserToken,"createMockUserToken"),__name(getUA,"getUA"),__name(isMobileCordova,"isMobileCordova"),__name(isNode,"isNode"),__name(isBrowser,"isBrowser"),__name(isBrowserExtension,"isBrowserExtension"),__name(isReactNative,"isReactNative"),__name(isElectron,"isElectron"),__name(isIE,"isIE"),__name(isUWP,"isUWP"),__name(isNodeSdk,"isNodeSdk"),__name(isSafari,"isSafari"),__name(isIndexedDBAvailable,"isIndexedDBAvailable"),__name(validateIndexedDBOpenable,"validateIndexedDBOpenable"),__name(areCookiesEnabled,"areCookiesEnabled"),__name(getGlobal,"getGlobal");var FirebaseError=function(_super){function FirebaseError2(code,message,customData){var _this=_super.call(this,message)||this;return _this.code=code,_this.customData=customData,_this.name="FirebaseError",Object.setPrototypeOf(_this,FirebaseError2.prototype),Error.captureStackTrace&&Error.captureStackTrace(_this,ErrorFactory.prototype.create),_this}return tslib.__extends(FirebaseError2,_super),__name(FirebaseError2,"FirebaseError"),FirebaseError2}(Error),ErrorFactory=function(){function ErrorFactory2(service,serviceName,errors){this.service=service,this.serviceName=serviceName,this.errors=errors}return __name(ErrorFactory2,"ErrorFactory"),ErrorFactory2.prototype.create=function(code){for(var data=[],_i=1;_i<arguments.length;_i++)data[_i-1]=arguments[_i];var customData=data[0]||{},fullCode=this.service+"/"+code,template=this.errors[code],message=template?replaceTemplate(template,customData):"Error",fullMessage=this.serviceName+": "+message+" ("+fullCode+").",error=new FirebaseError(fullCode,fullMessage,customData);return error},ErrorFactory2}();function replaceTemplate(template,data){return template.replace(PATTERN,function(_,key){var value=data[key];return null!=value?String(value):"<"+key+"?>"})}__name(replaceTemplate,"replaceTemplate");var PATTERN=/\{\$([^}]+)}/g;function jsonEval(str){return JSON.parse(str)}function stringify(data){return JSON.stringify(data)}__name(jsonEval,"jsonEval"),__name(stringify,"stringify");var decode=__name(function(token){var header={},claims={},data={},signature="";try{var parts=token.split(".");header=jsonEval(base64Decode(parts[0])||""),claims=jsonEval(base64Decode(parts[1])||""),signature=parts[2],data=claims.d||{},delete claims.d}catch(e){}return{header,claims,data,signature}},"decode"),isValidTimestamp=__name(function(token){var claims=decode(token).claims,now=Math.floor((new Date).getTime()/1e3),validSince=0,validUntil=0;return"object"==typeof claims&&(claims.hasOwnProperty("nbf")?validSince=claims.nbf:claims.hasOwnProperty("iat")&&(validSince=claims.iat),validUntil=claims.hasOwnProperty("exp")?claims.exp:validSince+86400),!!now&&!!validSince&&!!validUntil&&now>=validSince&&now<=validUntil},"isValidTimestamp"),issuedAtTime=__name(function(token){var claims=decode(token).claims;return"object"==typeof claims&&claims.hasOwnProperty("iat")?claims.iat:null},"issuedAtTime"),isValidFormat=__name(function(token){var claims=decode(token).claims;return!!claims&&"object"==typeof claims&&claims.hasOwnProperty("iat")},"isValidFormat"),isAdmin=__name(function(token){var claims=decode(token).claims;return"object"==typeof claims&&!0===claims.admin},"isAdmin");function contains(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}function safeGet(obj,key){if(Object.prototype.hasOwnProperty.call(obj,key))return obj[key]}function isEmpty(obj){for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key))return!1;return!0}function map(obj,fn,contextObj){var res={};for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(res[key]=fn.call(contextObj,obj[key],key,obj));return res}function deepEqual(a,b){if(a===b)return!0;for(var aKeys=Object.keys(a),bKeys=Object.keys(b),_i=0,aKeys_1=aKeys;_i<aKeys_1.length;_i++){var k=aKeys_1[_i];if(!bKeys.includes(k))return!1;var aProp=a[k],bProp=b[k];if(isObject(aProp)&&isObject(bProp)){if(!deepEqual(aProp,bProp))return!1}else if(aProp!==bProp)return!1}for(var _a=0,bKeys_1=bKeys;_a<bKeys_1.length;_a++){k=bKeys_1[_a];if(!aKeys.includes(k))return!1}return!0}function isObject(thing){return null!==thing&&"object"==typeof thing}function querystring(querystringParams){for(var params=[],_loop_1=__name(function(key2,value2){Array.isArray(value2)?value2.forEach(function(arrayVal){params.push(encodeURIComponent(key2)+"="+encodeURIComponent(arrayVal))}):params.push(encodeURIComponent(key2)+"="+encodeURIComponent(value2))},"_loop_1"),_i=0,_a=Object.entries(querystringParams);_i<_a.length;_i++){var _b=_a[_i];_loop_1(_b[0],_b[1])}return params.length?"&"+params.join("&"):""}function querystringDecode(querystring2){var obj={};return querystring2.replace(/^\?/,"").split("&").forEach(function(token){if(token){var _a=token.split("="),key=_a[0],value=_a[1];obj[decodeURIComponent(key)]=decodeURIComponent(value)}}),obj}function extractQuerystring(url){var queryStart=url.indexOf("?");if(!queryStart)return"";var fragmentStart=url.indexOf("#",queryStart);return url.substring(queryStart,fragmentStart>0?fragmentStart:void 0)}__name(contains,"contains"),__name(safeGet,"safeGet"),__name(isEmpty,"isEmpty"),__name(map,"map"),__name(deepEqual,"deepEqual"),__name(isObject,"isObject"),__name(querystring,"querystring"),__name(querystringDecode,"querystringDecode"),__name(extractQuerystring,"extractQuerystring");var Sha1=function(){function Sha12(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var i=1;i<this.blockSize;++i)this.pad_[i]=0;this.reset()}return __name(Sha12,"Sha1"),Sha12.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},Sha12.prototype.compress_=function(buf,offset){offset||(offset=0);var W=this.W_;if("string"==typeof buf)for(var i=0;i<16;i++)W[i]=buf.charCodeAt(offset)<<24|buf.charCodeAt(offset+1)<<16|buf.charCodeAt(offset+2)<<8|buf.charCodeAt(offset+3),offset+=4;else for(i=0;i<16;i++)W[i]=buf[offset]<<24|buf[offset+1]<<16|buf[offset+2]<<8|buf[offset+3],offset+=4;for(i=16;i<80;i++){var t=W[i-3]^W[i-8]^W[i-14]^W[i-16];W[i]=4294967295&(t<<1|t>>>31)}var f,k,a=this.chain_[0],b=this.chain_[1],c=this.chain_[2],d=this.chain_[3],e=this.chain_[4];for(i=0;i<80;i++){i<40?i<20?(f=d^b&(c^d),k=1518500249):(f=b^c^d,k=1859775393):i<60?(f=b&c|d&(b|c),k=2400959708):(f=b^c^d,k=3395469782);t=(a<<5|a>>>27)+f+e+k+W[i]&4294967295;e=d,d=c,c=4294967295&(b<<30|b>>>2),b=a,a=t}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+b&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+d&4294967295,this.chain_[4]=this.chain_[4]+e&4294967295},Sha12.prototype.update=function(bytes,length){if(null!=bytes){void 0===length&&(length=bytes.length);for(var lengthMinusBlock=length-this.blockSize,n=0,buf=this.buf_,inbuf=this.inbuf_;n<length;){if(0===inbuf)for(;n<=lengthMinusBlock;)this.compress_(bytes,n),n+=this.blockSize;if("string"==typeof bytes){for(;n<length;)if(buf[inbuf]=bytes.charCodeAt(n),++n,++inbuf===this.blockSize){this.compress_(buf),inbuf=0;break}}else for(;n<length;)if(buf[inbuf]=bytes[n],++n,++inbuf===this.blockSize){this.compress_(buf),inbuf=0;break}}this.inbuf_=inbuf,this.total_+=length}},Sha12.prototype.digest=function(){var digest=[],totalBits=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&totalBits,totalBits/=256;this.compress_(this.buf_);var n=0;for(i=0;i<5;i++)for(var j=24;j>=0;j-=8)digest[n]=this.chain_[i]>>j&255,++n;return digest},Sha12}();function createSubscribe(executor,onNoObservers){var proxy=new ObserverProxy(executor,onNoObservers);return proxy.subscribe.bind(proxy)}__name(createSubscribe,"createSubscribe");var ObserverProxy=function(){function ObserverProxy2(executor,onNoObservers){var _this=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=onNoObservers,this.task.then(function(){executor(_this)}).catch(function(e){_this.error(e)})}return __name(ObserverProxy2,"ObserverProxy"),ObserverProxy2.prototype.next=function(value){this.forEachObserver(function(observer){observer.next(value)})},ObserverProxy2.prototype.error=function(error){this.forEachObserver(function(observer){observer.error(error)}),this.close(error)},ObserverProxy2.prototype.complete=function(){this.forEachObserver(function(observer){observer.complete()}),this.close()},ObserverProxy2.prototype.subscribe=function(nextOrObserver,error,complete){var observer,_this=this;if(void 0===nextOrObserver&&void 0===error&&void 0===complete)throw new Error("Missing Observer.");void 0===(observer=implementsAnyMethods(nextOrObserver,["next","error","complete"])?nextOrObserver:{next:nextOrObserver,error,complete}).next&&(observer.next=noop),void 0===observer.error&&(observer.error=noop),void 0===observer.complete&&(observer.complete=noop);var unsub=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{_this.finalError?observer.error(_this.finalError):observer.complete()}catch(e){}}),this.observers.push(observer),unsub},ObserverProxy2.prototype.unsubscribeOne=function(i){void 0===this.observers||void 0===this.observers[i]||(delete this.observers[i],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},ObserverProxy2.prototype.forEachObserver=function(fn){if(!this.finalized)for(var i=0;i<this.observers.length;i++)this.sendOne(i,fn)},ObserverProxy2.prototype.sendOne=function(i,fn){var _this=this;this.task.then(function(){if(void 0!==_this.observers&&void 0!==_this.observers[i])try{fn(_this.observers[i])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})},ObserverProxy2.prototype.close=function(err){var _this=this;this.finalized||(this.finalized=!0,void 0!==err&&(this.finalError=err),this.task.then(function(){_this.observers=void 0,_this.onNoObservers=void 0}))},ObserverProxy2}();function async(fn,onError){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];Promise.resolve(!0).then(function(){fn.apply(void 0,args)}).catch(function(error){onError&&onError(error)})}}function implementsAnyMethods(obj,methods){if("object"!=typeof obj||null===obj)return!1;for(var _i=0,methods_1=methods;_i<methods_1.length;_i++){var method=methods_1[_i];if(method in obj&&"function"==typeof obj[method])return!0}return!1}function noop(){}__name(async,"async"),__name(implementsAnyMethods,"implementsAnyMethods"),__name(noop,"noop");var validateArgCount=__name(function(fnName,minCount,maxCount,argCount){var argError;if(argCount<minCount?argError="at least "+minCount:argCount>maxCount&&(argError=0===maxCount?"none":"no more than "+maxCount),argError)throw new Error(fnName+" failed: Was called with "+argCount+(1===argCount?" argument.":" arguments.")+" Expects "+argError+".")},"validateArgCount");function errorPrefix(fnName,argName){return fnName+" failed: "+argName+" argument "}function validateNamespace(fnName,namespace,optional){if((!optional||namespace)&&"string"!=typeof namespace)throw new Error(errorPrefix(fnName,"namespace")+"must be a valid firebase namespace.")}function validateCallback(fnName,argumentName,callback,optional){if((!optional||callback)&&"function"!=typeof callback)throw new Error(errorPrefix(fnName,argumentName)+"must be a valid function.")}function validateContextObject(fnName,argumentName,context,optional){if((!optional||context)&&("object"!=typeof context||null===context))throw new Error(errorPrefix(fnName,argumentName)+"must be a valid context object.")}__name(errorPrefix,"errorPrefix"),__name(validateNamespace,"validateNamespace"),__name(validateCallback,"validateCallback"),__name(validateContextObject,"validateContextObject");var stringToByteArray=__name(function(str){for(var out=[],p=0,i=0;i<str.length;i++){var c=str.charCodeAt(i);if(c>=55296&&c<=56319){var high=c-55296;i++,assert(i<str.length,"Surrogate pair missing trail surrogate."),c=65536+(high<<10)+(str.charCodeAt(i)-56320)}c<128?out[p++]=c:c<2048?(out[p++]=c>>6|192,out[p++]=63&c|128):c<65536?(out[p++]=c>>12|224,out[p++]=c>>6&63|128,out[p++]=63&c|128):(out[p++]=c>>18|240,out[p++]=c>>12&63|128,out[p++]=c>>6&63|128,out[p++]=63&c|128)}return out},"stringToByteArray"),stringLength=__name(function(str){for(var p=0,i=0;i<str.length;i++){var c=str.charCodeAt(i);c<128?p++:c<2048?p+=2:c>=55296&&c<=56319?(p+=4,i++):p+=3}return p},"stringLength");function calculateBackoffMillis(backoffCount,intervalMillis,backoffFactor){void 0===intervalMillis&&(intervalMillis=1e3),void 0===backoffFactor&&(backoffFactor=2);var currBaseValue=intervalMillis*Math.pow(backoffFactor,backoffCount),randomWait=Math.round(.5*currBaseValue*(Math.random()-.5)*2);return Math.min(144e5,currBaseValue+randomWait)}function ordinal(i){return Number.isFinite(i)?i+indicator(i):""+i}function indicator(i){var cent=(i=Math.abs(i))%100;if(cent>=10&&cent<=20)return"th";var dec=i%10;return 1===dec?"st":2===dec?"nd":3===dec?"rd":"th"}function getModularInstance(service){return service&&service._delegate?service._delegate:service}__name(calculateBackoffMillis,"calculateBackoffMillis"),__name(ordinal,"ordinal"),__name(indicator,"indicator"),__name(getModularInstance,"getModularInstance"),CONSTANTS.NODE_CLIENT=!0,exports2.CONSTANTS=CONSTANTS,exports2.Deferred=Deferred,exports2.ErrorFactory=ErrorFactory,exports2.FirebaseError=FirebaseError,exports2.MAX_VALUE_MILLIS=144e5,exports2.RANDOM_FACTOR=.5,exports2.Sha1=Sha1,exports2.areCookiesEnabled=areCookiesEnabled,exports2.assert=assert,exports2.assertionError=assertionError,exports2.async=async,exports2.base64=base64,exports2.base64Decode=base64Decode,exports2.base64Encode=base64Encode,exports2.base64urlEncodeWithoutPadding=base64urlEncodeWithoutPadding,exports2.calculateBackoffMillis=calculateBackoffMillis,exports2.contains=contains,exports2.createMockUserToken=createMockUserToken,exports2.createSubscribe=createSubscribe,exports2.decode=decode,exports2.deepCopy=deepCopy,exports2.deepEqual=deepEqual,exports2.deepExtend=deepExtend,exports2.errorPrefix=errorPrefix,exports2.extractQuerystring=extractQuerystring,exports2.getGlobal=getGlobal,exports2.getModularInstance=getModularInstance,exports2.getUA=getUA,exports2.isAdmin=isAdmin,exports2.isBrowser=isBrowser,exports2.isBrowserExtension=isBrowserExtension,exports2.isElectron=isElectron,exports2.isEmpty=isEmpty,exports2.isIE=isIE,exports2.isIndexedDBAvailable=isIndexedDBAvailable,exports2.isMobileCordova=isMobileCordova,exports2.isNode=isNode,exports2.isNodeSdk=isNodeSdk,exports2.isReactNative=isReactNative,exports2.isSafari=isSafari,exports2.isUWP=isUWP,exports2.isValidFormat=isValidFormat,exports2.isValidTimestamp=isValidTimestamp,exports2.issuedAtTime=issuedAtTime,exports2.jsonEval=jsonEval,exports2.map=map,exports2.ordinal=ordinal,exports2.querystring=querystring,exports2.querystringDecode=querystringDecode,exports2.safeGet=safeGet,exports2.stringLength=stringLength,exports2.stringToByteArray=stringToByteArray,exports2.stringify=stringify,exports2.validateArgCount=validateArgCount,exports2.validateCallback=validateCallback,exports2.validateContextObject=validateContextObject,exports2.validateIndexedDBOpenable=validateIndexedDBOpenable,exports2.validateNamespace=validateNamespace},29311:(module,__unused_webpack_exports,__webpack_require__)=>{!function(){"use strict";var fs=__webpack_require__(35747);function Storage(path,opts){var db;opts=opts||{},Object.defineProperty(this,"___priv_bk___",{value:{path},writable:!1,enumerable:!1}),Object.defineProperty(this,"___priv_strict___",{value:!!opts.strict,writable:!1,enumerable:!1}),Object.defineProperty(this,"___priv_ws___",{value:opts.ws||"  ",writable:!1,enumerable:!1});try{db=JSON.parse(fs.readFileSync(path))}catch(e){db={}}Object.keys(db).forEach(function(key){this[key]=db[key]},this)}__name(Storage,"Storage"),Storage.prototype.getItem=function(key){return this.hasOwnProperty(key)?this.___priv_strict___?String(this[key]):this[key]:null},Storage.prototype.setItem=function(key,val){void 0===val?this[key]=null:this.___priv_strict___?this[key]=String(val):this[key]=val,this.___save___()},Storage.prototype.removeItem=function(key){delete this[key],this.___save___()},Storage.prototype.clear=function(){var self2=this;Object.keys(self2).forEach(function(key){self2[key]=void 0,delete self2[key]})},Storage.prototype.key=function(i){return i=i||0,Object.keys(this)[i]},Object.defineProperty(Storage.prototype,"length",{get:function(){return Object.keys(this).length}}),Storage.prototype.___save___=function(){var self2=this;if(this.___priv_bk___.path){if(this.___priv_bk___.lock)return void(this.___priv_bk___.wait=!0);this.___priv_bk___.lock=!0,fs.writeFile(this.___priv_bk___.path,JSON.stringify(this,null,this.___priv_ws___),"utf8",function(e){if(self2.___priv_bk___.lock=!1,e)return console.error("Could not write to database",self2.___priv_bk___.path),void console.error(e);self2.___priv_bk___.wait&&(self2.___priv_bk___.wait=!1,self2.___save___())})}},Object.defineProperty(Storage,"create",{value:function(path,opts){return new Storage(path,opts)},writable:!1,enumerable:!1}),module.exports=Storage}()},24395:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var firebase=__webpack_require__(42672);function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}__name(_interopDefaultLegacy,"_interopDefaultLegacy");var firebase__default=_interopDefaultLegacy(firebase);firebase__default.default.registerVersion("firebase","8.10.0","app"),firebase__default.default.SDK_VERSION="8.10.0",module.exports=firebase__default.default},3977:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{"use strict";__webpack_require__(6003)},96550:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{"use strict";__webpack_require__(56099)},59690:(__unused_webpack_module,exports2,__webpack_require__)=>{var assert=__webpack_require__(42357);function HTTPParser(type){assert.ok(type===HTTPParser.REQUEST||type===HTTPParser.RESPONSE),this.type=type,this.state=type+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1}exports2.m=HTTPParser,__name(HTTPParser,"HTTPParser"),HTTPParser.maxHeaderSize=81920,HTTPParser.REQUEST="REQUEST",HTTPParser.RESPONSE="RESPONSE";var kOnHeaders=HTTPParser.kOnHeaders=0,kOnHeadersComplete=HTTPParser.kOnHeadersComplete=1,kOnBody=HTTPParser.kOnBody=2,kOnMessageComplete=HTTPParser.kOnMessageComplete=3;HTTPParser.prototype[kOnHeaders]=HTTPParser.prototype[kOnHeadersComplete]=HTTPParser.prototype[kOnBody]=HTTPParser.prototype[kOnMessageComplete]=function(){};var compatMode0_12=!0;Object.defineProperty(HTTPParser,"kOnExecute",{get:function(){return compatMode0_12=!1,4}});var methods=HTTPParser.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK"];HTTPParser.prototype.reinitialize=HTTPParser,HTTPParser.prototype.close=HTTPParser.prototype.pause=HTTPParser.prototype.resume=HTTPParser.prototype.free=function(){},HTTPParser.prototype._compatMode0_11=!1,HTTPParser.prototype.getAsyncId=function(){return 0};var headerState={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};HTTPParser.prototype.execute=function(chunk,start,length){if(!(this instanceof HTTPParser))throw new TypeError("not a HTTPParser");start=start||0,length="number"==typeof length?length:chunk.length,this.chunk=chunk,this.offset=start;var end=this.end=start+length;try{for(;this.offset<end&&!this[this.state](););}catch(err){if(this.isUserCall)throw err;return this.hadError=!0,err}return this.chunk=null,length=this.offset-start,headerState[this.state]&&(this.headerSize+=length,this.headerSize>HTTPParser.maxHeaderSize)?new Error("max header size exceeded"):length};var stateFinishAllowed={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};HTTPParser.prototype.finish=function(){if(!this.hadError){if(!stateFinishAllowed[this.state])return new Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[kOnMessageComplete]())}},HTTPParser.prototype.consume=HTTPParser.prototype.unconsume=HTTPParser.prototype.getCurrentBuffer=function(){},HTTPParser.prototype.userCall=function(){this.isUserCall=!0;var self2=this;return function(ret){return self2.isUserCall=!1,ret}},HTTPParser.prototype.nextRequest=function(){this.userCall()(this[kOnMessageComplete]()),this.reinitialize(this.type)},HTTPParser.prototype.consumeLine=function(){for(var end=this.end,chunk=this.chunk,i=this.offset;i<end;i++)if(10===chunk[i]){var line=this.line+chunk.toString("ascii",this.offset,i);return"\r"===line.charAt(line.length-1)&&(line=line.substr(0,line.length-1)),this.line="",this.offset=i+1,line}this.line+=chunk.toString("ascii",this.offset,this.end),this.offset=this.end};var headerExp=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,headerContinueExp=/^[ \t]+(.*[^ \t])/;HTTPParser.prototype.parseHeader=function(line,headers){if(-1!==line.indexOf("\r"))throw parseErrorCode("HPE_LF_EXPECTED");var match=headerExp.exec(line),k=match&&match[1];if(k)headers.push(k),headers.push(match[2]);else{var matchContinue=headerContinueExp.exec(line);matchContinue&&headers.length&&(headers[headers.length-1]&&(headers[headers.length-1]+=" "),headers[headers.length-1]+=matchContinue[1])}};var requestExp=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;HTTPParser.prototype.REQUEST_LINE=function(){var line=this.consumeLine();if(line){var match=requestExp.exec(line);if(null===match)throw parseErrorCode("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?match[1]:methods.indexOf(match[1]),-1===this.info.method)throw new Error("invalid request method");"CONNECT"===match[1]&&(this.info.upgrade=!0),this.info.url=match[2],this.info.versionMajor=+match[3],this.info.versionMinor=+match[4],this.body_bytes=0,this.state="HEADER"}};var responseExp=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function parseErrorCode(code){var err=new Error("Parse Error");return err.code=code,err}HTTPParser.prototype.RESPONSE_LINE=function(){var line=this.consumeLine();if(line){var match=responseExp.exec(line);if(null===match)throw parseErrorCode("HPE_INVALID_CONSTANT");this.info.versionMajor=+match[1],this.info.versionMinor=+match[2];var statusCode=this.info.statusCode=+match[3];this.info.statusMessage=match[4],(1==(statusCode/100|0)||204===statusCode||304===statusCode)&&(this.body_bytes=0),this.state="HEADER"}},HTTPParser.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return!(null===this.body_bytes&&!this.isChunked)},HTTPParser.prototype.HEADER=function(){var line=this.consumeLine();if(void 0!==line){var info=this.info;if(line)this.parseHeader(line,info.headers);else{for(var currentContentLengthValue,headers=info.headers,hasContentLength=!1,i=0;i<headers.length;i+=2)switch(headers[i].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===headers[i+1].toLowerCase();break;case"content-length":if(currentContentLengthValue=+headers[i+1],hasContentLength){if(currentContentLengthValue!==this.body_bytes)throw parseErrorCode("HPE_UNEXPECTED_CONTENT_LENGTH")}else hasContentLength=!0,this.body_bytes=currentContentLengthValue;break;case"connection":this.connection+=headers[i+1].toLowerCase();break;case"upgrade":info.upgrade=!0}if(this.isChunked&&hasContentLength)throw parseErrorCode("HPE_UNEXPECTED_CONTENT_LENGTH");var skipBody;if(info.shouldKeepAlive=this.shouldKeepAlive(),skipBody=compatMode0_12?this.userCall()(this[kOnHeadersComplete](info)):this.userCall()(this[kOnHeadersComplete](info.versionMajor,info.versionMinor,info.headers,info.method,info.url,info.statusCode,info.statusMessage,info.upgrade,info.shouldKeepAlive)),info.upgrade||2===skipBody)return this.nextRequest(),!0;this.isChunked&&!skipBody?this.state="BODY_CHUNKHEAD":skipBody||0===this.body_bytes?this.nextRequest():null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}},HTTPParser.prototype.BODY_CHUNKHEAD=function(){var line=this.consumeLine();void 0!==line&&(this.body_bytes=parseInt(line,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},HTTPParser.prototype.BODY_CHUNK=function(){var length=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[kOnBody](this.chunk,this.offset,length)),this.offset+=length,this.body_bytes-=length,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},HTTPParser.prototype.BODY_CHUNKEMPTYLINE=function(){var line=this.consumeLine();void 0!==line&&(assert.equal(line,""),this.state="BODY_CHUNKHEAD")},HTTPParser.prototype.BODY_CHUNKTRAILERS=function(){var line=this.consumeLine();void 0!==line&&(line?this.parseHeader(line,this.trailers):(this.trailers.length&&this.userCall()(this[kOnHeaders](this.trailers,"")),this.nextRequest()))},HTTPParser.prototype.BODY_RAW=function(){var length=this.end-this.offset;this.userCall()(this[kOnBody](this.chunk,this.offset,length)),this.offset=this.end},HTTPParser.prototype.BODY_SIZED=function(){var length=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[kOnBody](this.chunk,this.offset,length)),this.offset+=length,this.body_bytes-=length,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(name){var k=HTTPParser["kOn"+name];Object.defineProperty(HTTPParser.prototype,"on"+name,{get:function(){return this[k]},set:function(to){return this._compatMode0_11=!0,this[k]=to}})}),__name(parseErrorCode,"parseErrorCode")},49673:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{R:()=>subscribeOn});var Observable=__webpack_require__(18891),asap=__webpack_require__(64581),isNumeric=__webpack_require__(26561);class SubscribeOnObservable extends Observable.y{constructor(source,delayTime=0,scheduler=asap.e){super(),this.source=source,this.delayTime=delayTime,this.scheduler=scheduler,(!(0,isNumeric.k)(delayTime)||delayTime<0)&&(this.delayTime=0),(!scheduler||"function"!=typeof scheduler.schedule)&&(this.scheduler=asap.e)}static create(source,delay=0,scheduler=asap.e){return new SubscribeOnObservable(source,delay,scheduler)}static dispatch(arg){const{source,subscriber}=arg;return this.add(source.subscribe(subscriber))}_subscribe(subscriber){const delay=this.delayTime,source=this.source;return this.scheduler.schedule(SubscribeOnObservable.dispatch,delay,{source,subscriber})}}function subscribeOn(scheduler,delay=0){return __name(function(source){return source.lift(new SubscribeOnOperator(scheduler,delay))},"subscribeOnOperatorFunction")}__name(SubscribeOnObservable,"SubscribeOnObservable"),__name(subscribeOn,"subscribeOn");class SubscribeOnOperator{constructor(scheduler,delay){this.scheduler=scheduler,this.delay=delay}call(subscriber,source){return new SubscribeOnObservable(source,this.delay,this.scheduler).subscribe(subscriber)}}__name(SubscribeOnOperator,"SubscribeOnOperator")},57057:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{M:()=>withLatestFrom});var _OuterSubscriber__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(55197),_util_subscribeToResult__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(20509);function withLatestFrom(...args){return source=>{let project;"function"==typeof args[args.length-1]&&(project=args.pop());const observables=args;return source.lift(new WithLatestFromOperator(observables,project))}}__name(withLatestFrom,"withLatestFrom");class WithLatestFromOperator{constructor(observables,project){this.observables=observables,this.project=project}call(subscriber,source){return source.subscribe(new WithLatestFromSubscriber(subscriber,this.observables,this.project))}}__name(WithLatestFromOperator,"WithLatestFromOperator");class WithLatestFromSubscriber extends _OuterSubscriber__WEBPACK_IMPORTED_MODULE_0__.L{constructor(destination,observables,project){super(destination),this.observables=observables,this.project=project,this.toRespond=[];const len=observables.length;this.values=new Array(len);for(let i=0;i<len;i++)this.toRespond.push(i);for(let i=0;i<len;i++){let observable=observables[i];this.add((0,_util_subscribeToResult__WEBPACK_IMPORTED_MODULE_1__.D)(this,observable,void 0,i))}}notifyNext(_outerValue,innerValue,outerIndex){this.values[outerIndex]=innerValue;const toRespond=this.toRespond;if(toRespond.length>0){const found=toRespond.indexOf(outerIndex);-1!==found&&toRespond.splice(found,1)}}notifyComplete(){}_next(value){if(0===this.toRespond.length){const args=[value,...this.values];this.project?this._tryProject(args):this.destination.next(args)}}_tryProject(args){let result;try{result=this.project.apply(this,args)}catch(err){return void this.destination.error(err)}this.destination.next(result)}}__name(WithLatestFromSubscriber,"WithLatestFromSubscriber")},3081:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Base=__webpack_require__(53766),Client=__webpack_require__(85951),Server=__webpack_require__(50712),Driver={client:function(url,options){return void 0===(options=options||{}).masking&&(options.masking=!0),new Client(url,options)},server:function(options){return void 0===(options=options||{}).requireMasking&&(options.requireMasking=!0),new Server(options)},http:function(){return Server.http.apply(Server,arguments)},isSecureRequest:function(request){return Server.isSecureRequest(request)},isWebSocket:function(request){return Base.isWebSocket(request)},validateOptions:function(options,validKeys){Base.validateOptions(options,validKeys)}};module.exports=Driver},53766:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Buffer2=__webpack_require__(55859).Buffer,Emitter=__webpack_require__(28614).EventEmitter,util=__webpack_require__(31669),streams=__webpack_require__(10629),Headers2=__webpack_require__(30419),Reader=__webpack_require__(73777),Base=__name(function(request,url,options){Emitter.call(this),Base.validateOptions(options||{},["maxLength","masking","requireMasking","protocols"]),this._request=request,this._reader=new Reader,this._options=options||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new Headers2,this.__queue=[],this.readyState=0,this.url=url,this.io=new streams.IO(this),this.messages=new streams.Messages(this),this._bindEventListeners()},"Base");util.inherits(Base,Emitter),Base.isWebSocket=function(request){var connection=request.headers.connection||"",upgrade=request.headers.upgrade||"";return"GET"===request.method&&connection.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===upgrade.toLowerCase()},Base.validateOptions=function(options,validKeys){for(var key2 in options)if(validKeys.indexOf(key2)<0)throw new Error("Unrecognized option: "+key2)};var instance={MAX_LENGTH:67108863,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var self2=this;this.messages.on("error",function(){}),this.on("message",function(event){var messages=self2.messages;messages.readable&&messages.emit("data",event.data)}),this.on("error",function(error){var messages=self2.messages;messages.readable&&messages.emit("error",error)}),this.on("close",function(){var messages=self2.messages;!messages.readable||(messages.readable=messages.writable=!1,messages.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(extension){return!1},setHeader:function(name,value){return!(this.readyState>0)&&(this._headers.set(name,value),!0)},start:function(){if(0!==this.readyState)return!1;if(!Base.isWebSocket(this._request))return this._failHandshake(new Error("Not a WebSocket request"));var response;try{response=this._handshakeResponse()}catch(error){return this._failHandshake(error)}return this._write(response),-1!==this._stage&&this._open(),!0},_failHandshake:function(error){var headers=new Headers2;return headers.set("Content-Type","text/plain"),headers.set("Content-Length",Buffer2.byteLength(error.message,"utf8")),headers=["HTTP/1.1 400 Bad Request",headers.toString(),error.message],this._write(Buffer2.from(headers.join("\r\n"),"utf8")),this._fail("protocol_error",error.message),!1},text:function(message){return this.frame(message)},binary:function(message){return!1},ping:function(){return!1},pong:function(){return!1},close:function(reason,code){return 1===this.readyState&&(this.readyState=3,this.emit("close",new Base.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(args){this.frame.apply(this,args)},this),this.__queue=[],this.emit("open",new Base.OpenEvent)},_queue:function(message){return this.__queue.push(message),!0},_write:function(chunk){var io=this.io;io.readable&&io.emit("data",chunk)},_fail:function(type,message){this.readyState=2,this.emit("error",new Error(message)),this.close()}};for(var key in instance)Base.prototype[key]=instance[key];Base.ConnectEvent=function(){},Base.OpenEvent=function(){},Base.CloseEvent=function(code,reason){this.code=code,this.reason=reason},Base.MessageEvent=function(data){this.data=data},Base.PingEvent=function(data){this.data=data},Base.PongEvent=function(data){this.data=data},module.exports=Base},85951:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Buffer2=__webpack_require__(55859).Buffer,crypto=__webpack_require__(76417),url=__webpack_require__(78835),util=__webpack_require__(31669),HttpParser=__webpack_require__(30707),Base=__webpack_require__(53766),Hybi=__webpack_require__(26380),Proxy2=__webpack_require__(97225),Client=__name(function(_url,options){this.version="hybi-"+Hybi.VERSION,Hybi.call(this,null,_url,options),this.readyState=-1,this._key=Client.generateKey(),this._accept=Hybi.generateAccept(this._key),this._http=new HttpParser("response");var uri=url.parse(this.url),auth=uri.auth&&Buffer2.from(uri.auth,"utf8").toString("base64");if(this.VALID_PROTOCOLS.indexOf(uri.protocol)<0)throw new Error(this.url+" is not a valid WebSocket URL");this._pathname=(uri.pathname||"/")+(uri.search||""),this._headers.set("Host",uri.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",Hybi.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),auth&&this._headers.set("Authorization","Basic "+auth)},"Client");util.inherits(Client,Hybi),Client.generateKey=function(){return crypto.randomBytes(16).toString("base64")};var instance={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(origin,options){return new Proxy2(this,origin,options)},start:function(){return-1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(chunk){if(3!==this.readyState){if(this.readyState>0)return Hybi.prototype.parse.call(this,chunk);this._http.parse(chunk),this._http.isComplete()&&(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body)))}},_handshakeRequest:function(){var extensions=this._extensions.generateOffer();extensions&&this._headers.set("Sec-WebSocket-Extensions",extensions);var headers=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return Buffer2.from(headers.join("\r\n"),"utf8")},_failHandshake:function(message){message="Error during WebSocket handshake: "+message,this.readyState=3,this.emit("error",new Error(message)),this.emit("close",new Base.CloseEvent(this.ERRORS.protocol_error,message))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var headers=this._http.headers,upgrade=headers.upgrade||"",connection=headers.connection||"",accept=headers["sec-websocket-accept"]||"",protocol=headers["sec-websocket-protocol"]||"";if(""===upgrade)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==upgrade.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===connection)return this._failHandshake("'Connection' header is missing");if("upgrade"!==connection.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(accept!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==protocol){if(this._protocols.indexOf(protocol)<0)return this._failHandshake("Sec-WebSocket-Protocol mismatch");this.protocol=protocol}try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(e){return this._failHandshake(e.message)}}};for(var key in instance)Client.prototype[key]=instance[key];module.exports=Client},866:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Buffer2=__webpack_require__(55859).Buffer,Base=__webpack_require__(53766),util=__webpack_require__(31669),Draft75=__name(function(request,url,options){Base.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)},"Draft75");util.inherits(Draft75,Base);var instance={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new Base.CloseEvent(null,null)),!0)},parse:function(chunk){this.readyState>1||(this._reader.put(chunk),this._reader.eachByte(function(octet){var message;switch(this._stage){case-1:this._body.push(octet),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(octet);break;case 1:if(this._length=(127&octet)+128*this._length,this._closing&&0===this._length)return this.close();128!=(128&octet)&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===octet)this._stage=0,message=Buffer2.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new Base.MessageEvent(message));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(octet),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(buffer){if(0===this.readyState)return this._queue([buffer]);if(this.readyState>1)return!1;"string"!=typeof buffer&&(buffer=buffer.toString());var length=Buffer2.byteLength(buffer),frame=Buffer2.allocUnsafe(length+2);return frame[0]=0,frame.write(buffer,1),frame[frame.length-1]=255,this._write(frame),!0},_handshakeResponse:function(){var headers=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return Buffer2.from(headers.join("\r\n"),"utf8")},_parseLeadingByte:function(octet){128==(128&octet)?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var key in instance)Draft75.prototype[key]=instance[key];module.exports=Draft75},539:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Buffer2=__webpack_require__(55859).Buffer,Base=__webpack_require__(53766),Draft75=__webpack_require__(866),crypto=__webpack_require__(76417),util=__webpack_require__(31669),numberFromKey=__name(function(key2){return parseInt((key2.match(/[0-9]/g)||[]).join(""),10)},"numberFromKey"),spacesInKey=__name(function(key2){return(key2.match(/ /g)||[]).length},"spacesInKey"),Draft76=__name(function(request,url,options){Draft75.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)},"Draft76");util.inherits(Draft76,Draft75);var instance={BODY_SIZE:8,start:function(){return!!Draft75.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(Buffer2.from([255,0])),this.readyState=3,this.emit("close",new Base.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var key1=(headers=this._request.headers)["sec-websocket-key1"],key2=headers["sec-websocket-key2"];if(!key1)throw new Error("Missing required header: Sec-WebSocket-Key1");if(!key2)throw new Error("Missing required header: Sec-WebSocket-Key2");var number1=numberFromKey(key1),spaces1=spacesInKey(key1),number2=numberFromKey(key2),spaces2=spacesInKey(key2);if(number1%spaces1!=0||number2%spaces2!=0)throw new Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[number1/spaces1,number2/spaces2];var headers=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return Buffer2.from(headers.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var md5=crypto.createHash("md5"),buffer=Buffer2.allocUnsafe(8+this.BODY_SIZE);return buffer.writeUInt32BE(this._keyValues[0],0),buffer.writeUInt32BE(this._keyValues[1],4),Buffer2.from(this._body).copy(buffer,8,0,this.BODY_SIZE),md5.update(buffer),Buffer2.from(md5.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var signature=this._handshakeSignature();!signature||(this._write(signature),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(octet){if(255!==octet)return Draft75.prototype._parseLeadingByte.call(this,octet);this._closing=!0,this._length=0,this._stage=1}};for(var key in instance)Draft76.prototype[key]=instance[key];module.exports=Draft76},30419:module=>{"use strict";var Headers2=__name(function(){this.clear()},"Headers");Headers2.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],Headers2.prototype.clear=function(){this._sent={},this._lines=[]},Headers2.prototype.set=function(name,value){if(void 0!==value){name=this._strip(name),value=this._strip(value);var key=name.toLowerCase();(!this._sent.hasOwnProperty(key)||this.ALLOWED_DUPLICATES.indexOf(key)>=0)&&(this._sent[key]=!0,this._lines.push(name+": "+value+"\r\n"))}},Headers2.prototype.toString=function(){return this._lines.join("")},Headers2.prototype._strip=function(string){return string.toString().replace(/^ */,"").replace(/ *$/,"")},module.exports=Headers2},26380:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Buffer2=__webpack_require__(55859).Buffer,crypto=__webpack_require__(76417),util=__webpack_require__(31669),Extensions=__webpack_require__(62422),Base=__webpack_require__(53766),Frame=__webpack_require__(42050),Message=__webpack_require__(40544),Hybi=__name(function(request,url,options){if(Base.apply(this,arguments),this._extensions=new Extensions,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var protos=this._request.headers["sec-websocket-protocol"],supported=this._protocols;void 0!==protos&&("string"==typeof protos&&(protos=protos.split(/ *, */)),this.protocol=protos.filter(function(p){return supported.indexOf(p)>=0})[0]),this.version="hybi-"+Hybi.VERSION}},"Hybi");util.inherits(Hybi,Base),Hybi.VERSION="13",Hybi.mask=function(payload,mask,offset){if(!mask||0===mask.length)return payload;offset=offset||0;for(var i=0,n=payload.length-offset;i<n;i++)payload[offset+i]=payload[offset+i]^mask[i%4];return payload},Hybi.generateAccept=function(key2){var sha1=crypto.createHash("sha1");return sha1.update(key2+Hybi.GUID),sha1.digest("base64")},Hybi.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var instance={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(extension){return this._extensions.add(extension),!0},parse:function(chunk){this._reader.put(chunk);for(var buffer=!0;buffer;)switch(this._stage){case 0:(buffer=this._reader.read(1))&&this._parseOpcode(buffer[0]);break;case 1:(buffer=this._reader.read(1))&&this._parseLength(buffer[0]);break;case 2:(buffer=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(buffer);break;case 3:(buffer=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=buffer);break;case 4:(buffer=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(buffer));break;default:buffer=null}},text:function(message){return!(this.readyState>1)&&this.frame(message,"text")},binary:function(message){return!(this.readyState>1)&&this.frame(message,"binary")},ping:function(message,callback){return!(this.readyState>1)&&(message=message||"",callback&&(this._pingCallbacks[message]=callback),this.frame(message,"ping"))},pong:function(message){return!(this.readyState>1)&&(message=message||"",this.frame(message,"pong"))},close:function(reason,code){return reason=reason||"",code=code||this.ERRORS.normal_closure,this.readyState<=0?(this.readyState=3,this.emit("close",new Base.CloseEvent(code,reason)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(reason,"close",code)},this),!0)},frame:function(buffer,type,code){if(this.readyState<=0)return this._queue([buffer,type,code]);if(this.readyState>2)return!1;buffer instanceof Array&&(buffer=Buffer2.from(buffer)),"number"==typeof buffer&&(buffer=buffer.toString());var payload,copy,message=new Message,isText="string"==typeof buffer;message.rsv1=message.rsv2=message.rsv3=!1,message.opcode=this.OPCODES[type||(isText?"text":"binary")],payload=isText?Buffer2.from(buffer,"utf8"):buffer,code&&(copy=payload,(payload=Buffer2.allocUnsafe(2+copy.length)).writeUInt16BE(code,0),copy.copy(payload,2)),message.data=payload;var onMessageReady=__name(function(message2){var frame=new Frame;frame.final=!0,frame.rsv1=message2.rsv1,frame.rsv2=message2.rsv2,frame.rsv3=message2.rsv3,frame.opcode=message2.opcode,frame.masked=!!this._masking,frame.length=message2.data.length,frame.payload=message2.data,frame.masked&&(frame.maskingKey=crypto.randomBytes(4)),this._sendFrame(frame)},"onMessageReady");return this.MESSAGE_OPCODES.indexOf(message.opcode)>=0?this._extensions.processOutgoingMessage(message,function(error,message2){if(error)return this._fail("extension_error",error.message);onMessageReady.call(this,message2)},this):onMessageReady.call(this,message),!0},_sendFrame:function(frame){var length=frame.length,header=length<=125?2:length<=65535?4:10,offset=header+(frame.masked?4:0),buffer=Buffer2.allocUnsafe(offset+length),masked=frame.masked?this.MASK:0;buffer[0]=(frame.final?this.FIN:0)|(frame.rsv1?this.RSV1:0)|(frame.rsv2?this.RSV2:0)|(frame.rsv3?this.RSV3:0)|frame.opcode,length<=125?buffer[1]=masked|length:length<=65535?(buffer[1]=126|masked,buffer.writeUInt16BE(length,2)):(buffer[1]=127|masked,buffer.writeUInt32BE(Math.floor(length/4294967296),2),buffer.writeUInt32BE(length%4294967296,6)),frame.payload.copy(buffer,offset),frame.masked&&(frame.maskingKey.copy(buffer,header),Hybi.mask(buffer,frame.maskingKey,offset)),this._write(buffer)},_handshakeResponse:function(){var secKey=this._request.headers["sec-websocket-key"],version=this._request.headers["sec-websocket-version"];if(version!==Hybi.VERSION)throw new Error("Unsupported WebSocket version: "+version);if("string"!=typeof secKey)throw new Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",Hybi.generateAccept(secKey)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var extensions=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);extensions&&this._headers.set("Sec-WebSocket-Extensions",extensions);var headers=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return Buffer2.from(headers.join("\r\n"),"utf8")},_shutdown:function(code,reason,error){delete this._frame,delete this._message,this._stage=5;var sendCloseFrame=1===this.readyState;this.readyState=2,this._extensions.close(function(){sendCloseFrame&&this.frame(reason,"close",code),this.readyState=3,error&&this.emit("error",new Error(reason)),this.emit("close",new Base.CloseEvent(code,reason))},this)},_fail:function(type,message){this.readyState>1||this._shutdown(this.ERRORS[type],message,!0)},_parseOpcode:function(octet){var rsvs=[this.RSV1,this.RSV2,this.RSV3].map(function(rsv){return(octet&rsv)===rsv}),frame=this._frame=new Frame;return frame.final=(octet&this.FIN)===this.FIN,frame.rsv1=rsvs[0],frame.rsv2=rsvs[1],frame.rsv3=rsvs[2],frame.opcode=octet&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(frame)?this.OPCODE_CODES.indexOf(frame.opcode)<0?this._fail("protocol_error","Unrecognized frame opcode: "+frame.opcode):this.MESSAGE_OPCODES.indexOf(frame.opcode)<0&&!frame.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+frame.opcode):this._message&&this.OPENING_OPCODES.indexOf(frame.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+(frame.rsv1?1:0)+", reserved2 = "+(frame.rsv2?1:0)+", reserved3 = "+(frame.rsv3?1:0))},_parseLength:function(octet){var frame=this._frame;if(frame.masked=(octet&this.MASK)===this.MASK,frame.length=octet&this.LENGTH,frame.length>=0&&frame.length<=125){if(this._stage=frame.masked?3:4,!this._checkFrameLength())return}else this._stage=2,frame.lengthBytes=126===frame.length?2:8;if(this._requireMasking&&!frame.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(buffer){var frame=this._frame;if(frame.length=this._readUInt(buffer),this._stage=frame.masked?3:4,this.MESSAGE_OPCODES.indexOf(frame.opcode)<0&&frame.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+frame.length);this._checkFrameLength()},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(buffer){var message,code,reason,callbacks,callback,frame=this._frame,payload=frame.payload=Hybi.mask(buffer,frame.maskingKey),opcode=frame.opcode;if(delete this._frame,opcode===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(frame)}if((opcode===this.OPCODES.text||opcode===this.OPCODES.binary)&&(this._message=new Message,this._message.pushFrame(frame)),frame.final&&this.MESSAGE_OPCODES.indexOf(opcode)>=0)return this._emitMessage(this._message);opcode===this.OPCODES.close&&(code=payload.length>=2?payload.readUInt16BE(0):null,reason=payload.length>2?this._encode(payload.slice(2)):null,0!==payload.length&&!(null!==code&&code>=this.MIN_RESERVED_ERROR&&code<=this.MAX_RESERVED_ERROR)&&this.ERROR_CODES.indexOf(code)<0&&(code=this.ERRORS.protocol_error),(payload.length>125||payload.length>2&&!reason)&&(code=this.ERRORS.protocol_error),this._shutdown(code||this.DEFAULT_ERROR_CODE,reason||"")),opcode===this.OPCODES.ping&&(this.frame(payload,"pong"),this.emit("ping",new Base.PingEvent(payload.toString()))),opcode===this.OPCODES.pong&&(callback=(callbacks=this._pingCallbacks)[message=this._encode(payload)],delete callbacks[message],callback&&callback(),this.emit("pong",new Base.PongEvent(payload.toString())))},_emitMessage:function(message){(message=this._message).read(),delete this._message,this._extensions.processIncomingMessage(message,function(error,message2){if(error)return this._fail("extension_error",error.message);var payload=message2.data;if(message2.opcode===this.OPCODES.text&&(payload=this._encode(payload)),null===payload)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new Base.MessageEvent(payload))},this)},_encode:function(buffer){try{var string=buffer.toString("binary",0,buffer.length);if(!this.UTF8_MATCH.test(string))return null}catch(e){}return buffer.toString("utf8",0,buffer.length)},_readUInt:function(buffer){return 2===buffer.length?buffer.readUInt16BE(0):4294967296*buffer.readUInt32BE(0)+buffer.readUInt32BE(4)}};for(var key in instance)Hybi.prototype[key]=instance[key];module.exports=Hybi},42050:module=>{"use strict";var Frame=__name(function(){},"Frame"),instance={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var key in instance)Frame.prototype[key]=instance[key];module.exports=Frame},40544:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Buffer2=__webpack_require__(55859).Buffer,Message=__name(function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},"Message"),instance={read:function(){return this.data=this.data||Buffer2.concat(this._chunks,this.length)},pushFrame:function(frame){this.rsv1=this.rsv1||frame.rsv1,this.rsv2=this.rsv2||frame.rsv2,this.rsv3=this.rsv3||frame.rsv3,null===this.opcode&&(this.opcode=frame.opcode),this._chunks.push(frame.payload),this.length+=frame.length}};for(var key in instance)Message.prototype[key]=instance[key];module.exports=Message},97225:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Buffer2=__webpack_require__(55859).Buffer,Stream=__webpack_require__(92413).Stream,url=__webpack_require__(78835),util=__webpack_require__(31669),Base=__webpack_require__(53766),Headers2=__webpack_require__(30419),HttpParser=__webpack_require__(30707),PORTS={"ws:":80,"wss:":443},Proxy2=__name(function(client,origin,options){this._client=client,this._http=new HttpParser("response"),this._origin="object"==typeof client.url?client.url:url.parse(client.url),this._url="object"==typeof origin?origin:url.parse(origin),this._options=options||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new Headers2,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var auth=this._url.auth&&Buffer2.from(this._url.auth,"utf8").toString("base64");auth&&this._headers.set("Proxy-Authorization","Basic "+auth)},"Proxy");util.inherits(Proxy2,Stream);var instance={setHeader:function(name,value){return 0===this._state&&(this._headers.set(name,value),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var origin=this._origin,port=origin.port||PORTS[origin.protocol],headers=["CONNECT "+origin.hostname+":"+port+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",Buffer2.from(headers.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(chunk){if(!this.writable)return!1;if(this._http.parse(chunk),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new Base.ConnectEvent);else{var message="Can't establish a connection to the server at "+this._origin.href;this.emit("error",new Error(message))}return this.end(),!this._paused},end:function(chunk){!this.writable||(void 0!==chunk&&this.write(chunk),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var key in instance)Proxy2.prototype[key]=instance[key];module.exports=Proxy2},50712:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var util=__webpack_require__(31669),HttpParser=__webpack_require__(30707),Base=__webpack_require__(53766),Draft75=__webpack_require__(866),Draft76=__webpack_require__(539),Hybi=__webpack_require__(26380),Server=__name(function(options){Base.call(this,null,null,options),this._http=new HttpParser("request")},"Server");util.inherits(Server,Base);var instance={EVENTS:["open","message","error","close"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(chunk){if(this._delegate)return this._delegate.parse(chunk);if(this._http.parse(chunk),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var self2=this;this._delegate=Server.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(event){this._delegate.on(event,function(e){self2.emit(event,e)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new Base.ConnectEvent)}},_open:function(){this.__queue.forEach(function(msg){this._delegate[msg[0]].apply(this._delegate,msg[1])},this),this.__queue=[]}};for(var key in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(method){instance[method]=function(){return this._delegate?this._delegate[method].apply(this._delegate,arguments):(this.__queue.push([method,arguments]),!0)}}),instance)Server.prototype[key]=instance[key];Server.isSecureRequest=function(request){if(request.connection&&void 0!==request.connection.authorized||request.socket&&request.socket.secure)return!0;var headers=request.headers;return!!headers&&("on"===headers.https||"on"===headers["x-forwarded-ssl"]||"https"===headers["x-forwarded-scheme"]||"https"===headers["x-forwarded-proto"])},Server.determineUrl=function(request){return(this.isSecureRequest(request)?"wss:":"ws:")+"//"+request.headers.host+request.url},Server.http=function(request,options){void 0===(options=options||{}).requireMasking&&(options.requireMasking=!0);var headers=request.headers,version=headers["sec-websocket-version"],key2=headers["sec-websocket-key"],key1=headers["sec-websocket-key1"],key22=headers["sec-websocket-key2"],url=this.determineUrl(request);return version||key2?new Hybi(request,url,options):key1||key22?new Draft76(request,url,options):new Draft75(request,url,options)},module.exports=Server},73777:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Buffer2=__webpack_require__(55859).Buffer,StreamReader=__name(function(){this._queue=[],this._queueSize=0,this._offset=0},"StreamReader");StreamReader.prototype.put=function(buffer){!buffer||0===buffer.length||(Buffer2.isBuffer(buffer)||(buffer=Buffer2.from(buffer)),this._queue.push(buffer),this._queueSize+=buffer.length)},StreamReader.prototype.read=function(length){if(length>this._queueSize)return null;if(0===length)return Buffer2.alloc(0);this._queueSize-=length;var buffers,buffer,queue=this._queue,remain=length,first=queue[0];if(first.length>=length)return first.length===length?queue.shift():(buffer=first.slice(0,length),queue[0]=first.slice(length),buffer);for(var i=0,n=queue.length;i<n&&!(remain<queue[i].length);i++)remain-=queue[i].length;return buffers=queue.splice(0,i),remain>0&&queue.length>0&&(buffers.push(queue[0].slice(0,remain)),queue[0]=queue[0].slice(remain)),Buffer2.concat(buffers,length)},StreamReader.prototype.eachByte=function(callback,context){for(var buffer,n,index;this._queue.length>0;){for(n=(buffer=this._queue[0]).length;this._offset<n;)index=this._offset,this._offset+=1,callback.call(context,buffer[index]);this._offset=0,this._queue.shift()}},module.exports=StreamReader},30707:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var NodeHTTPParser=__webpack_require__(59690).m,Buffer2=__webpack_require__(55859).Buffer,TYPES={request:NodeHTTPParser.REQUEST||"request",response:NodeHTTPParser.RESPONSE||"response"},HttpParser=__name(function(type){this._type=type,this._parser=new NodeHTTPParser(TYPES[type]),this._complete=!1,this.headers={};var current=null,self2=this;this._parser.onHeaderField=function(b,start,length){current=b.toString("utf8",start,start+length).toLowerCase()},this._parser.onHeaderValue=function(b,start,length){var value=b.toString("utf8",start,start+length);self2.headers.hasOwnProperty(current)?self2.headers[current]+=", "+value:self2.headers[current]=value},this._parser.onHeadersComplete=this._parser[NodeHTTPParser.kOnHeadersComplete]=function(majorVersion,minorVersion,headers,method,pathname,statusCode){var info=arguments[0];if("object"==typeof info&&(method=info.method,pathname=info.url,statusCode=info.statusCode,headers=info.headers),self2.method="number"==typeof method?HttpParser.METHODS[method]:method,self2.statusCode=statusCode,self2.url=pathname,headers){for(var key,value,i=0,n=headers.length;i<n;i+=2)key=headers[i].toLowerCase(),value=headers[i+1],self2.headers.hasOwnProperty(key)?self2.headers[key]+=", "+value:self2.headers[key]=value;self2._complete=!0}}},"HttpParser");HttpParser.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var VERSION=(process.version||"").match(/[0-9]+/g).map(function(n){return parseInt(n,10)});0===VERSION[0]&&12===VERSION[1]&&(HttpParser.METHODS[16]="REPORT",HttpParser.METHODS[17]="MKACTIVITY",HttpParser.METHODS[18]="CHECKOUT",HttpParser.METHODS[19]="MERGE",HttpParser.METHODS[20]="M-SEARCH",HttpParser.METHODS[21]="NOTIFY",HttpParser.METHODS[22]="SUBSCRIBE",HttpParser.METHODS[23]="UNSUBSCRIBE",HttpParser.METHODS[24]="PATCH",HttpParser.METHODS[25]="PURGE"),HttpParser.prototype.isComplete=function(){return this._complete},HttpParser.prototype.parse=function(chunk){var consumed=this._parser.execute(chunk,0,chunk.length);if("number"!=typeof consumed)return this.error=consumed,void(this._complete=!0);this._complete&&(this.body=consumed<chunk.length?chunk.slice(consumed):Buffer2.alloc(0))},module.exports=HttpParser},10629:(__unused_webpack_module,exports2,__webpack_require__)=>{"use strict";var Stream=__webpack_require__(92413).Stream,util=__webpack_require__(31669),IO=__name(function(driver){this.readable=this.writable=!0,this._paused=!1,this._driver=driver},"IO");util.inherits(IO,Stream),IO.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},IO.prototype.resume=function(){this._paused=!1,this.emit("drain");var messages=this._driver.messages;messages._paused=!1,messages.emit("drain")},IO.prototype.write=function(chunk){return!!this.writable&&(this._driver.parse(chunk),!this._paused)},IO.prototype.end=function(chunk){if(this.writable){void 0!==chunk&&this.write(chunk),this.writable=!1;var messages=this._driver.messages;messages.readable&&(messages.readable=messages.writable=!1,messages.emit("end"))}},IO.prototype.destroy=function(){this.end()};var Messages=__name(function(driver){this.readable=this.writable=!0,this._paused=!1,this._driver=driver},"Messages");util.inherits(Messages,Stream),Messages.prototype.pause=function(){this._driver.io._paused=!0},Messages.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},Messages.prototype.write=function(message){return!!this.writable&&("string"==typeof message?this._driver.text(message):this._driver.binary(message),!this._paused)},Messages.prototype.end=function(message){void 0!==message&&this.write(message)},Messages.prototype.destroy=function(){},exports2.IO=IO,exports2.Messages=Messages},19723:module=>{"use strict";var TOKEN=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,NOTOKEN=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,PARAM=new RegExp(TOKEN.source+"(?:=(?:"+TOKEN.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"])*)"/.source+"))?"),EXT=new RegExp(TOKEN.source+"(?: *; *"+PARAM.source+")*","g"),EXT_LIST=new RegExp("^"+EXT.source+"(?: *, *"+EXT.source+")*$"),NUMBER=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,hasOwnProperty=Object.prototype.hasOwnProperty,Parser={parseHeader:function(header){var offers=new Offers;if(""===header||void 0===header)return offers;if(!EXT_LIST.test(header))throw new SyntaxError("Invalid Sec-WebSocket-Extensions header: "+header);return header.match(EXT).forEach(function(value){var params=value.match(new RegExp(PARAM.source,"g")),name=params.shift(),offer={};params.forEach(function(param){var data,args=param.match(PARAM),key=args[1];data=void 0!==args[2]?args[2]:void 0===args[3]||args[3].replace(/\\/g,""),NUMBER.test(data)&&(data=parseFloat(data)),hasOwnProperty.call(offer,key)?(offer[key]=[].concat(offer[key]),offer[key].push(data)):offer[key]=data},this),offers.push(name,offer)},this),offers},serializeParams:function(name,params){var values=[],print=__name(function(key2,value){value instanceof Array?value.forEach(function(v){print(key2,v)}):!0===value?values.push(key2):"number"==typeof value?values.push(key2+"="+value):NOTOKEN.test(value)?values.push(key2+'="'+value.replace(/"/g,'\\"')+'"'):values.push(key2+"="+value)},"print");for(var key in params)print(key,params[key]);return[name].concat(values).join("; ")}},Offers=__name(function(){this._byName={},this._inOrder=[]},"Offers");Offers.prototype.push=function(name,params){hasOwnProperty.call(this._byName,name)||(this._byName[name]=[]),this._byName[name].push(params),this._inOrder.push({name,params})},Offers.prototype.eachOffer=function(callback,context){for(var list=this._inOrder,i=0,n=list.length;i<n;i++)callback.call(context,list[i].name,list[i].params)},Offers.prototype.byName=function(name){return this._byName[name]||[]},Offers.prototype.toArray=function(){return this._inOrder.slice()},module.exports=Parser},38077:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Functor=__webpack_require__(68028),Pledge=__webpack_require__(31824),Cell=__name(function(tuple){this._ext=tuple[0],this._session=tuple[1],this._functors={incoming:new Functor(this._session,"processIncomingMessage"),outgoing:new Functor(this._session,"processOutgoingMessage")}},"Cell");Cell.prototype.pending=function(direction){var functor=this._functors[direction];functor._stopped||(functor.pending+=1)},Cell.prototype.incoming=function(error,message,callback,context){this._exec("incoming",error,message,callback,context)},Cell.prototype.outgoing=function(error,message,callback,context){this._exec("outgoing",error,message,callback,context)},Cell.prototype.close=function(){return this._closed=this._closed||new Pledge,this._doClose(),this._closed},Cell.prototype._exec=function(direction,error,message,callback,context){this._functors[direction].call(error,message,function(err,msg){err&&(err.message=this._ext.name+": "+err.message),callback.call(context,err,msg),this._doClose()},this)},Cell.prototype._doClose=function(){var fin=this._functors.incoming,fout=this._functors.outgoing;!this._closed||fin.pending+fout.pending!==0||(this._session&&this._session.close(),this._session=null,this._closed.done())},module.exports=Cell},68028:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var RingBuffer=__webpack_require__(29500),Functor=__name(function(session,method){this._session=session,this._method=method,this._queue=new RingBuffer(Functor.QUEUE_SIZE),this._stopped=!1,this.pending=0},"Functor");Functor.QUEUE_SIZE=8,Functor.prototype.call=function(error,message,callback,context){if(!this._stopped){var record={error,message,callback,context,done:!1},called=!1,self2=this;if(this._queue.push(record),record.error)return record.done=!0,this._stop(),this._flushQueue();var handler=__name(function(err,msg){!(called^(called=!0))||(err?(self2._stop(),record.error=err,record.message=null):record.message=msg,record.done=!0,self2._flushQueue())},"handler");try{this._session[this._method](message,handler)}catch(err){handler(err)}}},Functor.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},Functor.prototype._flushQueue=function(){for(var record,queue=this._queue;queue.length>0&&queue.peek().done;)(record=queue.shift()).error?(this.pending=0,queue.clear()):this.pending-=1,record.callback.call(record.context,record.error,record.message)},module.exports=Functor},6169:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Cell=__webpack_require__(38077),Pledge=__webpack_require__(31824),Pipeline=__name(function(sessions){this._cells=sessions.map(function(session){return new Cell(session)}),this._stopped={incoming:!1,outgoing:!1}},"Pipeline");Pipeline.prototype.processIncomingMessage=function(message,callback,context){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,message,callback,context)},Pipeline.prototype.processOutgoingMessage=function(message,callback,context){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,message,callback,context)},Pipeline.prototype.close=function(callback,context){this._stopped={incoming:!0,outgoing:!0};var closed=this._cells.map(function(a){return a.close()});callback&&Pledge.all(closed).then(function(){callback.call(context)})},Pipeline.prototype._loop=function(direction,start,end,step,message,callback,context){for(var cells=this._cells,n=cells.length,self2=this;n--;)cells[n].pending(direction);var pipe=__name(function(index,error,msg){if(index===end)return callback.call(context,error,msg);cells[index][direction](error,msg,function(err,m){err&&(self2._stopped[direction]=!0),pipe(index+step,err,m)})},"pipe");pipe(start,null,message)},module.exports=Pipeline},31824:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var RingBuffer=__webpack_require__(29500),Pledge=__name(function(){this._complete=!1,this._callbacks=new RingBuffer(Pledge.QUEUE_SIZE)},"Pledge");Pledge.QUEUE_SIZE=4,Pledge.all=function(list){var pledge=new Pledge,pending=list.length,n=pending;for(0===pending&&pledge.done();n--;)list[n].then(function(){0===(pending-=1)&&pledge.done()});return pledge},Pledge.prototype.then=function(callback){this._complete?callback():this._callbacks.push(callback)},Pledge.prototype.done=function(){this._complete=!0;for(var callback,callbacks=this._callbacks;callback=callbacks.shift();)callback()},module.exports=Pledge},29500:module=>{"use strict";var RingBuffer=__name(function(bufferSize){this._bufferSize=bufferSize,this.clear()},"RingBuffer");RingBuffer.prototype.clear=function(){this._buffer=new Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},RingBuffer.prototype.push=function(value){var expandBuffer=!1,expandRing=!1;this._ringSize<this._bufferSize?expandBuffer=0===this._tail:this._ringOffset===this._ringSize&&(expandBuffer=!0,expandRing=0===this._tail),expandBuffer&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(new Array(this._bufferSize)),this._bufferSize=this._buffer.length,expandRing&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=value,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},RingBuffer.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},RingBuffer.prototype.shift=function(){if(0!==this.length){var value=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,value}},module.exports=RingBuffer},62422:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Parser=__webpack_require__(19723),Pipeline=__webpack_require__(6169),Extensions=__name(function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}},"Extensions");Extensions.MESSAGE_OPCODES=[1,2];var instance={add:function(ext){if("string"!=typeof ext.name)throw new TypeError("extension.name must be a string");if("permessage"!==ext.type)throw new TypeError('extension.type must be "permessage"');if("boolean"!=typeof ext.rsv1)throw new TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof ext.rsv2)throw new TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof ext.rsv3)throw new TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(ext.name))throw new TypeError('An extension with name "'+ext.name+'" is already registered');this._byName[ext.name]=ext,this._inOrder.push(ext)},generateOffer:function(){var sessions=[],offer=[],index={};return this._inOrder.forEach(function(ext){var session=ext.createClientSession();if(session){var record=[ext,session];sessions.push(record),index[ext.name]=record;var offers=session.generateOffer();(offers=offers?[].concat(offers):[]).forEach(function(off){offer.push(Parser.serializeParams(ext.name,off))},this)}},this),this._sessions=sessions,this._index=index,offer.length>0?offer.join(", "):null},activate:function(header){var responses=Parser.parseHeader(header),sessions=[];responses.eachOffer(function(name,params){var record=this._index[name];if(!record)throw new Error('Server sent an extension response for unknown extension "'+name+'"');var ext=record[0],session=record[1],reserved=this._reserved(ext);if(reserved)throw new Error("Server sent two extension responses that use the RSV"+reserved[0]+' bit: "'+reserved[1]+'" and "'+ext.name+'"');if(!0!==session.activate(params))throw new Error("Server sent unacceptable extension parameters: "+Parser.serializeParams(name,params));this._reserve(ext),sessions.push(record)},this),this._sessions=sessions,this._pipeline=new Pipeline(sessions)},generateResponse:function(header){var sessions=[],response=[],offers=Parser.parseHeader(header);return this._inOrder.forEach(function(ext){var offer=offers.byName(ext.name);if(0!==offer.length&&!this._reserved(ext)){var session=ext.createServerSession(offer);!session||(this._reserve(ext),sessions.push([ext,session]),response.push(Parser.serializeParams(ext.name,session.generateResponse())))}},this),this._sessions=sessions,this._pipeline=new Pipeline(sessions),response.length>0?response.join(", "):null},validFrameRsv:function(frame){var ext,allowed={rsv1:!1,rsv2:!1,rsv3:!1};if(Extensions.MESSAGE_OPCODES.indexOf(frame.opcode)>=0)for(var i=0,n=this._sessions.length;i<n;i++)ext=this._sessions[i][0],allowed.rsv1=allowed.rsv1||ext.rsv1,allowed.rsv2=allowed.rsv2||ext.rsv2,allowed.rsv3=allowed.rsv3||ext.rsv3;return(allowed.rsv1||!frame.rsv1)&&(allowed.rsv2||!frame.rsv2)&&(allowed.rsv3||!frame.rsv3)},processIncomingMessage:function(message,callback,context){this._pipeline.processIncomingMessage(message,callback,context)},processOutgoingMessage:function(message,callback,context){this._pipeline.processOutgoingMessage(message,callback,context)},close:function(callback,context){if(!this._pipeline)return callback.call(context);this._pipeline.close(callback,context)},_reserve:function(ext){this._rsv1=this._rsv1||ext.rsv1&&ext.name,this._rsv2=this._rsv2||ext.rsv2&&ext.name,this._rsv3=this._rsv3||ext.rsv3&&ext.name},_reserved:function(ext){return this._rsv1&&ext.rsv1?[1,this._rsv1]:this._rsv2&&ext.rsv2?[2,this._rsv2]:!(!this._rsv3||!ext.rsv3)&&[3,this._rsv3]}};for(var key in instance)Extensions.prototype[key]=instance[key];module.exports=Extensions},7924:(__unused_webpack_module,exports2,__webpack_require__)=>{var Url=__webpack_require__(78835),spawn=__webpack_require__(67004).spawn,fs=__webpack_require__(35747);exports2.XMLHttpRequest=function(){"use strict";var request,response,self2=this,http=__webpack_require__(98605),https=__webpack_require__(57211),settings={},disableHeaderCheck=!1,defaultHeaders={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},headers={},headersCase={},forbiddenRequestHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],forbiddenRequestMethods=["TRACE","TRACK","CONNECT"],sendFlag=!1,errorFlag=!1,listeners={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.status=null,this.statusText=null,this.withCredentials=!1;var isAllowedHttpHeader=__name(function(header){return disableHeaderCheck||header&&-1===forbiddenRequestHeaders.indexOf(header.toLowerCase())},"isAllowedHttpHeader"),isAllowedHttpMethod=__name(function(method){return method&&-1===forbiddenRequestMethods.indexOf(method)},"isAllowedHttpMethod");this.open=function(method,url,async,user,password){if(this.abort(),errorFlag=!1,!isAllowedHttpMethod(method))throw new Error("SecurityError: Request method not allowed");settings={method,url:url.toString(),async:"boolean"!=typeof async||async,user:user||null,password:password||null},setState(this.OPENED)},this.setDisableHeaderCheck=function(state){disableHeaderCheck=state},this.setRequestHeader=function(header,value){if(this.readyState!==this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(isAllowedHttpHeader(header)){if(sendFlag)throw new Error("INVALID_STATE_ERR: send flag is true");header=headersCase[header.toLowerCase()]||header,headersCase[header.toLowerCase()]=header,headers[header]=headers[header]?headers[header]+", "+value:value}else console.warn('Refused to set unsafe header "'+header+'"')},this.getResponseHeader=function(header){return"string"==typeof header&&this.readyState>this.OPENED&&response&&response.headers&&response.headers[header.toLowerCase()]&&!errorFlag?response.headers[header.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||errorFlag)return"";var result="";for(var i in response.headers)"set-cookie"!==i&&"set-cookie2"!==i&&(result+=i+": "+response.headers[i]+"\r\n");return result.substr(0,result.length-2)},this.getRequestHeader=function(name){return"string"==typeof name&&headersCase[name.toLowerCase()]?headers[headersCase[name.toLowerCase()]]:""},this.send=function(data){if(this.readyState!==this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(sendFlag)throw new Error("INVALID_STATE_ERR: send has already been called");var host,ssl=!1,local=!1,url=Url.parse(settings.url);switch(url.protocol){case"https:":ssl=!0;case"http:":host=url.hostname;break;case"file:":local=!0;break;case void 0:case null:case"":host="localhost";break;default:throw new Error("Protocol not supported.")}if(local){if("GET"!==settings.method)throw new Error("XMLHttpRequest: Only GET method is supported");if(settings.async)fs.readFile(url.pathname,"utf8",function(error,data2){error?self2.handleError(error):(self2.status=200,self2.responseText=data2,setState(self2.DONE))});else try{this.responseText=fs.readFileSync(url.pathname,"utf8"),this.status=200,setState(self2.DONE)}catch(e){this.handleError(e)}}else{var port=url.port||(ssl?443:80),uri=url.pathname+(url.search?url.search:"");for(var name in defaultHeaders)headersCase[name.toLowerCase()]||(headers[name]=defaultHeaders[name]);if(headers.Host=host,ssl&&443===port||80===port||(headers.Host+=":"+url.port),settings.user){void 0===settings.password&&(settings.password="");var authBuf=new Buffer(settings.user+":"+settings.password);headers.Authorization="Basic "+authBuf.toString("base64")}"GET"===settings.method||"HEAD"===settings.method?data=null:data?(headers["Content-Length"]=Buffer.isBuffer(data)?data.length:Buffer.byteLength(data),headers["Content-Type"]||(headers["Content-Type"]="text/plain;charset=UTF-8")):"POST"===settings.method&&(headers["Content-Length"]=0);var options={host,port,path:uri,method:settings.method,headers,agent:!1,withCredentials:self2.withCredentials};if(errorFlag=!1,settings.async){var doRequest=ssl?https.request:http.request;sendFlag=!0,self2.dispatchEvent("readystatechange");var responseHandler=__name(function responseHandler2(resp2){if(301!==(response=resp2).statusCode&&302!==response.statusCode&&303!==response.statusCode&&307!==response.statusCode)response.setEncoding("utf8"),setState(self2.HEADERS_RECEIVED),self2.status=response.statusCode,response.on("data",function(chunk){chunk&&(self2.responseText+=chunk),sendFlag&&setState(self2.LOADING)}),response.on("end",function(){sendFlag&&(setState(self2.DONE),sendFlag=!1)}),response.on("error",function(error){self2.handleError(error)});else{settings.url=response.headers.location;var url2=Url.parse(settings.url);host=url2.hostname;var newOptions={hostname:url2.hostname,port:url2.port,path:url2.path,method:303===response.statusCode?"GET":settings.method,headers,withCredentials:self2.withCredentials};(request=doRequest(newOptions,responseHandler2).on("error",errorHandler)).end()}},"responseHandler"),errorHandler=__name(function(error){self2.handleError(error)},"errorHandler");request=doRequest(options,responseHandler).on("error",errorHandler),data&&request.write(data),request.end(),self2.dispatchEvent("loadstart")}else{var contentFile=".node-xmlhttprequest-content-"+process.pid,syncFile=".node-xmlhttprequest-sync-"+process.pid;fs.writeFileSync(syncFile,"","utf8");for(var execString="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(ssl?"s":"")+".request;var options = "+JSON.stringify(options)+";var responseText = '';var req = doRequest(options, function(response) {response.setEncoding('utf8');response.on('data', function(chunk) {  responseText += chunk;});response.on('end', function() {fs.writeFileSync('"+contentFile+"', JSON.stringify({err: null, data: {statusCode: response.statusCode, headers: response.headers, text: responseText}}), 'utf8');fs.unlinkSync('"+syncFile+"');});response.on('error', function(error) {fs.writeFileSync('"+contentFile+"', JSON.stringify({err: error}), 'utf8');fs.unlinkSync('"+syncFile+"');});}).on('error', function(error) {fs.writeFileSync('"+contentFile+"', JSON.stringify({err: error}), 'utf8');fs.unlinkSync('"+syncFile+"');});"+(data?"req.write('"+JSON.stringify(data).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",syncProc=spawn(process.argv[0],["-e",execString]);fs.existsSync(syncFile););var resp=JSON.parse(fs.readFileSync(contentFile,"utf8"));syncProc.stdin.end(),fs.unlinkSync(contentFile),resp.err?self2.handleError(resp.err):(response=resp.data,self2.status=resp.data.statusCode,self2.responseText=resp.data.text,setState(self2.DONE))}}},this.handleError=function(error){this.status=0,this.statusText=error,this.responseText=error.stack,errorFlag=!0,setState(this.DONE),this.dispatchEvent("error")},this.abort=function(){request&&(request.abort(),request=null),headers=defaultHeaders,this.status=0,this.responseText="",this.responseXML="",errorFlag=!0,this.readyState!==this.UNSENT&&(this.readyState!==this.OPENED||sendFlag)&&this.readyState!==this.DONE&&(sendFlag=!1,setState(this.DONE)),this.readyState=this.UNSENT,this.dispatchEvent("abort")},this.addEventListener=function(event,callback){event in listeners||(listeners[event]=[]),listeners[event].push(callback)},this.removeEventListener=function(event,callback){event in listeners&&(listeners[event]=listeners[event].filter(function(ev){return ev!==callback}))},this.dispatchEvent=function(event){if("function"==typeof self2["on"+event]&&self2["on"+event](),event in listeners)for(var i=0,len=listeners[event].length;i<len;i++)listeners[event][i].call(self2)};var setState=__name(function(state){(state==self2.LOADING||self2.readyState!==state)&&(self2.readyState=state,(settings.async||self2.readyState<self2.OPENED||self2.readyState===self2.DONE)&&self2.dispatchEvent("readystatechange"),self2.readyState===self2.DONE&&!errorFlag&&(self2.dispatchEvent("load"),self2.dispatchEvent("loadend")))},"setState")}}};